{"slug":"haroin57-com","name":"haroin57.com","description":"Personal portfolio website built with React and TypeScript","language":"TypeScript","tags":["React","Vite","Tailwind CSS","Cloudflare Pages"],"url":"https://github.com/haroin57/haroin57.com","demo":"https://haroin57.com","createdAt":"2025-12-19T13:03:33.664Z","updatedAt":"2025-12-19T13:03:33.664Z","markdown":"---\ntitle: \"haroin57.com - ポートフォリオサイトの技術解説\"\nsummary: \"React 19とViteで構築したポートフォリオサイトの実装について\"\ndate: \"2025-12-18\"\nproduct: \"haroin57-com\"\ntags:\n- React\n- TypeScript\n- Vite\n- Cloudflare\n---\n\n## 目次\n\n<br />\n\n## はじめに\n\nこのサイト（haroin57.com）自体がProductsの1つです。React 19とViteを使って構築し、Cloudflare Pagesにデプロイしています。\n\nパフォーマンスとユーザー体験を重視して設計しました。モダンなReactの機能をフル活用しつつ、Web Vitals（特にINP）の最適化に注力しています。\n\n<br />\n\n## 技術スタック\n\n<br />\n\n### フロントエンド\n\n| 技術 | 説明 |\n|------|------|\n| **React 19** | 最新のReact。React Compilerによる自動最適化を有効化 |\n| **TypeScript** | 型安全な開発。strict modeで運用 |\n| **Tailwind CSS v4** | ユーティリティファーストなスタイリング |\n| **React Router v7** | クライアントサイドルーティング |\n\n<br />\n\n### ビルドツール\n\n| 技術 | 説明 |\n|------|------|\n| **Vite 7** | 高速な開発サーバーとビルド |\n| **Rolldown** | ESBuildの代替。Rustベースでさらなる高速化 |\n| **React Compiler** | useMemo/useCallbackの自動挿入 |\n\n<br />\n\n### デプロイ・インフラ\n\n| 技術 | 説明 |\n|------|------|\n| **Cloudflare Pages** | グローバルCDNによる高速配信 |\n| **Cloudflare Workers** | アクセスカウンターのバックエンド |\n| **Cloudflare KV** | いいね数などの永続化ストレージ |\n\n<br />\n\n## アーキテクチャ\n\n```mermaid\nflowchart TB\n    subgraph Edge[\"Cloudflare Edge\"]\n        Pages[\"Pages<br/>(静的配信)\"]\n        Workers[\"Workers<br/>(API処理)\"]\n        KV[\"KV<br/>(データ保存)\"]\n    end\n\n    subgraph Client[\"React SPA (Client)\"]\n        Router[\"Router<br/>(React Router v7)\"]\n        PageComponents[\"Pages<br/>(Home, Posts, Products)\"]\n        Components[\"Components<br/>(UI部品)\"]\n    end\n\n    Pages --> Router\n    Router --> PageComponents\n    PageComponents --> Components\n    PageComponents <--> Workers\n    Workers <--> KV\n\n    style Pages fill:#f97316,stroke:#fdba74,stroke-width:2px,color:#fff\n    style Router fill:#134e4a,stroke:#5eead4,stroke-width:2px\n    style KV fill:#3b2f4a,stroke:#a78bfa,stroke-width:2px\n```\n\n<br />\n\n## 主な機能と実装詳細\n\n<br />\n\n### 1. ページ遷移アニメーション\n\n`react-transition-group` の `CSSTransition` を使用してページ間の遷移をスムーズにしています。\n\n```tsx\nimport { CSSTransition, TransitionGroup } from 'react-transition-group'\n\n<TransitionGroup component={null}>\n  <CSSTransition\n    key={location.pathname}\n    classNames=\"page-transition\"\n    timeout={300}\n  >\n    <Routes location={location}>\n      {/* ルート定義 */}\n    </Routes>\n  </CSSTransition>\n</TransitionGroup>\n```\n\nCSSでは以下のようにアニメーションを定義：\n\n```css\n.page-transition-enter {\n  opacity: 0;\n  transform: translateY(10px);\n}\n.page-transition-enter-active {\n  opacity: 1;\n  transform: translateY(0);\n  transition: opacity 300ms, transform 300ms;\n}\n.page-transition-exit {\n  opacity: 1;\n}\n.page-transition-exit-active {\n  opacity: 0;\n  transition: opacity 200ms;\n}\n```\n\n<br />\n\n### 2. INP（Interaction to Next Paint）最適化\n\nユーザーインタラクションの応答性を向上させるため、複数の最適化を実施しています。\n\n<br />\n\n#### startTransitionによる優先度制御\n\n状態更新の優先度を制御し、UIのブロッキングを防止：\n\n```tsx\nimport { startTransition } from 'react'\n\nconst handleTagSelect = (tag: string) => {\n  startTransition(() => {\n    // 低優先度の状態更新\n    setSearchParams(nextParams)\n  })\n}\n```\n\n<br />\n\n#### content-visibilityによる遅延レンダリング\n\nオフスクリーンのコンテンツをレンダリングスキップ：\n\n```css\n.post-content {\n  content-visibility: auto;\n  contain-intrinsic-size: 0 500px;\n}\n```\n\n<br />\n\n#### React.lazyによる動的インポート\n\n重いコンポーネントを必要時にのみ読み込み：\n\n```tsx\nconst PostDetail = lazy(() => import('./routes/PostDetail'))\nconst ProductDetail = lazy(() => import('./routes/ProductDetail'))\n```\n\n<br />\n\n### 3. Markdownブログシステム\n\n`remark` / `rehype` エコシステムを使用してMarkdownをHTMLに変換しています。\n\n<br />\n\n#### 使用プラグイン\n\n| プラグイン | 用途 |\n|-----------|------|\n| **remark-gfm** | GitHub Flavored Markdown（テーブル、タスクリストなど） |\n| **remark-math** | 数式記法のパース |\n| **rehype-katex** | KaTeXによる数式レンダリング |\n| **rehype-pretty-code** | shikiによるシンタックスハイライト |\n| **remark-toc** | 目次の自動生成 |\n\n<br />\n\n#### ビルド時処理フロー\n\n```mermaid\nflowchart LR\n    MD[\".md files<br/>(content/)\"] --> Matter[\"gray-matter<br/>(frontmatter)\"]\n    Matter --> Remark[\"remark<br/>(parse MD)\"]\n    Remark --> Rehype[\"rehype<br/>(HTML変換)\"]\n    Rehype --> JSON[\"posts.json<br/>(出力)\"]\n\n    style MD fill:#1e3a5f,stroke:#60a5fa,stroke-width:2px\n    style JSON fill:#134e4a,stroke:#5eead4,stroke-width:2px\n```\n\n<br />\n\n#### 数式レンダリング例\n\n```markdown\n$$\nE = mc^2\n$$\n```\n\nのような記法で数式が書けます。実際の表示例:\n\n$$\nE = mc^2\n$$\n\nインライン数式も対応しています：$f(x) = ax^2 + bx + c$\n\n<br />\n\n### 4. スクロール連動背景エフェクト\n\n投稿詳細ページでは、スクロールに応じて背景にブラーエフェクトを適用しています。\n\n```tsx\nuseEffect(() => {\n  const startPx = 48\n  const rangePx = 420\n  const maxBlurPx = 5\n\n  const update = () => {\n    const y = window.scrollY || 0\n    const t = Math.max(0, Math.min(1, (y - startPx) / rangePx))\n    const blur = t * maxBlurPx\n\n    document.body.style.setProperty('--bg-blur', `${blur}px`)\n  }\n\n  const onScroll = () => {\n    requestAnimationFrame(update)\n  }\n\n  window.addEventListener('scroll', onScroll, { passive: true })\n  return () => window.removeEventListener('scroll', onScroll)\n}, [])\n```\n\n<br />\n\n### 5. Adobe Fontsの最適化\n\nAdobe Fontsを使用していますが、ロード時間を最小化するために以下を実施：\n\n- **dns-prefetch / preconnect** でDNS解決を事前に実行\n- フォント読み込み前はシステムフォントにフォールバック\n- **font-display: swap** で表示のブロッキングを回避\n\n```html\n<link rel=\"preconnect\" href=\"https://use.typekit.net\" crossorigin />\n<link rel=\"dns-prefetch\" href=\"https://use.typekit.net\" />\n```\n\n<br />\n\n## パフォーマンス最適化\n\n<br />\n\n### Cloudflare Edge Caching\n\n| リソース | キャッシュ戦略 |\n|---------|---------------|\n| 静的アセット（JS/CSS/画像） | 長期キャッシュ（1年）+ immutable |\n| HTML | 短いTTL（5分）で鮮度維持 |\n| API レスポンス | KVによる永続化 |\n\n<br />\n\n### 画像最適化\n\n- **WebP形式**を採用（JPEG比30-40%軽量化）\n- `loading=\"lazy\"` で遅延読み込み\n- 適切なサイズの画像を提供（srcset未使用だが検討中）\n\n<br />\n\n### バンドルサイズ削減\n\n| 手法 | 効果 |\n|------|------|\n| Tree Shaking | 未使用コードの除去 |\n| Code Splitting | ルートベースの分割 |\n| Dynamic Import | 必要時のみロード |\n\n<br />\n\n## 開発体験\n\n<br />\n\n### HMR（Hot Module Replacement）\n\nVite + Rolldownにより、ファイル変更から画面反映まで**50ms以下**を実現。\n\n<br />\n\n### 型安全性\n\nTypeScript strict modeに加え、以下で型安全性を強化：\n\n- eslint-plugin-react-compiler による React Compiler互換性チェック\n- 明示的な型アノテーション必須化\n\n<br />\n\n## 今後の改善予定\n\n- [ ] 記事の検索機能追加\n- [ ] ダークモード/ライトモードの切り替えボタン\n- [ ] 記事の目次をサイドバーに表示\n- [ ] コードブロックのファイル名表示\n- [ ] 関連記事の表示\n\n<br />\n\n## まとめ\n\nモダンなReactの機能を活用しつつ、パフォーマンスにも気を配ったサイトを構築できました。\n\n特にReact 19 + React Compilerの組み合わせは、手動でのメモ化を不要にし、開発体験を大幅に向上させてくれます。Vite + Rolldownによるビルドも高速で、開発イテレーションが非常にスムーズです。\n\n<br />\n\nソースコードはGitHubで公開しています: [haroin57/haroin57.com](https://github.com/haroin57/haroin57.com)\n","html":""}