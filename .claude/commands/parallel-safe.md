# 並列エージェント操作ガイド

このスキルは複数のエージェント（Task tool）を並列実行する際のファイル競合を防ぐためのベストプラクティスを提供します。

## 基本原則

### 1. ファイル分割戦略（最重要）
並列タスクを起動する前に、各エージェントが担当するファイルを**明確に分離**してください：

```
❌ 悪い例：
- Agent A: src/components/Button.tsx を編集
- Agent B: src/components/Button.tsx を編集（競合！）

✅ 良い例：
- Agent A: src/components/Button.tsx を編集
- Agent B: src/components/Card.tsx を編集（分離されている）
```

### 2. タスク分割のパターン

#### パターン A: ファイル単位で分割
```
タスク: 全コンポーネントにTypeScript型を追加

Agent 1: src/components/Header.tsx, Navigation.tsx
Agent 2: src/components/Footer.tsx, Sidebar.tsx
Agent 3: src/components/Card.tsx, Button.tsx
```

#### パターン B: 機能/レイヤー単位で分割
```
タスク: 認証機能の実装

Agent 1: バックエンド（src/api/auth.ts, src/services/）
Agent 2: フロントエンド（src/pages/login/, src/components/auth/）
Agent 3: テスト（src/__tests__/auth/）
```

#### パターン C: 読み取り専用タスクは並列OK
```
✅ 並列実行可能：
- Agent 1: コードベースを調査してレポート作成
- Agent 2: 別のディレクトリを調査してレポート作成
- Agent 3: ドキュメントを読んで要約
```

### 3. 共有ファイルの扱い

複数エージェントが同じファイルを変更する必要がある場合：

#### 方法1: 順次実行に切り替える
```
1. まず Agent A を完了させる
2. 完了後、Agent B を開始する
```

#### 方法2: 変更を集約する親エージェントを使う
```
親タスク: 各サブエージェントから提案を収集し、1つのファイルにまとめて適用

- Sub-Agent 1: Button.tsxへの変更案を提案（編集しない）
- Sub-Agent 2: Button.tsxへの別の変更案を提案（編集しない）
- 親エージェント: 両方の提案を統合してButton.tsxを編集
```

#### 方法3: ファイルのセクションを分ける
```
例：index.ts の export 文を追加する場合

- Agent A: // Section A の下に追加
- Agent B: // Section B の下に追加
```

## 実践的なプロンプト例

### 安全な並列タスク起動
```
以下の3つのタスクを並列で実行してください：

1. src/components/Header/ 内のファイルのみを対象に、アクセシビリティを改善
2. src/components/Footer/ 内のファイルのみを対象に、アクセシビリティを改善
3. src/components/Sidebar/ 内のファイルのみを対象に、アクセシビリティを改善

重要：各タスクは指定されたディレクトリ内のファイルのみを編集すること
```

### 調査タスクの並列実行
```
以下の調査タスクを並列で実行してください（ファイル編集なし）：

1. 認証フローを調査し、改善点をリストアップ
2. パフォーマンスボトルネックを特定
3. セキュリティ上の懸念点を洗い出す

各タスクは調査結果のみを報告し、コードの変更は行わないこと
```

### 設定ファイルの扱い
```
package.json, tsconfig.json などの設定ファイルは
複数エージェントが同時に編集しないよう、
メインエージェントのみが編集するか、
全サブタスク完了後にまとめて編集してください
```

## 競合が発生した場合

1. エラーメッセージを確認
2. 競合したファイルを特定
3. 一方のエージェントの変更を手動でマージ
4. 必要に応じて再実行

## チェックリスト

並列タスクを起動する前に確認：

- [ ] 各エージェントの担当ファイルは重複していないか
- [ ] 共有の設定ファイル（package.json等）を複数が編集しないか
- [ ] 読み取り専用タスクと編集タスクを適切に分離したか
- [ ] 依存関係のあるタスクは順次実行にしたか
