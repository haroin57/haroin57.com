<!DOCTYPE html><html><head>
      <title>README</title>
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      
      <link rel="stylesheet" href="file:///c:\Users\harut\.vscode\extensions\shd101wyy.markdown-preview-enhanced-0.8.20\crossnote\dependencies\katex\katex.min.css">
      
      
      
      
      
      <style>
      code[class*=language-],pre[class*=language-]{color:#333;background:0 0;font-family:Consolas,"Liberation Mono",Menlo,Courier,monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.4;-moz-tab-size:8;-o-tab-size:8;tab-size:8;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none}pre[class*=language-]{padding:.8em;overflow:auto;border-radius:3px;background:#f5f5f5}:not(pre)>code[class*=language-]{padding:.1em;border-radius:.3em;white-space:normal;background:#f5f5f5}.token.blockquote,.token.comment{color:#969896}.token.cdata{color:#183691}.token.doctype,.token.macro.property,.token.punctuation,.token.variable{color:#333}.token.builtin,.token.important,.token.keyword,.token.operator,.token.rule{color:#a71d5d}.token.attr-value,.token.regex,.token.string,.token.url{color:#183691}.token.atrule,.token.boolean,.token.code,.token.command,.token.constant,.token.entity,.token.number,.token.property,.token.symbol{color:#0086b3}.token.prolog,.token.selector,.token.tag{color:#63a35c}.token.attr-name,.token.class,.token.class-name,.token.function,.token.id,.token.namespace,.token.pseudo-class,.token.pseudo-element,.token.url-reference .token.variable{color:#795da3}.token.entity{cursor:help}.token.title,.token.title .token.punctuation{font-weight:700;color:#1d3e81}.token.list{color:#ed6a43}.token.inserted{background-color:#eaffea;color:#55a532}.token.deleted{background-color:#ffecec;color:#bd2c00}.token.bold{font-weight:700}.token.italic{font-style:italic}.language-json .token.property{color:#183691}.language-markup .token.tag .token.punctuation{color:#333}.language-css .token.function,code.language-css{color:#0086b3}.language-yaml .token.atrule{color:#63a35c}code.language-yaml{color:#183691}.language-ruby .token.function{color:#333}.language-markdown .token.url{color:#795da3}.language-makefile .token.symbol{color:#795da3}.language-makefile .token.variable{color:#183691}.language-makefile .token.builtin{color:#0086b3}.language-bash .token.keyword{color:#0086b3}pre[data-line]{position:relative;padding:1em 0 1em 3em}pre[data-line] .line-highlight-wrapper{position:absolute;top:0;left:0;background-color:transparent;display:block;width:100%}pre[data-line] .line-highlight{position:absolute;left:0;right:0;padding:inherit 0;margin-top:1em;background:hsla(24,20%,50%,.08);background:linear-gradient(to right,hsla(24,20%,50%,.1) 70%,hsla(24,20%,50%,0));pointer-events:none;line-height:inherit;white-space:pre}pre[data-line] .line-highlight:before,pre[data-line] .line-highlight[data-end]:after{content:attr(data-start);position:absolute;top:.4em;left:.6em;min-width:1em;padding:0 .5em;background-color:hsla(24,20%,50%,.4);color:#f4f1ef;font:bold 65%/1.5 sans-serif;text-align:center;vertical-align:.3em;border-radius:999px;text-shadow:none;box-shadow:0 1px #fff}pre[data-line] .line-highlight[data-end]:after{content:attr(data-end);top:auto;bottom:.4em}html body{font-family:'Helvetica Neue',Helvetica,'Segoe UI',Arial,freesans,sans-serif;font-size:16px;line-height:1.6;color:#333;background-color:#fff;overflow:initial;box-sizing:border-box;word-wrap:break-word}html body>:first-child{margin-top:0}html body h1,html body h2,html body h3,html body h4,html body h5,html body h6{line-height:1.2;margin-top:1em;margin-bottom:16px;color:#000}html body h1{font-size:2.25em;font-weight:300;padding-bottom:.3em}html body h2{font-size:1.75em;font-weight:400;padding-bottom:.3em}html body h3{font-size:1.5em;font-weight:500}html body h4{font-size:1.25em;font-weight:600}html body h5{font-size:1.1em;font-weight:600}html body h6{font-size:1em;font-weight:600}html body h1,html body h2,html body h3,html body h4,html body h5{font-weight:600}html body h5{font-size:1em}html body h6{color:#5c5c5c}html body strong{color:#000}html body del{color:#5c5c5c}html body a:not([href]){color:inherit;text-decoration:none}html body a{color:#08c;text-decoration:none}html body a:hover{color:#00a3f5;text-decoration:none}html body img{max-width:100%}html body>p{margin-top:0;margin-bottom:16px;word-wrap:break-word}html body>ol,html body>ul{margin-bottom:16px}html body ol,html body ul{padding-left:2em}html body ol.no-list,html body ul.no-list{padding:0;list-style-type:none}html body ol ol,html body ol ul,html body ul ol,html body ul ul{margin-top:0;margin-bottom:0}html body li{margin-bottom:0}html body li.task-list-item{list-style:none}html body li>p{margin-top:0;margin-bottom:0}html body .task-list-item-checkbox{margin:0 .2em .25em -1.8em;vertical-align:middle}html body .task-list-item-checkbox:hover{cursor:pointer}html body blockquote{margin:16px 0;font-size:inherit;padding:0 15px;color:#5c5c5c;background-color:#f0f0f0;border-left:4px solid #d6d6d6}html body blockquote>:first-child{margin-top:0}html body blockquote>:last-child{margin-bottom:0}html body hr{height:4px;margin:32px 0;background-color:#d6d6d6;border:0 none}html body table{margin:10px 0 15px 0;border-collapse:collapse;border-spacing:0;display:block;width:100%;overflow:auto;word-break:normal;word-break:keep-all}html body table th{font-weight:700;color:#000}html body table td,html body table th{border:1px solid #d6d6d6;padding:6px 13px}html body dl{padding:0}html body dl dt{padding:0;margin-top:16px;font-size:1em;font-style:italic;font-weight:700}html body dl dd{padding:0 16px;margin-bottom:16px}html body code{font-family:Menlo,Monaco,Consolas,'Courier New',monospace;font-size:.85em;color:#000;background-color:#f0f0f0;border-radius:3px;padding:.2em 0}html body code::after,html body code::before{letter-spacing:-.2em;content:'\00a0'}html body pre>code{padding:0;margin:0;word-break:normal;white-space:pre;background:0 0;border:0}html body .highlight{margin-bottom:16px}html body .highlight pre,html body pre{padding:1em;overflow:auto;line-height:1.45;border:#d6d6d6;border-radius:3px}html body .highlight pre{margin-bottom:0;word-break:normal}html body pre code,html body pre tt{display:inline;max-width:initial;padding:0;margin:0;overflow:initial;line-height:inherit;word-wrap:normal;background-color:transparent;border:0}html body pre code:after,html body pre code:before,html body pre tt:after,html body pre tt:before{content:normal}html body blockquote,html body dl,html body ol,html body p,html body pre,html body ul{margin-top:0;margin-bottom:16px}html body kbd{color:#000;border:1px solid #d6d6d6;border-bottom:2px solid #c7c7c7;padding:2px 4px;background-color:#f0f0f0;border-radius:3px}@media print{html body{background-color:#fff}html body h1,html body h2,html body h3,html body h4,html body h5,html body h6{color:#000;page-break-after:avoid}html body blockquote{color:#5c5c5c}html body pre{page-break-inside:avoid}html body table{display:table}html body img{display:block;max-width:100%;max-height:100%}html body code,html body pre{word-wrap:break-word;white-space:pre}}.markdown-preview{width:100%;height:100%;box-sizing:border-box}.markdown-preview ul{list-style:disc}.markdown-preview ul ul{list-style:circle}.markdown-preview ul ul ul{list-style:square}.markdown-preview ol{list-style:decimal}.markdown-preview ol ol,.markdown-preview ul ol{list-style-type:lower-roman}.markdown-preview ol ol ol,.markdown-preview ol ul ol,.markdown-preview ul ol ol,.markdown-preview ul ul ol{list-style-type:lower-alpha}.markdown-preview .newpage,.markdown-preview .pagebreak{page-break-before:always}.markdown-preview pre.line-numbers{position:relative;padding-left:3.8em;counter-reset:linenumber}.markdown-preview pre.line-numbers>code{position:relative}.markdown-preview pre.line-numbers .line-numbers-rows{position:absolute;pointer-events:none;top:1em;font-size:100%;left:0;width:3em;letter-spacing:-1px;border-right:1px solid #999;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.markdown-preview pre.line-numbers .line-numbers-rows>span{pointer-events:none;display:block;counter-increment:linenumber}.markdown-preview pre.line-numbers .line-numbers-rows>span:before{content:counter(linenumber);color:#999;display:block;padding-right:.8em;text-align:right}.markdown-preview .mathjax-exps .MathJax_Display{text-align:center!important}.markdown-preview:not([data-for=preview]) .code-chunk .code-chunk-btn-group{display:none}.markdown-preview:not([data-for=preview]) .code-chunk .status{display:none}.markdown-preview:not([data-for=preview]) .code-chunk .output-div{margin-bottom:16px}.markdown-preview .md-toc{padding:0}.markdown-preview .md-toc .md-toc-link-wrapper .md-toc-link{display:inline;padding:.25rem 0}.markdown-preview .md-toc .md-toc-link-wrapper .md-toc-link div,.markdown-preview .md-toc .md-toc-link-wrapper .md-toc-link p{display:inline}.markdown-preview .md-toc .md-toc-link-wrapper.highlighted .md-toc-link{font-weight:800}.scrollbar-style::-webkit-scrollbar{width:8px}.scrollbar-style::-webkit-scrollbar-track{border-radius:10px;background-color:transparent}.scrollbar-style::-webkit-scrollbar-thumb{border-radius:5px;background-color:rgba(150,150,150,.66);border:4px solid rgba(150,150,150,.66);background-clip:content-box}html body[for=html-export]:not([data-presentation-mode]){position:relative;width:100%;height:100%;top:0;left:0;margin:0;padding:0;overflow:auto}html body[for=html-export]:not([data-presentation-mode]) .markdown-preview{position:relative;top:0;min-height:100vh}@media screen and (min-width:914px){html body[for=html-export]:not([data-presentation-mode]) .markdown-preview{padding:2em calc(50% - 457px + 2em)}}@media screen and (max-width:914px){html body[for=html-export]:not([data-presentation-mode]) .markdown-preview{padding:2em}}@media screen and (max-width:450px){html body[for=html-export]:not([data-presentation-mode]) .markdown-preview{font-size:14px!important;padding:1em}}@media print{html body[for=html-export]:not([data-presentation-mode]) #sidebar-toc-btn{display:none}}html body[for=html-export]:not([data-presentation-mode]) #sidebar-toc-btn{position:fixed;bottom:8px;left:8px;font-size:28px;cursor:pointer;color:inherit;z-index:99;width:32px;text-align:center;opacity:.4}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] #sidebar-toc-btn{opacity:1}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc{position:fixed;top:0;left:0;width:300px;height:100%;padding:32px 0 48px 0;font-size:14px;box-shadow:0 0 4px rgba(150,150,150,.33);box-sizing:border-box;overflow:auto;background-color:inherit}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc::-webkit-scrollbar{width:8px}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc::-webkit-scrollbar-track{border-radius:10px;background-color:transparent}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc::-webkit-scrollbar-thumb{border-radius:5px;background-color:rgba(150,150,150,.66);border:4px solid rgba(150,150,150,.66);background-clip:content-box}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc a{text-decoration:none}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc .md-toc{padding:0 16px}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc .md-toc .md-toc-link-wrapper .md-toc-link{display:inline;padding:.25rem 0}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc .md-toc .md-toc-link-wrapper .md-toc-link div,html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc .md-toc .md-toc-link-wrapper .md-toc-link p{display:inline}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc .md-toc .md-toc-link-wrapper.highlighted .md-toc-link{font-weight:800}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .markdown-preview{left:300px;width:calc(100% - 300px);padding:2em calc(50% - 457px - 300px / 2);margin:0;box-sizing:border-box}@media screen and (max-width:1274px){html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .markdown-preview{padding:2em}}@media screen and (max-width:450px){html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .markdown-preview{width:100%}}html body[for=html-export]:not([data-presentation-mode]):not([html-show-sidebar-toc]) .markdown-preview{left:50%;transform:translateX(-50%)}html body[for=html-export]:not([data-presentation-mode]):not([html-show-sidebar-toc]) .md-sidebar-toc{display:none}
/* Please visit the URL below for more information: */
/*   https://shd101wyy.github.io/markdown-preview-enhanced/#/customize-css */

      </style>
      <!-- The content below will be included at the end of the <head> element. --><script type="text/javascript">
  document.addEventListener("DOMContentLoaded", function () {
    // your code here
  });
</script></head><body for="html-export">
    
    
      <div class="crossnote markdown-preview  ">
      <div>
<h1 id="haroin57-web-コードベースドキュメント">haroin57-web コードベースドキュメント </h1>
<p>本ドキュメントでは、haroin57-webプロジェクトの全ファイル、関数、クラス、実装、依存関係を解説します。</p>
<hr>
<h2 id="目次">目次 </h2>
<ol>
<li><a href="#%E3%83%97%E3%83%AD%E3%82%B8%E3%82%A7%E3%82%AF%E3%83%88%E6%A7%8B%E6%88%90">プロジェクト構成</a></li>
<li><a href="#%E3%82%A8%E3%83%B3%E3%83%88%E3%83%AA%E3%83%BC%E3%83%9D%E3%82%A4%E3%83%B3%E3%83%88">エントリーポイント</a></li>
<li><a href="#%E3%82%B3%E3%83%B3%E3%83%86%E3%82%AD%E3%82%B9%E3%83%88">コンテキスト</a></li>
<li><a href="#%E3%82%B3%E3%83%B3%E3%83%9D%E3%83%BC%E3%83%8D%E3%83%B3%E3%83%88">コンポーネント</a></li>
<li><a href="#%E3%83%AB%E3%83%BC%E3%83%88%E3%83%9A%E3%83%BC%E3%82%B8">ルート（ページ）</a></li>
<li><a href="#%E7%AE%A1%E7%90%86%E8%80%85%E6%A9%9F%E8%83%BD">管理者機能</a></li>
<li><a href="#%E3%83%A9%E3%82%A4%E3%83%96%E3%83%A9%E3%83%AA%E3%83%A6%E3%83%BC%E3%83%86%E3%82%A3%E3%83%AA%E3%83%86%E3%82%A3">ライブラリ・ユーティリティ</a></li>
<li><a href="#%E3%83%87%E3%83%BC%E3%82%BF%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB">データファイル</a></li>
<li><a href="#%E4%BE%9D%E5%AD%98%E9%96%A2%E4%BF%82%E4%B8%80%E8%A6%A7">依存関係一覧</a></li>
<li><a href="#%E3%82%BB%E3%82%AD%E3%83%A5%E3%83%AA%E3%83%86%E3%82%A3%E5%AE%9F%E8%A3%85">セキュリティ実装</a></li>
<li><a href="#pv-workerts-%E8%A9%B3%E7%B4%B0%E8%A7%A3%E8%AA%AC">pv-worker.ts 詳細解説</a></li>
<li><a href="#%E3%83%AD%E3%83%BC%E3%82%AB%E3%83%AB%E8%A8%98%E4%BA%8B%E3%81%AE%E3%83%87%E3%83%97%E3%83%AD%E3%82%A4">ローカル記事のデプロイ</a></li>
</ol>
<hr>
<h2 id="プロジェクト構成">プロジェクト構成 </h2>
<pre data-role="codeBlock" data-info="" class="language-text"><code>src/
├── main.tsx                    # クライアントエントリ（hydrate対応）
├── entry-server.tsx            # SSG/SSR用エントリ（renderToString）
├── App.tsx                     # ランディングページ（トップページ）
├── index.css                   # グローバルスタイル
├── contexts/
│   └── AdminAuthContext.tsx    # Firebase認証コンテキスト
├── components/
│   ├── AnimatedRoutes.tsx      # ルーティング（コード分割 + preload/prefetch）
│   ├── ServerRoutes.tsx        # SSG/SSR向けRoutes（同期import）
│   ├── GlobalBackground.tsx    # 背景画像 + p5背景アニメ管理
│   ├── P5HypercubeBackground.tsx # p5.js: 4次元立方体背景
│   ├── ScrollTopHomeSwitch.tsx # スクロール/スワイプによるページ切り替え
│   ├── ClientOnly.tsx          # SSG/SSRでクライアントのみ描画
│   ├── AccessCounter.tsx       # PVカウンター
│   ├── SiteFooter.tsx          # フッター（PVカウンター含む）
│   ├── PrefetchLink.tsx        # プリフェッチ対応リンク
│   ├── Lightbox.tsx            # 画像モーダル
│   ├── MermaidRenderer.tsx     # Mermaidダイアグラム描画
│   ├── BackButton.tsx          # 戻るボタン
│   └── admin/
│       └── MarkdownEditor.tsx  # Markdownエディタ（画像アップロード対応）
├── routes/
│   ├── Home.tsx                # ホームページ（コンテンツ一覧）
│   ├── Posts.tsx               # 記事一覧ページ
│   ├── PostDetail.tsx          # 記事詳細ページ
│   ├── Products.tsx            # プロダクト一覧ページ
│   ├── ProductDetail.tsx       # プロダクト詳細ページ
│   ├── Photos.tsx              # 写真ギャラリーページ
│   ├── BBSList.tsx             # BBS スレッド一覧ページ
│   ├── BBSThread.tsx           # BBS スレッド詳細ページ
│   └── admin/
│       ├── PostEditor.tsx      # 記事編集ページ
│       └── ProductEditor.tsx   # プロダクト編集ページ
├── lib/
│   ├── firebase.ts             # Firebase初期化
│   └── draftStorage.ts         # 下書き保存ユーティリティ
├── types/
│   └── p5.d.ts                 # p5モジュール型宣言
└── data/
    ├── posts.json              # 記事データ（ビルド時生成）
    ├── products.json           # プロダクトデータ
    ├── product-posts.json      # プロダクト詳細記事
    └── photos.ts               # 写真データ定義
</code></pre><p>※ SSG（静的HTML生成）は <code>src/entry-server.tsx</code> と <code>scripts/prerender.ts</code> を利用します。</p>
<hr>
<h2 id="エントリーポイント">エントリーポイント </h2>
<h3 id="srcmaintsx"><code>src/main.tsx</code> </h3>
<p>アプリケーションのエントリーポイント。</p>
<pre data-role="codeBlock" data-info="typescript" class="language-typescript typescript"><code><span class="token keyword keyword-const">const</span> rootElement <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'root'</span><span class="token punctuation">)</span>
<span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>rootElement<span class="token punctuation">)</span> <span class="token keyword keyword-throw">throw</span> <span class="token keyword keyword-new">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">'Root element not found'</span><span class="token punctuation">)</span>

<span class="token keyword keyword-const">const</span> app <span class="token operator">=</span> <span class="token punctuation">(</span>
  <span class="token operator">&lt;</span>BrowserRouter<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>AdminAuthProvider<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>GlobalBackground <span class="token operator">/</span><span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>ScrollTopHomeSwitch <span class="token operator">/</span><span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>AnimatedRoutes <span class="token operator">/</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>AdminAuthProvider<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span><span class="token operator">/</span>BrowserRouter<span class="token operator">&gt;</span>
<span class="token punctuation">)</span>

<span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>rootElement<span class="token punctuation">.</span><span class="token function">hasChildNodes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">hydrateRoot</span><span class="token punctuation">(</span>rootElement<span class="token punctuation">,</span> app<span class="token punctuation">)</span>  <span class="token comment">// SSG/SSRで事前生成されたHTMLを利用</span>
<span class="token punctuation">}</span> <span class="token keyword keyword-else">else</span> <span class="token punctuation">{</span>
  <span class="token function">createRoot</span><span class="token punctuation">(</span>rootElement<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span>app<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><p><strong>依存関係:</strong></p>
<ul>
<li><code>react-dom/client</code>: <code>createRoot</code>, <code>hydrateRoot</code></li>
<li><code>react-router-dom</code>: <code>BrowserRouter</code></li>
<li><code>./components/AnimatedRoutes</code></li>
<li><code>./components/GlobalBackground</code></li>
<li><code>./components/ScrollTopHomeSwitch</code></li>
<li><code>./contexts/AdminAuthContext</code></li>
</ul>
<hr>
<h3 id="srcentry-servertsx"><code>src/entry-server.tsx</code> </h3>
<p>SSG/SSR（静的HTML生成）用のサーバーエントリ。<code>vite build --ssr</code> で <code>dist/server/</code> に出力され、<code>scripts/prerender.ts</code> から呼び出されます。</p>
<pre data-role="codeBlock" data-info="typescript" class="language-typescript typescript"><code><span class="token keyword keyword-import">import</span> <span class="token punctuation">{</span> renderToString <span class="token punctuation">}</span> <span class="token keyword keyword-from">from</span> <span class="token string">'react-dom/server'</span>
<span class="token keyword keyword-import">import</span> <span class="token punctuation">{</span> StaticRouter <span class="token punctuation">}</span> <span class="token keyword keyword-from">from</span> <span class="token string">'react-router'</span>

<span class="token keyword keyword-export">export</span> <span class="token keyword keyword-function">function</span> <span class="token function">render</span><span class="token punctuation">(</span>url<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword keyword-return">return</span> <span class="token function">renderToString</span><span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>StaticRouter location<span class="token operator">=</span><span class="token punctuation">{</span>url<span class="token punctuation">}</span><span class="token operator">&gt;</span>
      <span class="token punctuation">{</span><span class="token comment">/* ... */</span><span class="token punctuation">}</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>StaticRouter<span class="token operator">&gt;</span>
  <span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><p><strong>依存関係:</strong></p>
<ul>
<li><code>react-dom/server</code>: <code>renderToString</code></li>
<li><code>react-router</code>: <code>StaticRouter</code></li>
</ul>
<hr>
<h3 id="scriptsprerenderts"><code>scripts/prerender.ts</code> </h3>
<p>SSG（静的HTML生成）スクリプト。<code>dist/index.html</code> をテンプレートにして、<code>dist/server/entry-server.*</code> の <code>render(url)</code> を呼び出し、各ルートのHTMLを <code>dist/&lt;route&gt;/index.html</code> として書き出します。</p>
<p><strong>主な挙動:</strong></p>
<ul>
<li>対象ルート: <code>['/', '/home', '/posts', '/products', '/photos']</code></li>
<li>記事詳細: <code>src/data/posts.json</code> の <code>slug</code> から <code>/posts/:slug</code> を生成</li>
<li>プロダクト詳細: <code>src/data/products.json</code> の <code>slug</code> から <code>/products/:slug</code> を生成</li>
<li><code>BBS</code> や管理者ページなどはプリレンダ対象外（SPAとして動作）</li>
</ul>
<p><strong>関連するビルドフロー（<code>package.json</code>）:</strong></p>
<ul>
<li><code>vite build</code>（クライアント）</li>
<li><code>vite build --ssr src/entry-server.tsx --outDir dist/server</code>（SSRバンドル）</li>
<li><code>node --experimental-strip-types scripts/prerender.ts</code>（HTML書き出し）</li>
</ul>
<hr>
<h3 id="srcapptsx"><code>src/App.tsx</code> </h3>
<p>ランディングページ（ルートパス <code>/</code>）のコンポーネント。</p>
<p><strong>関数:</strong></p>
<table>
<thead>
<tr>
<th>関数名</th>
<th>説明</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>App()</code></td>
<td>ランディングページをレンダリング。ヒーローセクションと「進む」ボタンを表示</td>
</tr>
<tr>
<td><code>handleNavigate()</code></td>
<td><code>/home</code> へナビゲート</td>
</tr>
</tbody>
</table>
<p><strong>機能:</strong></p>
<ul>
<li>reveal要素のアニメーション表示（<code>queueMicrotask</code>で即座にクラス追加）</li>
<li>ページ読み込み時にスクロール位置をトップにリセット</li>
<li>ホバーアニメーション付きの進むボタン</li>
</ul>
<p><strong>依存関係:</strong></p>
<ul>
<li><code>react</code>: <code>useEffect</code>, <code>useRef</code>, <code>useCallback</code></li>
<li><code>react-router-dom</code>: <code>useNavigate</code></li>
</ul>
<hr>
<h2 id="コンテキスト">コンテキスト </h2>
<h3 id="srccontextsadminauthcontexttsx"><code>src/contexts/AdminAuthContext.tsx</code> </h3>
<p>Firebase認証とセッション管理を提供するReactコンテキスト。</p>
<p><strong>定数:</strong></p>
<table>
<thead>
<tr>
<th>定数名</th>
<th>値</th>
<th>説明</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>SESSION_TIMEOUT_MS</code></td>
<td><code>60 * 60 * 1000</code></td>
<td>セッションタイムアウト（1時間）</td>
</tr>
<tr>
<td><code>ADMIN_EMAILS</code></td>
<td>環境変数から取得</td>
<td>管理者メールアドレスリスト</td>
</tr>
</tbody>
</table>
<p><strong>型定義:</strong></p>
<pre data-role="codeBlock" data-info="typescript" class="language-typescript typescript"><code><span class="token keyword keyword-type">type</span> <span class="token class-name">BeforeLogoutCallback</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword keyword-void">void</span> <span class="token operator">|</span> <span class="token builtin">Promise</span><span class="token operator">&lt;</span><span class="token keyword keyword-void">void</span><span class="token operator">&gt;</span>

<span class="token keyword keyword-type">type</span> <span class="token class-name">AdminAuthContextType</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
  isAdmin<span class="token operator">:</span> <span class="token builtin">boolean</span>           <span class="token comment">// 管理者かどうか</span>
  user<span class="token operator">:</span> User <span class="token operator">|</span> <span class="token keyword keyword-null">null</span>          <span class="token comment">// Firebaseユーザー</span>
  idToken<span class="token operator">:</span> <span class="token builtin">string</span> <span class="token operator">|</span> <span class="token keyword keyword-null">null</span>     <span class="token comment">// Firebase IDトークン</span>
  isLoading<span class="token operator">:</span> <span class="token builtin">boolean</span>         <span class="token comment">// 認証状態読み込み中</span>
  sessionExpiresAt<span class="token operator">:</span> <span class="token builtin">number</span> <span class="token operator">|</span> <span class="token keyword keyword-null">null</span>  <span class="token comment">// セッション期限</span>
  <span class="token function-variable function">loginWithGoogle</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token builtin">Promise</span><span class="token operator">&lt;</span><span class="token builtin">boolean</span><span class="token operator">&gt;</span>  <span class="token comment">// Googleログイン</span>
  <span class="token function-variable function">logout</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token builtin">Promise</span><span class="token operator">&lt;</span><span class="token keyword keyword-void">void</span><span class="token operator">&gt;</span>              <span class="token comment">// ログアウト</span>
  <span class="token function-variable function">registerBeforeLogout</span><span class="token operator">:</span> <span class="token punctuation">(</span>callback<span class="token operator">:</span> BeforeLogoutCallback<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword keyword-void">void</span>  <span class="token comment">// ログアウト前コールバック登録</span>
<span class="token punctuation">}</span>
</code></pre><p><strong>関数:</strong></p>
<table>
<thead>
<tr>
<th>関数名</th>
<th>説明</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>AdminAuthProvider({ children })</code></td>
<td>認証コンテキストプロバイダー</td>
</tr>
<tr>
<td><code>useAdminAuth()</code></td>
<td>認証コンテキストを取得するフック</td>
</tr>
<tr>
<td><code>loginWithGoogle()</code></td>
<td>Googleポップアップでログイン。管理者でなければ即サインアウト</td>
</tr>
<tr>
<td><code>logout(skipCallbacks?)</code></td>
<td>ログアウト処理。登録済みコールバック（下書き保存など）を先に実行</td>
</tr>
<tr>
<td><code>startSessionTimeout()</code></td>
<td>1時間のセッションタイムアウトを設定</td>
</tr>
<tr>
<td><code>registerBeforeLogout(callback)</code></td>
<td>ログアウト前に実行するコールバックを登録。登録解除関数を返す</td>
</tr>
</tbody>
</table>
<p><strong>機能:</strong></p>
<ul>
<li>Firebase認証状態の監視（<code>onAuthStateChanged</code>）</li>
<li>IDトークンの自動更新（50分ごと）</li>
<li>1時間のセッションタイムアウト</li>
<li>ページリロード時のセッション維持</li>
<li>ログアウト前コールバックシステム（下書き自動保存用）</li>
</ul>
<p><strong>依存関係:</strong></p>
<ul>
<li><code>react</code>: <code>createContext</code>, <code>useContext</code>, <code>useState</code>, <code>useCallback</code>, <code>useEffect</code>, <code>useRef</code></li>
<li><code>firebase/auth</code>: <code>signInWithPopup</code>, <code>signOut</code>, <code>onAuthStateChanged</code>, <code>User</code></li>
<li><code>../lib/firebase</code>: <code>auth</code>, <code>googleProvider</code></li>
</ul>
<hr>
<h2 id="コンポーネント">コンポーネント </h2>
<h3 id="srccomponentsanimatedroutestsx"><code>src/components/AnimatedRoutes.tsx</code> </h3>
<p>ルーティング（コード分割 + preload/prefetch）を管理。</p>
<p><strong>ルートローダー（例）:</strong></p>
<pre data-role="codeBlock" data-info="typescript" class="language-typescript typescript"><code><span class="token keyword keyword-const">const</span> loadHome <span class="token operator">=</span> <span class="token function">preload</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword keyword-import">import</span><span class="token punctuation">(</span><span class="token string">'../routes/Home'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>         <span class="token comment">// 高優先度</span>
<span class="token keyword keyword-const">const</span> loadBBSList <span class="token operator">=</span> <span class="token function">prefetch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword keyword-import">import</span><span class="token punctuation">(</span><span class="token string">'../routes/BBSList'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment">// 低優先度</span>
<span class="token keyword keyword-const">const</span> loadPostDetail <span class="token operator">=</span> <span class="token function">lazyLoad</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword keyword-import">import</span><span class="token punctuation">(</span><span class="token string">'../routes/PostDetail'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment">// ユーザー操作時</span>
</code></pre><p><strong>機能:</strong></p>
<ul>
<li>React.lazy + Suspenseによる全ルートの遅延読み込み（動的import）</li>
<li><code>preload</code>/<code>prefetch</code>/<code>lazyLoad</code> でルートの読み込み優先度を制御</li>
<li>回線状況に応じて、遷移時に関連ルートを順番にプリロード（<code>shouldPrefetch()</code>）</li>
</ul>
<p><strong>依存関係:</strong></p>
<ul>
<li><code>react-router-dom</code>: <code>Routes</code>, <code>Route</code>, <code>useLocation</code></li>
<li><code>react</code>: <code>lazy</code>, <code>Suspense</code>, <code>useEffect</code></li>
<li><code>../lib/network</code>: <code>shouldPrefetch</code></li>
<li><code>../lib/preload</code>: <code>preload</code>, <code>prefetch</code>, <code>lazyLoad</code></li>
</ul>
<hr>
<h3 id="srccomponentsserverroutestsx"><code>src/components/ServerRoutes.tsx</code> </h3>
<p>SSG/SSR向けのRoutes定義（同期import）。<code>src/entry-server.tsx</code> から利用します（管理者ルートは含めません）。</p>
<p><strong>機能:</strong></p>
<ul>
<li>各ページを同期importして即時レンダリング</li>
<li><code>AnimatedRoutes.tsx</code>（クライアント向けの遅延ロード）と責務分離</li>
</ul>
<p><strong>依存関係:</strong></p>
<ul>
<li><code>react-router-dom</code>: <code>Routes</code>, <code>Route</code>, <code>useLocation</code></li>
</ul>
<hr>
<h3 id="srccomponentsglobalbackgroundtsx"><code>src/components/GlobalBackground.tsx</code> </h3>
<p>レスポンシブ背景画像 + p5背景アニメを管理。</p>
<p><strong>定数:</strong></p>
<pre data-role="codeBlock" data-info="typescript" class="language-typescript typescript"><code><span class="token keyword keyword-const">const</span> <span class="token constant">BACKGROUND_SRC</span> <span class="token operator">=</span> <span class="token string">'/background-1920.webp'</span>
<span class="token keyword keyword-const">const</span> <span class="token constant">BACKGROUND_SRCSET</span> <span class="token operator">=</span> <span class="token punctuation">[</span>
  <span class="token string">'/background-1280.webp 1280w'</span><span class="token punctuation">,</span>
  <span class="token string">'/background-1920.webp 1920w'</span><span class="token punctuation">,</span>
  <span class="token string">'/background-2560.webp 2560w'</span><span class="token punctuation">,</span>
  <span class="token string">'/background-3840.webp 3840w'</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">', '</span><span class="token punctuation">)</span>
</code></pre><p><strong>機能:</strong></p>
<ul>
<li><code>P5HypercubeBackground</code> による背景アニメ描画</li>
<li>srcsetによるレスポンシブ画像読み込み</li>
<li>パスに応じた透明度変更（<code>/</code>では1、それ以外では0.45）</li>
<li>CSS変数による動的ブラー・スケール適用（<code>--bg-blur</code>, <code>--bg-scale</code>）
<ul>
<li>記事/プロダクト詳細ページで設定されるブラーが、背景画像とp5側の両方に反映される</li>
</ul>
</li>
</ul>
<p><strong>依存関係:</strong></p>
<ul>
<li><code>react-router-dom</code>: <code>useLocation</code></li>
<li><code>./P5HypercubeBackground</code></li>
</ul>
<hr>
<h3 id="srccomponentsp5hypercubebackgroundtsx"><code>src/components/P5HypercubeBackground.tsx</code> </h3>
<p>p5.js（WEBGL）で「4次元立方体（tesseract）」の投影アニメーションを背景として描画。</p>
<p><strong>機能:</strong></p>
<ul>
<li><code>p5</code> を動的importして初期バンドルを軽量化</li>
<li>4D回転 → 3D投影 → 2D投影でワイヤーフレームを描画</li>
<li>パフォーマンス調整（低解像度レンダリング、FPS制限、<code>pixelDensity(1)</code>、<code>noSmooth()</code>）</li>
<li><code>prefers-reduced-motion</code> では描画停止</li>
</ul>
<p><strong>依存関係:</strong></p>
<ul>
<li><code>react</code>: <code>useEffect</code>, <code>useRef</code></li>
<li><code>p5</code>（dynamic import）</li>
</ul>
<hr>
<h3 id="srccomponentsscrolltophomeswitchtsx"><code>src/components/ScrollTopHomeSwitch.tsx</code> </h3>
<p>スクロール/スワイプジェスチャーで<code>/</code>と<code>/home</code>間を切り替え。</p>
<p><strong>定数:</strong></p>
<table>
<thead>
<tr>
<th>定数名</th>
<th>値</th>
<th>説明</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>TOP_PATH</code></td>
<td><code>'/'</code></td>
<td>トップページパス</td>
</tr>
<tr>
<td><code>HOME_PATH</code></td>
<td><code>'/home'</code></td>
<td>ホームページパス</td>
</tr>
</tbody>
</table>
<p><strong>関数:</strong></p>
<table>
<thead>
<tr>
<th>関数名</th>
<th>説明</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>normalizeWheelDeltaY(event)</code></td>
<td>ホイールイベントのdeltaYを正規化</td>
</tr>
<tr>
<td><code>shouldIgnoreTarget(target)</code></td>
<td>入力要素等を無視するか判定</td>
</tr>
</tbody>
</table>
<p><strong>機能:</strong></p>
<ul>
<li>ホイールスクロールで累積値120px以上で遷移</li>
<li>タッチスワイプで72px以上で遷移</li>
<li>900msのクールダウン</li>
<li>入力要素やカスタム属性付き要素は無視</li>
</ul>
<p><strong>依存関係:</strong></p>
<ul>
<li><code>react</code>: <code>useEffect</code>, <code>useRef</code></li>
<li><code>react-router-dom</code>: <code>useLocation</code>, <code>useNavigate</code></li>
</ul>
<hr>
<h3 id="srccomponentsclientonlytsx"><code>src/components/ClientOnly.tsx</code> </h3>
<p>SSG/SSRでのhydration差分や <code>window</code> 依存の副作用を避けるため、マウント後にのみ子要素を描画するラッパー。</p>
<p><strong>機能:</strong></p>
<ul>
<li>初回レンダリングでは <code>null</code> を返す</li>
<li><code>useEffect</code> でマウントを検知して描画を開始</li>
</ul>
<p><strong>依存関係:</strong></p>
<ul>
<li><code>react</code>: <code>useEffect</code>, <code>useState</code></li>
</ul>
<hr>
<h3 id="srccomponentssitefootertsx"><code>src/components/SiteFooter.tsx</code> </h3>
<p>サイト共通のフッター。<code>AccessCounter</code>（PVカウンター）は <code>ClientOnly</code> 内で描画し、SSG/SSRで静的HTMLに含めないようにします。</p>
<p><strong>依存関係:</strong></p>
<ul>
<li><code>./AccessCounter</code></li>
<li><code>./ClientOnly</code></li>
<li><code>../styles/typography</code>: <code>MAIN_TEXT_STYLE</code></li>
</ul>
<hr>
<h3 id="srccomponentsaccesscountertsx"><code>src/components/AccessCounter.tsx</code> </h3>
<p>PV（ページビュー）カウンターを表示。</p>
<p><strong>定数:</strong></p>
<table>
<thead>
<tr>
<th>定数名</th>
<th>値</th>
<th>説明</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>API_ENDPOINT</code></td>
<td><code>'/api/pv'</code></td>
<td>PVカウントAPI</td>
</tr>
<tr>
<td><code>CACHE_KEY</code></td>
<td><code>'haroin-pv-last'</code></td>
<td>localStorageキャッシュキー</td>
</tr>
</tbody>
</table>
<p><strong>機能:</strong></p>
<ul>
<li>初回レンダリング時にAPIへPOSTリクエスト</li>
<li>localStorageにカウントをキャッシュ</li>
<li>オフライン時はキャッシュ値を表示</li>
</ul>
<p><strong>依存関係:</strong></p>
<ul>
<li><code>react</code>: <code>useEffect</code>, <code>useRef</code>, <code>useState</code></li>
</ul>
<hr>
<h3 id="srccomponentsprefetchlinktsx"><code>src/components/PrefetchLink.tsx</code> </h3>
<p>ホバー/フォーカス時にルートチャンクをプリフェッチするリンクコンポーネント。</p>
<p><strong>型定義:</strong></p>
<pre data-role="codeBlock" data-info="typescript" class="language-typescript typescript"><code><span class="token keyword keyword-interface">interface</span> <span class="token class-name">PrefetchLinkProps</span> <span class="token keyword keyword-extends">extends</span> <span class="token class-name">LinkProps</span> <span class="token punctuation">{</span>
  enablePrefetch<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">boolean</span>  <span class="token comment">// プリフェッチを有効にするか（デフォルト: true）</span>
<span class="token punctuation">}</span>
</code></pre><p><strong>関数:</strong></p>
<table>
<thead>
<tr>
<th>関数名</th>
<th>説明</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>normalizePathname(raw)</code></td>
<td>パスからクエリ・ハッシュを除去</td>
</tr>
<tr>
<td><code>prefetchRouteChunk(rawPath)</code></td>
<td>パスに対応するチャンクをプリフェッチ</td>
</tr>
</tbody>
</table>
<p><strong>機能:</strong></p>
<ul>
<li>ホバー・フォーカスでルートチャンクを動的インポート</li>
<li>一度プリフェッチしたらスキップ</li>
</ul>
<p><strong>依存関係:</strong></p>
<ul>
<li><code>react-router-dom</code>: <code>Link</code>, <code>LinkProps</code></li>
<li><code>react</code>: <code>useCallback</code>, <code>useRef</code></li>
</ul>
<hr>
<h3 id="srccomponentslightboxtsx"><code>src/components/Lightbox.tsx</code> </h3>
<p>画像モーダル（ライトボックス）コンポーネント。</p>
<p><strong>Props:</strong></p>
<pre data-role="codeBlock" data-info="typescript" class="language-typescript typescript"><code><span class="token keyword keyword-type">type</span> <span class="token class-name">LightboxProps</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
  isOpen<span class="token operator">:</span> <span class="token builtin">boolean</span>           <span class="token comment">// モーダル表示状態</span>
  <span class="token function-variable function">onClose</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword keyword-void">void</span>       <span class="token comment">// 閉じるコールバック</span>
  imageSrc<span class="token operator">:</span> <span class="token builtin">string</span>          <span class="token comment">// 画像URL</span>
  imageAlt<span class="token operator">:</span> <span class="token builtin">string</span>          <span class="token comment">// 画像alt</span>
  children<span class="token operator">?</span><span class="token operator">:</span> React<span class="token punctuation">.</span>ReactNode  <span class="token comment">// 追加コンテンツ</span>
<span class="token punctuation">}</span>
</code></pre><p><strong>機能:</strong></p>
<ul>
<li>Escapeキーで閉じる</li>
<li>背景クリックで閉じる</li>
<li>閉じるボタン</li>
<li>画像下に追加情報を表示可能</li>
</ul>
<p><strong>依存関係:</strong></p>
<ul>
<li><code>react</code>: <code>useEffect</code></li>
</ul>
<hr>
<h3 id="srccomponentsmermaidrenderertsx"><code>src/components/MermaidRenderer.tsx</code> </h3>
<p>Mermaidダイアグラムをレンダリング。</p>
<p><strong>コンポーネント:</strong></p>
<table>
<thead>
<tr>
<th>コンポーネント名</th>
<th>Props</th>
<th>説明</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>MermaidRenderer</code></td>
<td><code>{ chart, className }</code></td>
<td>Mermaidコードをレンダリング</td>
</tr>
<tr>
<td><code>MermaidBlock</code></td>
<td><code>{ code }</code></td>
<td>Markdownから抽出されたMermaidブロック用ラッパー</td>
</tr>
</tbody>
</table>
<p><strong>機能:</strong></p>
<ul>
<li>mermaidライブラリを使用した非同期レンダリング</li>
<li>ダークテーマ設定</li>
<li>エラー時はエラーメッセージと元コードを表示</li>
</ul>
<p><strong>依存関係:</strong></p>
<ul>
<li><code>react</code>: <code>useEffect</code>, <code>useRef</code>, <code>useState</code></li>
<li><code>mermaid</code></li>
</ul>
<hr>
<h3 id="srccomponentsbackbuttontsx"><code>src/components/BackButton.tsx</code> </h3>
<p>戻るボタンコンポーネント。</p>
<p><strong>Props:</strong></p>
<pre data-role="codeBlock" data-info="typescript" class="language-typescript typescript"><code><span class="token keyword keyword-type">type</span> <span class="token class-name">BackButtonProps</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
  to<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">string</span>  <span class="token comment">// 遷移先（デフォルト: '/home'）</span>
<span class="token punctuation">}</span>
</code></pre><p><strong>機能:</strong></p>
<ul>
<li>指定パスへナビゲート</li>
<li>ホバーアニメーション</li>
</ul>
<p><strong>依存関係:</strong></p>
<ul>
<li><code>react</code>: <code>useCallback</code></li>
<li><code>react-router-dom</code>: <code>useNavigate</code></li>
</ul>
<hr>
<h3 id="srccomponentsadminmarkdowneditortsx"><code>src/components/admin/MarkdownEditor.tsx</code> </h3>
<p>管理者用Markdownエディタ。</p>
<p><strong>型定義:</strong></p>
<pre data-role="codeBlock" data-info="typescript" class="language-typescript typescript"><code><span class="token keyword keyword-type">type</span> <span class="token class-name">FrontmatterData</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
  title<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">string</span>
  summary<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">string</span>
  date<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">string</span>
  tags<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">[</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span>

<span class="token keyword keyword-type">type</span> <span class="token class-name">MarkdownEditorProps</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
  value<span class="token operator">:</span> <span class="token builtin">string</span>
  <span class="token function-variable function">onChange</span><span class="token operator">:</span> <span class="token punctuation">(</span>value<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword keyword-void">void</span>
  height<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">number</span>
  placeholder<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">string</span>
<span class="token punctuation">}</span>
</code></pre><p><strong>関数:</strong></p>
<table>
<thead>
<tr>
<th>関数名</th>
<th>説明</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>parseFrontmatter(markdown)</code></td>
<td>Markdownからfrontmatterをパース</td>
</tr>
<tr>
<td><code>FrontmatterHeader({ data })</code></td>
<td>Frontmatter情報をヘッダーとして表示</td>
</tr>
<tr>
<td><code>MermaidRenderer({ code })</code></td>
<td>プレビュー用Mermaidレンダラー</td>
</tr>
<tr>
<td><code>extractTextFromChildren(children)</code></td>
<td>ReactNodeからテキストを抽出</td>
</tr>
<tr>
<td><code>CodeBlock({ className, children })</code></td>
<td>カスタムコードブロック（Mermaid対応）</td>
</tr>
<tr>
<td><code>PreviewWithFrontmatter({ source })</code></td>
<td>Frontmatter付きプレビュー</td>
</tr>
<tr>
<td><code>handleImageUpload(file)</code></td>
<td>画像をCMS APIへアップロード</td>
</tr>
<tr>
<td><code>handleDrop(e)</code></td>
<td>ドラッグ&amp;ドロップで画像アップロード</td>
</tr>
<tr>
<td><code>handlePaste(e)</code></td>
<td>ペーストで画像アップロード</td>
</tr>
</tbody>
</table>
<p><strong>機能:</strong></p>
<ul>
<li><code>@uiw/react-md-editor</code>ベースのエディタ</li>
<li>ライブプレビュー</li>
<li>Frontmatterのパースと表示</li>
<li>Mermaidダイアグラムのプレビュー</li>
<li>KaTeX数式のプレビュー</li>
<li>画像のドラッグ&amp;ドロップ/ペーストアップロード</li>
</ul>
<p><strong>依存関係:</strong></p>
<ul>
<li><code>react</code>: <code>useState</code>, <code>useCallback</code>, <code>useRef</code>, <code>useEffect</code>, <code>useMemo</code></li>
<li><code>@uiw/react-md-editor</code></li>
<li><code>rehype-katex</code>, <code>remark-math</code></li>
<li><code>mermaid</code></li>
<li><code>../../contexts/AdminAuthContext</code></li>
</ul>
<hr>
<h2 id="ルートページ">ルート（ページ） </h2>
<h3 id="srcrouteshometsx"><code>src/routes/Home.tsx</code> </h3>
<p>ホームページ（コンテンツ一覧）。</p>
<p><strong>型定義:</strong></p>
<pre data-role="codeBlock" data-info="typescript" class="language-typescript typescript"><code><span class="token keyword keyword-type">type</span> <span class="token class-name">Interest</span> <span class="token operator">=</span> <span class="token punctuation">{</span> title<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span> text<span class="token operator">:</span> <span class="token builtin">string</span> <span class="token punctuation">}</span>
<span class="token keyword keyword-type">type</span> <span class="token class-name">PostMeta</span> <span class="token operator">=</span> <span class="token punctuation">{</span> slug<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span> title<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span> createdAt<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">string</span> <span class="token punctuation">}</span>
</code></pre><p><strong>機能:</strong></p>
<ul>
<li>Interests（興味分野）の折りたたみ表示</li>
<li>最新記事5件の表示</li>
<li>Products, Photos, BBSへのリンク</li>
<li>フッター（AccessCounter、SNSリンク）</li>
</ul>
<p><strong>依存関係:</strong></p>
<ul>
<li><code>react</code>: <code>useEffect</code>, <code>useRef</code>, <code>useState</code>, <code>useCallback</code></li>
<li><code>react-router-dom</code>: <code>useNavigate</code></li>
<li><code>../components/PrefetchLink</code>, <code>../components/AccessCounter</code></li>
<li><code>../data/posts.json</code></li>
</ul>
<hr>
<h3 id="srcroutespoststsx"><code>src/routes/Posts.tsx</code> </h3>
<p>記事一覧ページ。</p>
<p><strong>型定義:</strong></p>
<pre data-role="codeBlock" data-info="typescript" class="language-typescript typescript"><code><span class="token keyword keyword-type">type</span> <span class="token class-name">Post</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
  slug<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">string</span>
  title<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">string</span>
  html<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">string</span>
  summary<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">string</span>
  createdAt<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">string</span>
  tags<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">[</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre><p><strong>機能:</strong></p>
<ul>
<li>CMS APIから記事一覧を取得（フォールバック: 静的JSON）</li>
<li>タグによるフィルタリング</li>
<li>管理者UI（新規作成、編集、ログアウト）</li>
</ul>
<p><strong>依存関係:</strong></p>
<ul>
<li><code>react</code>: <code>useSearchParams</code>, <code>useEffect</code>, <code>useMemo</code>, <code>useRef</code>, <code>useCallback</code>, <code>startTransition</code>, <code>useState</code></li>
<li><code>react-router-dom</code>: <code>Link</code></li>
<li><code>../data/posts.json</code></li>
<li><code>../components/AccessCounter</code>, <code>../components/PrefetchLink</code></li>
<li><code>../contexts/AdminAuthContext</code></li>
</ul>
<hr>
<h3 id="srcroutespostdetailtsx"><code>src/routes/PostDetail.tsx</code> </h3>
<p>記事詳細ページ。</p>
<p><strong>機能:</strong></p>
<ul>
<li>Mermaidダイアグラムのレンダリング</li>
<li>コードブロックのコピーボタン</li>
<li>スクロールに応じた背景ブラー効果</li>
<li>Good（いいね）機能</li>
<li>X（Twitter）シェアボタン</li>
<li>OGP/Twitterカードのメタタグ設定</li>
</ul>
<p><strong>関数:</strong></p>
<table>
<thead>
<tr>
<th>関数名</th>
<th>説明</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>extractCodeText(codeElement)</code></td>
<td>コード要素からテキストを抽出</td>
</tr>
<tr>
<td><code>writeToClipboard(text)</code></td>
<td>クリップボードにテキストをコピー</td>
</tr>
<tr>
<td><code>handleGood()</code></td>
<td>いいね投票（楽観的更新）</td>
</tr>
</tbody>
</table>
<p><strong>依存関係:</strong></p>
<ul>
<li><code>react</code>: <code>useLocation</code>, <code>useParams</code>, <code>useEffect</code>, <code>useMemo</code>, <code>useRef</code>, <code>useState</code>, <code>useCallback</code>, <code>startTransition</code></li>
<li><code>react-router-dom</code>: <code>Link</code></li>
<li><code>mermaid</code></li>
<li><code>../data/posts.json</code></li>
<li><code>../components/AccessCounter</code>, <code>../components/PrefetchLink</code></li>
</ul>
<hr>
<h3 id="srcroutesproductstsx"><code>src/routes/Products.tsx</code> </h3>
<p>プロダクト一覧ページ。</p>
<p><strong>型定義:</strong></p>
<pre data-role="codeBlock" data-info="typescript" class="language-typescript typescript"><code><span class="token keyword keyword-type">type</span> <span class="token class-name">Product</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
  slug<span class="token operator">:</span> <span class="token builtin">string</span>
  name<span class="token operator">:</span> <span class="token builtin">string</span>
  description<span class="token operator">:</span> <span class="token builtin">string</span>
  language<span class="token operator">:</span> <span class="token builtin">string</span>
  tags<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">[</span><span class="token punctuation">]</span>
  url<span class="token operator">:</span> <span class="token builtin">string</span>
  demo<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">string</span>
<span class="token punctuation">}</span>
</code></pre><p><strong>定数:</strong></p>
<pre data-role="codeBlock" data-info="typescript" class="language-typescript typescript"><code><span class="token keyword keyword-const">const</span> languageColors<span class="token operator">:</span> Record<span class="token operator">&lt;</span><span class="token builtin">string</span><span class="token punctuation">,</span> <span class="token builtin">string</span><span class="token operator">&gt;</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
  TypeScript<span class="token operator">:</span> <span class="token string">'#3178c6'</span><span class="token punctuation">,</span>
  JavaScript<span class="token operator">:</span> <span class="token string">'#f7df1e'</span><span class="token punctuation">,</span>
  Python<span class="token operator">:</span> <span class="token string">'#3572A5'</span><span class="token punctuation">,</span>
  Java<span class="token operator">:</span> <span class="token string">'#b07219'</span><span class="token punctuation">,</span>
  Go<span class="token operator">:</span> <span class="token string">'#00ADD8'</span><span class="token punctuation">,</span>
  Rust<span class="token operator">:</span> <span class="token string">'#dea584'</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre><p><strong>機能:</strong></p>
<ul>
<li>CMS APIからプロダクト一覧を取得</li>
<li>言語カラーインジケーター</li>
<li>管理者UI</li>
</ul>
<p><strong>依存関係:</strong></p>
<ul>
<li><code>react</code>: <code>useEffect</code>, <code>useRef</code>, <code>useState</code></li>
<li><code>react-router-dom</code>: <code>Link</code></li>
<li><code>../data/products.json</code></li>
<li><code>../components/AccessCounter</code>, <code>../components/PrefetchLink</code></li>
<li><code>../contexts/AdminAuthContext</code></li>
</ul>
<hr>
<h3 id="srcroutesproductdetailtsx"><code>src/routes/ProductDetail.tsx</code> </h3>
<p>プロダクト詳細ページ。</p>
<p><strong>機能:</strong></p>
<ul>
<li>Markdown記事がある場合は表示、なければJSON contentを表示</li>
<li>GitHub/Demoリンク</li>
<li>Mermaidダイアグラム対応</li>
<li>コードコピーボタン</li>
<li>スクロール時背景ブラー</li>
</ul>
<p><strong>依存関係:</strong></p>
<ul>
<li><code>react</code>: <code>useEffect</code>, <code>useRef</code></li>
<li><code>react-router-dom</code>: <code>useParams</code>, <code>Link</code></li>
<li><code>mermaid</code></li>
<li><code>../data/products.json</code>, <code>../data/product-posts.json</code></li>
<li><code>../components/AccessCounter</code>, <code>../components/PrefetchLink</code></li>
</ul>
<hr>
<h3 id="srcroutesphotostsx"><code>src/routes/Photos.tsx</code> </h3>
<p>写真ギャラリーページ。</p>
<p><strong>内部コンポーネント:</strong></p>
<table>
<thead>
<tr>
<th>コンポーネント名</th>
<th>説明</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>PhotoCard</code></td>
<td>写真カード（クリックでLightbox表示）</td>
</tr>
<tr>
<td><code>PhotoDetails</code></td>
<td>Lightbox内の写真詳細情報</td>
</tr>
<tr>
<td><code>Tag</code></td>
<td>タグチップ</td>
</tr>
</tbody>
</table>
<p><strong>定数:</strong></p>
<pre data-role="codeBlock" data-info="typescript" class="language-typescript typescript"><code><span class="token keyword keyword-const">const</span> <span class="token constant">RATIO_CLASS_MAP</span><span class="token operator">:</span> Record<span class="token operator">&lt;</span>PhotoRatio<span class="token punctuation">,</span> <span class="token builtin">string</span><span class="token operator">&gt;</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
  portrait<span class="token operator">:</span> <span class="token string">'aspect-[4/5]'</span><span class="token punctuation">,</span>
  landscape<span class="token operator">:</span> <span class="token string">'aspect-[4/3]'</span><span class="token punctuation">,</span>
  square<span class="token operator">:</span> <span class="token string">'aspect-square'</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre><p><strong>依存関係:</strong></p>
<ul>
<li><code>react</code>: <code>useState</code>, <code>useEffect</code>, <code>useRef</code></li>
<li><code>react-router-dom</code>: <code>Link</code></li>
<li><code>../components/AccessCounter</code>, <code>../components/PrefetchLink</code>, <code>../components/Lightbox</code></li>
<li><code>../data/photos</code></li>
</ul>
<hr>
<h3 id="srcroutesbbslisttsx"><code>src/routes/BBSList.tsx</code> </h3>
<p>BBS スレッド一覧ページ。</p>
<p><strong>型定義:</strong></p>
<pre data-role="codeBlock" data-info="typescript" class="language-typescript typescript"><code><span class="token keyword keyword-type">type</span> <span class="token class-name">Thread</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
  id<span class="token operator">:</span> <span class="token builtin">string</span>
  title<span class="token operator">:</span> <span class="token builtin">string</span>
  createdAt<span class="token operator">:</span> <span class="token builtin">string</span>
  createdBy<span class="token operator">:</span> <span class="token builtin">string</span>
  postCount<span class="token operator">:</span> <span class="token builtin">number</span>
  lastPostAt<span class="token operator">:</span> <span class="token builtin">string</span>
<span class="token punctuation">}</span>
</code></pre><p><strong>機能:</strong></p>
<ul>
<li>スレッド一覧表示</li>
<li>スレッド作成フォーム</li>
<li>管理者ログイン/ログアウト</li>
<li>管理者によるスレッド削除</li>
</ul>
<p><strong>関数:</strong></p>
<table>
<thead>
<tr>
<th>関数名</th>
<th>説明</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>fetchThreads()</code></td>
<td>スレッド一覧を取得</td>
</tr>
<tr>
<td><code>handleCreateThread(e)</code></td>
<td>新規スレッド作成</td>
</tr>
<tr>
<td><code>formatDisplayDate(isoDate)</code></td>
<td>日時をフォーマット</td>
</tr>
<tr>
<td><code>handleLogin()</code></td>
<td>管理者ログイン</td>
</tr>
<tr>
<td><code>handleDeleteThread(threadId, e)</code></td>
<td>スレッド削除</td>
</tr>
</tbody>
</table>
<p><strong>依存関係:</strong></p>
<ul>
<li><code>react</code>: <code>useEffect</code>, <code>useRef</code>, <code>useState</code>, <code>useCallback</code></li>
<li><code>react-router-dom</code>: <code>Link</code></li>
<li><code>../components/AccessCounter</code>, <code>../components/PrefetchLink</code></li>
<li><code>../contexts/AdminAuthContext</code></li>
</ul>
<hr>
<h3 id="srcroutesbbsthreadtsx"><code>src/routes/BBSThread.tsx</code> </h3>
<p>BBS スレッド詳細ページ。</p>
<p><strong>型定義:</strong></p>
<pre data-role="codeBlock" data-info="typescript" class="language-typescript typescript"><code><span class="token keyword keyword-type">type</span> <span class="token class-name">Thread</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
  id<span class="token operator">:</span> <span class="token builtin">string</span>
  title<span class="token operator">:</span> <span class="token builtin">string</span>
  createdAt<span class="token operator">:</span> <span class="token builtin">string</span>
  createdBy<span class="token operator">:</span> <span class="token builtin">string</span>
  postCount<span class="token operator">:</span> <span class="token builtin">number</span>
  lastPostAt<span class="token operator">:</span> <span class="token builtin">string</span>
<span class="token punctuation">}</span>

<span class="token keyword keyword-type">type</span> <span class="token class-name">Post</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
  id<span class="token operator">:</span> <span class="token builtin">number</span>
  name<span class="token operator">:</span> <span class="token builtin">string</span>
  date<span class="token operator">:</span> <span class="token builtin">string</span>
  userId<span class="token operator">:</span> <span class="token builtin">string</span>
  content<span class="token operator">:</span> <span class="token builtin">string</span>
<span class="token punctuation">}</span>
</code></pre><p><strong>関数:</strong></p>
<table>
<thead>
<tr>
<th>関数名</th>
<th>説明</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>parseContent(content)</code></td>
<td>アンカーリンク（&gt;&gt;数字）をパース</td>
</tr>
<tr>
<td><code>fetchThread()</code></td>
<td>スレッド・投稿を取得</td>
</tr>
<tr>
<td><code>handleSubmit(e)</code></td>
<td>投稿送信</td>
</tr>
<tr>
<td><code>handleDeletePost(postId)</code></td>
<td>投稿削除（管理者用）</td>
</tr>
</tbody>
</table>
<p><strong>機能:</strong></p>
<ul>
<li>投稿一覧表示</li>
<li>アンカーリンク（&gt;&gt;数字）のクリックでスムーズスクロール</li>
<li>投稿フォーム</li>
<li>管理者による投稿削除</li>
</ul>
<p><strong>依存関係:</strong></p>
<ul>
<li><code>react</code>: <code>useEffect</code>, <code>useRef</code>, <code>useState</code>, <code>useCallback</code></li>
<li><code>react-router-dom</code>: <code>useParams</code>, <code>Link</code></li>
<li><code>../components/AccessCounter</code>, <code>../components/PrefetchLink</code></li>
<li><code>../contexts/AdminAuthContext</code></li>
</ul>
<hr>
<h2 id="管理者機能">管理者機能 </h2>
<h3 id="srcroutesadminposteditortsx"><code>src/routes/admin/PostEditor.tsx</code> </h3>
<p>記事編集ページ。</p>
<p><strong>型定義:</strong></p>
<pre data-role="codeBlock" data-info="typescript" class="language-typescript typescript"><code><span class="token keyword keyword-type">type</span> <span class="token class-name">PostData</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
  slug<span class="token operator">:</span> <span class="token builtin">string</span>
  title<span class="token operator">:</span> <span class="token builtin">string</span>
  summary<span class="token operator">:</span> <span class="token builtin">string</span>
  markdown<span class="token operator">:</span> <span class="token builtin">string</span>
  html<span class="token operator">:</span> <span class="token builtin">string</span>
  tags<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">[</span><span class="token punctuation">]</span>
  createdAt<span class="token operator">:</span> <span class="token builtin">string</span>
  updatedAt<span class="token operator">:</span> <span class="token builtin">string</span>
<span class="token punctuation">}</span>
</code></pre><p><strong>関数:</strong></p>
<table>
<thead>
<tr>
<th>関数名</th>
<th>説明</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>markdownToHtml(markdown)</code></td>
<td>MarkdownをHTMLに変換</td>
</tr>
<tr>
<td><code>saveCurrentDraft()</code></td>
<td>現在のデータを下書き保存</td>
</tr>
<tr>
<td><code>handleSave()</code></td>
<td>記事をCMS APIに保存</td>
</tr>
<tr>
<td><code>discardDraft()</code></td>
<td>下書きを破棄してリロード</td>
</tr>
<tr>
<td><code>handleDelete()</code></td>
<td>記事を削除</td>
</tr>
</tbody>
</table>
<p><strong>機能:</strong></p>
<ul>
<li>新規作成/編集の両対応</li>
<li>下書きの自動保存・復元</li>
<li>ログアウト前に下書き自動保存</li>
<li>Markdownエディタ</li>
<li>フォーム検証</li>
</ul>
<p><strong>依存関係:</strong></p>
<ul>
<li><code>react</code>: <code>useEffect</code>, <code>useState</code>, <code>useCallback</code>, <code>useRef</code></li>
<li><code>react-router-dom</code>: <code>useParams</code>, <code>useNavigate</code>, <code>Link</code></li>
<li><code>unified</code>, <code>remark-parse</code>, <code>remark-gfm</code>, <code>remark-rehype</code>, <code>rehype-stringify</code></li>
<li><code>../../contexts/AdminAuthContext</code></li>
<li><code>../../components/admin/MarkdownEditor</code></li>
<li><code>../../lib/draftStorage</code></li>
</ul>
<hr>
<h3 id="srcroutesadminproducteditortsx"><code>src/routes/admin/ProductEditor.tsx</code> </h3>
<p>プロダクト編集ページ。</p>
<p><strong>型定義:</strong></p>
<pre data-role="codeBlock" data-info="typescript" class="language-typescript typescript"><code><span class="token keyword keyword-type">type</span> <span class="token class-name">ProductData</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
  slug<span class="token operator">:</span> <span class="token builtin">string</span>
  name<span class="token operator">:</span> <span class="token builtin">string</span>
  description<span class="token operator">:</span> <span class="token builtin">string</span>
  language<span class="token operator">:</span> <span class="token builtin">string</span>
  tags<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">[</span><span class="token punctuation">]</span>
  url<span class="token operator">:</span> <span class="token builtin">string</span>
  demo<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">string</span>
  markdown<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">string</span>
  html<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">string</span>
  createdAt<span class="token operator">:</span> <span class="token builtin">string</span>
  updatedAt<span class="token operator">:</span> <span class="token builtin">string</span>
<span class="token punctuation">}</span>
</code></pre><p><strong>機能:</strong></p>
<ul>
<li>PostEditorと同様の機能</li>
<li>プロダクト固有のフィールド（言語、URL、Demo URL）</li>
</ul>
<p><strong>依存関係:</strong></p>
<ul>
<li>PostEditorと同様</li>
</ul>
<hr>
<h2 id="ライブラリユーティリティ">ライブラリ・ユーティリティ </h2>
<h3 id="srclibfirebasets"><code>src/lib/firebase.ts</code> </h3>
<p>Firebase初期化。</p>
<pre data-role="codeBlock" data-info="typescript" class="language-typescript typescript"><code><span class="token keyword keyword-const">const</span> firebaseConfig <span class="token operator">=</span> <span class="token punctuation">{</span>
  apiKey<span class="token operator">:</span> <span class="token keyword keyword-import">import</span><span class="token punctuation">.</span>meta<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">VITE_FIREBASE_API_KEY</span><span class="token punctuation">,</span>
  authDomain<span class="token operator">:</span> <span class="token keyword keyword-import">import</span><span class="token punctuation">.</span>meta<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">VITE_FIREBASE_AUTH_DOMAIN</span><span class="token punctuation">,</span>
  projectId<span class="token operator">:</span> <span class="token keyword keyword-import">import</span><span class="token punctuation">.</span>meta<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">VITE_FIREBASE_PROJECT_ID</span><span class="token punctuation">,</span>
  storageBucket<span class="token operator">:</span> <span class="token keyword keyword-import">import</span><span class="token punctuation">.</span>meta<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">VITE_FIREBASE_STORAGE_BUCKET</span><span class="token punctuation">,</span>
  messagingSenderId<span class="token operator">:</span> <span class="token keyword keyword-import">import</span><span class="token punctuation">.</span>meta<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">VITE_FIREBASE_MESSAGING_SENDER_ID</span><span class="token punctuation">,</span>
  appId<span class="token operator">:</span> <span class="token keyword keyword-import">import</span><span class="token punctuation">.</span>meta<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">VITE_FIREBASE_APP_ID</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>

<span class="token keyword keyword-export">export</span> <span class="token keyword keyword-const">const</span> auth <span class="token operator">=</span> <span class="token function">getAuth</span><span class="token punctuation">(</span>app<span class="token punctuation">)</span>
<span class="token keyword keyword-export">export</span> <span class="token keyword keyword-const">const</span> googleProvider <span class="token operator">=</span> <span class="token keyword keyword-new">new</span> <span class="token class-name">GoogleAuthProvider</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre><p><strong>依存関係:</strong></p>
<ul>
<li><code>firebase/app</code>: <code>initializeApp</code></li>
<li><code>firebase/auth</code>: <code>getAuth</code>, <code>GoogleAuthProvider</code></li>
</ul>
<hr>
<h3 id="srclibdraftstoragets"><code>src/lib/draftStorage.ts</code> </h3>
<p>下書き保存ユーティリティ。localStorageを使用。</p>
<p><strong>型定義:</strong></p>
<pre data-role="codeBlock" data-info="typescript" class="language-typescript typescript"><code><span class="token keyword keyword-export">export</span> <span class="token keyword keyword-type">type</span> <span class="token class-name">PostDraft</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
  slug<span class="token operator">:</span> <span class="token builtin">string</span>
  title<span class="token operator">:</span> <span class="token builtin">string</span>
  summary<span class="token operator">:</span> <span class="token builtin">string</span>
  tags<span class="token operator">:</span> <span class="token builtin">string</span>
  markdown<span class="token operator">:</span> <span class="token builtin">string</span>
  savedAt<span class="token operator">:</span> <span class="token builtin">number</span>
<span class="token punctuation">}</span>

<span class="token keyword keyword-export">export</span> <span class="token keyword keyword-type">type</span> <span class="token class-name">ProductDraft</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
  slug<span class="token operator">:</span> <span class="token builtin">string</span>
  name<span class="token operator">:</span> <span class="token builtin">string</span>
  description<span class="token operator">:</span> <span class="token builtin">string</span>
  language<span class="token operator">:</span> <span class="token builtin">string</span>
  tags<span class="token operator">:</span> <span class="token builtin">string</span>
  url<span class="token operator">:</span> <span class="token builtin">string</span>
  demo<span class="token operator">:</span> <span class="token builtin">string</span>
  markdown<span class="token operator">:</span> <span class="token builtin">string</span>
  savedAt<span class="token operator">:</span> <span class="token builtin">number</span>
<span class="token punctuation">}</span>
</code></pre><p><strong>関数:</strong></p>
<table>
<thead>
<tr>
<th>関数名</th>
<th>引数</th>
<th>戻り値</th>
<th>説明</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>getDraftKey(type, slug)</code></td>
<td><code>'post' | 'product'</code>, <code>string</code></td>
<td><code>string</code></td>
<td>下書きキーを生成</td>
</tr>
<tr>
<td><code>saveDraft&lt;T&gt;(type, slug, data)</code></td>
<td>...</td>
<td><code>void</code></td>
<td>下書きを保存</td>
</tr>
<tr>
<td><code>loadDraft&lt;T&gt;(type, slug)</code></td>
<td>...</td>
<td><code>T | null</code></td>
<td>下書きを読み込み</td>
</tr>
<tr>
<td><code>deleteDraft(type, slug)</code></td>
<td>...</td>
<td><code>void</code></td>
<td>下書きを削除</td>
</tr>
<tr>
<td><code>getAllDrafts()</code></td>
<td>-</td>
<td><code>{ posts, products }</code></td>
<td>全下書きを取得</td>
</tr>
<tr>
<td><code>hasDraft(type, slug)</code></td>
<td>...</td>
<td><code>boolean</code></td>
<td>下書きが存在するか</td>
</tr>
<tr>
<td><code>formatDraftDate(savedAt)</code></td>
<td><code>number</code></td>
<td><code>string</code></td>
<td>保存日時をフォーマット</td>
</tr>
</tbody>
</table>
<p><strong>定数:</strong></p>
<pre data-role="codeBlock" data-info="typescript" class="language-typescript typescript"><code><span class="token keyword keyword-const">const</span> <span class="token constant">DRAFT_PREFIX</span> <span class="token operator">=</span> <span class="token string">'haroin57_draft_'</span>
</code></pre><hr>
<h2 id="データファイル">データファイル </h2>
<h3 id="srcdataphotosts"><code>src/data/photos.ts</code> </h3>
<p>写真データ定義。</p>
<p><strong>型定義:</strong></p>
<pre data-role="codeBlock" data-info="typescript" class="language-typescript typescript"><code><span class="token keyword keyword-export">export</span> <span class="token keyword keyword-type">type</span> <span class="token class-name">PhotoRatio</span> <span class="token operator">=</span> <span class="token string">'portrait'</span> <span class="token operator">|</span> <span class="token string">'landscape'</span> <span class="token operator">|</span> <span class="token string">'square'</span>

<span class="token keyword keyword-export">export</span> <span class="token keyword keyword-type">type</span> <span class="token class-name">Photo</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
  src<span class="token operator">:</span> <span class="token builtin">string</span>      <span class="token comment">// 画像ファイルパス</span>
  title<span class="token operator">:</span> <span class="token builtin">string</span>    <span class="token comment">// 写真タイトル</span>
  location<span class="token operator">:</span> <span class="token builtin">string</span> <span class="token comment">// 撮影場所</span>
  date<span class="token operator">:</span> <span class="token builtin">string</span>     <span class="token comment">// 撮影日（YYYY-MM-DD形式）</span>
  camera<span class="token operator">:</span> <span class="token builtin">string</span>   <span class="token comment">// カメラ種類</span>
  lens<span class="token operator">:</span> <span class="token builtin">string</span>     <span class="token comment">// レンズ情報</span>
  exposure<span class="token operator">:</span> <span class="token builtin">string</span> <span class="token comment">// 露出情報</span>
  note<span class="token operator">:</span> <span class="token builtin">string</span>     <span class="token comment">// 写真の説明文</span>
  ratio<span class="token operator">:</span> PhotoRatio <span class="token comment">// アスペクト比</span>
  tone<span class="token operator">:</span> <span class="token builtin">string</span>     <span class="token comment">// アクセントカラー（HEX形式）</span>
<span class="token punctuation">}</span>
</code></pre><p><strong>エクスポート:</strong></p>
<ul>
<li><code>photos: Photo[]</code> - 写真データ配列</li>
<li><code>shotTags: string[]</code> - タグ配列</li>
</ul>
<hr>
<h2 id="初学者向けtypescriptjavascript基礎文法">初学者向け：TypeScript/JavaScript基礎文法 </h2>
<p>本プロジェクトのコードを理解するために必要な基礎文法を解説します。</p>
<h3 id="変数宣言">変数宣言 </h3>
<h4 id="const---再代入不可の変数"><code>const</code> - 再代入不可の変数 </h4>
<pre data-role="codeBlock" data-info="typescript" class="language-typescript typescript"><code><span class="token keyword keyword-const">const</span> name <span class="token operator">=</span> <span class="token string">'haroin57'</span>      <span class="token comment">// 文字列</span>
<span class="token keyword keyword-const">const</span> count <span class="token operator">=</span> <span class="token number">42</span>             <span class="token comment">// 数値</span>
<span class="token keyword keyword-const">const</span> isActive <span class="token operator">=</span> <span class="token boolean">true</span>        <span class="token comment">// 真偽値</span>
<span class="token keyword keyword-const">const</span> items <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span>      <span class="token comment">// 配列</span>
<span class="token keyword keyword-const">const</span> user <span class="token operator">=</span> <span class="token punctuation">{</span> id<span class="token operator">:</span> <span class="token number">1</span> <span class="token punctuation">}</span>       <span class="token comment">// オブジェクト</span>

<span class="token comment">// ❌ 再代入はエラー</span>
<span class="token comment">// name = 'other'  // Error: Assignment to constant variable</span>

<span class="token comment">// ✅ 配列やオブジェクトの中身は変更可能</span>
items<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span>                <span class="token comment">// [1, 2, 3, 4]</span>
user<span class="token punctuation">.</span>id <span class="token operator">=</span> <span class="token number">2</span>                  <span class="token comment">// { id: 2 }</span>
</code></pre><h4 id="let---再代入可能な変数"><code>let</code> - 再代入可能な変数 </h4>
<pre data-role="codeBlock" data-info="typescript" class="language-typescript typescript"><code><span class="token keyword keyword-let">let</span> count <span class="token operator">=</span> <span class="token number">0</span>
count <span class="token operator">=</span> count <span class="token operator">+</span> <span class="token number">1</span>    <span class="token comment">// ✅ 再代入OK</span>
count<span class="token operator">++</span>              <span class="token comment">// ✅ インクリメントOK</span>
</code></pre><p><strong>使い分け:</strong> 基本は<code>const</code>を使い、再代入が必要な場合のみ<code>let</code>を使用。</p>
<hr>
<h3 id="アロー関数arrow-function">アロー関数（Arrow Function） </h3>
<p>従来の<code>function</code>宣言の代わりに、<code>=&gt;</code>を使った簡潔な関数定義。</p>
<h4 id="基本構文">基本構文 </h4>
<pre data-role="codeBlock" data-info="typescript" class="language-typescript typescript"><code><span class="token comment">// 従来の関数</span>
<span class="token keyword keyword-function">function</span> <span class="token function">add</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword keyword-return">return</span> a <span class="token operator">+</span> b
<span class="token punctuation">}</span>

<span class="token comment">// アロー関数（同じ意味）</span>
<span class="token keyword keyword-const">const</span> <span class="token function-variable function">add</span> <span class="token operator">=</span> <span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword keyword-return">return</span> a <span class="token operator">+</span> b
<span class="token punctuation">}</span>

<span class="token comment">// 1行で書ける場合はさらに省略可能（暗黙のreturn）</span>
<span class="token keyword keyword-const">const</span> <span class="token function-variable function">add</span> <span class="token operator">=</span> <span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> a <span class="token operator">+</span> b

<span class="token comment">// 引数が1つなら括弧も省略可能</span>
<span class="token keyword keyword-const">const</span> <span class="token function-variable function">double</span> <span class="token operator">=</span> x <span class="token operator">=&gt;</span> x <span class="token operator">*</span> <span class="token number">2</span>

<span class="token comment">// 引数がないなら空括弧</span>
<span class="token keyword keyword-const">const</span> <span class="token function-variable function">greet</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token string">'Hello!'</span>
</code></pre><h4 id="本プロジェクトでの例">本プロジェクトでの例 </h4>
<pre data-role="codeBlock" data-info="typescript" class="language-typescript typescript"><code><span class="token comment">// BBSList.tsx - イベントハンドラ</span>
<span class="token keyword keyword-const">const</span> <span class="token function-variable function">handleSubmit</span> <span class="token operator">=</span> <span class="token punctuation">(</span>e<span class="token operator">:</span> React<span class="token punctuation">.</span>FormEvent<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  e<span class="token punctuation">.</span><span class="token function">preventDefault</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token comment">// 処理...</span>
<span class="token punctuation">}</span>

<span class="token comment">// Photos.tsx - 配列のフィルタリング</span>
<span class="token keyword keyword-const">const</span> filteredPhotos <span class="token operator">=</span> photos<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>photo <span class="token operator">=&gt;</span> photo<span class="token punctuation">.</span>tags<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span>selectedTag<span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment">// AnimatedRoutes.tsx - 遅延読み込み関数</span>
<span class="token keyword keyword-const">const</span> <span class="token function-variable function">loadHome</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword keyword-import">import</span><span class="token punctuation">(</span><span class="token string">'../routes/Home'</span><span class="token punctuation">)</span>
</code></pre><hr>
<h3 id="分割代入destructuring">分割代入（Destructuring） </h3>
<p>配列やオブジェクトから値を取り出して変数に代入する構文。</p>
<h4 id="配列の分割代入">配列の分割代入 </h4>
<pre data-role="codeBlock" data-info="typescript" class="language-typescript typescript"><code><span class="token keyword keyword-const">const</span> colors <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'red'</span><span class="token punctuation">,</span> <span class="token string">'green'</span><span class="token punctuation">,</span> <span class="token string">'blue'</span><span class="token punctuation">]</span>

<span class="token comment">// 従来の書き方</span>
<span class="token keyword keyword-const">const</span> first <span class="token operator">=</span> colors<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>   <span class="token comment">// 'red'</span>
<span class="token keyword keyword-const">const</span> second <span class="token operator">=</span> colors<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>  <span class="token comment">// 'green'</span>

<span class="token comment">// 分割代入（同じ意味）</span>
<span class="token keyword keyword-const">const</span> <span class="token punctuation">[</span>first<span class="token punctuation">,</span> second<span class="token punctuation">]</span> <span class="token operator">=</span> colors  <span class="token comment">// first='red', second='green'</span>

<span class="token comment">// useStateで使われる形</span>
<span class="token keyword keyword-const">const</span> <span class="token punctuation">[</span>count<span class="token punctuation">,</span> setCount<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
<span class="token comment">// count: 現在の値</span>
<span class="token comment">// setCount: 更新関数</span>
</code></pre><h4 id="オブジェクトの分割代入">オブジェクトの分割代入 </h4>
<pre data-role="codeBlock" data-info="typescript" class="language-typescript typescript"><code><span class="token keyword keyword-const">const</span> user <span class="token operator">=</span> <span class="token punctuation">{</span> name<span class="token operator">:</span> <span class="token string">'haroin57'</span><span class="token punctuation">,</span> age<span class="token operator">:</span> <span class="token number">25</span><span class="token punctuation">,</span> email<span class="token operator">:</span> <span class="token string">'test@example.com'</span> <span class="token punctuation">}</span>

<span class="token comment">// 従来の書き方</span>
<span class="token keyword keyword-const">const</span> name <span class="token operator">=</span> user<span class="token punctuation">.</span>name
<span class="token keyword keyword-const">const</span> age <span class="token operator">=</span> user<span class="token punctuation">.</span>age

<span class="token comment">// 分割代入（同じ意味）</span>
<span class="token keyword keyword-const">const</span> <span class="token punctuation">{</span> name<span class="token punctuation">,</span> age <span class="token punctuation">}</span> <span class="token operator">=</span> user  <span class="token comment">// name='haroin57', age=25</span>

<span class="token comment">// 関数の引数で直接分割代入</span>
<span class="token keyword keyword-function">function</span> <span class="token function">greet</span><span class="token punctuation">(</span><span class="token punctuation">{</span> name<span class="token punctuation">,</span> age <span class="token punctuation">}</span><span class="token operator">:</span> <span class="token punctuation">{</span> name<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span> age<span class="token operator">:</span> <span class="token builtin">number</span> <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword keyword-return">return</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Hello, </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">! You are </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>age<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> years old.</span><span class="token template-punctuation string">`</span></span>
<span class="token punctuation">}</span>

<span class="token comment">// 本プロジェクトでの例（Lightbox.tsx）</span>
<span class="token keyword keyword-function">function</span> <span class="token function">Lightbox</span><span class="token punctuation">(</span><span class="token punctuation">{</span> isOpen<span class="token punctuation">,</span> onClose<span class="token punctuation">,</span> imageSrc<span class="token punctuation">,</span> imageAlt <span class="token punctuation">}</span><span class="token operator">:</span> LightboxProps<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// propsから直接値を取り出している</span>
<span class="token punctuation">}</span>
</code></pre><hr>
<h3 id="スプレッド構文spread-syntax">スプレッド構文（Spread Syntax） </h3>
<p><code>...</code>を使って配列やオブジェクトを展開する構文。</p>
<h4 id="配列のスプレッド">配列のスプレッド </h4>
<pre data-role="codeBlock" data-info="typescript" class="language-typescript typescript"><code><span class="token keyword keyword-const">const</span> arr1 <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span>
<span class="token keyword keyword-const">const</span> arr2 <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">]</span>

<span class="token comment">// 配列を結合</span>
<span class="token keyword keyword-const">const</span> combined <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token operator">...</span>arr1<span class="token punctuation">,</span> <span class="token operator">...</span>arr2<span class="token punctuation">]</span>  <span class="token comment">// [1, 2, 3, 4, 5, 6]</span>

<span class="token comment">// 先頭に要素を追加</span>
<span class="token keyword keyword-const">const</span> newArr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">...</span>arr1<span class="token punctuation">]</span>  <span class="token comment">// [0, 1, 2, 3]</span>

<span class="token comment">// 末尾に要素を追加</span>
<span class="token keyword keyword-const">const</span> newArr2 <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token operator">...</span>arr1<span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">]</span>  <span class="token comment">// [1, 2, 3, 4]</span>
</code></pre><h4 id="オブジェクトのスプレッド">オブジェクトのスプレッド </h4>
<pre data-role="codeBlock" data-info="typescript" class="language-typescript typescript"><code><span class="token keyword keyword-const">const</span> user <span class="token operator">=</span> <span class="token punctuation">{</span> name<span class="token operator">:</span> <span class="token string">'haroin57'</span><span class="token punctuation">,</span> age<span class="token operator">:</span> <span class="token number">25</span> <span class="token punctuation">}</span>

<span class="token comment">// オブジェクトをコピーして一部を上書き</span>
<span class="token keyword keyword-const">const</span> updatedUser <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token operator">...</span>user<span class="token punctuation">,</span> age<span class="token operator">:</span> <span class="token number">26</span> <span class="token punctuation">}</span>
<span class="token comment">// { name: 'haroin57', age: 26 }</span>

<span class="token comment">// 本プロジェクトでの例（PostEditor.tsx）</span>
<span class="token function">setFormData</span><span class="token punctuation">(</span><span class="token punctuation">(</span>prev<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token operator">...</span>prev<span class="token punctuation">,</span> title<span class="token operator">:</span> e<span class="token punctuation">.</span>target<span class="token punctuation">.</span>value <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment">// prevの全プロパティをコピーし、titleだけ上書き</span>
</code></pre><hr>
<h3 id="テンプレートリテラルtemplate-literal">テンプレートリテラル（Template Literal） </h3>
<p>バッククォート（<code>`</code>）を使った文字列。変数の埋め込みや改行が可能。</p>
<pre data-role="codeBlock" data-info="typescript" class="language-typescript typescript"><code><span class="token keyword keyword-const">const</span> name <span class="token operator">=</span> <span class="token string">'haroin57'</span>
<span class="token keyword keyword-const">const</span> age <span class="token operator">=</span> <span class="token number">25</span>

<span class="token comment">// 従来の文字列結合</span>
<span class="token keyword keyword-const">const</span> message <span class="token operator">=</span> <span class="token string">'Hello, '</span> <span class="token operator">+</span> name <span class="token operator">+</span> <span class="token string">'! You are '</span> <span class="token operator">+</span> age <span class="token operator">+</span> <span class="token string">' years old.'</span>

<span class="token comment">// テンプレートリテラル（同じ意味）</span>
<span class="token keyword keyword-const">const</span> message <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Hello, </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">! You are </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>age<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> years old.</span><span class="token template-punctuation string">`</span></span>

<span class="token comment">// 複数行も可能</span>
<span class="token keyword keyword-const">const</span> multiLine <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">
  First line
  Second line
  Third line
</span><span class="token template-punctuation string">`</span></span>

<span class="token comment">// 本プロジェクトでの例（PostDetail.tsx）</span>
document<span class="token punctuation">.</span>title <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>post<span class="token punctuation">.</span>title<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> | haroin57</span><span class="token template-punctuation string">`</span></span>

<span class="token comment">// APIエンドポイント（BBSList.tsx）</span>
<span class="token keyword keyword-const">const</span> res <span class="token operator">=</span> <span class="token keyword keyword-await">await</span> <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token constant">BBS_ENDPOINT</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">/threads/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>id<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
</code></pre><hr>
<h3 id="三項演算子ternary-operator">三項演算子（Ternary Operator） </h3>
<p><code>条件 ? 真の場合 : 偽の場合</code> という形式の条件分岐。</p>
<pre data-role="codeBlock" data-info="typescript" class="language-typescript typescript"><code><span class="token keyword keyword-const">const</span> age <span class="token operator">=</span> <span class="token number">20</span>

<span class="token comment">// if文</span>
<span class="token keyword keyword-let">let</span> status
<span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>age <span class="token operator">&gt;=</span> <span class="token number">18</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  status <span class="token operator">=</span> <span class="token string">'成人'</span>
<span class="token punctuation">}</span> <span class="token keyword keyword-else">else</span> <span class="token punctuation">{</span>
  status <span class="token operator">=</span> <span class="token string">'未成年'</span>
<span class="token punctuation">}</span>

<span class="token comment">// 三項演算子（同じ意味）</span>
<span class="token keyword keyword-const">const</span> status <span class="token operator">=</span> age <span class="token operator">&gt;=</span> <span class="token number">18</span> <span class="token operator">?</span> <span class="token string">'成人'</span> <span class="token operator">:</span> <span class="token string">'未成年'</span>

<span class="token comment">// 本プロジェクトでの例（AccessCounter.tsx）</span>
<span class="token keyword keyword-return">return</span> <span class="token operator">&lt;</span>span<span class="token operator">&gt;</span>Access<span class="token operator">:</span> <span class="token punctuation">{</span>count <span class="token operator">??</span> <span class="token string">'...'</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>span<span class="token operator">&gt;</span>
<span class="token comment">// countがnullかundefinedなら '...' を表示</span>

<span class="token comment">// ネストした三項演算子（読みにくいので注意）</span>
<span class="token keyword keyword-const">const</span> color <span class="token operator">=</span> score <span class="token operator">&gt;=</span> <span class="token number">90</span> <span class="token operator">?</span> <span class="token string">'gold'</span> <span class="token operator">:</span> score <span class="token operator">&gt;=</span> <span class="token number">70</span> <span class="token operator">?</span> <span class="token string">'silver'</span> <span class="token operator">:</span> <span class="token string">'bronze'</span>
</code></pre><hr>
<h3 id="null合体演算子とオプショナルチェーン">Null合体演算子（<code>??</code>）とオプショナルチェーン（<code>?.</code>） </h3>
<h4 id="null合体演算子">Null合体演算子（<code>??</code>） </h4>
<p>左辺が<code>null</code>または<code>undefined</code>の場合のみ右辺を返す。</p>
<pre data-role="codeBlock" data-info="typescript" class="language-typescript typescript"><code><span class="token keyword keyword-const">const</span> value <span class="token operator">=</span> <span class="token keyword keyword-null">null</span>
<span class="token keyword keyword-const">const</span> result <span class="token operator">=</span> value <span class="token operator">??</span> <span class="token string">'default'</span>  <span class="token comment">// 'default'</span>

<span class="token keyword keyword-const">const</span> zero <span class="token operator">=</span> <span class="token number">0</span>
<span class="token keyword keyword-const">const</span> result2 <span class="token operator">=</span> zero <span class="token operator">??</span> <span class="token string">'default'</span>  <span class="token comment">// 0（0はnullでもundefinedでもない）</span>

<span class="token comment">// 本プロジェクトでの例（AccessCounter.tsx）</span>
<span class="token keyword keyword-const">const</span> cached <span class="token operator">=</span> <span class="token function">Number</span><span class="token punctuation">(</span>localStorage<span class="token punctuation">.</span><span class="token function">getItem</span><span class="token punctuation">(</span><span class="token constant">CACHE_KEY</span><span class="token punctuation">)</span> <span class="token operator">??</span> <span class="token string">'0'</span><span class="token punctuation">)</span>
<span class="token comment">// localStorageにない場合は '0' を使用</span>
</code></pre><h4 id="オプショナルチェーン">オプショナルチェーン（<code>?.</code>） </h4>
<p>プロパティが存在しない場合にエラーにならず<code>undefined</code>を返す。</p>
<pre data-role="codeBlock" data-info="typescript" class="language-typescript typescript"><code><span class="token keyword keyword-const">const</span> user <span class="token operator">=</span> <span class="token punctuation">{</span> profile<span class="token operator">:</span> <span class="token punctuation">{</span> name<span class="token operator">:</span> <span class="token string">'haroin57'</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span>

<span class="token comment">// 従来の書き方（エラー防止）</span>
<span class="token keyword keyword-const">const</span> name <span class="token operator">=</span> user <span class="token operator">&amp;&amp;</span> user<span class="token punctuation">.</span>profile <span class="token operator">&amp;&amp;</span> user<span class="token punctuation">.</span>profile<span class="token punctuation">.</span>name

<span class="token comment">// オプショナルチェーン（同じ意味）</span>
<span class="token keyword keyword-const">const</span> name <span class="token operator">=</span> user<span class="token operator">?.</span>profile<span class="token operator">?.</span>name  <span class="token comment">// 'haroin57'</span>

<span class="token comment">// プロパティがない場合</span>
<span class="token keyword keyword-const">const</span> missing <span class="token operator">=</span> user<span class="token operator">?.</span>settings<span class="token operator">?.</span>theme  <span class="token comment">// undefined（エラーにならない）</span>

<span class="token comment">// 本プロジェクトでの例（Home.tsx）</span>
<span class="token keyword keyword-const">const</span> targets <span class="token operator">=</span> pageRef<span class="token punctuation">.</span>current<span class="token operator">?.</span><span class="token function">querySelectorAll</span><span class="token punctuation">(</span><span class="token string">'.reveal'</span><span class="token punctuation">)</span>
<span class="token comment">// pageRef.currentがnullなら処理をスキップ</span>
</code></pre><hr>
<h3 id="非同期処理asyncawait">非同期処理（async/await） </h3>
<p>時間のかかる処理（API呼び出し等）を待つための構文。</p>
<h4 id="promise基礎">Promise基礎 </h4>
<pre data-role="codeBlock" data-info="typescript" class="language-typescript typescript"><code><span class="token comment">// Promiseを返す関数</span>
<span class="token keyword keyword-function">function</span> <span class="token function">fetchData</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword keyword-return">return</span> <span class="token keyword keyword-new">new</span> <span class="token class-name"><span class="token builtin">Promise</span></span><span class="token punctuation">(</span><span class="token punctuation">(</span>resolve<span class="token punctuation">,</span> reject<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'データ取得完了'</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">// .then()で結果を受け取る（従来の書き方）</span>
<span class="token function">fetchData</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>result <span class="token operator">=&gt;</span> <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span>error <span class="token operator">=&gt;</span> <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre><h4 id="asyncawait推奨">async/await（推奨） </h4>
<pre data-role="codeBlock" data-info="typescript" class="language-typescript typescript"><code><span class="token comment">// async関数内でawaitを使用</span>
<span class="token keyword keyword-async">async</span> <span class="token keyword keyword-function">function</span> <span class="token function">loadData</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword keyword-try">try</span> <span class="token punctuation">{</span>
    <span class="token keyword keyword-const">const</span> result <span class="token operator">=</span> <span class="token keyword keyword-await">await</span> <span class="token function">fetchData</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment">// 完了まで待つ</span>
    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span>
  <span class="token punctuation">}</span> <span class="token keyword keyword-catch">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// 本プロジェクトでの例（BBSList.tsx）</span>
<span class="token keyword keyword-const">const</span> fetchThreads <span class="token operator">=</span> <span class="token function">useCallback</span><span class="token punctuation">(</span><span class="token keyword keyword-async">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword keyword-try">try</span> <span class="token punctuation">{</span>
    <span class="token function">setIsLoading</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span>
    <span class="token keyword keyword-const">const</span> res <span class="token operator">=</span> <span class="token keyword keyword-await">await</span> <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token constant">BBS_ENDPOINT</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">/threads</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
    <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>res<span class="token punctuation">.</span>ok<span class="token punctuation">)</span> <span class="token keyword keyword-throw">throw</span> <span class="token keyword keyword-new">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">'Failed to fetch'</span><span class="token punctuation">)</span>
    <span class="token keyword keyword-const">const</span> data <span class="token operator">=</span> <span class="token keyword keyword-await">await</span> res<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token function">setThreads</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span>threads<span class="token punctuation">)</span>
  <span class="token punctuation">}</span> <span class="token keyword keyword-catch">catch</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">setError</span><span class="token punctuation">(</span><span class="token string">'取得に失敗しました'</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span> <span class="token keyword keyword-finally">finally</span> <span class="token punctuation">{</span>
    <span class="token function">setIsLoading</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre><h4 id="重要な注意点">重要な注意点 </h4>
<pre data-role="codeBlock" data-info="typescript" class="language-typescript typescript"><code><span class="token comment">// ❌ 間違い: awaitはasync関数の中でのみ使用可能</span>
<span class="token keyword keyword-function">function</span> <span class="token function">wrong</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword keyword-const">const</span> data <span class="token operator">=</span> <span class="token keyword keyword-await">await</span> <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">'/api/data'</span><span class="token punctuation">)</span>  <span class="token comment">// SyntaxError</span>
<span class="token punctuation">}</span>

<span class="token comment">// ✅ 正しい</span>
<span class="token keyword keyword-async">async</span> <span class="token keyword keyword-function">function</span> <span class="token function">correct</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword keyword-const">const</span> data <span class="token operator">=</span> <span class="token keyword keyword-await">await</span> <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">'/api/data'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">// トップレベルawait（モジュールの最上位では使用可能）</span>
<span class="token keyword keyword-const">const</span> data <span class="token operator">=</span> <span class="token keyword keyword-await">await</span> <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">'/api/data'</span><span class="token punctuation">)</span>  <span class="token comment">// ES2022以降</span>
</code></pre><hr>
<h3 id="型注釈type-annotation">型注釈（Type Annotation） </h3>
<p>TypeScriptでは変数や関数に型を指定できる。</p>
<h4 id="基本的な型">基本的な型 </h4>
<pre data-role="codeBlock" data-info="typescript" class="language-typescript typescript"><code><span class="token comment">// プリミティブ型</span>
<span class="token keyword keyword-const">const</span> name<span class="token operator">:</span> <span class="token builtin">string</span> <span class="token operator">=</span> <span class="token string">'haroin57'</span>
<span class="token keyword keyword-const">const</span> age<span class="token operator">:</span> <span class="token builtin">number</span> <span class="token operator">=</span> <span class="token number">25</span>
<span class="token keyword keyword-const">const</span> isActive<span class="token operator">:</span> <span class="token builtin">boolean</span> <span class="token operator">=</span> <span class="token boolean">true</span>

<span class="token comment">// 配列</span>
<span class="token keyword keyword-const">const</span> numbers<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span>
<span class="token keyword keyword-const">const</span> names<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'a'</span><span class="token punctuation">,</span> <span class="token string">'b'</span><span class="token punctuation">,</span> <span class="token string">'c'</span><span class="token punctuation">]</span>
<span class="token keyword keyword-const">const</span> items<span class="token operator">:</span> <span class="token builtin">Array</span><span class="token operator">&lt;</span><span class="token builtin">string</span><span class="token operator">&gt;</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'a'</span><span class="token punctuation">,</span> <span class="token string">'b'</span><span class="token punctuation">]</span>  <span class="token comment">// 同じ意味</span>

<span class="token comment">// オブジェクト</span>
<span class="token keyword keyword-const">const</span> user<span class="token operator">:</span> <span class="token punctuation">{</span> name<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span> age<span class="token operator">:</span> <span class="token builtin">number</span> <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token punctuation">{</span> name<span class="token operator">:</span> <span class="token string">'haroin57'</span><span class="token punctuation">,</span> age<span class="token operator">:</span> <span class="token number">25</span> <span class="token punctuation">}</span>

<span class="token comment">// nullを許容</span>
<span class="token keyword keyword-const">const</span> value<span class="token operator">:</span> <span class="token builtin">string</span> <span class="token operator">|</span> <span class="token keyword keyword-null">null</span> <span class="token operator">=</span> <span class="token keyword keyword-null">null</span>

<span class="token comment">// 関数の型</span>
<span class="token keyword keyword-const">const</span> <span class="token function-variable function">greet</span><span class="token operator">:</span> <span class="token punctuation">(</span>name<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function-variable function">string</span> <span class="token operator">=</span> <span class="token punctuation">(</span>name<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Hello, </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">!</span><span class="token template-punctuation string">`</span></span>
</code></pre><h4 id="型エイリアスtype">型エイリアス（type） </h4>
<pre data-role="codeBlock" data-info="typescript" class="language-typescript typescript"><code><span class="token comment">// 型に名前をつける</span>
<span class="token keyword keyword-type">type</span> <span class="token class-name">User</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
  id<span class="token operator">:</span> <span class="token builtin">number</span>
  name<span class="token operator">:</span> <span class="token builtin">string</span>
  email<span class="token operator">:</span> <span class="token builtin">string</span>
<span class="token punctuation">}</span>

<span class="token keyword keyword-const">const</span> user<span class="token operator">:</span> User <span class="token operator">=</span> <span class="token punctuation">{</span> id<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> name<span class="token operator">:</span> <span class="token string">'haroin57'</span><span class="token punctuation">,</span> email<span class="token operator">:</span> <span class="token string">'test@example.com'</span> <span class="token punctuation">}</span>

<span class="token comment">// 本プロジェクトでの例（Lightbox.tsx）</span>
<span class="token keyword keyword-type">type</span> <span class="token class-name">LightboxProps</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
  isOpen<span class="token operator">:</span> <span class="token builtin">boolean</span>
  <span class="token function-variable function">onClose</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword keyword-void">void</span>
  imageSrc<span class="token operator">:</span> <span class="token builtin">string</span>
  imageAlt<span class="token operator">:</span> <span class="token builtin">string</span>
  children<span class="token operator">?</span><span class="token operator">:</span> React<span class="token punctuation">.</span>ReactNode  <span class="token comment">// ?は省略可能を意味</span>
<span class="token punctuation">}</span>
</code></pre><h4 id="interface">interface </h4>
<pre data-role="codeBlock" data-info="typescript" class="language-typescript typescript"><code><span class="token comment">// typeと似ているが、拡張が可能</span>
<span class="token keyword keyword-interface">interface</span> <span class="token class-name">User</span> <span class="token punctuation">{</span>
  id<span class="token operator">:</span> <span class="token builtin">number</span>
  name<span class="token operator">:</span> <span class="token builtin">string</span>
<span class="token punctuation">}</span>

<span class="token keyword keyword-interface">interface</span> <span class="token class-name">AdminUser</span> <span class="token keyword keyword-extends">extends</span> <span class="token class-name">User</span> <span class="token punctuation">{</span>
  role<span class="token operator">:</span> <span class="token string">'admin'</span>
  permissions<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">[</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span>

<span class="token comment">// 本プロジェクトでの例（PrefetchLink.tsx）</span>
<span class="token keyword keyword-interface">interface</span> <span class="token class-name">PrefetchLinkProps</span> <span class="token keyword keyword-extends">extends</span> <span class="token class-name">LinkProps</span> <span class="token punctuation">{</span>
  enablePrefetch<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">boolean</span>
<span class="token punctuation">}</span>
</code></pre><h4 id="ジェネリクスgenerics">ジェネリクス（Generics） </h4>
<p>型をパラメータとして受け取る仕組み。</p>
<pre data-role="codeBlock" data-info="typescript" class="language-typescript typescript"><code><span class="token comment">// Tは任意の型を表すプレースホルダー</span>
<span class="token keyword keyword-function">function</span> <span class="token generic-function"><span class="token function">identity</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>value<span class="token operator">:</span> <span class="token constant">T</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token constant">T</span> <span class="token punctuation">{</span>
  <span class="token keyword keyword-return">return</span> value
<span class="token punctuation">}</span>

<span class="token generic-function"><span class="token function">identity</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token builtin">string</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token string">'hello'</span><span class="token punctuation">)</span>  <span class="token comment">// string型</span>
<span class="token generic-function"><span class="token function">identity</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token builtin">number</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token number">42</span><span class="token punctuation">)</span>       <span class="token comment">// number型</span>
<span class="token function">identity</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span>             <span class="token comment">// 型推論でboolean型</span>

<span class="token comment">// useStateでの使用例</span>
<span class="token keyword keyword-const">const</span> <span class="token punctuation">[</span>count<span class="token punctuation">,</span> setCount<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token generic-function"><span class="token function">useState</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token builtin">number</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
<span class="token keyword keyword-const">const</span> <span class="token punctuation">[</span>user<span class="token punctuation">,</span> setUser<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token generic-function"><span class="token function">useState</span><span class="token generic class-name"><span class="token operator">&lt;</span>User <span class="token operator">|</span> <span class="token keyword keyword-null">null</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token keyword keyword-null">null</span><span class="token punctuation">)</span>
<span class="token keyword keyword-const">const</span> <span class="token punctuation">[</span>items<span class="token punctuation">,</span> setItems<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token generic-function"><span class="token function">useState</span><span class="token generic class-name"><span class="token operator">&lt;</span>Item<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre><hr>
<h3 id="配列メソッド">配列メソッド </h3>
<h4 id="map---各要素を変換"><code>map</code> - 各要素を変換 </h4>
<pre data-role="codeBlock" data-info="typescript" class="language-typescript typescript"><code><span class="token keyword keyword-const">const</span> numbers <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span>
<span class="token keyword keyword-const">const</span> doubled <span class="token operator">=</span> numbers<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>n <span class="token operator">=&gt;</span> n <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">)</span>  <span class="token comment">// [2, 4, 6]</span>

<span class="token comment">// Reactでのリストレンダリング</span>
<span class="token keyword keyword-const">const</span> items <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'A'</span><span class="token punctuation">,</span> <span class="token string">'B'</span><span class="token punctuation">,</span> <span class="token string">'C'</span><span class="token punctuation">]</span>
<span class="token keyword keyword-return">return</span> <span class="token punctuation">(</span>
  <span class="token operator">&lt;</span>ul<span class="token operator">&gt;</span>
    <span class="token punctuation">{</span>items<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span>item<span class="token punctuation">,</span> index<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span>
      <span class="token operator">&lt;</span>li key<span class="token operator">=</span><span class="token punctuation">{</span>index<span class="token punctuation">}</span><span class="token operator">&gt;</span><span class="token punctuation">{</span>item<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>li<span class="token operator">&gt;</span>
    <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span>
  <span class="token operator">&lt;</span><span class="token operator">/</span>ul<span class="token operator">&gt;</span>
<span class="token punctuation">)</span>
</code></pre><h4 id="filter---条件に合う要素を抽出"><code>filter</code> - 条件に合う要素を抽出 </h4>
<pre data-role="codeBlock" data-info="typescript" class="language-typescript typescript"><code><span class="token keyword keyword-const">const</span> numbers <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">]</span>
<span class="token keyword keyword-const">const</span> evens <span class="token operator">=</span> numbers<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>n <span class="token operator">=&gt;</span> n <span class="token operator">%</span> <span class="token number">2</span> <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">)</span>  <span class="token comment">// [2, 4]</span>

<span class="token comment">// 本プロジェクトでの例（Photos.tsx）</span>
<span class="token keyword keyword-const">const</span> filteredPhotos <span class="token operator">=</span> photos<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>photo <span class="token operator">=&gt;</span>
  photo<span class="token punctuation">.</span>tags<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span>selectedTag<span class="token punctuation">)</span>
<span class="token punctuation">)</span>
</code></pre><h4 id="find---条件に合う最初の要素を取得"><code>find</code> - 条件に合う最初の要素を取得 </h4>
<pre data-role="codeBlock" data-info="typescript" class="language-typescript typescript"><code><span class="token keyword keyword-const">const</span> users <span class="token operator">=</span> <span class="token punctuation">[</span>
  <span class="token punctuation">{</span> id<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> name<span class="token operator">:</span> <span class="token string">'Alice'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span> id<span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span> name<span class="token operator">:</span> <span class="token string">'Bob'</span> <span class="token punctuation">}</span>
<span class="token punctuation">]</span>
<span class="token keyword keyword-const">const</span> bob <span class="token operator">=</span> users<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span>user <span class="token operator">=&gt;</span> user<span class="token punctuation">.</span>name <span class="token operator">===</span> <span class="token string">'Bob'</span><span class="token punctuation">)</span>  <span class="token comment">// { id: 2, name: 'Bob' }</span>

<span class="token comment">// 本プロジェクトでの例（PostDetail.tsx）</span>
<span class="token keyword keyword-const">const</span> post <span class="token operator">=</span> postsData<span class="token punctuation">.</span>posts<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span>p <span class="token operator">=&gt;</span> p<span class="token punctuation">.</span>slug <span class="token operator">===</span> slug<span class="token punctuation">)</span>
</code></pre><h4 id="some--every---条件判定"><code>some</code> / <code>every</code> - 条件判定 </h4>
<pre data-role="codeBlock" data-info="typescript" class="language-typescript typescript"><code><span class="token keyword keyword-const">const</span> numbers <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">]</span>

<span class="token comment">// some: 1つでも条件を満たせばtrue</span>
numbers<span class="token punctuation">.</span><span class="token function">some</span><span class="token punctuation">(</span>n <span class="token operator">=&gt;</span> n <span class="token operator">&gt;</span> <span class="token number">3</span><span class="token punctuation">)</span>   <span class="token comment">// true</span>

<span class="token comment">// every: 全てが条件を満たせばtrue</span>
numbers<span class="token punctuation">.</span><span class="token function">every</span><span class="token punctuation">(</span>n <span class="token operator">=&gt;</span> n <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span>  <span class="token comment">// true</span>
numbers<span class="token punctuation">.</span><span class="token function">every</span><span class="token punctuation">(</span>n <span class="token operator">=&gt;</span> n <span class="token operator">&gt;</span> <span class="token number">3</span><span class="token punctuation">)</span>  <span class="token comment">// false</span>
</code></pre><hr>
<h3 id="インポートエクスポートes-modules">インポート/エクスポート（ES Modules） </h3>
<h4 id="名前付きエクスポートインポート">名前付きエクスポート/インポート </h4>
<pre data-role="codeBlock" data-info="typescript" class="language-typescript typescript"><code><span class="token comment">// utils.ts</span>
<span class="token keyword keyword-export">export</span> <span class="token keyword keyword-function">function</span> <span class="token function">add</span><span class="token punctuation">(</span>a<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">,</span> b<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword keyword-return">return</span> a <span class="token operator">+</span> b
<span class="token punctuation">}</span>
<span class="token keyword keyword-export">export</span> <span class="token keyword keyword-const">const</span> <span class="token constant">PI</span> <span class="token operator">=</span> <span class="token number">3.14159</span>

<span class="token comment">// 使用側</span>
<span class="token keyword keyword-import">import</span> <span class="token punctuation">{</span> add<span class="token punctuation">,</span> <span class="token constant">PI</span> <span class="token punctuation">}</span> <span class="token keyword keyword-from">from</span> <span class="token string">'./utils'</span>
</code></pre><h4 id="デフォルトエクスポートインポート">デフォルトエクスポート/インポート </h4>
<pre data-role="codeBlock" data-info="typescript" class="language-typescript typescript"><code><span class="token comment">// Component.tsx</span>
<span class="token keyword keyword-function">function</span> <span class="token function">MyComponent</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword keyword-return">return</span> <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>Hello<span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
<span class="token punctuation">}</span>
<span class="token keyword keyword-export">export</span> <span class="token keyword keyword-default">default</span> MyComponent

<span class="token comment">// 使用側（名前は自由）</span>
<span class="token keyword keyword-import">import</span> MyComponent <span class="token keyword keyword-from">from</span> <span class="token string">'./Component'</span>
<span class="token keyword keyword-import">import</span> AnyName <span class="token keyword keyword-from">from</span> <span class="token string">'./Component'</span>  <span class="token comment">// 同じものをインポート</span>
</code></pre><h4 id="本プロジェクトでの例-1">本プロジェクトでの例 </h4>
<pre data-role="codeBlock" data-info="typescript" class="language-typescript typescript"><code><span class="token comment">// 名前付きインポート（react）</span>
<span class="token keyword keyword-import">import</span> <span class="token punctuation">{</span> useState<span class="token punctuation">,</span> useEffect<span class="token punctuation">,</span> useCallback <span class="token punctuation">}</span> <span class="token keyword keyword-from">from</span> <span class="token string">'react'</span>

<span class="token comment">// デフォルトインポート（コンポーネント）</span>
<span class="token keyword keyword-import">import</span> PrefetchLink <span class="token keyword keyword-from">from</span> <span class="token string">'../components/PrefetchLink'</span>

<span class="token comment">// 型のみのインポート</span>
<span class="token keyword keyword-import">import</span> <span class="token keyword keyword-type">type</span> <span class="token punctuation">{</span> LinkProps <span class="token punctuation">}</span> <span class="token keyword keyword-from">from</span> <span class="token string">'react-router-dom'</span>

<span class="token comment">// JSON with type assertion</span>
<span class="token keyword keyword-import">import</span> postsData <span class="token keyword keyword-from">from</span> <span class="token string">'../data/posts.json'</span> <span class="token keyword keyword-with">with</span> <span class="token punctuation">{</span> type<span class="token operator">:</span> <span class="token string">'json'</span> <span class="token punctuation">}</span>
</code></pre><hr>
<h3 id="javascripttypescript標準関数メソッド">JavaScript/TypeScript標準関数・メソッド </h3>
<p>本プロジェクトで使用されている標準APIを解説します。</p>
<h4 id="文字列メソッド">文字列メソッド </h4>
<h5 id="stringprototypetrim"><code>String.prototype.trim()</code> </h5>
<p>文字列の前後の空白を削除する。</p>
<pre data-role="codeBlock" data-info="typescript" class="language-typescript typescript"><code><span class="token keyword keyword-const">const</span> input <span class="token operator">=</span> <span class="token string">'  hello world  '</span>
input<span class="token punctuation">.</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment">// 'hello world'</span>

<span class="token comment">// 本プロジェクトでの例（BBSList.tsx）</span>
<span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>title<span class="token punctuation">.</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token operator">!</span>content<span class="token punctuation">.</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword keyword-return">return</span>  <span class="token comment">// 空白のみの入力を拒否</span>
</code></pre><h5 id="stringprototypesplit"><code>String.prototype.split()</code> </h5>
<p>文字列を指定した区切り文字で分割し、配列にする。</p>
<pre data-role="codeBlock" data-info="typescript" class="language-typescript typescript"><code><span class="token keyword keyword-const">const</span> str <span class="token operator">=</span> <span class="token string">'apple,banana,cherry'</span>
str<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">','</span><span class="token punctuation">)</span>  <span class="token comment">// ['apple', 'banana', 'cherry']</span>

<span class="token keyword keyword-const">const</span> path <span class="token operator">=</span> <span class="token string">'/posts/my-article'</span>
path<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">)</span>  <span class="token comment">// ['', 'posts', 'my-article']</span>

<span class="token comment">// 本プロジェクトでの例（PrefetchLink.tsx）</span>
<span class="token keyword keyword-const">const</span> pathname <span class="token operator">=</span> raw<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">'#'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">?.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">'?'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>  <span class="token comment">// ハッシュとクエリを除去</span>
</code></pre><h5 id="stringprototypestartswith--endswith"><code>String.prototype.startsWith()</code> / <code>endsWith()</code> </h5>
<p>文字列が指定した文字列で始まる/終わるかを判定。</p>
<pre data-role="codeBlock" data-info="typescript" class="language-typescript typescript"><code><span class="token keyword keyword-const">const</span> url <span class="token operator">=</span> <span class="token string">'/posts/my-article'</span>
url<span class="token punctuation">.</span><span class="token function">startsWith</span><span class="token punctuation">(</span><span class="token string">'/posts/'</span><span class="token punctuation">)</span>  <span class="token comment">// true</span>
url<span class="token punctuation">.</span><span class="token function">endsWith</span><span class="token punctuation">(</span><span class="token string">'.html'</span><span class="token punctuation">)</span>      <span class="token comment">// false</span>

<span class="token comment">// 本プロジェクトでの例（PrefetchLink.tsx）</span>
<span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>path<span class="token punctuation">.</span><span class="token function">startsWith</span><span class="token punctuation">(</span><span class="token string">'/posts/'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 投稿詳細ページのプリフェッチ</span>
<span class="token punctuation">}</span>
</code></pre><h5 id="stringprototypeincludes"><code>String.prototype.includes()</code> </h5>
<p>文字列に指定した文字列が含まれるかを判定。</p>
<pre data-role="codeBlock" data-info="typescript" class="language-typescript typescript"><code><span class="token keyword keyword-const">const</span> message <span class="token operator">=</span> <span class="token string">'Hello, World!'</span>
message<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span><span class="token string">'World'</span><span class="token punctuation">)</span>  <span class="token comment">// true</span>
message<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span><span class="token string">'world'</span><span class="token punctuation">)</span>  <span class="token comment">// false（大文字小文字を区別）</span>

<span class="token comment">// 本プロジェクトでの例（Photos.tsx）</span>
photo<span class="token punctuation">.</span>tags<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span>selectedTag<span class="token punctuation">)</span>  <span class="token comment">// タグが含まれているか</span>
</code></pre><h5 id="stringprototypeslice"><code>String.prototype.slice()</code> </h5>
<p>文字列の一部を切り出す。</p>
<pre data-role="codeBlock" data-info="typescript" class="language-typescript typescript"><code><span class="token keyword keyword-const">const</span> str <span class="token operator">=</span> <span class="token string">'Hello, World!'</span>
str<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span>   <span class="token comment">// 'Hello'（0番目から5文字）</span>
str<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">)</span>      <span class="token comment">// 'World!'（7番目から最後まで）</span>
str<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">6</span><span class="token punctuation">)</span>     <span class="token comment">// 'World!'（末尾から6文字）</span>

<span class="token comment">// 本プロジェクトでの例（MermaidRenderer.tsx）</span>
<span class="token keyword keyword-const">const</span> id <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">mermaid-</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token number">36</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span>
</code></pre><h5 id="stringprototypereplace--replaceall"><code>String.prototype.replace()</code> / <code>replaceAll()</code> </h5>
<p>文字列の一部を置換する。</p>
<pre data-role="codeBlock" data-info="typescript" class="language-typescript typescript"><code><span class="token keyword keyword-const">const</span> text <span class="token operator">=</span> <span class="token string">'Hello World'</span>
text<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token string">'World'</span><span class="token punctuation">,</span> <span class="token string">'React'</span><span class="token punctuation">)</span>     <span class="token comment">// 'Hello React'（最初の1つだけ）</span>
text<span class="token punctuation">.</span><span class="token function">replaceAll</span><span class="token punctuation">(</span><span class="token string">'l'</span><span class="token punctuation">,</span> <span class="token string">'L'</span><span class="token punctuation">)</span>          <span class="token comment">// 'HeLLo WorLd'（すべて置換）</span>

<span class="token comment">// 正規表現も使用可能</span>
<span class="token string">'a1b2c3'</span><span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">[0-9]</span><span class="token regex-delimiter">/</span><span class="token regex-flags">g</span></span><span class="token punctuation">,</span> <span class="token string">'X'</span><span class="token punctuation">)</span>    <span class="token comment">// 'aXbXcX'</span>
</code></pre><hr>
<h4 id="配列メソッド詳細">配列メソッド（詳細） </h4>
<h5 id="arrayprototypemap"><code>Array.prototype.map()</code> </h5>
<p>各要素を変換した新しい配列を作成。</p>
<pre data-role="codeBlock" data-info="typescript" class="language-typescript typescript"><code><span class="token keyword keyword-const">const</span> numbers <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span>
numbers<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>n <span class="token operator">=&gt;</span> n <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">)</span>  <span class="token comment">// [2, 4, 6]</span>

<span class="token comment">// オブジェクト配列から特定のプロパティを抽出</span>
<span class="token keyword keyword-const">const</span> users <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">{</span> name<span class="token operator">:</span> <span class="token string">'Alice'</span><span class="token punctuation">,</span> age<span class="token operator">:</span> <span class="token number">25</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> name<span class="token operator">:</span> <span class="token string">'Bob'</span><span class="token punctuation">,</span> age<span class="token operator">:</span> <span class="token number">30</span> <span class="token punctuation">}</span><span class="token punctuation">]</span>
users<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>u <span class="token operator">=&gt;</span> u<span class="token punctuation">.</span>name<span class="token punctuation">)</span>  <span class="token comment">// ['Alice', 'Bob']</span>

<span class="token comment">// インデックスも取得可能</span>
<span class="token punctuation">[</span><span class="token string">'a'</span><span class="token punctuation">,</span> <span class="token string">'b'</span><span class="token punctuation">,</span> <span class="token string">'c'</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span>item<span class="token punctuation">,</span> index<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>index<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>item<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
<span class="token comment">// ['0: a', '1: b', '2: c']</span>
</code></pre><h5 id="arrayprototypefilter"><code>Array.prototype.filter()</code> </h5>
<p>条件に合う要素だけを抽出した新しい配列を作成。</p>
<pre data-role="codeBlock" data-info="typescript" class="language-typescript typescript"><code><span class="token keyword keyword-const">const</span> numbers <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">]</span>
numbers<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>n <span class="token operator">=&gt;</span> n <span class="token operator">&gt;</span> <span class="token number">2</span><span class="token punctuation">)</span>      <span class="token comment">// [3, 4, 5]</span>
numbers<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>n <span class="token operator">=&gt;</span> n <span class="token operator">%</span> <span class="token number">2</span> <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">)</span>  <span class="token comment">// [2, 4]（偶数のみ）</span>

<span class="token comment">// falsyな値を除去</span>
<span class="token keyword keyword-const">const</span> mixed <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">,</span> <span class="token string">'hello'</span><span class="token punctuation">,</span> <span class="token keyword keyword-null">null</span><span class="token punctuation">,</span> <span class="token keyword keyword-undefined">undefined</span><span class="token punctuation">]</span>
mixed<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>Boolean<span class="token punctuation">)</span>  <span class="token comment">// [1, 'hello']</span>
</code></pre><h5 id="arrayprototypefind--findindex"><code>Array.prototype.find()</code> / <code>findIndex()</code> </h5>
<p>条件に合う最初の要素/インデックスを返す。</p>
<pre data-role="codeBlock" data-info="typescript" class="language-typescript typescript"><code><span class="token keyword keyword-const">const</span> users <span class="token operator">=</span> <span class="token punctuation">[</span>
  <span class="token punctuation">{</span> id<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> name<span class="token operator">:</span> <span class="token string">'Alice'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span> id<span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span> name<span class="token operator">:</span> <span class="token string">'Bob'</span> <span class="token punctuation">}</span>
<span class="token punctuation">]</span>

users<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span>u <span class="token operator">=&gt;</span> u<span class="token punctuation">.</span>id <span class="token operator">===</span> <span class="token number">2</span><span class="token punctuation">)</span>       <span class="token comment">// { id: 2, name: 'Bob' }</span>
users<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span>u <span class="token operator">=&gt;</span> u<span class="token punctuation">.</span>id <span class="token operator">===</span> <span class="token number">99</span><span class="token punctuation">)</span>      <span class="token comment">// undefined（見つからない）</span>

users<span class="token punctuation">.</span><span class="token function">findIndex</span><span class="token punctuation">(</span>u <span class="token operator">=&gt;</span> u<span class="token punctuation">.</span>id <span class="token operator">===</span> <span class="token number">2</span><span class="token punctuation">)</span>  <span class="token comment">// 1</span>
users<span class="token punctuation">.</span><span class="token function">findIndex</span><span class="token punctuation">(</span>u <span class="token operator">=&gt;</span> u<span class="token punctuation">.</span>id <span class="token operator">===</span> <span class="token number">99</span><span class="token punctuation">)</span> <span class="token comment">// -1（見つからない）</span>
</code></pre><h5 id="arrayprototypereduce"><code>Array.prototype.reduce()</code> </h5>
<p>配列を1つの値に集約する。</p>
<pre data-role="codeBlock" data-info="typescript" class="language-typescript typescript"><code><span class="token keyword keyword-const">const</span> numbers <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">]</span>

<span class="token comment">// 合計</span>
numbers<span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span><span class="token punctuation">(</span>sum<span class="token punctuation">,</span> n<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> sum <span class="token operator">+</span> n<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>  <span class="token comment">// 15</span>

<span class="token comment">// 最大値</span>
numbers<span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span><span class="token punctuation">(</span>max<span class="token punctuation">,</span> n<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> Math<span class="token punctuation">.</span><span class="token function">max</span><span class="token punctuation">(</span>max<span class="token punctuation">,</span> n<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">Infinity</span><span class="token punctuation">)</span>  <span class="token comment">// 5</span>

<span class="token comment">// オブジェクトの集計</span>
<span class="token keyword keyword-const">const</span> items <span class="token operator">=</span> <span class="token punctuation">[</span>
  <span class="token punctuation">{</span> category<span class="token operator">:</span> <span class="token string">'A'</span><span class="token punctuation">,</span> value<span class="token operator">:</span> <span class="token number">10</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span> category<span class="token operator">:</span> <span class="token string">'B'</span><span class="token punctuation">,</span> value<span class="token operator">:</span> <span class="token number">20</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span> category<span class="token operator">:</span> <span class="token string">'A'</span><span class="token punctuation">,</span> value<span class="token operator">:</span> <span class="token number">30</span> <span class="token punctuation">}</span>
<span class="token punctuation">]</span>
items<span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span><span class="token punctuation">(</span>acc<span class="token punctuation">,</span> item<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  acc<span class="token punctuation">[</span>item<span class="token punctuation">.</span>category<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span>acc<span class="token punctuation">[</span>item<span class="token punctuation">.</span>category<span class="token punctuation">]</span> <span class="token operator">||</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">+</span> item<span class="token punctuation">.</span>value
  <span class="token keyword keyword-return">return</span> acc
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token punctuation">}</span> <span class="token keyword keyword-as">as</span> Record<span class="token operator">&lt;</span><span class="token builtin">string</span><span class="token punctuation">,</span> <span class="token builtin">number</span><span class="token operator">&gt;</span><span class="token punctuation">)</span>
<span class="token comment">// { A: 40, B: 20 }</span>
</code></pre><h5 id="arrayprototypesort"><code>Array.prototype.sort()</code> </h5>
<p>配列を並べ替える（元の配列を変更する）。</p>
<pre data-role="codeBlock" data-info="typescript" class="language-typescript typescript"><code><span class="token comment">// 文字列のソート</span>
<span class="token punctuation">[</span><span class="token string">'banana'</span><span class="token punctuation">,</span> <span class="token string">'apple'</span><span class="token punctuation">,</span> <span class="token string">'cherry'</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">sort</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment">// ['apple', 'banana', 'cherry']</span>

<span class="token comment">// 数値のソート（比較関数が必要）</span>
<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">sort</span><span class="token punctuation">(</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> a <span class="token operator">-</span> b<span class="token punctuation">)</span>  <span class="token comment">// [1, 1, 3, 4, 5]（昇順）</span>
<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">sort</span><span class="token punctuation">(</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> b <span class="token operator">-</span> a<span class="token punctuation">)</span>  <span class="token comment">// [5, 4, 3, 1, 1]（降順）</span>

<span class="token comment">// オブジェクト配列のソート</span>
<span class="token keyword keyword-const">const</span> posts <span class="token operator">=</span> <span class="token punctuation">[</span>
  <span class="token punctuation">{</span> title<span class="token operator">:</span> <span class="token string">'B'</span><span class="token punctuation">,</span> date<span class="token operator">:</span> <span class="token string">'2024-02-01'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span> title<span class="token operator">:</span> <span class="token string">'A'</span><span class="token punctuation">,</span> date<span class="token operator">:</span> <span class="token string">'2024-01-01'</span> <span class="token punctuation">}</span>
<span class="token punctuation">]</span>
posts<span class="token punctuation">.</span><span class="token function">sort</span><span class="token punctuation">(</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword keyword-new">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span>b<span class="token punctuation">.</span>date<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token keyword keyword-new">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span>a<span class="token punctuation">.</span>date<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment">// 日付の降順（新しい順）</span>
</code></pre><h5 id="arrayprototypeconcat--スプレッド構文"><code>Array.prototype.concat()</code> / スプレッド構文 </h5>
<p>配列を結合する。</p>
<pre data-role="codeBlock" data-info="typescript" class="language-typescript typescript"><code><span class="token keyword keyword-const">const</span> arr1 <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span>
<span class="token keyword keyword-const">const</span> arr2 <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">]</span>

arr1<span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span>arr2<span class="token punctuation">)</span>     <span class="token comment">// [1, 2, 3, 4]</span>
<span class="token punctuation">[</span><span class="token operator">...</span>arr1<span class="token punctuation">,</span> <span class="token operator">...</span>arr2<span class="token punctuation">]</span>    <span class="token comment">// [1, 2, 3, 4]（同じ結果、こちらが一般的）</span>
</code></pre><h5 id="arrayprototypejoin"><code>Array.prototype.join()</code> </h5>
<p>配列を文字列に結合する。</p>
<pre data-role="codeBlock" data-info="typescript" class="language-typescript typescript"><code><span class="token punctuation">[</span><span class="token string">'a'</span><span class="token punctuation">,</span> <span class="token string">'b'</span><span class="token punctuation">,</span> <span class="token string">'c'</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">'-'</span><span class="token punctuation">)</span>   <span class="token comment">// 'a-b-c'</span>
<span class="token punctuation">[</span><span class="token string">'a'</span><span class="token punctuation">,</span> <span class="token string">'b'</span><span class="token punctuation">,</span> <span class="token string">'c'</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span>    <span class="token comment">// 'abc'</span>
<span class="token punctuation">[</span><span class="token string">'a'</span><span class="token punctuation">,</span> <span class="token string">'b'</span><span class="token punctuation">,</span> <span class="token string">'c'</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">', '</span><span class="token punctuation">)</span>  <span class="token comment">// 'a, b, c'</span>
</code></pre><h5 id="arrayfrom"><code>Array.from()</code> </h5>
<p>イテラブルから配列を作成する。</p>
<pre data-role="codeBlock" data-info="typescript" class="language-typescript typescript"><code><span class="token comment">// 文字列を配列に</span>
<span class="token builtin">Array</span><span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">'hello'</span><span class="token punctuation">)</span>  <span class="token comment">// ['h', 'e', 'l', 'l', 'o']</span>

<span class="token comment">// Setを配列に</span>
<span class="token builtin">Array</span><span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token keyword keyword-new">new</span> <span class="token class-name">Set</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment">// [1, 2, 3]</span>

<span class="token comment">// 連番の配列を作成</span>
<span class="token builtin">Array</span><span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token punctuation">{</span> length<span class="token operator">:</span> <span class="token number">5</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>_<span class="token punctuation">,</span> i<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> i<span class="token punctuation">)</span>  <span class="token comment">// [0, 1, 2, 3, 4]</span>

<span class="token comment">// 本プロジェクトでの例（AdminAuthContext.tsx）</span>
<span class="token keyword keyword-const">const</span> callbacks <span class="token operator">=</span> <span class="token builtin">Array</span><span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span>beforeLogoutCallbacksRef<span class="token punctuation">.</span>current<span class="token punctuation">)</span>
</code></pre><hr>
<h4 id="オブジェクトメソッド">オブジェクトメソッド </h4>
<h5 id="objectkeys--objectvalues--objectentries"><code>Object.keys()</code> / <code>Object.values()</code> / <code>Object.entries()</code> </h5>
<p>オブジェクトのキー/値/エントリを配列として取得。</p>
<pre data-role="codeBlock" data-info="typescript" class="language-typescript typescript"><code><span class="token keyword keyword-const">const</span> user <span class="token operator">=</span> <span class="token punctuation">{</span> name<span class="token operator">:</span> <span class="token string">'Alice'</span><span class="token punctuation">,</span> age<span class="token operator">:</span> <span class="token number">25</span><span class="token punctuation">,</span> city<span class="token operator">:</span> <span class="token string">'Tokyo'</span> <span class="token punctuation">}</span>

Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span>    <span class="token comment">// ['name', 'age', 'city']</span>
Object<span class="token punctuation">.</span><span class="token function">values</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span>  <span class="token comment">// ['Alice', 25, 'Tokyo']</span>
Object<span class="token punctuation">.</span><span class="token function">entries</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span> <span class="token comment">// [['name', 'Alice'], ['age', 25], ['city', 'Tokyo']]</span>

<span class="token comment">// エントリを使ったループ</span>
<span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span><span class="token keyword keyword-const">const</span> <span class="token punctuation">[</span>key<span class="token punctuation">,</span> value<span class="token punctuation">]</span> <span class="token keyword keyword-of">of</span> Object<span class="token punctuation">.</span><span class="token function">entries</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>key<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>value<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><h5 id="objectassign"><code>Object.assign()</code> </h5>
<p>オブジェクトをマージする（スプレッド構文の方が一般的）。</p>
<pre data-role="codeBlock" data-info="typescript" class="language-typescript typescript"><code><span class="token keyword keyword-const">const</span> defaults <span class="token operator">=</span> <span class="token punctuation">{</span> theme<span class="token operator">:</span> <span class="token string">'light'</span><span class="token punctuation">,</span> lang<span class="token operator">:</span> <span class="token string">'en'</span> <span class="token punctuation">}</span>
<span class="token keyword keyword-const">const</span> userSettings <span class="token operator">=</span> <span class="token punctuation">{</span> theme<span class="token operator">:</span> <span class="token string">'dark'</span> <span class="token punctuation">}</span>

Object<span class="token punctuation">.</span><span class="token function">assign</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> defaults<span class="token punctuation">,</span> userSettings<span class="token punctuation">)</span>  <span class="token comment">// { theme: 'dark', lang: 'en' }</span>
<span class="token punctuation">{</span> <span class="token operator">...</span>defaults<span class="token punctuation">,</span> <span class="token operator">...</span>userSettings <span class="token punctuation">}</span>           <span class="token comment">// 同じ結果</span>
</code></pre><hr>
<h4 id="数値数学関数">数値・数学関数 </h4>
<h5 id="number--parseint--parsefloat"><code>Number()</code> / <code>parseInt()</code> / <code>parseFloat()</code> </h5>
<p>文字列を数値に変換する。</p>
<pre data-role="codeBlock" data-info="typescript" class="language-typescript typescript"><code><span class="token function">Number</span><span class="token punctuation">(</span><span class="token string">'42'</span><span class="token punctuation">)</span>       <span class="token comment">// 42</span>
<span class="token function">Number</span><span class="token punctuation">(</span><span class="token string">'3.14'</span><span class="token punctuation">)</span>     <span class="token comment">// 3.14</span>
<span class="token function">Number</span><span class="token punctuation">(</span><span class="token string">'hello'</span><span class="token punctuation">)</span>    <span class="token comment">// NaN（変換失敗）</span>
<span class="token function">Number</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span>         <span class="token comment">// 0</span>

<span class="token function">parseInt</span><span class="token punctuation">(</span><span class="token string">'42px'</span><span class="token punctuation">)</span>   <span class="token comment">// 42（数値部分のみ解析）</span>
<span class="token function">parseInt</span><span class="token punctuation">(</span><span class="token string">'3.14'</span><span class="token punctuation">)</span>   <span class="token comment">// 3（整数のみ）</span>
<span class="token function">parseFloat</span><span class="token punctuation">(</span><span class="token string">'3.14'</span><span class="token punctuation">)</span> <span class="token comment">// 3.14</span>

<span class="token comment">// 本プロジェクトでの例（AccessCounter.tsx）</span>
<span class="token keyword keyword-const">const</span> cached <span class="token operator">=</span> <span class="token function">Number</span><span class="token punctuation">(</span>localStorage<span class="token punctuation">.</span><span class="token function">getItem</span><span class="token punctuation">(</span><span class="token constant">CACHE_KEY</span><span class="token punctuation">)</span> <span class="token operator">??</span> <span class="token string">'0'</span><span class="token punctuation">)</span>
</code></pre><h5 id="numberisfinite--numberisnan"><code>Number.isFinite()</code> / <code>Number.isNaN()</code> </h5>
<p>数値の検証。</p>
<pre data-role="codeBlock" data-info="typescript" class="language-typescript typescript"><code>Number<span class="token punctuation">.</span><span class="token function">isFinite</span><span class="token punctuation">(</span><span class="token number">42</span><span class="token punctuation">)</span>        <span class="token comment">// true</span>
Number<span class="token punctuation">.</span><span class="token function">isFinite</span><span class="token punctuation">(</span><span class="token number">Infinity</span><span class="token punctuation">)</span>  <span class="token comment">// false</span>
Number<span class="token punctuation">.</span><span class="token function">isFinite</span><span class="token punctuation">(</span><span class="token number">NaN</span><span class="token punctuation">)</span>       <span class="token comment">// false</span>

Number<span class="token punctuation">.</span><span class="token function">isNaN</span><span class="token punctuation">(</span><span class="token number">NaN</span><span class="token punctuation">)</span>          <span class="token comment">// true</span>
Number<span class="token punctuation">.</span><span class="token function">isNaN</span><span class="token punctuation">(</span><span class="token string">'hello'</span><span class="token punctuation">)</span>      <span class="token comment">// false（グローバルisNaNとは異なる）</span>

<span class="token comment">// 本プロジェクトでの例（AccessCounter.tsx）</span>
<span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>Number<span class="token punctuation">.</span><span class="token function">isFinite</span><span class="token punctuation">(</span>cached<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> cached <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token operator">...</span> <span class="token punctuation">}</span>
</code></pre><h5 id="mathオブジェクト"><code>Math</code>オブジェクト </h5>
<p>数学関数のコレクション。</p>
<pre data-role="codeBlock" data-info="typescript" class="language-typescript typescript"><code>Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span>           <span class="token comment">// 0以上1未満のランダムな小数</span>
Math<span class="token punctuation">.</span><span class="token function">floor</span><span class="token punctuation">(</span><span class="token number">3.7</span><span class="token punctuation">)</span>         <span class="token comment">// 3（切り捨て）</span>
Math<span class="token punctuation">.</span><span class="token function">ceil</span><span class="token punctuation">(</span><span class="token number">3.2</span><span class="token punctuation">)</span>          <span class="token comment">// 4（切り上げ）</span>
Math<span class="token punctuation">.</span><span class="token function">round</span><span class="token punctuation">(</span><span class="token number">3.5</span><span class="token punctuation">)</span>         <span class="token comment">// 4（四捨五入）</span>
Math<span class="token punctuation">.</span><span class="token function">max</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span>       <span class="token comment">// 5</span>
Math<span class="token punctuation">.</span><span class="token function">min</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span>       <span class="token comment">// 1</span>
Math<span class="token punctuation">.</span><span class="token function">abs</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">5</span><span class="token punctuation">)</span>            <span class="token comment">// 5（絶対値）</span>
Math<span class="token punctuation">.</span><span class="token function">pow</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span>          <span class="token comment">// 8（2の3乗）</span>

<span class="token comment">// ランダムなIDを生成</span>
Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token number">36</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">)</span>  <span class="token comment">// 'k5x8m2n1p'のような文字列</span>
</code></pre><hr>
<h4 id="日付時間">日付・時間 </h4>
<h5 id="dateオブジェクト"><code>Date</code>オブジェクト </h5>
<p>日付と時間を扱う。</p>
<pre data-role="codeBlock" data-info="typescript" class="language-typescript typescript"><code><span class="token comment">// 現在時刻</span>
<span class="token keyword keyword-const">const</span> now <span class="token operator">=</span> <span class="token keyword keyword-new">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
now<span class="token punctuation">.</span><span class="token function">getTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span>          <span class="token comment">// 1703001600000（UNIXタイムスタンプ、ミリ秒）</span>
now<span class="token punctuation">.</span><span class="token function">toISOString</span><span class="token punctuation">(</span><span class="token punctuation">)</span>      <span class="token comment">// '2024-12-20T00:00:00.000Z'</span>
now<span class="token punctuation">.</span><span class="token function">toLocaleDateString</span><span class="token punctuation">(</span><span class="token string">'ja-JP'</span><span class="token punctuation">)</span>  <span class="token comment">// '2024/12/20'</span>

<span class="token comment">// 特定の日付を作成</span>
<span class="token keyword keyword-new">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token string">'2024-12-20'</span><span class="token punctuation">)</span>
<span class="token keyword keyword-new">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token number">2024</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">)</span>  <span class="token comment">// 月は0始まり（11 = 12月）</span>

<span class="token comment">// 日付の計算</span>
<span class="token keyword keyword-const">const</span> future <span class="token operator">=</span> <span class="token keyword keyword-new">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span>Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">60</span> <span class="token operator">*</span> <span class="token number">60</span> <span class="token operator">*</span> <span class="token number">1000</span><span class="token punctuation">)</span>  <span class="token comment">// 1時間後</span>

<span class="token comment">// 本プロジェクトでの例（AdminAuthContext.tsx）</span>
<span class="token keyword keyword-const">const</span> expiresAt <span class="token operator">=</span> Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token constant">SESSION_TIMEOUT_MS</span>
</code></pre><h5 id="settimeout--setinterval--cleartimeout--clearinterval"><code>setTimeout()</code> / <code>setInterval()</code> / <code>clearTimeout()</code> / <code>clearInterval()</code> </h5>
<p>タイマー関数。</p>
<pre data-role="codeBlock" data-info="typescript" class="language-typescript typescript"><code><span class="token comment">// 一度だけ実行</span>
<span class="token keyword keyword-const">const</span> timerId <span class="token operator">=</span> <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'3秒経過'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">3000</span><span class="token punctuation">)</span>

<span class="token comment">// キャンセル</span>
<span class="token function">clearTimeout</span><span class="token punctuation">(</span>timerId<span class="token punctuation">)</span>

<span class="token comment">// 繰り返し実行</span>
<span class="token keyword keyword-const">const</span> intervalId <span class="token operator">=</span> <span class="token function">setInterval</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'1秒ごとに実行'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span>

<span class="token comment">// 停止</span>
<span class="token function">clearInterval</span><span class="token punctuation">(</span>intervalId<span class="token punctuation">)</span>

<span class="token comment">// 本プロジェクトでの例（AdminAuthContext.tsx）</span>
sessionTimeoutRef<span class="token punctuation">.</span>current <span class="token operator">=</span> <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword keyword-async">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword keyword-await">await</span> <span class="token function">logout</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token constant">SESSION_TIMEOUT_MS</span><span class="token punctuation">)</span>
</code></pre><hr>
<h4 id="web-api">Web API </h4>
<h5 id="fetch"><code>fetch()</code> </h5>
<p>HTTPリクエストを送信する。</p>
<pre data-role="codeBlock" data-info="typescript" class="language-typescript typescript"><code><span class="token comment">// GETリクエスト</span>
<span class="token keyword keyword-const">const</span> response <span class="token operator">=</span> <span class="token keyword keyword-await">await</span> <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">'/api/posts'</span><span class="token punctuation">)</span>
<span class="token keyword keyword-const">const</span> data <span class="token operator">=</span> <span class="token keyword keyword-await">await</span> response<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment">// POSTリクエスト</span>
<span class="token keyword keyword-const">const</span> response <span class="token operator">=</span> <span class="token keyword keyword-await">await</span> <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">'/api/posts'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  method<span class="token operator">:</span> <span class="token string">'POST'</span><span class="token punctuation">,</span>
  headers<span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token string-property property">'Content-Type'</span><span class="token operator">:</span> <span class="token string">'application/json'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  body<span class="token operator">:</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span><span class="token punctuation">{</span> title<span class="token operator">:</span> <span class="token string">'New Post'</span><span class="token punctuation">,</span> content<span class="token operator">:</span> <span class="token string">'...'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// エラーハンドリング</span>
<span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>response<span class="token punctuation">.</span>ok<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword keyword-throw">throw</span> <span class="token keyword keyword-new">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">HTTP </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>response<span class="token punctuation">.</span>status<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">// 本プロジェクトでの例（BBSList.tsx）</span>
<span class="token keyword keyword-const">const</span> res <span class="token operator">=</span> <span class="token keyword keyword-await">await</span> <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token constant">BBS_ENDPOINT</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">/threads</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  method<span class="token operator">:</span> <span class="token string">'POST'</span><span class="token punctuation">,</span>
  headers<span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token string-property property">'Content-Type'</span><span class="token operator">:</span> <span class="token string">'application/json'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  body<span class="token operator">:</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span><span class="token punctuation">{</span> title<span class="token punctuation">,</span> content<span class="token punctuation">,</span> author <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><h5 id="localstorage--sessionstorage"><code>localStorage</code> / <code>sessionStorage</code> </h5>
<p>ブラウザにデータを保存する。</p>
<pre data-role="codeBlock" data-info="typescript" class="language-typescript typescript"><code><span class="token comment">// 保存</span>
localStorage<span class="token punctuation">.</span><span class="token function">setItem</span><span class="token punctuation">(</span><span class="token string">'key'</span><span class="token punctuation">,</span> <span class="token string">'value'</span><span class="token punctuation">)</span>
localStorage<span class="token punctuation">.</span><span class="token function">setItem</span><span class="token punctuation">(</span><span class="token string">'user'</span><span class="token punctuation">,</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span><span class="token punctuation">{</span> name<span class="token operator">:</span> <span class="token string">'Alice'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment">// 取得</span>
<span class="token keyword keyword-const">const</span> value <span class="token operator">=</span> localStorage<span class="token punctuation">.</span><span class="token function">getItem</span><span class="token punctuation">(</span><span class="token string">'key'</span><span class="token punctuation">)</span>  <span class="token comment">// 'value' または null</span>
<span class="token keyword keyword-const">const</span> user <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>localStorage<span class="token punctuation">.</span><span class="token function">getItem</span><span class="token punctuation">(</span><span class="token string">'user'</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token string">'{}'</span><span class="token punctuation">)</span>

<span class="token comment">// 削除</span>
localStorage<span class="token punctuation">.</span><span class="token function">removeItem</span><span class="token punctuation">(</span><span class="token string">'key'</span><span class="token punctuation">)</span>

<span class="token comment">// 全削除</span>
localStorage<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment">// 本プロジェクトでの例（AccessCounter.tsx）</span>
localStorage<span class="token punctuation">.</span><span class="token function">setItem</span><span class="token punctuation">(</span><span class="token constant">CACHE_KEY</span><span class="token punctuation">,</span> <span class="token function">String</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span>total<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword keyword-const">const</span> cached <span class="token operator">=</span> localStorage<span class="token punctuation">.</span><span class="token function">getItem</span><span class="token punctuation">(</span><span class="token constant">CACHE_KEY</span><span class="token punctuation">)</span>
</code></pre><h5 id="abortcontroller"><code>AbortController</code> </h5>
<p>非同期処理のキャンセル。</p>
<pre data-role="codeBlock" data-info="typescript" class="language-typescript typescript"><code><span class="token keyword keyword-const">const</span> controller <span class="token operator">=</span> <span class="token keyword keyword-new">new</span> <span class="token class-name">AbortController</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">'/api/data'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> signal<span class="token operator">:</span> controller<span class="token punctuation">.</span>signal <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>res <span class="token operator">=&gt;</span> res<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span>err <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">.</span>name <span class="token operator">===</span> <span class="token string">'AbortError'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'リクエストがキャンセルされました'</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// キャンセル</span>
controller<span class="token punctuation">.</span><span class="token function">abort</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment">// 本プロジェクトでの例（AccessCounter.tsx）</span>
<span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword keyword-const">const</span> controller <span class="token operator">=</span> <span class="token keyword keyword-new">new</span> <span class="token class-name">AbortController</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

  <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token constant">API_ENDPOINT</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> signal<span class="token operator">:</span> controller<span class="token punctuation">.</span>signal <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token comment">/* ... */</span><span class="token punctuation">)</span>

  <span class="token keyword keyword-return">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> controller<span class="token punctuation">.</span><span class="token function">abort</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment">// クリーンアップ時にキャンセル</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre><h5 id="consoleメソッド"><code>console</code>メソッド </h5>
<p>デバッグ出力。</p>
<pre data-role="codeBlock" data-info="typescript" class="language-typescript typescript"><code><span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'通常のログ'</span><span class="token punctuation">)</span>
<span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">'エラー'</span><span class="token punctuation">)</span>
<span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">warn</span><span class="token punctuation">(</span><span class="token string">'警告'</span><span class="token punctuation">)</span>
<span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">table</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">{</span> a<span class="token operator">:</span> <span class="token number">1</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> a<span class="token operator">:</span> <span class="token number">2</span> <span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">)</span>  <span class="token comment">// 表形式で表示</span>
<span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">time</span><span class="token punctuation">(</span><span class="token string">'処理'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">/* ... */</span> <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">timeEnd</span><span class="token punctuation">(</span><span class="token string">'処理'</span><span class="token punctuation">)</span>  <span class="token comment">// 時間計測</span>
<span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">group</span><span class="token punctuation">(</span><span class="token string">'グループ'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'内容'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">groupEnd</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre><hr>
<h4 id="dom操作">DOM操作 </h4>
<h5 id="documentqueryselector--queryselectorall"><code>document.querySelector()</code> / <code>querySelectorAll()</code> </h5>
<p>CSSセレクタで要素を取得。</p>
<pre data-role="codeBlock" data-info="typescript" class="language-typescript typescript"><code><span class="token comment">// 単一要素</span>
<span class="token keyword keyword-const">const</span> header <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'.header'</span><span class="token punctuation">)</span>
<span class="token keyword keyword-const">const</span> button <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'#submit-btn'</span><span class="token punctuation">)</span>
<span class="token keyword keyword-const">const</span> input <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'input[type="email"]'</span><span class="token punctuation">)</span>

<span class="token comment">// 複数要素</span>
<span class="token keyword keyword-const">const</span> items <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelectorAll</span><span class="token punctuation">(</span><span class="token string">'.list-item'</span><span class="token punctuation">)</span>
items<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>item <span class="token operator">=&gt;</span> <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>item<span class="token punctuation">.</span>textContent<span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment">// 本プロジェクトでの例（Home.tsx）</span>
<span class="token keyword keyword-const">const</span> targets <span class="token operator">=</span> pageRef<span class="token punctuation">.</span>current<span class="token operator">?.</span><span class="token function">querySelectorAll</span><span class="token punctuation">(</span><span class="token string">'.reveal'</span><span class="token punctuation">)</span>
</code></pre><h5 id="elementclasslist"><code>element.classList</code> </h5>
<p>CSSクラスの操作。</p>
<pre data-role="codeBlock" data-info="typescript" class="language-typescript typescript"><code><span class="token keyword keyword-const">const</span> el <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'.box'</span><span class="token punctuation">)</span>

el<span class="token punctuation">.</span>classList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">'active'</span><span class="token punctuation">)</span>         <span class="token comment">// クラスを追加</span>
el<span class="token punctuation">.</span>classList<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token string">'active'</span><span class="token punctuation">)</span>      <span class="token comment">// クラスを削除</span>
el<span class="token punctuation">.</span>classList<span class="token punctuation">.</span><span class="token function">toggle</span><span class="token punctuation">(</span><span class="token string">'active'</span><span class="token punctuation">)</span>      <span class="token comment">// あれば削除、なければ追加</span>
el<span class="token punctuation">.</span>classList<span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span><span class="token string">'active'</span><span class="token punctuation">)</span>    <span class="token comment">// 含まれているか確認</span>

<span class="token comment">// 本プロジェクトでの例（PostDetail.tsx / ProductDetail.tsx）</span>
<span class="token keyword keyword-const">const</span> body <span class="token operator">=</span> document<span class="token punctuation">.</span>body
body<span class="token punctuation">.</span>classList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">'post-detail-page'</span><span class="token punctuation">)</span>
body<span class="token punctuation">.</span>classList<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token string">'post-detail-page'</span><span class="token punctuation">)</span>
</code></pre><h5 id="addeventlistener--removeeventlistener"><code>addEventListener()</code> / <code>removeEventListener()</code> </h5>
<p>イベントリスナーの登録と解除。</p>
<pre data-role="codeBlock" data-info="typescript" class="language-typescript typescript"><code><span class="token keyword keyword-const">const</span> <span class="token function-variable function">handleClick</span> <span class="token operator">=</span> <span class="token punctuation">(</span>e<span class="token operator">:</span> MouseEvent<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'クリックされた'</span><span class="token punctuation">,</span> e<span class="token punctuation">.</span>target<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

element<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'click'</span><span class="token punctuation">,</span> handleClick<span class="token punctuation">)</span>
element<span class="token punctuation">.</span><span class="token function">removeEventListener</span><span class="token punctuation">(</span><span class="token string">'click'</span><span class="token punctuation">,</span> handleClick<span class="token punctuation">)</span>

<span class="token comment">// オプション</span>
window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'scroll'</span><span class="token punctuation">,</span> handleScroll<span class="token punctuation">,</span> <span class="token punctuation">{</span> passive<span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'click'</span><span class="token punctuation">,</span> handleClick<span class="token punctuation">,</span> <span class="token punctuation">{</span> once<span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>  <span class="token comment">// 1回だけ</span>

<span class="token comment">// 本プロジェクトでの例（ScrollTopHomeSwitch.tsx）</span>
window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'wheel'</span><span class="token punctuation">,</span> onWheel<span class="token punctuation">,</span> <span class="token punctuation">{</span> passive<span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword keyword-return">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> window<span class="token punctuation">.</span><span class="token function">removeEventListener</span><span class="token punctuation">(</span><span class="token string">'wheel'</span><span class="token punctuation">,</span> onWheel<span class="token punctuation">)</span>
</code></pre><hr>
<h4 id="promise関連">Promise関連 </h4>
<h5 id="promiseall--promiserace--promiseallsettled"><code>Promise.all()</code> / <code>Promise.race()</code> / <code>Promise.allSettled()</code> </h5>
<p>複数のPromiseを扱う。</p>
<pre data-role="codeBlock" data-info="typescript" class="language-typescript typescript"><code><span class="token comment">// すべて完了を待つ（1つでも失敗すると全体が失敗）</span>
<span class="token keyword keyword-const">const</span> <span class="token punctuation">[</span>user<span class="token punctuation">,</span> posts<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword keyword-await">await</span> <span class="token builtin">Promise</span><span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
  <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">'/api/user'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>r <span class="token operator">=&gt;</span> r<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">'/api/posts'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>r <span class="token operator">=&gt;</span> r<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span>

<span class="token comment">// 最初に完了したものを取得</span>
<span class="token keyword keyword-const">const</span> fastest <span class="token operator">=</span> <span class="token keyword keyword-await">await</span> <span class="token builtin">Promise</span><span class="token punctuation">.</span><span class="token function">race</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
  <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">'/api/server1'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">'/api/server2'</span><span class="token punctuation">)</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span>

<span class="token comment">// すべての結果を取得（成功/失敗問わず）</span>
<span class="token keyword keyword-const">const</span> results <span class="token operator">=</span> <span class="token keyword keyword-await">await</span> <span class="token builtin">Promise</span><span class="token punctuation">.</span><span class="token function">allSettled</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
  <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">'/api/a'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">'/api/b'</span><span class="token punctuation">)</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token comment">// [{ status: 'fulfilled', value: ... }, { status: 'rejected', reason: ... }]</span>
</code></pre><hr>
<h4 id="json">JSON </h4>
<h5 id="jsonstringify--jsonparse"><code>JSON.stringify()</code> / <code>JSON.parse()</code> </h5>
<p>オブジェクトとJSON文字列の相互変換。</p>
<pre data-role="codeBlock" data-info="typescript" class="language-typescript typescript"><code><span class="token keyword keyword-const">const</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span> name<span class="token operator">:</span> <span class="token string">'Alice'</span><span class="token punctuation">,</span> age<span class="token operator">:</span> <span class="token number">25</span> <span class="token punctuation">}</span>

<span class="token comment">// オブジェクト → JSON文字列</span>
<span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span>           <span class="token comment">// '{"name":"Alice","age":25}'</span>
<span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span> <span class="token keyword keyword-null">null</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>  <span class="token comment">// 整形（インデント2）</span>

<span class="token comment">// JSON文字列 → オブジェクト</span>
<span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span><span class="token string">'{"name":"Alice"}'</span><span class="token punctuation">)</span>  <span class="token comment">// { name: 'Alice' }</span>

<span class="token comment">// 本プロジェクトでの例（BBSList.tsx）</span>
body<span class="token operator">:</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span><span class="token punctuation">{</span> title<span class="token punctuation">,</span> content<span class="token punctuation">,</span> author <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword keyword-const">const</span> data <span class="token operator">=</span> <span class="token keyword keyword-await">await</span> res<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment">// fetchのjson()は内部でJSON.parseを呼ぶ</span>
</code></pre><hr>
<h2 id="css基礎とtailwind-css">CSS基礎とTailwind CSS </h2>
<p>本プロジェクトではTailwind CSSを使用しています。まず標準CSSの基礎を理解してからTailwindを学びましょう。</p>
<h3 id="css基礎">CSS基礎 </h3>
<h4 id="ボックスモデル">ボックスモデル </h4>
<p>すべてのHTML要素は「ボックス」として扱われる。</p>
<pre data-role="codeBlock" data-info="" class="language-text"><code>┌─────────────────────────────────┐
│           margin                │  ← 外側の余白
│  ┌───────────────────────────┐  │
│  │        border             │  │  ← 枠線
│  │  ┌─────────────────────┐  │  │
│  │  │      padding        │  │  │  ← 内側の余白
│  │  │  ┌───────────────┐  │  │  │
│  │  │  │   content     │  │  │  │  ← コンテンツ領域
│  │  │  └───────────────┘  │  │  │
│  │  └─────────────────────┘  │  │
│  └───────────────────────────┘  │
└─────────────────────────────────┘
</code></pre><pre data-role="codeBlock" data-info="css" class="language-css css"><code><span class="token comment">/* 標準CSS */</span>
<span class="token selector"><span class="token class">.box</span></span> <span class="token punctuation">{</span>
  <span class="token property">width</span><span class="token punctuation">:</span> <span class="token number">200</span><span class="token unit">px</span><span class="token punctuation">;</span>
  <span class="token property">height</span><span class="token punctuation">:</span> <span class="token number">100</span><span class="token unit">px</span><span class="token punctuation">;</span>
  <span class="token property">padding</span><span class="token punctuation">:</span> <span class="token number">16</span><span class="token unit">px</span><span class="token punctuation">;</span>
  <span class="token property">margin</span><span class="token punctuation">:</span> <span class="token number">8</span><span class="token unit">px</span><span class="token punctuation">;</span>
  <span class="token property">border</span><span class="token punctuation">:</span> <span class="token number">1</span><span class="token unit">px</span> solid <span class="token color">black</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><pre data-role="codeBlock" data-info="typescript" class="language-typescript typescript"><code><span class="token comment">/* Tailwind CSS */</span>
<span class="token operator">&lt;</span>div className<span class="token operator">=</span><span class="token string">"w-[200px] h-[100px] p-4 m-2 border border-black"</span><span class="token operator">&gt;</span>
</code></pre><hr>
<h4 id="主要cssプロパティとtailwind対応表">主要CSSプロパティとTailwind対応表 </h4>
<h5 id="レイアウト">レイアウト </h5>
<table>
<thead>
<tr>
<th>CSS</th>
<th>Tailwind</th>
<th>説明</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>display: flex</code></td>
<td><code>flex</code></td>
<td>フレックスボックス</td>
</tr>
<tr>
<td><code>display: grid</code></td>
<td><code>grid</code></td>
<td>グリッドレイアウト</td>
</tr>
<tr>
<td><code>display: block</code></td>
<td><code>block</code></td>
<td>ブロック要素</td>
</tr>
<tr>
<td><code>display: inline</code></td>
<td><code>inline</code></td>
<td>インライン要素</td>
</tr>
<tr>
<td><code>display: none</code></td>
<td><code>hidden</code></td>
<td>非表示</td>
</tr>
<tr>
<td><code>position: relative</code></td>
<td><code>relative</code></td>
<td>相対配置</td>
</tr>
<tr>
<td><code>position: absolute</code></td>
<td><code>absolute</code></td>
<td>絶対配置</td>
</tr>
<tr>
<td><code>position: fixed</code></td>
<td><code>fixed</code></td>
<td>固定配置</td>
</tr>
<tr>
<td><code>position: sticky</code></td>
<td><code>sticky</code></td>
<td>スティッキー配置</td>
</tr>
</tbody>
</table>
<h5 id="flexbox">Flexbox </h5>
<table>
<thead>
<tr>
<th>CSS</th>
<th>Tailwind</th>
<th>説明</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>flex-direction: row</code></td>
<td><code>flex-row</code></td>
<td>横並び</td>
</tr>
<tr>
<td><code>flex-direction: column</code></td>
<td><code>flex-col</code></td>
<td>縦並び</td>
</tr>
<tr>
<td><code>justify-content: center</code></td>
<td><code>justify-center</code></td>
<td>主軸の中央揃え</td>
</tr>
<tr>
<td><code>justify-content: space-between</code></td>
<td><code>justify-between</code></td>
<td>両端揃え</td>
</tr>
<tr>
<td><code>align-items: center</code></td>
<td><code>items-center</code></td>
<td>交差軸の中央揃え</td>
</tr>
<tr>
<td><code>flex-wrap: wrap</code></td>
<td><code>flex-wrap</code></td>
<td>折り返し</td>
</tr>
<tr>
<td><code>gap: 16px</code></td>
<td><code>gap-4</code></td>
<td>要素間の隙間</td>
</tr>
</tbody>
</table>
<pre data-role="codeBlock" data-info="typescript" class="language-typescript typescript"><code><span class="token comment">// 本プロジェクトでの例（Lightbox.tsx）</span>
<span class="token operator">&lt;</span>div className<span class="token operator">=</span><span class="token string">"fixed inset-0 z-50 flex items-center justify-center"</span><span class="token operator">&gt;</span>
<span class="token comment">// → position: fixed; top/right/bottom/left: 0; z-index: 50;</span>
<span class="token comment">//   display: flex; align-items: center; justify-content: center;</span>
</code></pre><h5 id="サイズ">サイズ </h5>
<table>
<thead>
<tr>
<th>CSS</th>
<th>Tailwind</th>
<th>説明</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>width: 100%</code></td>
<td><code>w-full</code></td>
<td>幅100%</td>
</tr>
<tr>
<td><code>width: 100vw</code></td>
<td><code>w-screen</code></td>
<td>ビューポート幅</td>
</tr>
<tr>
<td><code>width: auto</code></td>
<td><code>w-auto</code></td>
<td>自動</td>
</tr>
<tr>
<td><code>max-width: 1024px</code></td>
<td><code>max-w-4xl</code></td>
<td>最大幅</td>
</tr>
<tr>
<td><code>height: 100%</code></td>
<td><code>h-full</code></td>
<td>高さ100%</td>
</tr>
<tr>
<td><code>height: 100vh</code></td>
<td><code>h-screen</code></td>
<td>ビューポート高さ</td>
</tr>
<tr>
<td><code>min-height: 100vh</code></td>
<td><code>min-h-screen</code></td>
<td>最小高さ</td>
</tr>
</tbody>
</table>
<h5 id="余白spacing">余白（Spacing） </h5>
<p>Tailwindの余白は4pxを1単位とする。</p>
<table>
<thead>
<tr>
<th>CSS</th>
<th>Tailwind</th>
<th>値</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>padding: 0</code></td>
<td><code>p-0</code></td>
<td>0px</td>
</tr>
<tr>
<td><code>padding: 4px</code></td>
<td><code>p-1</code></td>
<td>4px</td>
</tr>
<tr>
<td><code>padding: 8px</code></td>
<td><code>p-2</code></td>
<td>8px</td>
</tr>
<tr>
<td><code>padding: 16px</code></td>
<td><code>p-4</code></td>
<td>16px</td>
</tr>
<tr>
<td><code>padding: 24px</code></td>
<td><code>p-6</code></td>
<td>24px</td>
</tr>
<tr>
<td><code>padding: 32px</code></td>
<td><code>p-8</code></td>
<td>32px</td>
</tr>
<tr>
<td><code>margin: 16px</code></td>
<td><code>m-4</code></td>
<td>16px</td>
</tr>
<tr>
<td><code>margin: auto</code></td>
<td><code>m-auto</code></td>
<td>自動</td>
</tr>
</tbody>
</table>
<p>方向指定:</p>
<ul>
<li><code>p-4</code> → 全方向</li>
<li><code>px-4</code> → 左右（x軸）</li>
<li><code>py-4</code> → 上下（y軸）</li>
<li><code>pt-4</code> → 上（top）</li>
<li><code>pr-4</code> → 右（right）</li>
<li><code>pb-4</code> → 下（bottom）</li>
<li><code>pl-4</code> → 左（left）</li>
</ul>
<h5 id="色">色 </h5>
<pre data-role="codeBlock" data-info="typescript" class="language-typescript typescript"><code><span class="token comment">// 背景色</span>
<span class="token operator">&lt;</span>div className<span class="token operator">=</span><span class="token string">"bg-white"</span><span class="token operator">&gt;</span>        <span class="token comment">// 白</span>
<span class="token operator">&lt;</span>div className<span class="token operator">=</span><span class="token string">"bg-black"</span><span class="token operator">&gt;</span>        <span class="token comment">// 黒</span>
<span class="token operator">&lt;</span>div className<span class="token operator">=</span><span class="token string">"bg-gray-500"</span><span class="token operator">&gt;</span>     <span class="token comment">// グレー</span>
<span class="token operator">&lt;</span>div className<span class="token operator">=</span><span class="token string">"bg-blue-500"</span><span class="token operator">&gt;</span>     <span class="token comment">// 青</span>
<span class="token operator">&lt;</span>div className<span class="token operator">=</span><span class="token string">"bg-red-500"</span><span class="token operator">&gt;</span>      <span class="token comment">// 赤</span>
<span class="token operator">&lt;</span>div className<span class="token operator">=</span><span class="token string">"bg-transparent"</span><span class="token operator">&gt;</span>  <span class="token comment">// 透明</span>

<span class="token comment">// 透明度付き</span>
<span class="token operator">&lt;</span>div className<span class="token operator">=</span><span class="token string">"bg-black/50"</span><span class="token operator">&gt;</span>     <span class="token comment">// 黒、透明度50%</span>
<span class="token operator">&lt;</span>div className<span class="token operator">=</span><span class="token string">"bg-white/10"</span><span class="token operator">&gt;</span>     <span class="token comment">// 白、透明度10%</span>

<span class="token comment">// 文字色</span>
<span class="token operator">&lt;</span>div className<span class="token operator">=</span><span class="token string">"text-white"</span><span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>div className<span class="token operator">=</span><span class="token string">"text-gray-400"</span><span class="token operator">&gt;</span>

<span class="token comment">// 本プロジェクトでの例</span>
<span class="token operator">&lt;</span>div className<span class="token operator">=</span><span class="token string">"bg-black/90 backdrop-blur-sm"</span><span class="token operator">&gt;</span>
<span class="token comment">// → background: rgba(0, 0, 0, 0.9); backdrop-filter: blur(4px);</span>
</code></pre><h5 id="テキスト">テキスト </h5>
<table>
<thead>
<tr>
<th>CSS</th>
<th>Tailwind</th>
<th>説明</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>font-size: 14px</code></td>
<td><code>text-sm</code></td>
<td>小さい文字</td>
</tr>
<tr>
<td><code>font-size: 16px</code></td>
<td><code>text-base</code></td>
<td>基本サイズ</td>
</tr>
<tr>
<td><code>font-size: 18px</code></td>
<td><code>text-lg</code></td>
<td>大きい文字</td>
</tr>
<tr>
<td><code>font-size: 24px</code></td>
<td><code>text-2xl</code></td>
<td>見出し</td>
</tr>
<tr>
<td><code>font-weight: bold</code></td>
<td><code>font-bold</code></td>
<td>太字</td>
</tr>
<tr>
<td><code>font-weight: 600</code></td>
<td><code>font-semibold</code></td>
<td>やや太字</td>
</tr>
<tr>
<td><code>text-align: center</code></td>
<td><code>text-center</code></td>
<td>中央揃え</td>
</tr>
<tr>
<td><code>text-align: left</code></td>
<td><code>text-left</code></td>
<td>左揃え</td>
</tr>
<tr>
<td><code>line-height: 1.5</code></td>
<td><code>leading-relaxed</code></td>
<td>行間</td>
</tr>
</tbody>
</table>
<h5 id="角丸border-radius">角丸（Border Radius） </h5>
<table>
<thead>
<tr>
<th>CSS</th>
<th>Tailwind</th>
<th>値</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>border-radius: 0</code></td>
<td><code>rounded-none</code></td>
<td>なし</td>
</tr>
<tr>
<td><code>border-radius: 4px</code></td>
<td><code>rounded</code></td>
<td>小</td>
</tr>
<tr>
<td><code>border-radius: 8px</code></td>
<td><code>rounded-lg</code></td>
<td>中</td>
</tr>
<tr>
<td><code>border-radius: 16px</code></td>
<td><code>rounded-2xl</code></td>
<td>大</td>
</tr>
<tr>
<td><code>border-radius: 9999px</code></td>
<td><code>rounded-full</code></td>
<td>円形</td>
</tr>
</tbody>
</table>
<h5 id="ボーダー">ボーダー </h5>
<pre data-role="codeBlock" data-info="typescript" class="language-typescript typescript"><code><span class="token operator">&lt;</span>div className<span class="token operator">=</span><span class="token string">"border"</span><span class="token operator">&gt;</span>                  <span class="token comment">// 1px solid</span>
<span class="token operator">&lt;</span>div className<span class="token operator">=</span><span class="token string">"border-2"</span><span class="token operator">&gt;</span>                <span class="token comment">// 2px</span>
<span class="token operator">&lt;</span>div className<span class="token operator">=</span><span class="token string">"border-gray-300"</span><span class="token operator">&gt;</span>         <span class="token comment">// 色指定</span>
<span class="token operator">&lt;</span>div className<span class="token operator">=</span><span class="token string">"border-t"</span><span class="token operator">&gt;</span>                <span class="token comment">// 上だけ</span>
<span class="token operator">&lt;</span>div className<span class="token operator">=</span><span class="token string">"border border-white/50"</span><span class="token operator">&gt;</span>  <span class="token comment">// 透明度付き</span>
</code></pre><h5 id="影box-shadow">影（Box Shadow） </h5>
<table>
<thead>
<tr>
<th>CSS</th>
<th>Tailwind</th>
<th>説明</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>box-shadow: ...</code></td>
<td><code>shadow-sm</code></td>
<td>小さい影</td>
</tr>
<tr>
<td><code>box-shadow: ...</code></td>
<td><code>shadow</code></td>
<td>標準の影</td>
</tr>
<tr>
<td><code>box-shadow: ...</code></td>
<td><code>shadow-lg</code></td>
<td>大きい影</td>
</tr>
<tr>
<td><code>box-shadow: ...</code></td>
<td><code>shadow-xl</code></td>
<td>より大きい影</td>
</tr>
<tr>
<td><code>box-shadow: none</code></td>
<td><code>shadow-none</code></td>
<td>影なし</td>
</tr>
</tbody>
</table>
<h5 id="トランジションアニメーション">トランジション・アニメーション </h5>
<pre data-role="codeBlock" data-info="typescript" class="language-typescript typescript"><code><span class="token comment">// トランジション</span>
<span class="token operator">&lt;</span>div className<span class="token operator">=</span><span class="token string">"transition"</span><span class="token operator">&gt;</span>              <span class="token comment">// すべてのプロパティ</span>
<span class="token operator">&lt;</span>div className<span class="token operator">=</span><span class="token string">"transition-colors"</span><span class="token operator">&gt;</span>       <span class="token comment">// 色のみ</span>
<span class="token operator">&lt;</span>div className<span class="token operator">=</span><span class="token string">"transition-opacity"</span><span class="token operator">&gt;</span>      <span class="token comment">// 透明度のみ</span>
<span class="token operator">&lt;</span>div className<span class="token operator">=</span><span class="token string">"duration-300"</span><span class="token operator">&gt;</span>            <span class="token comment">// 300ms</span>
<span class="token operator">&lt;</span>div className<span class="token operator">=</span><span class="token string">"ease-in-out"</span><span class="token operator">&gt;</span>             <span class="token comment">// イージング</span>

<span class="token comment">// 本プロジェクトでの例（Lightbox.tsx）</span>
<span class="token operator">&lt;</span>button className<span class="token operator">=</span><span class="token string">"transition-colors hover:bg-white/20"</span><span class="token operator">&gt;</span>
<span class="token comment">// → マウスオーバー時に背景色がアニメーション</span>
</code></pre><h5 id="ホバーフォーカス状態">ホバー・フォーカス・状態 </h5>
<pre data-role="codeBlock" data-info="typescript" class="language-typescript typescript"><code><span class="token comment">// ホバー（マウスオーバー）</span>
<span class="token operator">&lt;</span>button className<span class="token operator">=</span><span class="token string">"hover:bg-blue-600"</span><span class="token operator">&gt;</span>

<span class="token comment">// フォーカス（選択時）</span>
<span class="token operator">&lt;</span>input className<span class="token operator">=</span><span class="token string">"focus:ring-2 focus:border-blue-500"</span><span class="token operator">&gt;</span>

<span class="token comment">// アクティブ（クリック中）</span>
<span class="token operator">&lt;</span>button className<span class="token operator">=</span><span class="token string">"active:scale-95"</span><span class="token operator">&gt;</span>

<span class="token comment">// 無効状態</span>
<span class="token operator">&lt;</span>button className<span class="token operator">=</span><span class="token string">"disabled:opacity-50"</span> disabled<span class="token operator">&gt;</span>

<span class="token comment">// グループホバー</span>
<span class="token operator">&lt;</span>div className<span class="token operator">=</span><span class="token string">"group"</span><span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>span className<span class="token operator">=</span><span class="token string">"group-hover:text-blue-500"</span><span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
</code></pre><h5 id="レスポンシブ">レスポンシブ </h5>
<p>画面サイズに応じてスタイルを変更。</p>
<table>
<thead>
<tr>
<th>プレフィックス</th>
<th>最小幅</th>
<th>説明</th>
</tr>
</thead>
<tbody>
<tr>
<td>(なし)</td>
<td>0px</td>
<td>モバイルファースト</td>
</tr>
<tr>
<td><code>sm:</code></td>
<td>640px</td>
<td>小さいタブレット</td>
</tr>
<tr>
<td><code>md:</code></td>
<td>768px</td>
<td>タブレット</td>
</tr>
<tr>
<td><code>lg:</code></td>
<td>1024px</td>
<td>デスクトップ</td>
</tr>
<tr>
<td><code>xl:</code></td>
<td>1280px</td>
<td>大きいデスクトップ</td>
</tr>
<tr>
<td><code>2xl:</code></td>
<td>1536px</td>
<td>超大画面</td>
</tr>
</tbody>
</table>
<pre data-role="codeBlock" data-info="typescript" class="language-typescript typescript"><code><span class="token comment">// モバイルでは1列、タブレット以上では2列、デスクトップでは3列</span>
<span class="token operator">&lt;</span>div className<span class="token operator">=</span><span class="token string">"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3"</span><span class="token operator">&gt;</span>

<span class="token comment">// モバイルでは非表示、デスクトップでは表示</span>
<span class="token operator">&lt;</span>div className<span class="token operator">=</span><span class="token string">"hidden lg:block"</span><span class="token operator">&gt;</span>

<span class="token comment">// 本プロジェクトでの例（Lightbox.tsx）</span>
<span class="token operator">&lt;</span>div className<span class="token operator">=</span><span class="token string">"p-4 sm:p-6"</span><span class="token operator">&gt;</span>
<span class="token comment">// → モバイル: padding: 16px; タブレット以上: padding: 24px;</span>
</code></pre><hr>
<h3 id="よく使うtailwindパターン">よく使うTailwindパターン </h3>
<h4 id="センタリング">センタリング </h4>
<pre data-role="codeBlock" data-info="typescript" class="language-typescript typescript"><code><span class="token comment">// Flexboxで中央揃え</span>
<span class="token operator">&lt;</span>div className<span class="token operator">=</span><span class="token string">"flex items-center justify-center"</span><span class="token operator">&gt;</span>

<span class="token comment">// 水平方向のみ中央</span>
<span class="token operator">&lt;</span>div className<span class="token operator">=</span><span class="token string">"mx-auto max-w-4xl"</span><span class="token operator">&gt;</span>

<span class="token comment">// 絶対配置で中央</span>
<span class="token operator">&lt;</span>div className<span class="token operator">=</span><span class="token string">"absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2"</span><span class="token operator">&gt;</span>
</code></pre><h4 id="フルスクリーンオーバーレイ">フルスクリーンオーバーレイ </h4>
<pre data-role="codeBlock" data-info="typescript" class="language-typescript typescript"><code><span class="token comment">// 本プロジェクトでの例（Lightbox.tsx）</span>
<span class="token operator">&lt;</span>div className<span class="token operator">=</span><span class="token string">"fixed inset-0 z-50 flex items-center justify-center bg-black/90"</span><span class="token operator">&gt;</span>
<span class="token comment">// → 画面全体を覆う半透明の黒背景</span>
</code></pre><h4 id="カード">カード </h4>
<pre data-role="codeBlock" data-info="typescript" class="language-typescript typescript"><code><span class="token operator">&lt;</span>div className<span class="token operator">=</span><span class="token string">"rounded-lg bg-white p-4 shadow-lg"</span><span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>h2 className<span class="token operator">=</span><span class="token string">"text-lg font-bold"</span><span class="token operator">&gt;</span>タイトル<span class="token operator">&lt;</span><span class="token operator">/</span>h2<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>p className<span class="token operator">=</span><span class="token string">"text-gray-600"</span><span class="token operator">&gt;</span>内容<span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
</code></pre><h4 id="ボタン">ボタン </h4>
<pre data-role="codeBlock" data-info="typescript" class="language-typescript typescript"><code><span class="token operator">&lt;</span>button className<span class="token operator">=</span><span class="token string">"rounded-lg bg-blue-500 px-4 py-2 text-white transition-colors hover:bg-blue-600"</span><span class="token operator">&gt;</span>
  クリック
<span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span>
</code></pre><h4 id="入力フィールド">入力フィールド </h4>
<pre data-role="codeBlock" data-info="typescript" class="language-typescript typescript"><code><span class="token operator">&lt;</span>input
  className<span class="token operator">=</span><span class="token string">"w-full rounded-lg border border-gray-300 px-4 py-2 focus:border-blue-500 focus:outline-none focus:ring-2 focus:ring-blue-500/50"</span>
  type<span class="token operator">=</span><span class="token string">"text"</span>
<span class="token operator">/</span><span class="token operator">&gt;</span>
</code></pre><hr>
<h2 id="react基礎概念">React基礎概念 </h2>
<p>Reactを理解するための核となる概念を解説します。</p>
<h3 id="コンポーネントcomponent">コンポーネント（Component） </h3>
<p>UIを構成する再利用可能なパーツ。関数として定義する。</p>
<pre data-role="codeBlock" data-info="typescript" class="language-typescript typescript"><code><span class="token comment">// 最もシンプルなコンポーネント</span>
<span class="token keyword keyword-function">function</span> <span class="token function">HelloWorld</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword keyword-return">return</span> <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>Hello<span class="token punctuation">,</span> World<span class="token operator">!</span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
<span class="token punctuation">}</span>

<span class="token comment">// propsを受け取るコンポーネント</span>
<span class="token keyword keyword-type">type</span> <span class="token class-name">GreetingProps</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
  name<span class="token operator">:</span> <span class="token builtin">string</span>
  age<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">number</span>  <span class="token comment">// オプショナル</span>
<span class="token punctuation">}</span>

<span class="token keyword keyword-function">function</span> <span class="token function">Greeting</span><span class="token punctuation">(</span><span class="token punctuation">{</span> name<span class="token punctuation">,</span> age <span class="token punctuation">}</span><span class="token operator">:</span> GreetingProps<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword keyword-return">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>p<span class="token operator">&gt;</span>Hello<span class="token punctuation">,</span> <span class="token punctuation">{</span>name<span class="token punctuation">}</span><span class="token operator">!</span><span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">&gt;</span>
      <span class="token punctuation">{</span>age <span class="token operator">&amp;&amp;</span> <span class="token operator">&lt;</span>p<span class="token operator">&gt;</span>You are <span class="token punctuation">{</span>age<span class="token punctuation">}</span> years old<span class="token punctuation">.</span><span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">&gt;</span><span class="token punctuation">}</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
  <span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">// 使用例</span>
<span class="token operator">&lt;</span>Greeting name<span class="token operator">=</span><span class="token string">"haroin57"</span> age<span class="token operator">=</span><span class="token punctuation">{</span><span class="token number">25</span><span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
</code></pre><h3 id="jsx">JSX </h3>
<p>JavaScriptの中にHTMLライクな構文を書ける拡張構文。</p>
<pre data-role="codeBlock" data-info="typescript" class="language-typescript typescript"><code><span class="token comment">// JSXの基本</span>
<span class="token keyword keyword-const">const</span> element <span class="token operator">=</span> <span class="token operator">&lt;</span>h1<span class="token operator">&gt;</span>Hello<span class="token punctuation">,</span> World<span class="token operator">!</span><span class="token operator">&lt;</span><span class="token operator">/</span>h1<span class="token operator">&gt;</span>

<span class="token comment">// JavaScript式の埋め込み（{}で囲む）</span>
<span class="token keyword keyword-const">const</span> name <span class="token operator">=</span> <span class="token string">'haroin57'</span>
<span class="token keyword keyword-const">const</span> element <span class="token operator">=</span> <span class="token operator">&lt;</span>h1<span class="token operator">&gt;</span>Hello<span class="token punctuation">,</span> <span class="token punctuation">{</span>name<span class="token punctuation">}</span><span class="token operator">!</span><span class="token operator">&lt;</span><span class="token operator">/</span>h1<span class="token operator">&gt;</span>

<span class="token comment">// 条件付きレンダリング</span>
<span class="token keyword keyword-function">function</span> <span class="token function">Status</span><span class="token punctuation">(</span><span class="token punctuation">{</span> isLoggedIn <span class="token punctuation">}</span><span class="token operator">:</span> <span class="token punctuation">{</span> isLoggedIn<span class="token operator">:</span> <span class="token builtin">boolean</span> <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword keyword-return">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>
      <span class="token punctuation">{</span>isLoggedIn <span class="token operator">?</span> <span class="token punctuation">(</span>
        <span class="token operator">&lt;</span>p<span class="token operator">&gt;</span>ログイン中<span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">&gt;</span>
      <span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token punctuation">(</span>
        <span class="token operator">&lt;</span>p<span class="token operator">&gt;</span>ログインしてください<span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">&gt;</span>
      <span class="token punctuation">)</span><span class="token punctuation">}</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
  <span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">// 条件付き表示（&amp;&amp;演算子）</span>
<span class="token keyword keyword-function">function</span> <span class="token function">MaybeShow</span><span class="token punctuation">(</span><span class="token punctuation">{</span> show<span class="token punctuation">,</span> message <span class="token punctuation">}</span><span class="token operator">:</span> <span class="token punctuation">{</span> show<span class="token operator">:</span> <span class="token builtin">boolean</span><span class="token punctuation">;</span> message<span class="token operator">:</span> <span class="token builtin">string</span> <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword keyword-return">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>
      <span class="token punctuation">{</span>show <span class="token operator">&amp;&amp;</span> <span class="token operator">&lt;</span>p<span class="token operator">&gt;</span><span class="token punctuation">{</span>message<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">&gt;</span><span class="token punctuation">}</span>  <span class="token punctuation">{</span><span class="token comment">/* showがtrueの時のみ表示 */</span><span class="token punctuation">}</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
  <span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><h3 id="フックhooks">フック（Hooks） </h3>
<p>関数コンポーネントに状態や副作用などの機能を追加する関数。</p>
<pre data-role="codeBlock" data-info="typescript" class="language-typescript typescript"><code><span class="token comment">// useで始まる関数がフック</span>
<span class="token keyword keyword-import">import</span> <span class="token punctuation">{</span> useState<span class="token punctuation">,</span> useEffect<span class="token punctuation">,</span> useCallback <span class="token punctuation">}</span> <span class="token keyword keyword-from">from</span> <span class="token string">'react'</span>

<span class="token keyword keyword-function">function</span> <span class="token function">Counter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// フックはコンポーネントの最上位で呼び出す</span>
  <span class="token keyword keyword-const">const</span> <span class="token punctuation">[</span>count<span class="token punctuation">,</span> setCount<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>  <span class="token comment">// ✅ OK</span>

  <span class="token comment">// ❌ 条件分岐の中で呼び出すのはNG</span>
  <span class="token comment">// if (someCondition) {</span>
  <span class="token comment">//   const [value, setValue] = useState(0)  // Error</span>
  <span class="token comment">// }</span>

  <span class="token keyword keyword-return">return</span> <span class="token operator">&lt;</span>button onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">setCount</span><span class="token punctuation">(</span>count <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token operator">&gt;</span><span class="token punctuation">{</span>count<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span>
<span class="token punctuation">}</span>
</code></pre><h3 id="再レンダリングre-rendering">再レンダリング（Re-rendering） </h3>
<p>Reactは状態が変更されると、そのコンポーネントを再度実行（再レンダリング）する。</p>
<pre data-role="codeBlock" data-info="typescript" class="language-typescript typescript"><code><span class="token keyword keyword-function">function</span> <span class="token function">Counter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'レンダリング実行'</span><span class="token punctuation">)</span>  <span class="token comment">// 状態が変わるたびに出力</span>

  <span class="token keyword keyword-const">const</span> <span class="token punctuation">[</span>count<span class="token punctuation">,</span> setCount<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>

  <span class="token keyword keyword-return">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>p<span class="token operator">&gt;</span>Count<span class="token operator">:</span> <span class="token punctuation">{</span>count<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>button onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">setCount</span><span class="token punctuation">(</span>count <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token operator">&gt;</span>
        <span class="token operator">+</span><span class="token number">1</span>
      <span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
  <span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">// クリックするたびに:</span>
<span class="token comment">// 1. setCountが呼ばれる</span>
<span class="token comment">// 2. countの値が更新される</span>
<span class="token comment">// 3. Counterコンポーネントが再レンダリングされる</span>
<span class="token comment">// 4. 新しいcountの値でUIが更新される</span>
</code></pre><hr>
<h2 id="依存関係一覧">依存関係一覧 </h2>
<h3 id="外部ライブラリ詳細解説">外部ライブラリ詳細解説 </h3>
<h4 id="react関連">React関連 </h4>
<h5 id="react"><code>react</code> </h5>
<p>Reactは、Facebookが開発したUIライブラリ。コンポーネントベースの宣言的UIを構築できる。</p>
<p><strong>インポートされるAPI一覧:</strong></p>
<table>
<thead>
<tr>
<th>API</th>
<th>説明</th>
<th>使用ファイル例</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>useState</code></td>
<td>コンポーネント内で状態を管理するフック</td>
<td>全ページコンポーネント</td>
</tr>
<tr>
<td><code>useEffect</code></td>
<td>副作用（API呼び出し、DOM操作等）を実行するフック</td>
<td>全ページコンポーネント</td>
</tr>
<tr>
<td><code>useCallback</code></td>
<td>コールバック関数をメモ化し、不要な再レンダリングを防ぐ</td>
<td>イベントハンドラ定義</td>
</tr>
<tr>
<td><code>useMemo</code></td>
<td>計算結果をメモ化し、パフォーマンスを最適化</td>
<td><code>Posts.tsx</code>, <code>PostDetail.tsx</code>, <code>MarkdownEditor.tsx</code></td>
</tr>
<tr>
<td><code>useRef</code></td>
<td>ミュータブルな参照を保持。DOM参照やタイマーID等に使用</td>
<td>全ページコンポーネント</td>
</tr>
<tr>
<td><code>useContext</code></td>
<td>Contextから値を取得するフック</td>
<td><code>AdminAuthContext.tsx</code></td>
</tr>
<tr>
<td><code>createContext</code></td>
<td>Context（コンポーネントツリー全体で値を共有する仕組み）を作成</td>
<td><code>AdminAuthContext.tsx</code></td>
</tr>
<tr>
<td><code>lazy</code></td>
<td>コンポーネントの遅延読み込み（コード分割）</td>
<td><code>AnimatedRoutes.tsx</code></td>
</tr>
<tr>
<td><code>Suspense</code></td>
<td>遅延読み込み中のフォールバックUIを表示</td>
<td><code>AnimatedRoutes.tsx</code></td>
</tr>
<tr>
<td><code>createRef</code></td>
<td>ref オブジェクトを作成</td>
<td>（現状未使用）</td>
</tr>
<tr>
<td><code>useLayoutEffect</code></td>
<td>DOM変更後、ブラウザ描画前に同期的に実行</td>
<td>（現状未使用）</td>
</tr>
<tr>
<td><code>startTransition</code></td>
<td>低優先度の状態更新をマーク（Concurrent Mode）</td>
<td><code>Posts.tsx</code>, <code>PostDetail.tsx</code></td>
</tr>
<tr>
<td><code>ReactNode</code></td>
<td>Reactがレンダリングできるすべての型</td>
<td>型定義</td>
</tr>
</tbody>
</table>
<hr>
<h6 id="usestate---状態管理フック"><code>useState</code> - 状態管理フック </h6>
<p>コンポーネント内でリアクティブな状態を管理するための基本フック。状態が変更されるとコンポーネントが再レンダリングされる。</p>
<p><strong>💡 初学者向け解説:</strong></p>
<p>「状態（state）」とは、コンポーネントが記憶しておきたいデータのこと。例えば：</p>
<ul>
<li>フォームに入力された文字</li>
<li>ボタンがクリックされた回数</li>
<li>APIから取得したデータ</li>
<li>ローディング中かどうか</li>
</ul>
<p>普通の変数（<code>let count = 0</code>）は、コンポーネントが再レンダリングされるたびにリセットされてしまう。<code>useState</code>を使うと、再レンダリングしても値が保持される。</p>
<pre data-role="codeBlock" data-info="typescript" class="language-typescript typescript"><code><span class="token comment">// ❌ 普通の変数: クリックしてもcountは常に0のまま</span>
<span class="token keyword keyword-function">function</span> <span class="token function">Counter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword keyword-let">let</span> count <span class="token operator">=</span> <span class="token number">0</span>  <span class="token comment">// 再レンダリングのたびに0にリセット</span>
  <span class="token keyword keyword-return">return</span> <span class="token operator">&lt;</span>button onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> count<span class="token operator">++</span><span class="token punctuation">}</span><span class="token operator">&gt;</span><span class="token punctuation">{</span>count<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span>
<span class="token punctuation">}</span>

<span class="token comment">// ✅ useState: クリックするとcountが増える</span>
<span class="token keyword keyword-function">function</span> <span class="token function">Counter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword keyword-const">const</span> <span class="token punctuation">[</span>count<span class="token punctuation">,</span> setCount<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>  <span class="token comment">// 値が保持される</span>
  <span class="token keyword keyword-return">return</span> <span class="token operator">&lt;</span>button onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">setCount</span><span class="token punctuation">(</span>count <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token operator">&gt;</span><span class="token punctuation">{</span>count<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span>
<span class="token punctuation">}</span>
</code></pre><p><strong>シグネチャ:</strong></p>
<pre data-role="codeBlock" data-info="typescript" class="language-typescript typescript"><code><span class="token keyword keyword-const">const</span> <span class="token punctuation">[</span>state<span class="token punctuation">,</span> setState<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token generic-function"><span class="token function">useState</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>initialValue<span class="token operator">:</span> <span class="token constant">T</span> <span class="token operator">|</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token constant">T</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre><p><strong>構文の読み方:</strong></p>
<ul>
<li><code>const [state, setState]</code> → 配列の分割代入。<code>useState</code>は[現在の値, 更新関数]の配列を返す</li>
<li><code>useState&lt;T&gt;</code> → ジェネリクス。<code>T</code>は状態の型（省略すると自動推論）</li>
<li><code>initialValue</code> → 最初に設定される値</li>
</ul>
<p><strong>引数:</strong></p>
<ul>
<li><code>initialValue</code>: 状態の初期値。関数を渡すと遅延初期化（初回レンダリング時のみ実行）</li>
</ul>
<p><strong>戻り値:</strong></p>
<ul>
<li><code>state</code>: 現在の状態値</li>
<li><code>setState</code>: 状態を更新する関数。新しい値または更新関数を受け取る</li>
</ul>
<p><strong>本プロジェクトでの使用例:</strong></p>
<pre data-role="codeBlock" data-info="typescript" class="language-typescript typescript"><code><span class="token comment">// BBSList.tsx - シンプルな状態管理</span>
<span class="token keyword keyword-const">const</span> <span class="token punctuation">[</span>threads<span class="token punctuation">,</span> setThreads<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token generic-function"><span class="token function">useState</span><span class="token generic class-name"><span class="token operator">&lt;</span>Thread<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token keyword keyword-const">const</span> <span class="token punctuation">[</span>isLoading<span class="token punctuation">,</span> setIsLoading<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span>
<span class="token keyword keyword-const">const</span> <span class="token punctuation">[</span>error<span class="token punctuation">,</span> setError<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token generic-function"><span class="token function">useState</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token builtin">string</span> <span class="token operator">|</span> <span class="token keyword keyword-null">null</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token keyword keyword-null">null</span><span class="token punctuation">)</span>

<span class="token comment">// フォーム入力の状態管理</span>
<span class="token keyword keyword-const">const</span> <span class="token punctuation">[</span>title<span class="token punctuation">,</span> setTitle<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span>
<span class="token keyword keyword-const">const</span> <span class="token punctuation">[</span>content<span class="token punctuation">,</span> setContent<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span>

<span class="token comment">// 状態の更新</span>
<span class="token function">setThreads</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span>threads<span class="token punctuation">)</span>  <span class="token comment">// 直接値を設定</span>
<span class="token function">setThreads</span><span class="token punctuation">(</span><span class="token punctuation">(</span>prev<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">[</span>newThread<span class="token punctuation">,</span> <span class="token operator">...</span>prev<span class="token punctuation">]</span><span class="token punctuation">)</span>  <span class="token comment">// 関数形式で前の状態を参照</span>
</code></pre><pre data-role="codeBlock" data-info="typescript" class="language-typescript typescript"><code><span class="token comment">// PostEditor.tsx - オブジェクト状態の管理</span>
<span class="token keyword keyword-const">const</span> <span class="token punctuation">[</span>formData<span class="token punctuation">,</span> setFormData<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  slug<span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span>
  title<span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span>
  summary<span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span>
  tags<span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// オブジェクトの一部を更新（スプレッド構文を使用）</span>
<span class="token function">setFormData</span><span class="token punctuation">(</span><span class="token punctuation">(</span>prev<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token operator">...</span>prev<span class="token punctuation">,</span> title<span class="token operator">:</span> e<span class="token punctuation">.</span>target<span class="token punctuation">.</span>value <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre><pre data-role="codeBlock" data-info="typescript" class="language-typescript typescript"><code><span class="token comment">// AccessCounter.tsx - 遅延初期化</span>
<span class="token keyword keyword-const">const</span> cached <span class="token operator">=</span> <span class="token keyword keyword-typeof">typeof</span> window <span class="token operator">!==</span> <span class="token string">'undefined'</span>
  <span class="token operator">?</span> <span class="token function">Number</span><span class="token punctuation">(</span>localStorage<span class="token punctuation">.</span><span class="token function">getItem</span><span class="token punctuation">(</span><span class="token constant">CACHE_KEY</span><span class="token punctuation">)</span> <span class="token operator">??</span> <span class="token string">'0'</span><span class="token punctuation">)</span>
  <span class="token operator">:</span> <span class="token number">0</span>
<span class="token keyword keyword-const">const</span> <span class="token punctuation">[</span>count<span class="token punctuation">,</span> setCount<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token generic-function"><span class="token function">useState</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token builtin">number</span> <span class="token operator">|</span> <span class="token keyword keyword-null">null</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>
  Number<span class="token punctuation">.</span><span class="token function">isFinite</span><span class="token punctuation">(</span>cached<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> cached <span class="token operator">&gt;</span> <span class="token number">0</span> <span class="token operator">?</span> cached <span class="token operator">:</span> <span class="token keyword keyword-null">null</span>
<span class="token punctuation">)</span>
</code></pre><p><strong>注意点:</strong></p>
<ul>
<li>状態更新は非同期的にバッチ処理される</li>
<li>オブジェクトや配列を更新する際は、新しい参照を作成する必要がある（イミュータブル更新）</li>
<li>前の状態に依存する更新は関数形式を使用する</li>
</ul>
<hr>
<h6 id="useeffect---副作用フック"><code>useEffect</code> - 副作用フック </h6>
<p>コンポーネントのレンダリング後に副作用（API呼び出し、DOM操作、イベントリスナー登録等）を実行するフック。</p>
<p><strong>💡 初学者向け解説:</strong></p>
<p>「副作用（side effect）」とは、コンポーネントの描画（レンダリング）以外の処理のこと：</p>
<ul>
<li>サーバーからデータを取得する（fetch）</li>
<li>ページタイトルを変更する（document.title）</li>
<li>タイマーを設定する（setTimeout）</li>
<li>イベントリスナーを登録する（addEventListener）</li>
<li>ローカルストレージに保存する</li>
</ul>
<p>これらは「画面を描く」という本来の役割とは別の「副次的な効果」なので副作用と呼ぶ。</p>
<pre data-role="codeBlock" data-info="typescript" class="language-typescript typescript"><code><span class="token comment">// 基本形: コンポーネントが表示された時に何かする</span>
<span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'コンポーネントが表示されました！'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

<span class="token comment">// クリーンアップ付き: コンポーネントが消える時に後片付け</span>
<span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword keyword-const">const</span> timer <span class="token operator">=</span> <span class="token function">setInterval</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'tick'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span>

  <span class="token comment">// この関数はコンポーネントが消える時に呼ばれる</span>
  <span class="token keyword keyword-return">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">clearInterval</span><span class="token punctuation">(</span>timer<span class="token punctuation">)</span>  <span class="token comment">// タイマーを停止</span>
    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'クリーンアップ完了'</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre><p><strong>シグネチャ:</strong></p>
<pre data-role="codeBlock" data-info="typescript" class="language-typescript typescript"><code><span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token function-variable function">effect</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword keyword-void">void</span> <span class="token operator">|</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword keyword-void">void</span><span class="token punctuation">)</span><span class="token punctuation">,</span> deps<span class="token operator">?</span><span class="token operator">:</span> DependencyList<span class="token punctuation">)</span>
</code></pre><p><strong>構文の読み方:</strong></p>
<ul>
<li><code>effect</code> → 実行したい処理を書いた関数（アロー関数で書くことが多い）</li>
<li><code>() =&gt; void | (() =&gt; void)</code> → 戻り値は「なし」または「クリーンアップ関数」</li>
<li><code>deps</code> → 依存配列。省略可能だが通常は指定する</li>
</ul>
<p><strong>引数:</strong></p>
<ul>
<li><code>effect</code>: 副作用を実行する関数。クリーンアップ関数を返すことができる</li>
<li><code>deps</code>: 依存配列。この配列内の値が変更された時のみエフェクトが再実行される</li>
</ul>
<p><strong>依存配列のパターン:</strong></p>
<table>
<thead>
<tr>
<th>書き方</th>
<th>意味</th>
<th>実行タイミング</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>[]</code></td>
<td>空配列</td>
<td>マウント時に1回だけ</td>
</tr>
<tr>
<td><code>[value]</code></td>
<td>値を指定</td>
<td>マウント時 + valueが変わった時</td>
</tr>
<tr>
<td><code>[a, b]</code></td>
<td>複数指定</td>
<td>マウント時 + aまたはbが変わった時</td>
</tr>
<tr>
<td>省略</td>
<td>なし</td>
<td>毎回のレンダリング後（非推奨）</td>
</tr>
</tbody>
</table>
<pre data-role="codeBlock" data-info="typescript" class="language-typescript typescript"><code><span class="token comment">// パターン1: マウント時のみ（APIから初期データ取得など）</span>
<span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token function">fetchData</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>  <span class="token comment">// 空配列 = 一度だけ</span>

<span class="token comment">// パターン2: 依存値が変わった時（検索条件が変わったら再検索など）</span>
<span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token function">search</span><span class="token punctuation">(</span>query<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>query<span class="token punctuation">]</span><span class="token punctuation">)</span>  <span class="token comment">// queryが変わるたびに実行</span>

<span class="token comment">// パターン3: 複数の依存値</span>
<span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token function">updateFilter</span><span class="token punctuation">(</span>category<span class="token punctuation">,</span> sort<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>category<span class="token punctuation">,</span> sort<span class="token punctuation">]</span><span class="token punctuation">)</span>  <span class="token comment">// どちらかが変わったら実行</span>
</code></pre><p><strong>本プロジェクトでの使用例:</strong></p>
<pre data-role="codeBlock" data-info="typescript" class="language-typescript typescript"><code><span class="token comment">// AdminAuthContext.tsx - Firebase認証状態の監視</span>
<span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword keyword-const">const</span> unsubscribe <span class="token operator">=</span> <span class="token function">onAuthStateChanged</span><span class="token punctuation">(</span>auth<span class="token punctuation">,</span> <span class="token keyword keyword-async">async</span> <span class="token punctuation">(</span>firebaseUser<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">setUser</span><span class="token punctuation">(</span>firebaseUser<span class="token punctuation">)</span>
    <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>firebaseUser<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword keyword-const">const</span> token <span class="token operator">=</span> <span class="token keyword keyword-await">await</span> firebaseUser<span class="token punctuation">.</span><span class="token function">getIdToken</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token function">setIdToken</span><span class="token punctuation">(</span>token<span class="token punctuation">)</span>
    <span class="token punctuation">}</span> <span class="token keyword keyword-else">else</span> <span class="token punctuation">{</span>
      <span class="token function">setIdToken</span><span class="token punctuation">(</span><span class="token keyword keyword-null">null</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token function">setIsLoading</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>

  <span class="token comment">// クリーンアップ: コンポーネントアンマウント時に購読解除</span>
  <span class="token keyword keyword-return">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">unsubscribe</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>  <span class="token comment">// 空配列: マウント時に1回だけ実行</span>
</code></pre><pre data-role="codeBlock" data-info="typescript" class="language-typescript typescript"><code><span class="token comment">// BBSList.tsx - データフェッチ</span>
<span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token function">fetchThreads</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>fetchThreads<span class="token punctuation">]</span><span class="token punctuation">)</span>  <span class="token comment">// fetchThreadsが変更された時に再実行</span>
</code></pre><pre data-role="codeBlock" data-info="typescript" class="language-typescript typescript"><code><span class="token comment">// ScrollTopHomeSwitch.tsx - イベントリスナーの登録と解除</span>
<span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword keyword-const">const</span> <span class="token function-variable function">onWheel</span> <span class="token operator">=</span> <span class="token punctuation">(</span>event<span class="token operator">:</span> WheelEvent<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span> <span class="token comment">/* ... */</span> <span class="token punctuation">}</span>
  <span class="token keyword keyword-const">const</span> <span class="token function-variable function">onTouchStart</span> <span class="token operator">=</span> <span class="token punctuation">(</span>event<span class="token operator">:</span> TouchEvent<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span> <span class="token comment">/* ... */</span> <span class="token punctuation">}</span>

  window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'wheel'</span><span class="token punctuation">,</span> onWheel<span class="token punctuation">,</span> <span class="token punctuation">{</span> passive<span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
  window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'touchstart'</span><span class="token punctuation">,</span> onTouchStart<span class="token punctuation">,</span> <span class="token punctuation">{</span> passive<span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>

  <span class="token comment">// クリーンアップ: イベントリスナーの解除</span>
  <span class="token keyword keyword-return">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    window<span class="token punctuation">.</span><span class="token function">removeEventListener</span><span class="token punctuation">(</span><span class="token string">'wheel'</span><span class="token punctuation">,</span> onWheel<span class="token punctuation">)</span>
    window<span class="token punctuation">.</span><span class="token function">removeEventListener</span><span class="token punctuation">(</span><span class="token string">'touchstart'</span><span class="token punctuation">,</span> onTouchStart<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>location<span class="token punctuation">.</span>pathname<span class="token punctuation">,</span> navigate<span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre><pre data-role="codeBlock" data-info="typescript" class="language-typescript typescript"><code><span class="token comment">// PostDetail.tsx - ページタイトルの設定</span>
<span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>post<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    document<span class="token punctuation">.</span>title <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>post<span class="token punctuation">.</span>title<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> | haroin57</span><span class="token template-punctuation string">`</span></span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>post<span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre><pre data-role="codeBlock" data-info="typescript" class="language-typescript typescript"><code><span class="token comment">// AdminAuthContext.tsx - タイマーのクリーンアップ</span>
<span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword keyword-return">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>sessionTimeoutRef<span class="token punctuation">.</span>current<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">clearTimeout</span><span class="token punctuation">(</span>sessionTimeoutRef<span class="token punctuation">.</span>current<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre><p><strong>注意点:</strong></p>
<ul>
<li>クリーンアップ関数は、依存配列の値が変更される前と、コンポーネントアンマウント時に実行される</li>
<li>依存配列に含めるべき値を省略すると、古い値を参照するバグ（stale closure）が発生する</li>
<li>ESLintの<code>react-hooks/exhaustive-deps</code>ルールで依存配列を検証できる</li>
</ul>
<hr>
<h6 id="usecallback---コールバック関数メモ化フック"><code>useCallback</code> - コールバック関数メモ化フック </h6>
<p>関数をメモ化し、依存配列が変更されない限り同じ関数参照を返す。子コンポーネントへの不要な再レンダリングを防止。</p>
<p><strong>💡 初学者向け解説:</strong></p>
<p>「メモ化（memoization）」とは、計算結果を記憶しておいて再利用する最適化技法のこと。</p>
<p><strong>なぜ必要？</strong></p>
<p>Reactでは、コンポーネントが再レンダリングされるたびに、その中で定義された関数も新しく作り直される。</p>
<pre data-role="codeBlock" data-info="typescript" class="language-typescript typescript"><code><span class="token keyword keyword-function">function</span> <span class="token function">Parent</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 再レンダリングのたびに新しい関数オブジェクトが作られる</span>
  <span class="token keyword keyword-const">const</span> <span class="token function-variable function">handleClick</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span> <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'clicked'</span><span class="token punctuation">)</span> <span class="token punctuation">}</span>

  <span class="token comment">// Childに渡されるhandleClickは毎回「別の関数」と見なされる</span>
  <span class="token keyword keyword-return">return</span> <span class="token operator">&lt;</span>Child onClick<span class="token operator">=</span><span class="token punctuation">{</span>handleClick<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
<span class="token punctuation">}</span>
</code></pre><p>これが問題になるのは：</p>
<ol>
<li>子コンポーネントが「propsが変わった」と判断して不要な再レンダリングをする</li>
<li><code>useEffect</code>の依存配列に関数を入れると、毎回エフェクトが実行される</li>
</ol>
<pre data-role="codeBlock" data-info="typescript" class="language-typescript typescript"><code><span class="token keyword keyword-function">function</span> <span class="token function">Parent</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// useCallbackで関数をメモ化</span>
  <span class="token comment">// 依存配列が変わらない限り、同じ関数参照を返す</span>
  <span class="token keyword keyword-const">const</span> handleClick <span class="token operator">=</span> <span class="token function">useCallback</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'clicked'</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>  <span class="token comment">// 依存なし = ずっと同じ関数</span>

  <span class="token keyword keyword-return">return</span> <span class="token operator">&lt;</span>Child onClick<span class="token operator">=</span><span class="token punctuation">{</span>handleClick<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">&gt;</span>  <span class="token comment">// 同じ参照なので Child は再レンダリングされない</span>
<span class="token punctuation">}</span>
</code></pre><p><strong>シグネチャ:</strong></p>
<pre data-role="codeBlock" data-info="typescript" class="language-typescript typescript"><code><span class="token keyword keyword-const">const</span> memoizedCallback <span class="token operator">=</span> <span class="token function">useCallback</span><span class="token punctuation">(</span>callback<span class="token operator">:</span> <span class="token constant">T</span><span class="token punctuation">,</span> deps<span class="token operator">:</span> DependencyList<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token constant">T</span>
</code></pre><p><strong>構文の読み方:</strong></p>
<ul>
<li><code>callback</code> → メモ化したい関数</li>
<li><code>deps</code> → 依存配列（useEffectと同じ考え方）</li>
<li>戻り値 → メモ化された関数（同じ参照）</li>
</ul>
<p><strong>本プロジェクトでの使用例:</strong></p>
<pre data-role="codeBlock" data-info="typescript" class="language-typescript typescript"><code><span class="token comment">// App.tsx - ナビゲーション関数のメモ化</span>
<span class="token keyword keyword-const">const</span> handleNavigate <span class="token operator">=</span> <span class="token function">useCallback</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token function">navigate</span><span class="token punctuation">(</span><span class="token string">'/home'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>navigate<span class="token punctuation">]</span><span class="token punctuation">)</span>  <span class="token comment">// navigateが変更された時のみ新しい関数を作成</span>
</code></pre><pre data-role="codeBlock" data-info="typescript" class="language-typescript typescript"><code><span class="token comment">// BBSList.tsx - APIコール関数のメモ化</span>
<span class="token keyword keyword-const">const</span> fetchThreads <span class="token operator">=</span> <span class="token function">useCallback</span><span class="token punctuation">(</span><span class="token keyword keyword-async">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword keyword-try">try</span> <span class="token punctuation">{</span>
    <span class="token function">setIsLoading</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span>
    <span class="token keyword keyword-const">const</span> res <span class="token operator">=</span> <span class="token keyword keyword-await">await</span> <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token constant">BBS_ENDPOINT</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">/threads</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
    <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>res<span class="token punctuation">.</span>ok<span class="token punctuation">)</span> <span class="token keyword keyword-throw">throw</span> <span class="token keyword keyword-new">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">'Failed to fetch threads'</span><span class="token punctuation">)</span>
    <span class="token keyword keyword-const">const</span> data <span class="token operator">=</span> <span class="token keyword keyword-await">await</span> res<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword keyword-as">as</span> <span class="token punctuation">{</span> threads<span class="token operator">:</span> Thread<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">}</span>
    <span class="token function">setThreads</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span>threads <span class="token operator">||</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token function">setError</span><span class="token punctuation">(</span><span class="token keyword keyword-null">null</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span> <span class="token keyword keyword-catch">catch</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">'Failed to fetch threads:'</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span>
    <span class="token function">setError</span><span class="token punctuation">(</span><span class="token string">'スレッド一覧の取得に失敗しました'</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span> <span class="token keyword keyword-finally">finally</span> <span class="token punctuation">{</span>
    <span class="token function">setIsLoading</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>  <span class="token comment">// 依存なし: 常に同じ関数</span>

<span class="token comment">// フォーム送信ハンドラのメモ化</span>
<span class="token keyword keyword-const">const</span> handleCreateThread <span class="token operator">=</span> <span class="token function">useCallback</span><span class="token punctuation">(</span>
  <span class="token keyword keyword-async">async</span> <span class="token punctuation">(</span>e<span class="token operator">:</span> React<span class="token punctuation">.</span>FormEvent<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    e<span class="token punctuation">.</span><span class="token function">preventDefault</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>title<span class="token punctuation">.</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token operator">!</span>content<span class="token punctuation">.</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">||</span> isSubmitting<span class="token punctuation">)</span> <span class="token keyword keyword-return">return</span>
    <span class="token comment">// ...処理</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">[</span>title<span class="token punctuation">,</span> content<span class="token punctuation">,</span> isSubmitting<span class="token punctuation">]</span>  <span class="token comment">// これらが変更された時のみ新しい関数</span>
<span class="token punctuation">)</span>
</code></pre><pre data-role="codeBlock" data-info="typescript" class="language-typescript typescript"><code><span class="token comment">// AdminAuthContext.tsx - ログアウト関数のメモ化</span>
<span class="token keyword keyword-const">const</span> logout <span class="token operator">=</span> <span class="token function">useCallback</span><span class="token punctuation">(</span><span class="token keyword keyword-async">async</span> <span class="token punctuation">(</span>skipCallbacks <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword keyword-try">try</span> <span class="token punctuation">{</span>
    <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>skipCallbacks<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword keyword-const">const</span> callbacks <span class="token operator">=</span> <span class="token builtin">Array</span><span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span>beforeLogoutCallbacksRef<span class="token punctuation">.</span>current<span class="token punctuation">)</span>
      <span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span><span class="token keyword keyword-const">const</span> callback <span class="token keyword keyword-of">of</span> callbacks<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword keyword-try">try</span> <span class="token punctuation">{</span>
          <span class="token keyword keyword-await">await</span> <span class="token function">callback</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span> <span class="token keyword keyword-catch">catch</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">'Before logout callback failed:'</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// ...ログアウト処理</span>
  <span class="token punctuation">}</span> <span class="token keyword keyword-catch">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">'Logout failed:'</span><span class="token punctuation">,</span> error<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>  <span class="token comment">// refはレンダリング間で同じなので依存に含めない</span>
</code></pre><p><strong>useCallbackを使うべき場面:</strong></p>
<ol>
<li>関数を子コンポーネントにpropsとして渡す時</li>
<li>関数をuseEffectの依存配列に含める時</li>
<li>高コストな計算を含む関数</li>
</ol>
<p><strong>注意点:</strong></p>
<ul>
<li>すべての関数に使用する必要はない（過度な最適化は複雑さを増す）</li>
<li>依存配列が頻繁に変更される場合、メモ化の効果が薄れる</li>
</ul>
<hr>
<h6 id="usememo---計算結果メモ化フック"><code>useMemo</code> - 計算結果メモ化フック </h6>
<p>計算コストの高い値をメモ化し、依存配列が変更されない限り再計算をスキップ。</p>
<p><strong>💡 初学者向け解説:</strong></p>
<p><code>useCallback</code>が「関数を記憶」するのに対し、<code>useMemo</code>は「関数の実行結果を記憶」する。</p>
<p><strong>なぜ必要？</strong></p>
<p>重い計算処理があると、再レンダリングのたびに毎回計算が走ってしまう。</p>
<pre data-role="codeBlock" data-info="typescript" class="language-typescript typescript"><code><span class="token keyword keyword-function">function</span> <span class="token function">ProductList</span><span class="token punctuation">(</span><span class="token punctuation">{</span> products<span class="token punctuation">,</span> filter <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// ❌ 毎回のレンダリングでフィルタリングが実行される</span>
  <span class="token keyword keyword-const">const</span> filteredProducts <span class="token operator">=</span> products<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>p <span class="token operator">=&gt;</span> p<span class="token punctuation">.</span>category <span class="token operator">===</span> filter<span class="token punctuation">)</span>

  <span class="token keyword keyword-return">return</span> <span class="token operator">&lt;</span>ul<span class="token operator">&gt;</span><span class="token punctuation">{</span>filteredProducts<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>p <span class="token operator">=&gt;</span> <span class="token operator">&lt;</span>li key<span class="token operator">=</span><span class="token punctuation">{</span>p<span class="token punctuation">.</span>id<span class="token punctuation">}</span><span class="token operator">&gt;</span><span class="token punctuation">{</span>p<span class="token punctuation">.</span>name<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>li<span class="token operator">&gt;</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>ul<span class="token operator">&gt;</span>
<span class="token punctuation">}</span>
</code></pre><p><code>useMemo</code>を使うと、依存値が変わった時だけ計算が実行される。</p>
<pre data-role="codeBlock" data-info="typescript" class="language-typescript typescript"><code><span class="token keyword keyword-function">function</span> <span class="token function">ProductList</span><span class="token punctuation">(</span><span class="token punctuation">{</span> products<span class="token punctuation">,</span> filter <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// ✅ productsかfilterが変わった時だけ計算</span>
  <span class="token keyword keyword-const">const</span> filteredProducts <span class="token operator">=</span> <span class="token function">useMemo</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword keyword-return">return</span> products<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>p <span class="token operator">=&gt;</span> p<span class="token punctuation">.</span>category <span class="token operator">===</span> filter<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>products<span class="token punctuation">,</span> filter<span class="token punctuation">]</span><span class="token punctuation">)</span>

  <span class="token keyword keyword-return">return</span> <span class="token operator">&lt;</span>ul<span class="token operator">&gt;</span><span class="token punctuation">{</span>filteredProducts<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>p <span class="token operator">=&gt;</span> <span class="token operator">&lt;</span>li key<span class="token operator">=</span><span class="token punctuation">{</span>p<span class="token punctuation">.</span>id<span class="token punctuation">}</span><span class="token operator">&gt;</span><span class="token punctuation">{</span>p<span class="token punctuation">.</span>name<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>li<span class="token operator">&gt;</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>ul<span class="token operator">&gt;</span>
<span class="token punctuation">}</span>
</code></pre><p><strong><code>useCallback</code>との違い:</strong></p>
<pre data-role="codeBlock" data-info="typescript" class="language-typescript typescript"><code><span class="token comment">// useMemo: 計算結果を記憶</span>
<span class="token keyword keyword-const">const</span> doubled <span class="token operator">=</span> <span class="token function">useMemo</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> numbers<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>n <span class="token operator">=&gt;</span> n <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>numbers<span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token comment">// → doubled は配列 [2, 4, 6, ...]</span>

<span class="token comment">// useCallback: 関数を記憶</span>
<span class="token keyword keyword-const">const</span> double <span class="token operator">=</span> <span class="token function">useCallback</span><span class="token punctuation">(</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> n <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token comment">// → double は関数 (n) =&gt; n * 2</span>
</code></pre><p><strong>シグネチャ:</strong></p>
<pre data-role="codeBlock" data-info="typescript" class="language-typescript typescript"><code><span class="token keyword keyword-const">const</span> memoizedValue <span class="token operator">=</span> <span class="token generic-function"><span class="token function">useMemo</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token function-variable function">factory</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token constant">T</span><span class="token punctuation">,</span> deps<span class="token operator">:</span> DependencyList<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token constant">T</span>
</code></pre><p><strong>構文の読み方:</strong></p>
<ul>
<li><code>factory</code> → 値を計算する関数（この関数の「戻り値」がメモ化される）</li>
<li><code>deps</code> → 依存配列</li>
<li>戻り値 → factory関数の実行結果</li>
</ul>
<p><strong>本プロジェクトでの使用例:</strong></p>
<pre data-role="codeBlock" data-info="typescript" class="language-typescript typescript"><code><span class="token comment">// Posts.tsx - フィルタリングされた記事リストのメモ化</span>
<span class="token keyword keyword-const">const</span> filteredPosts <span class="token operator">=</span> <span class="token function">useMemo</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>selectedTag<span class="token punctuation">)</span> <span class="token keyword keyword-return">return</span> posts
  <span class="token keyword keyword-return">return</span> posts<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>post <span class="token operator">=&gt;</span> post<span class="token punctuation">.</span>tags<span class="token operator">?.</span><span class="token function">includes</span><span class="token punctuation">(</span>selectedTag<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>posts<span class="token punctuation">,</span> selectedTag<span class="token punctuation">]</span><span class="token punctuation">)</span>  <span class="token comment">// postsまたはselectedTagが変更された時のみ再計算</span>
</code></pre><pre data-role="codeBlock" data-info="typescript" class="language-typescript typescript"><code><span class="token comment">// MarkdownEditor.tsx - Frontmatterパース結果のメモ化</span>
<span class="token keyword keyword-const">const</span> <span class="token punctuation">{</span> data<span class="token punctuation">,</span> content <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">useMemo</span><span class="token punctuation">(</span>
  <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">parseFrontmatter</span><span class="token punctuation">(</span>source<span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">[</span>source<span class="token punctuation">]</span>  <span class="token comment">// sourceが変更された時のみ再パース</span>
<span class="token punctuation">)</span>
</code></pre><p><strong>useCallbackとuseMemoの違い:</strong></p>
<pre data-role="codeBlock" data-info="typescript" class="language-typescript typescript"><code><span class="token comment">// useCallback: 関数自体をメモ化</span>
<span class="token keyword keyword-const">const</span> fn <span class="token operator">=</span> <span class="token function">useCallback</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">doSomething</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>a<span class="token punctuation">,</span> b<span class="token punctuation">]</span><span class="token punctuation">)</span>

<span class="token comment">// useMemo: 関数の実行結果をメモ化</span>
<span class="token keyword keyword-const">const</span> value <span class="token operator">=</span> <span class="token function">useMemo</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">computeExpensiveValue</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>a<span class="token punctuation">,</span> b<span class="token punctuation">]</span><span class="token punctuation">)</span>

<span class="token comment">// useCallback(fn, deps) は useMemo(() =&gt; fn, deps) と等価</span>
</code></pre><hr>
<h6 id="useref---ミュータブル参照フック"><code>useRef</code> - ミュータブル参照フック </h6>
<p>レンダリング間で保持されるミュータブルな参照を作成。値を変更しても再レンダリングをトリガーしない。</p>
<p><strong>💡 初学者向け解説:</strong></p>
<p><code>useRef</code>は「箱」のようなもの。中に何でも入れられ、中身を変えてもReactは気にしない（再レンダリングしない）。</p>
<p><strong>useStateとの違い:</strong></p>
<table>
<thead>
<tr>
<th>特性</th>
<th>useState</th>
<th>useRef</th>
</tr>
</thead>
<tbody>
<tr>
<td>値の変更</td>
<td>再レンダリングする</td>
<td>再レンダリングしない</td>
</tr>
<tr>
<td>値の読み方</td>
<td><code>value</code></td>
<td><code>ref.current</code></td>
</tr>
<tr>
<td>主な用途</td>
<td>UIに表示する値</td>
<td>DOM参照、内部フラグ、タイマーID</td>
</tr>
</tbody>
</table>
<p><strong>主な使い方3パターン:</strong></p>
<pre data-role="codeBlock" data-info="typescript" class="language-typescript typescript"><code><span class="token comment">// パターン1: DOM要素への参照</span>
<span class="token keyword keyword-function">function</span> <span class="token function">InputFocus</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword keyword-const">const</span> inputRef <span class="token operator">=</span> <span class="token generic-function"><span class="token function">useRef</span><span class="token generic class-name"><span class="token operator">&lt;</span>HTMLInputElement<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token keyword keyword-null">null</span><span class="token punctuation">)</span>

  <span class="token keyword keyword-const">const</span> <span class="token function-variable function">handleClick</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    inputRef<span class="token punctuation">.</span>current<span class="token operator">?.</span><span class="token function">focus</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment">// inputにフォーカスを当てる</span>
  <span class="token punctuation">}</span>

  <span class="token keyword keyword-return">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span><span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>input ref<span class="token operator">=</span><span class="token punctuation">{</span>inputRef<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>button onClick<span class="token operator">=</span><span class="token punctuation">{</span>handleClick<span class="token punctuation">}</span><span class="token operator">&gt;</span>フォーカス<span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span><span class="token operator">&gt;</span>
  <span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">// パターン2: 値を保持（再レンダリングなしで）</span>
<span class="token keyword keyword-function">function</span> <span class="token function">Timer</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword keyword-const">const</span> countRef <span class="token operator">=</span> <span class="token function">useRef</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>  <span class="token comment">// 内部カウンター</span>

  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword keyword-const">const</span> id <span class="token operator">=</span> <span class="token function">setInterval</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      countRef<span class="token punctuation">.</span>current<span class="token operator">++</span>  <span class="token comment">// 更新してもUIは変わらない</span>
      <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>countRef<span class="token punctuation">.</span>current<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span>
    <span class="token keyword keyword-return">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">clearInterval</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

  <span class="token keyword keyword-return">return</span> <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>コンソールを確認<span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
<span class="token punctuation">}</span>

<span class="token comment">// パターン3: 前回の値を保持</span>
<span class="token keyword keyword-function">function</span> <span class="token function">Counter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword keyword-const">const</span> <span class="token punctuation">[</span>count<span class="token punctuation">,</span> setCount<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
  <span class="token keyword keyword-const">const</span> prevCountRef <span class="token operator">=</span> <span class="token generic-function"><span class="token function">useRef</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token builtin">number</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>

  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    prevCountRef<span class="token punctuation">.</span>current <span class="token operator">=</span> count  <span class="token comment">// レンダリング後に更新</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>

  <span class="token keyword keyword-return">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>
      現在<span class="token operator">:</span> <span class="token punctuation">{</span>count<span class="token punctuation">}</span><span class="token punctuation">,</span> 前回<span class="token operator">:</span> <span class="token punctuation">{</span>prevCountRef<span class="token punctuation">.</span>current<span class="token punctuation">}</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
  <span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><p><strong>シグネチャ:</strong></p>
<pre data-role="codeBlock" data-info="typescript" class="language-typescript typescript"><code><span class="token keyword keyword-const">const</span> ref <span class="token operator">=</span> <span class="token generic-function"><span class="token function">useRef</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>initialValue<span class="token operator">:</span> <span class="token constant">T</span><span class="token punctuation">)</span><span class="token operator">:</span> MutableRefObject<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">&gt;</span>
<span class="token keyword keyword-const">const</span> ref <span class="token operator">=</span> <span class="token generic-function"><span class="token function">useRef</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token keyword keyword-null">null</span><span class="token punctuation">)</span><span class="token operator">:</span> RefObject<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">&gt;</span>  <span class="token comment">// DOM要素用</span>
</code></pre><p><strong>構文の読み方:</strong></p>
<ul>
<li><code>initialValue</code> → 初期値（<code>.current</code>の初期値）</li>
<li><code>.current</code> → 値を読み書きするプロパティ</li>
</ul>
<p><strong>主な用途:</strong></p>
<ol>
<li>DOM要素への参照</li>
<li>タイマーID等のミュータブル値の保持</li>
<li>前回の値の保持</li>
<li>レンダリングをトリガーしない状態の保持</li>
</ol>
<p><strong>本プロジェクトでの使用例:</strong></p>
<pre data-role="codeBlock" data-info="typescript" class="language-typescript typescript"><code><span class="token comment">// DOM要素への参照</span>
<span class="token keyword keyword-const">const</span> pageRef <span class="token operator">=</span> <span class="token generic-function"><span class="token function">useRef</span><span class="token generic class-name"><span class="token operator">&lt;</span>HTMLDivElement <span class="token operator">|</span> <span class="token keyword keyword-null">null</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token keyword keyword-null">null</span><span class="token punctuation">)</span>
<span class="token comment">// JSX内で使用</span>
<span class="token operator">&lt;</span>div ref<span class="token operator">=</span><span class="token punctuation">{</span>pageRef<span class="token punctuation">}</span><span class="token operator">&gt;</span><span class="token operator">...</span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
<span class="token comment">// DOM操作</span>
<span class="token keyword keyword-const">const</span> targets <span class="token operator">=</span> pageRef<span class="token punctuation">.</span>current<span class="token operator">?.</span><span class="token function">querySelectorAll</span><span class="token punctuation">(</span><span class="token string">'.reveal'</span><span class="token punctuation">)</span>
</code></pre><pre data-role="codeBlock" data-info="typescript" class="language-typescript typescript"><code><span class="token comment">// AdminAuthContext.tsx - タイマーIDの保持</span>
<span class="token keyword keyword-const">const</span> sessionTimeoutRef <span class="token operator">=</span> <span class="token generic-function"><span class="token function">useRef</span><span class="token generic class-name"><span class="token operator">&lt;</span>ReturnType<span class="token operator">&lt;</span><span class="token keyword keyword-typeof">typeof</span> setTimeout<span class="token operator">&gt;</span> <span class="token operator">|</span> <span class="token keyword keyword-null">null</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token keyword keyword-null">null</span><span class="token punctuation">)</span>

<span class="token comment">// タイマー設定</span>
sessionTimeoutRef<span class="token punctuation">.</span>current <span class="token operator">=</span> <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword keyword-async">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword keyword-await">await</span> <span class="token function">logout</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token constant">SESSION_TIMEOUT_MS</span><span class="token punctuation">)</span>

<span class="token comment">// タイマークリア</span>
<span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>sessionTimeoutRef<span class="token punctuation">.</span>current<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">clearTimeout</span><span class="token punctuation">(</span>sessionTimeoutRef<span class="token punctuation">.</span>current<span class="token punctuation">)</span>
  sessionTimeoutRef<span class="token punctuation">.</span>current <span class="token operator">=</span> <span class="token keyword keyword-null">null</span>
<span class="token punctuation">}</span>
</code></pre><pre data-role="codeBlock" data-info="typescript" class="language-typescript typescript"><code><span class="token comment">// AdminAuthContext.tsx - コールバック関数セットの保持</span>
<span class="token keyword keyword-const">const</span> beforeLogoutCallbacksRef <span class="token operator">=</span> <span class="token generic-function"><span class="token function">useRef</span><span class="token generic class-name"><span class="token operator">&lt;</span>Set<span class="token operator">&lt;</span>BeforeLogoutCallback<span class="token operator">&gt;&gt;</span></span></span><span class="token punctuation">(</span><span class="token keyword keyword-new">new</span> <span class="token class-name">Set</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment">// コールバック登録</span>
beforeLogoutCallbacksRef<span class="token punctuation">.</span>current<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>callback<span class="token punctuation">)</span>

<span class="token comment">// コールバック削除</span>
beforeLogoutCallbacksRef<span class="token punctuation">.</span>current<span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span>callback<span class="token punctuation">)</span>
</code></pre><pre data-role="codeBlock" data-info="typescript" class="language-typescript typescript"><code><span class="token comment">// AccessCounter.tsx - 重複実行防止フラグ</span>
<span class="token keyword keyword-const">const</span> didSend <span class="token operator">=</span> <span class="token function">useRef</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span>

<span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>didSend<span class="token punctuation">.</span>current<span class="token punctuation">)</span> <span class="token keyword keyword-return">return</span>  <span class="token comment">// 既に送信済みならスキップ</span>
  didSend<span class="token punctuation">.</span>current <span class="token operator">=</span> <span class="token boolean">true</span>
  <span class="token comment">// APIコール...</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre><pre data-role="codeBlock" data-info="typescript" class="language-typescript typescript"><code><span class="token comment">// ScrollTopHomeSwitch.tsx - 累積値の保持</span>
<span class="token keyword keyword-const">const</span> wheelAccumRef <span class="token operator">=</span> <span class="token function">useRef</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
<span class="token keyword keyword-const">const</span> wheelLastAtRef <span class="token operator">=</span> <span class="token function">useRef</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>

<span class="token comment">// イベントハンドラ内で更新（再レンダリングなし）</span>
wheelAccumRef<span class="token punctuation">.</span>current <span class="token operator">+=</span> deltaY
wheelLastAtRef<span class="token punctuation">.</span>current <span class="token operator">=</span> now
</code></pre><pre data-role="codeBlock" data-info="typescript" class="language-typescript typescript"><code><span class="token comment">// AnimatedRoutes.tsx - マウント状態の追跡</span>
<span class="token keyword keyword-const">const</span> hasMountedRef <span class="token operator">=</span> <span class="token function">useRef</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span>

<span class="token function">useLayoutEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>hasMountedRef<span class="token punctuation">.</span>current<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    hasMountedRef<span class="token punctuation">.</span>current <span class="token operator">=</span> <span class="token boolean">true</span>
    <span class="token keyword keyword-return">return</span>  <span class="token comment">// 初回はスキップ</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// 2回目以降の処理...</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>location<span class="token punctuation">.</span>pathname<span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre><p><strong>useStateとuseRefの使い分け:</strong></p>
<table>
<thead>
<tr>
<th>特性</th>
<th>useState</th>
<th>useRef</th>
</tr>
</thead>
<tbody>
<tr>
<td>値変更時の再レンダリング</td>
<td>する</td>
<td>しない</td>
</tr>
<tr>
<td>用途</td>
<td>UIに表示する値</td>
<td>DOM参照、タイマーID、内部フラグ</td>
</tr>
<tr>
<td>値の読み取り</td>
<td>直接</td>
<td><code>.current</code>プロパティ経由</td>
</tr>
</tbody>
</table>
<hr>
<h6 id="usecontext---コンテキスト消費フック"><code>useContext</code> - コンテキスト消費フック </h6>
<p>Contextから現在の値を取得するフック。Providerで包まれた子孫コンポーネントで使用。</p>
<p><strong>💡 初学者向け解説:</strong></p>
<p>通常、データを子コンポーネントに渡すには props を使う。しかし、深くネストしたコンポーネントにデータを渡すには、途中のすべてのコンポーネントを経由する必要がある（「props drilling」問題）。</p>
<pre data-role="codeBlock" data-info="typescript" class="language-typescript typescript"><code><span class="token comment">// ❌ props drilling: 中間コンポーネントがthemeを使わないのに渡している</span>
<span class="token keyword keyword-function">function</span> <span class="token function">App</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword keyword-const">const</span> theme <span class="token operator">=</span> <span class="token string">'dark'</span>
  <span class="token keyword keyword-return">return</span> <span class="token operator">&lt;</span>Header theme<span class="token operator">=</span><span class="token punctuation">{</span>theme<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
<span class="token punctuation">}</span>
<span class="token keyword keyword-function">function</span> <span class="token function">Header</span><span class="token punctuation">(</span><span class="token punctuation">{</span> theme <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword keyword-return">return</span> <span class="token operator">&lt;</span>Nav theme<span class="token operator">=</span><span class="token punctuation">{</span>theme<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
<span class="token punctuation">}</span>
<span class="token keyword keyword-function">function</span> <span class="token function">Nav</span><span class="token punctuation">(</span><span class="token punctuation">{</span> theme <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword keyword-return">return</span> <span class="token operator">&lt;</span>Button theme<span class="token operator">=</span><span class="token punctuation">{</span>theme<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
<span class="token punctuation">}</span>
<span class="token keyword keyword-function">function</span> <span class="token function">Button</span><span class="token punctuation">(</span><span class="token punctuation">{</span> theme <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword keyword-return">return</span> <span class="token operator">&lt;</span>button className<span class="token operator">=</span><span class="token punctuation">{</span>theme<span class="token punctuation">}</span><span class="token operator">&gt;</span>Click<span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span>
<span class="token punctuation">}</span>
</code></pre><p>Contextを使うと、途中を飛ばして直接データを受け取れる。</p>
<pre data-role="codeBlock" data-info="typescript" class="language-typescript typescript"><code><span class="token comment">// ✅ Context: どの階層からでも直接アクセス</span>
<span class="token keyword keyword-const">const</span> ThemeContext <span class="token operator">=</span> <span class="token function">createContext</span><span class="token punctuation">(</span><span class="token string">'light'</span><span class="token punctuation">)</span>

<span class="token keyword keyword-function">function</span> <span class="token function">App</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword keyword-return">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>ThemeContext<span class="token punctuation">.</span>Provider value<span class="token operator">=</span><span class="token string">"dark"</span><span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>Header <span class="token operator">/</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>ThemeContext<span class="token punctuation">.</span>Provider<span class="token operator">&gt;</span>
  <span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token keyword keyword-function">function</span> <span class="token function">Header</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword keyword-return">return</span> <span class="token operator">&lt;</span>Nav <span class="token operator">/</span><span class="token operator">&gt;</span> <span class="token punctuation">}</span>
<span class="token keyword keyword-function">function</span> <span class="token function">Nav</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword keyword-return">return</span> <span class="token operator">&lt;</span>Button <span class="token operator">/</span><span class="token operator">&gt;</span> <span class="token punctuation">}</span>
<span class="token keyword keyword-function">function</span> <span class="token function">Button</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword keyword-const">const</span> theme <span class="token operator">=</span> <span class="token function">useContext</span><span class="token punctuation">(</span>ThemeContext<span class="token punctuation">)</span>  <span class="token comment">// 直接取得！</span>
  <span class="token keyword keyword-return">return</span> <span class="token operator">&lt;</span>button className<span class="token operator">=</span><span class="token punctuation">{</span>theme<span class="token punctuation">}</span><span class="token operator">&gt;</span>Click<span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span>
<span class="token punctuation">}</span>
</code></pre><p><strong>シグネチャ:</strong></p>
<pre data-role="codeBlock" data-info="typescript" class="language-typescript typescript"><code><span class="token keyword keyword-const">const</span> value <span class="token operator">=</span> <span class="token generic-function"><span class="token function">useContext</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>Context<span class="token operator">:</span> React<span class="token punctuation">.</span>Context<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">&gt;</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token constant">T</span>
</code></pre><p><strong>構文の読み方:</strong></p>
<ul>
<li><code>Context</code> → <code>createContext</code>で作成したContextオブジェクト</li>
<li>戻り値 → 最も近い祖先のProviderが提供している値</li>
</ul>
<p><strong>本プロジェクトでの使用例:</strong></p>
<pre data-role="codeBlock" data-info="typescript" class="language-typescript typescript"><code><span class="token comment">// AdminAuthContext.tsx - カスタムフックでラップ</span>
<span class="token keyword keyword-export">export</span> <span class="token keyword keyword-function">function</span> <span class="token function">useAdminAuth</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword keyword-const">const</span> context <span class="token operator">=</span> <span class="token function">useContext</span><span class="token punctuation">(</span>AdminAuthContext<span class="token punctuation">)</span>
  <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>context<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword keyword-throw">throw</span> <span class="token keyword keyword-new">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">'useAdminAuth must be used within AdminAuthProvider'</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token keyword keyword-return">return</span> context
<span class="token punctuation">}</span>
</code></pre><pre data-role="codeBlock" data-info="typescript" class="language-typescript typescript"><code><span class="token comment">// 各コンポーネントでの使用</span>
<span class="token keyword keyword-const">const</span> <span class="token punctuation">{</span> isAdmin<span class="token punctuation">,</span> idToken<span class="token punctuation">,</span> loginWithGoogle<span class="token punctuation">,</span> logout <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">useAdminAuth</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>isAdmin<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword keyword-return">return</span> <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>管理者ログインが必要です<span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
<span class="token punctuation">}</span>
</code></pre><hr>
<h6 id="createcontext---コンテキスト作成"><code>createContext</code> - コンテキスト作成 </h6>
<p>コンポーネントツリー全体で値を共有するためのContextを作成。</p>
<p><strong>💡 初学者向け解説:</strong></p>
<p><code>createContext</code>と<code>useContext</code>はセットで使う。Contextは3つのパーツで構成される：</p>
<ol>
<li><strong>Context作成</strong> - <code>createContext(初期値)</code>でContextを作る</li>
<li><strong>Provider</strong> - データを提供する側。value propsで値を渡す</li>
<li><strong>Consumer</strong> - データを使う側。<code>useContext</code>で値を取得</li>
</ol>
<pre data-role="codeBlock" data-info="typescript" class="language-typescript typescript"><code><span class="token comment">// 1. Context作成</span>
<span class="token keyword keyword-const">const</span> UserContext <span class="token operator">=</span> <span class="token generic-function"><span class="token function">createContext</span><span class="token generic class-name"><span class="token operator">&lt;</span>User <span class="token operator">|</span> <span class="token keyword keyword-null">null</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token keyword keyword-null">null</span><span class="token punctuation">)</span>

<span class="token comment">// 2. Provider: 値を提供</span>
<span class="token keyword keyword-function">function</span> <span class="token function">App</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword keyword-const">const</span> <span class="token punctuation">[</span>user<span class="token punctuation">,</span> setUser<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token generic-function"><span class="token function">useState</span><span class="token generic class-name"><span class="token operator">&lt;</span>User <span class="token operator">|</span> <span class="token keyword keyword-null">null</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token keyword keyword-null">null</span><span class="token punctuation">)</span>

  <span class="token keyword keyword-return">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>UserContext<span class="token punctuation">.</span>Provider value<span class="token operator">=</span><span class="token punctuation">{</span>user<span class="token punctuation">}</span><span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>MainContent <span class="token operator">/</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>UserContext<span class="token punctuation">.</span>Provider<span class="token operator">&gt;</span>
  <span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">// 3. Consumer: 値を使用</span>
<span class="token keyword keyword-function">function</span> <span class="token function">Profile</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword keyword-const">const</span> user <span class="token operator">=</span> <span class="token function">useContext</span><span class="token punctuation">(</span>UserContext<span class="token punctuation">)</span>
  <span class="token keyword keyword-return">return</span> <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span><span class="token punctuation">{</span>user<span class="token operator">?.</span>name<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
<span class="token punctuation">}</span>
</code></pre><p><strong>本プロジェクトでのパターン:</strong></p>
<p>本プロジェクトでは、ContextとProviderをセットでエクスポートし、さらにカスタムフック（<code>useAdminAuth</code>）で使いやすくしている。</p>
<pre data-role="codeBlock" data-info="typescript" class="language-typescript typescript"><code><span class="token comment">// contexts/AdminAuthContext.tsx</span>

<span class="token comment">// 1. Context作成</span>
<span class="token keyword keyword-const">const</span> AdminAuthContext <span class="token operator">=</span> <span class="token generic-function"><span class="token function">createContext</span><span class="token generic class-name"><span class="token operator">&lt;</span>AdminAuthContextType <span class="token operator">|</span> <span class="token keyword keyword-null">null</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token keyword keyword-null">null</span><span class="token punctuation">)</span>

<span class="token comment">// 2. Providerコンポーネント</span>
<span class="token keyword keyword-export">export</span> <span class="token keyword keyword-function">function</span> <span class="token function">AdminAuthProvider</span><span class="token punctuation">(</span><span class="token punctuation">{</span> children <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword keyword-const">const</span> <span class="token punctuation">[</span>user<span class="token punctuation">,</span> setUser<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token keyword keyword-null">null</span><span class="token punctuation">)</span>
  <span class="token comment">// ... ロジック</span>
  <span class="token keyword keyword-return">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>AdminAuthContext<span class="token punctuation">.</span>Provider value<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">{</span> user<span class="token punctuation">,</span> <span class="token operator">...</span> <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&gt;</span>
      <span class="token punctuation">{</span>children<span class="token punctuation">}</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>AdminAuthContext<span class="token punctuation">.</span>Provider<span class="token operator">&gt;</span>
  <span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">// 3. カスタムフック（useContextをラップ）</span>
<span class="token keyword keyword-export">export</span> <span class="token keyword keyword-function">function</span> <span class="token function">useAdminAuth</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword keyword-const">const</span> context <span class="token operator">=</span> <span class="token function">useContext</span><span class="token punctuation">(</span>AdminAuthContext<span class="token punctuation">)</span>
  <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>context<span class="token punctuation">)</span> <span class="token keyword keyword-throw">throw</span> <span class="token keyword keyword-new">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">'Provider内で使ってください'</span><span class="token punctuation">)</span>
  <span class="token keyword keyword-return">return</span> context
<span class="token punctuation">}</span>

<span class="token comment">// 使用例</span>
<span class="token keyword keyword-const">const</span> <span class="token punctuation">{</span> user<span class="token punctuation">,</span> loginWithGoogle <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">useAdminAuth</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre><p><strong>シグネチャ:</strong></p>
<pre data-role="codeBlock" data-info="typescript" class="language-typescript typescript"><code><span class="token keyword keyword-const">const</span> MyContext <span class="token operator">=</span> <span class="token generic-function"><span class="token function">createContext</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>defaultValue<span class="token operator">:</span> <span class="token constant">T</span><span class="token punctuation">)</span><span class="token operator">:</span> Context<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">&gt;</span>
</code></pre><p><strong>構文の読み方:</strong></p>
<ul>
<li><code>defaultValue</code> → Providerがない場合に使われる初期値（通常はnull）</li>
<li>戻り値 → <code>Provider</code>と<code>Consumer</code>を持つContextオブジェクト</li>
</ul>
<p><strong>本プロジェクトでの使用例:</strong></p>
<pre data-role="codeBlock" data-info="typescript" class="language-typescript typescript"><code><span class="token comment">// AdminAuthContext.tsx</span>
<span class="token keyword keyword-type">type</span> <span class="token class-name">AdminAuthContextType</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
  isAdmin<span class="token operator">:</span> <span class="token builtin">boolean</span>
  user<span class="token operator">:</span> User <span class="token operator">|</span> <span class="token keyword keyword-null">null</span>
  idToken<span class="token operator">:</span> <span class="token builtin">string</span> <span class="token operator">|</span> <span class="token keyword keyword-null">null</span>
  isLoading<span class="token operator">:</span> <span class="token builtin">boolean</span>
  sessionExpiresAt<span class="token operator">:</span> <span class="token builtin">number</span> <span class="token operator">|</span> <span class="token keyword keyword-null">null</span>
  <span class="token function-variable function">loginWithGoogle</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token builtin">Promise</span><span class="token operator">&lt;</span><span class="token builtin">boolean</span><span class="token operator">&gt;</span>
  <span class="token function-variable function">logout</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token builtin">Promise</span><span class="token operator">&lt;</span><span class="token keyword keyword-void">void</span><span class="token operator">&gt;</span>
  <span class="token function-variable function">registerBeforeLogout</span><span class="token operator">:</span> <span class="token punctuation">(</span>callback<span class="token operator">:</span> BeforeLogoutCallback<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword keyword-void">void</span>
<span class="token punctuation">}</span>

<span class="token comment">// nullを初期値とし、Providerで実際の値を提供</span>
<span class="token keyword keyword-const">const</span> AdminAuthContext <span class="token operator">=</span> <span class="token generic-function"><span class="token function">createContext</span><span class="token generic class-name"><span class="token operator">&lt;</span>AdminAuthContextType <span class="token operator">|</span> <span class="token keyword keyword-null">null</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token keyword keyword-null">null</span><span class="token punctuation">)</span>

<span class="token comment">// Provider コンポーネント</span>
<span class="token keyword keyword-export">export</span> <span class="token keyword keyword-function">function</span> <span class="token function">AdminAuthProvider</span><span class="token punctuation">(</span><span class="token punctuation">{</span> children <span class="token punctuation">}</span><span class="token operator">:</span> <span class="token punctuation">{</span> children<span class="token operator">:</span> ReactNode <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...状態とロジック</span>

  <span class="token keyword keyword-return">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>AdminAuthContext<span class="token punctuation">.</span>Provider value<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">{</span>
      isAdmin<span class="token punctuation">,</span> user<span class="token punctuation">,</span> idToken<span class="token punctuation">,</span> isLoading<span class="token punctuation">,</span>
      sessionExpiresAt<span class="token punctuation">,</span> loginWithGoogle<span class="token punctuation">,</span> logout<span class="token punctuation">,</span> registerBeforeLogout
    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&gt;</span>
      <span class="token punctuation">{</span>children<span class="token punctuation">}</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>AdminAuthContext<span class="token punctuation">.</span>Provider<span class="token operator">&gt;</span>
  <span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><pre data-role="codeBlock" data-info="typescript" class="language-typescript typescript"><code><span class="token comment">// main.tsx - アプリ全体をProviderで包む</span>
<span class="token operator">&lt;</span>BrowserRouter<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>AdminAuthProvider<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>GlobalBackground <span class="token operator">/</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>ScrollTopHomeSwitch <span class="token operator">/</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>AnimatedRoutes <span class="token operator">/</span><span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span><span class="token operator">/</span>AdminAuthProvider<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>BrowserRouter<span class="token operator">&gt;</span>
</code></pre><hr>
<h6 id="lazy---遅延読み込み"><code>lazy</code> - 遅延読み込み </h6>
<p>コンポーネントを動的にインポートし、コード分割を実現。初期バンドルサイズを削減。</p>
<p><strong>💡 初学者向け解説:</strong></p>
<p>通常の<code>import</code>はページロード時にすべてのコードを読み込む。しかし、大きなアプリでは使わないページのコードまで読み込むのは無駄。</p>
<pre data-role="codeBlock" data-info="typescript" class="language-typescript typescript"><code><span class="token comment">// ❌ 通常のimport: 最初に全部読み込む</span>
<span class="token keyword keyword-import">import</span> Home <span class="token keyword keyword-from">from</span> <span class="token string">'./routes/Home'</span>
<span class="token keyword keyword-import">import</span> Posts <span class="token keyword keyword-from">from</span> <span class="token string">'./routes/Posts'</span>
<span class="token keyword keyword-import">import</span> AdminPanel <span class="token keyword keyword-from">from</span> <span class="token string">'./routes/AdminPanel'</span>  <span class="token comment">// 管理者しか使わないのに全員が読み込む</span>
</code></pre><p><code>lazy</code>を使うと、そのコンポーネントが必要になった時に初めて読み込む（遅延読み込み）。</p>
<pre data-role="codeBlock" data-info="typescript" class="language-typescript typescript"><code><span class="token comment">// ✅ lazy: 必要になったら読み込む</span>
<span class="token keyword keyword-const">const</span> Home <span class="token operator">=</span> <span class="token function">lazy</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword keyword-import">import</span><span class="token punctuation">(</span><span class="token string">'./routes/Home'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword keyword-const">const</span> Posts <span class="token operator">=</span> <span class="token function">lazy</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword keyword-import">import</span><span class="token punctuation">(</span><span class="token string">'./routes/Posts'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword keyword-const">const</span> AdminPanel <span class="token operator">=</span> <span class="token function">lazy</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword keyword-import">import</span><span class="token punctuation">(</span><span class="token string">'./routes/AdminPanel'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment">// 管理者がアクセスした時だけ読み込む</span>
</code></pre><p><strong>メリット:</strong></p>
<ul>
<li>初期表示が速くなる（最初に読み込むコード量が減る）</li>
<li>ユーザーが使わない機能のコードはダウンロードされない</li>
</ul>
<p><strong>注意:</strong> <code>lazy</code>コンポーネントは<code>Suspense</code>で囲む必要がある（ローディング中のUIを指定）</p>
<p><strong>シグネチャ:</strong></p>
<pre data-role="codeBlock" data-info="typescript" class="language-typescript typescript"><code><span class="token keyword keyword-const">const</span> LazyComponent <span class="token operator">=</span> <span class="token function">lazy</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword keyword-import">import</span><span class="token punctuation">(</span><span class="token string">'./Component'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">:</span> React<span class="token punctuation">.</span>LazyExoticComponent
</code></pre><p><strong>構文の読み方:</strong></p>
<ul>
<li><code>() =&gt; import('./Component')</code> → 動的インポートを返す関数</li>
<li><code>import()</code> → 実行時にモジュールを読み込むPromiseを返す</li>
</ul>
<p><strong>本プロジェクトでの使用例:</strong></p>
<pre data-role="codeBlock" data-info="typescript" class="language-typescript typescript"><code><span class="token comment">// AnimatedRoutes.tsx - 全ルートの遅延読み込み</span>
<span class="token keyword keyword-const">const</span> <span class="token function-variable function">loadHome</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword keyword-import">import</span><span class="token punctuation">(</span><span class="token comment">/* webpackPreload: true */</span> <span class="token string">'../routes/Home'</span><span class="token punctuation">)</span>
<span class="token keyword keyword-const">const</span> <span class="token function-variable function">loadPosts</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword keyword-import">import</span><span class="token punctuation">(</span><span class="token comment">/* webpackPreload: true */</span> <span class="token string">'../routes/Posts'</span><span class="token punctuation">)</span>
<span class="token keyword keyword-const">const</span> <span class="token function-variable function">loadPostDetail</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword keyword-import">import</span><span class="token punctuation">(</span><span class="token comment">/* webpackPrefetch: true */</span> <span class="token string">'../routes/PostDetail'</span><span class="token punctuation">)</span>
<span class="token comment">// ...</span>

<span class="token keyword keyword-const">const</span> Home <span class="token operator">=</span> <span class="token function">lazy</span><span class="token punctuation">(</span>loadHome<span class="token punctuation">)</span>
<span class="token keyword keyword-const">const</span> Posts <span class="token operator">=</span> <span class="token function">lazy</span><span class="token punctuation">(</span>loadPosts<span class="token punctuation">)</span>
<span class="token keyword keyword-const">const</span> PostDetail <span class="token operator">=</span> <span class="token function">lazy</span><span class="token punctuation">(</span>loadPostDetail<span class="token punctuation">)</span>
<span class="token comment">// ...</span>
</code></pre><p><strong>Webpackマジックコメント:</strong></p>
<ul>
<li><code>webpackPreload</code>: 高優先度で並行ロード（メインバンドルと同時）</li>
<li><code>webpackPrefetch</code>: 低優先度でプリフェッチ（ブラウザのアイドル時間に）</li>
<li><code>webpackChunkName</code>: チャンク名を指定（キャッシュ効率向上）</li>
</ul>
<hr>
<h6 id="suspense---サスペンス境界"><code>Suspense</code> - サスペンス境界 </h6>
<p>遅延読み込みコンポーネントのローディング中にフォールバックUIを表示。</p>
<p><strong>💡 初学者向け解説:</strong></p>
<p><code>lazy</code>でコンポーネントを遅延読み込みすると、読み込み完了まで少し時間がかかる。その間、何を表示するかを指定するのが<code>Suspense</code>。</p>
<pre data-role="codeBlock" data-info="typescript" class="language-typescript typescript"><code><span class="token comment">// lazyコンポーネントをSuspenseで囲む</span>
<span class="token operator">&lt;</span>Suspense fallback<span class="token operator">=</span><span class="token punctuation">{</span><span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>読み込み中<span class="token operator">...</span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span><span class="token punctuation">}</span><span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>LazyComponent <span class="token operator">/</span><span class="token operator">&gt;</span>  <span class="token punctuation">{</span><span class="token comment">/* 読み込み完了まで fallback が表示される */</span><span class="token punctuation">}</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>Suspense<span class="token operator">&gt;</span>
</code></pre><p><strong>fallbackに指定できるもの:</strong></p>
<pre data-role="codeBlock" data-info="typescript" class="language-typescript typescript"><code><span class="token comment">// パターン1: テキスト</span>
<span class="token operator">&lt;</span>Suspense fallback<span class="token operator">=</span><span class="token punctuation">{</span><span class="token operator">&lt;</span>p<span class="token operator">&gt;</span>Loading<span class="token operator">...</span><span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">&gt;</span><span class="token punctuation">}</span><span class="token operator">&gt;</span>

<span class="token comment">// パターン2: スピナー（くるくる回るアイコン）</span>
<span class="token operator">&lt;</span>Suspense fallback<span class="token operator">=</span><span class="token punctuation">{</span><span class="token operator">&lt;</span>Spinner <span class="token operator">/</span><span class="token operator">&gt;</span><span class="token punctuation">}</span><span class="token operator">&gt;</span>

<span class="token comment">// パターン3: スケルトン（レイアウトを維持した灰色ボックス）</span>
<span class="token operator">&lt;</span>Suspense fallback<span class="token operator">=</span><span class="token punctuation">{</span><span class="token operator">&lt;</span>PageSkeleton <span class="token operator">/</span><span class="token operator">&gt;</span><span class="token punctuation">}</span><span class="token operator">&gt;</span>

<span class="token comment">// パターン4: 何も表示しない（本プロジェクトで採用）</span>
<span class="token operator">&lt;</span>Suspense fallback<span class="token operator">=</span><span class="token punctuation">{</span><span class="token keyword keyword-null">null</span><span class="token punctuation">}</span><span class="token operator">&gt;</span>
</code></pre><p>本プロジェクトでは<code>fallback={null}</code>を使用。これは既存のUIを維持したまま、新しいコンポーネントが読み込まれるのを待つ。</p>
<p><strong>シグネチャ:</strong></p>
<pre data-role="codeBlock" data-info="typescript" class="language-typescript typescript"><code><span class="token operator">&lt;</span>Suspense fallback<span class="token operator">=</span><span class="token punctuation">{</span><span class="token operator">&lt;</span>Loading <span class="token operator">/</span><span class="token operator">&gt;</span><span class="token punctuation">}</span><span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>LazyComponent <span class="token operator">/</span><span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>Suspense<span class="token operator">&gt;</span>
</code></pre><p><strong>構文の読み方:</strong></p>
<ul>
<li><code>fallback</code> → ローディング中に表示するJSX</li>
<li>子要素 → 読み込み完了後に表示されるコンポーネント</li>
</ul>
<p><strong>本プロジェクトでの使用例:</strong></p>
<pre data-role="codeBlock" data-info="typescript" class="language-typescript typescript"><code><span class="token comment">// AnimatedRoutes.tsx</span>
<span class="token operator">&lt;</span>Suspense fallback<span class="token operator">=</span><span class="token punctuation">{</span><span class="token keyword keyword-null">null</span><span class="token punctuation">}</span><span class="token operator">&gt;</span>  <span class="token punctuation">{</span><span class="token comment">/* ローディング中は何も表示しない */</span><span class="token punctuation">}</span>
  <span class="token operator">&lt;</span>Routes location<span class="token operator">=</span><span class="token punctuation">{</span>location<span class="token punctuation">}</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>Route path<span class="token operator">=</span><span class="token string">"/"</span> element<span class="token operator">=</span><span class="token punctuation">{</span><span class="token operator">&lt;</span>App <span class="token operator">/</span><span class="token operator">&gt;</span><span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>Route path<span class="token operator">=</span><span class="token string">"/home"</span> element<span class="token operator">=</span><span class="token punctuation">{</span><span class="token operator">&lt;</span>Home <span class="token operator">/</span><span class="token operator">&gt;</span><span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>Route path<span class="token operator">=</span><span class="token string">"/posts"</span> element<span class="token operator">=</span><span class="token punctuation">{</span><span class="token operator">&lt;</span>Posts <span class="token operator">/</span><span class="token operator">&gt;</span><span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
    <span class="token punctuation">{</span><span class="token comment">/* ... */</span><span class="token punctuation">}</span>
  <span class="token operator">&lt;</span><span class="token operator">/</span>Routes<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>Suspense<span class="token operator">&gt;</span>
</code></pre><p><strong>fallbackの選択肢:</strong></p>
<ul>
<li><code>null</code>: 何も表示しない（既存UIを維持）</li>
<li>スピナー/スケルトン: ローディングインジケーター</li>
<li>プレースホルダー: レイアウトを維持するダミーUI</li>
</ul>
<hr>
<h6 id="createref---ref作成"><code>createRef</code> - ref作成 </h6>
<p>クラス外で使用可能なrefオブジェクトを作成。関数コンポーネント内では通常<code>useRef</code>を使用。</p>
<p><strong>シグネチャ:</strong></p>
<pre data-role="codeBlock" data-info="typescript" class="language-typescript typescript"><code><span class="token keyword keyword-const">const</span> ref <span class="token operator">=</span> <span class="token generic-function"><span class="token function">createRef</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> RefObject<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">&gt;</span>
</code></pre><p><strong>本プロジェクトでの使用例:</strong><br>
現状のコードベースでは <code>createRef</code> は未使用です（以前はページ遷移アニメーションのために使用していました）。</p>
<p><strong>useRefとcreateRefの違い:</strong></p>
<table>
<thead>
<tr>
<th>特性</th>
<th>useRef</th>
<th>createRef</th>
</tr>
</thead>
<tbody>
<tr>
<td>使用場所</td>
<td>関数コンポーネント内</td>
<td>どこでも</td>
</tr>
<tr>
<td>再レンダリング時</td>
<td>同じrefを維持</td>
<td>新しいrefを作成</td>
</tr>
<tr>
<td>用途</td>
<td>通常のref用途</td>
<td>動的なref生成</td>
</tr>
</tbody>
</table>
<hr>
<h6 id="uselayouteffect---同期的副作用フック"><code>useLayoutEffect</code> - 同期的副作用フック </h6>
<p>DOMの変更後、ブラウザの描画前に同期的に実行。レイアウト計算やDOM測定に使用。</p>
<p><strong>💡 初学者向け解説:</strong></p>
<p><code>useEffect</code>と似ているが、実行タイミングが異なる。</p>
<pre data-role="codeBlock" data-info="" class="language-text"><code>レンダリング完了 → useLayoutEffect実行 → 画面に描画 → useEffect実行
                  ↑ ここで実行           ↑ ユーザーに見える
</code></pre><p><strong>なぜ必要？</strong></p>
<p><code>useEffect</code>は画面描画後に実行されるため、DOM操作をすると「一瞬古い状態が見える」ことがある（ちらつき）。</p>
<pre data-role="codeBlock" data-info="typescript" class="language-typescript typescript"><code><span class="token comment">// ❌ useEffect: ちらつきが発生する可能性</span>
<span class="token keyword keyword-function">function</span> <span class="token function">Tooltip</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword keyword-const">const</span> <span class="token punctuation">[</span>position<span class="token punctuation">,</span> setPosition<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token punctuation">{</span> top<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span> left<span class="token operator">:</span> <span class="token number">0</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token keyword keyword-const">const</span> ref <span class="token operator">=</span> <span class="token generic-function"><span class="token function">useRef</span><span class="token generic class-name"><span class="token operator">&lt;</span>HTMLDivElement<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token keyword keyword-null">null</span><span class="token punctuation">)</span>

  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// 画面描画後に位置を計算 → 一瞬ずれた位置に表示される</span>
    <span class="token keyword keyword-const">const</span> rect <span class="token operator">=</span> ref<span class="token punctuation">.</span>current<span class="token operator">?.</span><span class="token function">getBoundingClientRect</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token function">setPosition</span><span class="token punctuation">(</span><span class="token punctuation">{</span> top<span class="token operator">:</span> rect<span class="token operator">?.</span>top <span class="token operator">??</span> <span class="token number">0</span><span class="token punctuation">,</span> left<span class="token operator">:</span> rect<span class="token operator">?.</span>left <span class="token operator">??</span> <span class="token number">0</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

  <span class="token keyword keyword-return">return</span> <span class="token operator">&lt;</span>div ref<span class="token operator">=</span><span class="token punctuation">{</span>ref<span class="token punctuation">}</span> style<span class="token operator">=</span><span class="token punctuation">{</span>position<span class="token punctuation">}</span><span class="token operator">&gt;</span>Tooltip<span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
<span class="token punctuation">}</span>

<span class="token comment">// ✅ useLayoutEffect: ちらつきなし</span>
<span class="token keyword keyword-function">function</span> <span class="token function">Tooltip</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword keyword-const">const</span> <span class="token punctuation">[</span>position<span class="token punctuation">,</span> setPosition<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token punctuation">{</span> top<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span> left<span class="token operator">:</span> <span class="token number">0</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token keyword keyword-const">const</span> ref <span class="token operator">=</span> <span class="token generic-function"><span class="token function">useRef</span><span class="token generic class-name"><span class="token operator">&lt;</span>HTMLDivElement<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token keyword keyword-null">null</span><span class="token punctuation">)</span>

  <span class="token function">useLayoutEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// 画面描画前に位置を計算 → 最初から正しい位置に表示</span>
    <span class="token keyword keyword-const">const</span> rect <span class="token operator">=</span> ref<span class="token punctuation">.</span>current<span class="token operator">?.</span><span class="token function">getBoundingClientRect</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token function">setPosition</span><span class="token punctuation">(</span><span class="token punctuation">{</span> top<span class="token operator">:</span> rect<span class="token operator">?.</span>top <span class="token operator">??</span> <span class="token number">0</span><span class="token punctuation">,</span> left<span class="token operator">:</span> rect<span class="token operator">?.</span>left <span class="token operator">??</span> <span class="token number">0</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

  <span class="token keyword keyword-return">return</span> <span class="token operator">&lt;</span>div ref<span class="token operator">=</span><span class="token punctuation">{</span>ref<span class="token punctuation">}</span> style<span class="token operator">=</span><span class="token punctuation">{</span>position<span class="token punctuation">}</span><span class="token operator">&gt;</span>Tooltip<span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
<span class="token punctuation">}</span>
</code></pre><p><strong>使い分け:</strong></p>
<ul>
<li><strong>useEffect（99%のケース）</strong>: API呼び出し、イベント登録、ログ出力など</li>
<li><strong>useLayoutEffect（レアケース）</strong>: DOM測定、ちらつき防止、レイアウト調整</li>
</ul>
<p><strong>シグネチャ:</strong></p>
<pre data-role="codeBlock" data-info="typescript" class="language-typescript typescript"><code><span class="token function">useLayoutEffect</span><span class="token punctuation">(</span><span class="token function-variable function">effect</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword keyword-void">void</span> <span class="token operator">|</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword keyword-void">void</span><span class="token punctuation">)</span><span class="token punctuation">,</span> deps<span class="token operator">?</span><span class="token operator">:</span> DependencyList<span class="token punctuation">)</span>
</code></pre><p><strong>構文の読み方:</strong></p>
<ul>
<li><code>useEffect</code>と完全に同じ書き方</li>
<li>違いは実行タイミングのみ</li>
</ul>
<p><strong>useEffectとの違い:</strong></p>
<table>
<thead>
<tr>
<th>特性</th>
<th>useEffect</th>
<th>useLayoutEffect</th>
</tr>
</thead>
<tbody>
<tr>
<td>実行タイミング</td>
<td>描画後（非同期）</td>
<td>描画前（同期）</td>
</tr>
<tr>
<td>UIブロック</td>
<td>しない</td>
<td>する（短時間）</td>
</tr>
<tr>
<td>用途</td>
<td>データフェッチ、イベントリスナー</td>
<td>DOM測定、レイアウト調整</td>
</tr>
</tbody>
</table>
<p><strong>本プロジェクトでの使用例:</strong><br>
現状のコードベースでは <code>useLayoutEffect</code> は未使用です（以前はページ遷移アニメーションのために使用していました）。</p>
<p><strong>useLayoutEffectを使うべき場面:</strong></p>
<ul>
<li>DOM要素のサイズ・位置を測定して即座に反映する時</li>
<li>フリッカーを防ぎたい時（useEffectだと一瞬古い状態が見える）</li>
<li>CSSクラスを遷移開始時に確実に付与したい時</li>
</ul>
<hr>
<h6 id="starttransition---低優先度更新マーク"><code>startTransition</code> - 低優先度更新マーク </h6>
<p>状態更新を低優先度としてマークし、より重要な更新（ユーザー入力等）を優先。React 18のConcurrent Modeの機能。</p>
<p><strong>💡 初学者向け解説:</strong></p>
<p>通常、Reactの状態更新は「すぐに画面に反映」される。しかし、重い処理が入ると画面がカクついたり、ユーザー入力が遅延したりする。</p>
<pre data-role="codeBlock" data-info="typescript" class="language-typescript typescript"><code><span class="token comment">// ❌ 重い処理がユーザー入力をブロック</span>
<span class="token keyword keyword-function">function</span> <span class="token function">Search</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword keyword-const">const</span> <span class="token punctuation">[</span>query<span class="token punctuation">,</span> setQuery<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span>
  <span class="token keyword keyword-const">const</span> <span class="token punctuation">[</span>results<span class="token punctuation">,</span> setResults<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

  <span class="token keyword keyword-const">const</span> <span class="token function-variable function">handleChange</span> <span class="token operator">=</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">setQuery</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>target<span class="token punctuation">.</span>value<span class="token punctuation">)</span>        <span class="token comment">// 入力を即座に反映したい</span>
    <span class="token function">setResults</span><span class="token punctuation">(</span><span class="token function">searchItems</span><span class="token punctuation">(</span>query<span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment">// 重い処理...入力が遅延する</span>
  <span class="token punctuation">}</span>

  <span class="token keyword keyword-return">return</span> <span class="token operator">&lt;</span>input value<span class="token operator">=</span><span class="token punctuation">{</span>query<span class="token punctuation">}</span> onChange<span class="token operator">=</span><span class="token punctuation">{</span>handleChange<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
<span class="token punctuation">}</span>
</code></pre><p><code>startTransition</code>を使うと、「この更新は後回しでOK」とReactに伝えられる。</p>
<pre data-role="codeBlock" data-info="typescript" class="language-typescript typescript"><code><span class="token comment">// ✅ 重い処理を低優先度に</span>
<span class="token keyword keyword-function">function</span> <span class="token function">Search</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword keyword-const">const</span> <span class="token punctuation">[</span>query<span class="token punctuation">,</span> setQuery<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span>
  <span class="token keyword keyword-const">const</span> <span class="token punctuation">[</span>results<span class="token punctuation">,</span> setResults<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

  <span class="token keyword keyword-const">const</span> <span class="token function-variable function">handleChange</span> <span class="token operator">=</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">setQuery</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>target<span class="token punctuation">.</span>value<span class="token punctuation">)</span>  <span class="token comment">// 高優先度: 即座に反映</span>

    <span class="token function">startTransition</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token comment">// 低優先度: ユーザー入力を邪魔しない</span>
      <span class="token function">setResults</span><span class="token punctuation">(</span><span class="token function">searchItems</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>target<span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token keyword keyword-return">return</span> <span class="token operator">&lt;</span>input value<span class="token operator">=</span><span class="token punctuation">{</span>query<span class="token punctuation">}</span> onChange<span class="token operator">=</span><span class="token punctuation">{</span>handleChange<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
<span class="token punctuation">}</span>
</code></pre><p><strong>具体的な効果:</strong></p>
<ul>
<li>入力フィールドは即座に反映される（カクつかない）</li>
<li>検索結果は少し遅れて更新される（でも体感は良い）</li>
</ul>
<p><strong>使いどころ:</strong></p>
<ul>
<li>フィルタリング/検索</li>
<li>大きなリストの更新</li>
<li>重いレンダリング処理</li>
</ul>
<p><strong>シグネチャ:</strong></p>
<pre data-role="codeBlock" data-info="typescript" class="language-typescript typescript"><code><span class="token function">startTransition</span><span class="token punctuation">(</span><span class="token function-variable function">callback</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword keyword-void">void</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword keyword-void">void</span>
</code></pre><p><strong>構文の読み方:</strong></p>
<ul>
<li><code>callback</code> → 低優先度にしたい状態更新を含む関数</li>
<li>戻り値なし</li>
</ul>
<p><strong>本プロジェクトでの使用例:</strong></p>
<pre data-role="codeBlock" data-info="typescript" class="language-typescript typescript"><code><span class="token comment">// Posts.tsx - タグフィルタリングの低優先度更新</span>
<span class="token keyword keyword-const">const</span> handleTagClick <span class="token operator">=</span> <span class="token function">useCallback</span><span class="token punctuation">(</span><span class="token punctuation">(</span>tag<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token function">startTransition</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// この更新は低優先度として扱われる</span>
    <span class="token comment">// ユーザーの他の操作をブロックしない</span>
    <span class="token function">setSearchParams</span><span class="token punctuation">(</span>tag <span class="token operator">?</span> <span class="token punctuation">{</span> tag <span class="token punctuation">}</span> <span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>setSearchParams<span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre><pre data-role="codeBlock" data-info="typescript" class="language-typescript typescript"><code><span class="token comment">// PostDetail.tsx - いいね数の更新</span>
<span class="token keyword keyword-const">const</span> handleGood <span class="token operator">=</span> <span class="token function">useCallback</span><span class="token punctuation">(</span><span class="token keyword keyword-async">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// 楽観的更新（即座にUI反映）</span>
  <span class="token function">startTransition</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">setGoodCount</span><span class="token punctuation">(</span><span class="token punctuation">(</span>prev<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> prev <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span>
    <span class="token function">setHasVoted</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>

  <span class="token comment">// APIコール...</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token comment">/* deps */</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre><p><strong>startTransitionを使うべき場面:</strong></p>
<ul>
<li>フィルタリング、検索結果の更新</li>
<li>大量のリスト再レンダリング</li>
<li>ユーザー体験に影響しない背景更新</li>
</ul>
<hr>
<h6 id="reactnode---react描画可能型"><code>ReactNode</code> - React描画可能型 </h6>
<p>Reactがレンダリングできるすべての型を表す。コンポーネントのchildren型として使用。</p>
<p><strong>💡 初学者向け解説:</strong></p>
<p>Reactでは、コンポーネントの中に「子要素」を渡せる。この子要素の型が<code>ReactNode</code>。</p>
<pre data-role="codeBlock" data-info="typescript" class="language-typescript typescript"><code><span class="token comment">// 子要素の例</span>
<span class="token operator">&lt;</span>Container<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>h1<span class="token operator">&gt;</span>タイトル<span class="token operator">&lt;</span><span class="token operator">/</span>h1<span class="token operator">&gt;</span>           <span class="token punctuation">{</span><span class="token comment">/* ReactElement */</span><span class="token punctuation">}</span>
  テキストも書ける              <span class="token punctuation">{</span><span class="token comment">/* string */</span><span class="token punctuation">}</span>
  <span class="token punctuation">{</span><span class="token number">42</span><span class="token punctuation">}</span>                        <span class="token punctuation">{</span><span class="token comment">/* number */</span><span class="token punctuation">}</span>
  <span class="token punctuation">{</span>items<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>i <span class="token operator">=&gt;</span> <span class="token operator">&lt;</span>li<span class="token operator">&gt;</span><span class="token punctuation">{</span>i<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>li<span class="token operator">&gt;</span><span class="token punctuation">)</span><span class="token punctuation">}</span>  <span class="token punctuation">{</span><span class="token comment">/* ReactNode[] */</span><span class="token punctuation">}</span>
  <span class="token punctuation">{</span><span class="token keyword keyword-null">null</span><span class="token punctuation">}</span>                      <span class="token punctuation">{</span><span class="token comment">/* null（何も表示しない） */</span><span class="token punctuation">}</span>
  <span class="token punctuation">{</span>isVisible <span class="token operator">&amp;&amp;</span> <span class="token operator">&lt;</span>Modal <span class="token operator">/</span><span class="token operator">&gt;</span><span class="token punctuation">}</span>    <span class="token punctuation">{</span><span class="token comment">/* boolean | ReactElement */</span><span class="token punctuation">}</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>Container<span class="token operator">&gt;</span>
</code></pre><p>これらすべてを受け入れられる型が<code>ReactNode</code>。</p>
<p><strong>コンポーネントでchildrenを受け取る:</strong></p>
<pre data-role="codeBlock" data-info="typescript" class="language-typescript typescript"><code><span class="token comment">// 基本的なラッパーコンポーネント</span>
<span class="token keyword keyword-type">type</span> <span class="token class-name">ContainerProps</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
  children<span class="token operator">:</span> ReactNode  <span class="token comment">// 何でも受け取れる</span>
<span class="token punctuation">}</span>

<span class="token keyword keyword-function">function</span> <span class="token function">Container</span><span class="token punctuation">(</span><span class="token punctuation">{</span> children <span class="token punctuation">}</span><span class="token operator">:</span> ContainerProps<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword keyword-return">return</span> <span class="token operator">&lt;</span>div className<span class="token operator">=</span><span class="token string">"container"</span><span class="token operator">&gt;</span><span class="token punctuation">{</span>children<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
<span class="token punctuation">}</span>

<span class="token comment">// オプショナルな場合は?をつける</span>
<span class="token keyword keyword-type">type</span> <span class="token class-name">CardProps</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
  title<span class="token operator">:</span> <span class="token builtin">string</span>
  children<span class="token operator">?</span><span class="token operator">:</span> ReactNode  <span class="token comment">// なくてもOK</span>
<span class="token punctuation">}</span>
</code></pre><p><strong>型定義:</strong></p>
<pre data-role="codeBlock" data-info="typescript" class="language-typescript typescript"><code><span class="token keyword keyword-type">type</span> <span class="token class-name">ReactNode</span> <span class="token operator">=</span>
  <span class="token operator">|</span> ReactElement      <span class="token comment">// &lt;Component /&gt; や &lt;div&gt; など</span>
  <span class="token operator">|</span> <span class="token builtin">string</span>            <span class="token comment">// "テキスト"</span>
  <span class="token operator">|</span> <span class="token builtin">number</span>            <span class="token comment">// 42</span>
  <span class="token operator">|</span> Iterable<span class="token operator">&lt;</span>ReactNode<span class="token operator">&gt;</span>  <span class="token comment">// 配列など</span>
  <span class="token operator">|</span> ReactPortal       <span class="token comment">// createPortalの戻り値</span>
  <span class="token operator">|</span> <span class="token builtin">boolean</span>           <span class="token comment">// true/false（表示されない）</span>
  <span class="token operator">|</span> <span class="token keyword keyword-null">null</span>              <span class="token comment">// 何も表示しない</span>
  <span class="token operator">|</span> <span class="token keyword keyword-undefined">undefined</span>         <span class="token comment">// 何も表示しない</span>
</code></pre><p><strong>本プロジェクトでの使用例:</strong></p>
<pre data-role="codeBlock" data-info="typescript" class="language-typescript typescript"><code><span class="token comment">// AdminAuthContext.tsx - Providerのchildren型</span>
<span class="token keyword keyword-export">export</span> <span class="token keyword keyword-function">function</span> <span class="token function">AdminAuthProvider</span><span class="token punctuation">(</span><span class="token punctuation">{</span> children <span class="token punctuation">}</span><span class="token operator">:</span> <span class="token punctuation">{</span> children<span class="token operator">:</span> ReactNode <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
  <span class="token keyword keyword-return">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>AdminAuthContext<span class="token punctuation">.</span>Provider value<span class="token operator">=</span><span class="token punctuation">{</span><span class="token comment">/* ... */</span><span class="token punctuation">}</span><span class="token operator">&gt;</span>
      <span class="token punctuation">{</span>children<span class="token punctuation">}</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>AdminAuthContext<span class="token punctuation">.</span>Provider<span class="token operator">&gt;</span>
  <span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><pre data-role="codeBlock" data-info="typescript" class="language-typescript typescript"><code><span class="token comment">// Lightbox.tsx - オプショナルなchildren</span>
<span class="token keyword keyword-type">type</span> <span class="token class-name">LightboxProps</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
  isOpen<span class="token operator">:</span> <span class="token builtin">boolean</span>
  <span class="token function-variable function">onClose</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword keyword-void">void</span>
  imageSrc<span class="token operator">:</span> <span class="token builtin">string</span>
  imageAlt<span class="token operator">:</span> <span class="token builtin">string</span>
  children<span class="token operator">?</span><span class="token operator">:</span> ReactNode  <span class="token comment">// 画像下に追加情報を表示</span>
<span class="token punctuation">}</span>
</code></pre><hr>
<h5 id="react-dom"><code>react-dom</code> </h5>
<p>ReactをDOM（ブラウザ）環境/サーバー環境でレンダリングするためのライブラリ。</p>
<p><strong>インポートされるAPI:</strong></p>
<table>
<thead>
<tr>
<th>API</th>
<th>説明</th>
<th>使用ファイル</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>createRoot</code></td>
<td>CSR時にアプリをDOMにマウント</td>
<td><code>main.tsx</code></td>
</tr>
<tr>
<td><code>hydrateRoot</code></td>
<td>SSG/SSRで事前生成されたHTMLをハイドレート</td>
<td><code>main.tsx</code></td>
</tr>
<tr>
<td><code>renderToString</code></td>
<td>SSG/SSR用にHTML文字列を生成</td>
<td><code>entry-server.tsx</code></td>
</tr>
</tbody>
</table>
<pre data-role="codeBlock" data-info="typescript" class="language-typescript typescript"><code><span class="token comment">// 使用例</span>
<span class="token function">hydrateRoot</span><span class="token punctuation">(</span>rootElement<span class="token punctuation">,</span> app<span class="token punctuation">)</span>
<span class="token keyword keyword-const">const</span> html <span class="token operator">=</span> <span class="token function">renderToString</span><span class="token punctuation">(</span><span class="token operator">&lt;</span>App <span class="token operator">/</span><span class="token operator">&gt;</span><span class="token punctuation">)</span>
</code></pre><hr>
<h5 id="react-router-dom"><code>react-router-dom</code> </h5>
<p>React用のクライアントサイドルーティングライブラリ。SPAでのページ遷移を管理。</p>
<p><strong>インポートされるAPI:</strong></p>
<table>
<thead>
<tr>
<th>API</th>
<th>説明</th>
<th>使用ファイル例</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>BrowserRouter</code></td>
<td>HTML5 History APIを使用したルーター</td>
<td><code>main.tsx</code></td>
</tr>
<tr>
<td><code>Routes</code></td>
<td>ルート定義のコンテナ</td>
<td><code>AnimatedRoutes.tsx</code></td>
</tr>
<tr>
<td><code>Route</code></td>
<td>個別のルート定義</td>
<td><code>AnimatedRoutes.tsx</code></td>
</tr>
<tr>
<td><code>Link</code></td>
<td>クライアントサイドナビゲーション用リンク</td>
<td>全ページコンポーネント</td>
</tr>
<tr>
<td><code>useNavigate</code></td>
<td>プログラマティックなナビゲーション用フック</td>
<td><code>App.tsx</code>, <code>ScrollTopHomeSwitch.tsx</code>, <code>BackButton.tsx</code></td>
</tr>
<tr>
<td><code>useLocation</code></td>
<td>現在のURL情報を取得</td>
<td><code>AnimatedRoutes.tsx</code>, <code>GlobalBackground.tsx</code></td>
</tr>
<tr>
<td><code>useParams</code></td>
<td>URLパラメータを取得</td>
<td><code>PostDetail.tsx</code>, <code>BBSThread.tsx</code></td>
</tr>
<tr>
<td><code>useSearchParams</code></td>
<td>クエリパラメータを取得・設定</td>
<td><code>Posts.tsx</code></td>
</tr>
<tr>
<td><code>LinkProps</code></td>
<td>Linkコンポーネントのprops型</td>
<td><code>PrefetchLink.tsx</code></td>
</tr>
</tbody>
</table>
<pre data-role="codeBlock" data-info="typescript" class="language-typescript typescript"><code><span class="token comment">// 使用例</span>
<span class="token keyword keyword-const">const</span> navigate <span class="token operator">=</span> <span class="token function">useNavigate</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token function">navigate</span><span class="token punctuation">(</span><span class="token string">'/home'</span><span class="token punctuation">)</span>  <span class="token comment">// /homeへ遷移</span>

<span class="token keyword keyword-const">const</span> <span class="token punctuation">{</span> slug <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token generic-function"><span class="token function">useParams</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token punctuation">{</span> slug<span class="token operator">:</span> <span class="token builtin">string</span> <span class="token punctuation">}</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment">// URL: /posts/:slug</span>
</code></pre><hr>
<h5 id="react-router"><code>react-router</code> </h5>
<p>SSG/SSR向けのルーティング（<code>StaticRouter</code> など）を提供。<code>react-router-dom</code> の内部依存としても利用されます。</p>
<p><strong>インポートされるAPI:</strong></p>
<table>
<thead>
<tr>
<th>API</th>
<th>説明</th>
<th>使用ファイル</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>StaticRouter</code></td>
<td>サーバー側でlocationを固定してレンダリング</td>
<td><code>entry-server.tsx</code></td>
</tr>
</tbody>
</table>
<pre data-role="codeBlock" data-info="typescript" class="language-typescript typescript"><code><span class="token comment">// 使用例</span>
<span class="token operator">&lt;</span>StaticRouter location<span class="token operator">=</span><span class="token string">"/posts/example"</span><span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>App <span class="token operator">/</span><span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>StaticRouter<span class="token operator">&gt;</span>
</code></pre><hr>
<h5 id="p5"><code>p5</code> </h5>
<p>クリエイティブコーディング向けの描画ライブラリ。背景アニメ（<code>P5HypercubeBackground.tsx</code>）でWEBGL描画に使用します（動的importで必要時のみロード）。</p>
<hr>
<h4 id="firebase関連">Firebase関連 </h4>
<h5 id="firebase"><code>firebase</code> </h5>
<p>Googleが提供するBaaS（Backend as a Service）。認証、データベース、ストレージ等を提供。</p>
<p><strong>インポートされるモジュール:</strong></p>
<h6 id="firebaseapp"><code>firebase/app</code> </h6>
<table>
<thead>
<tr>
<th>API</th>
<th>説明</th>
<th>使用ファイル</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>initializeApp</code></td>
<td>Firebaseアプリを初期化</td>
<td><code>firebase.ts</code></td>
</tr>
</tbody>
</table>
<h6 id="firebaseauth"><code>firebase/auth</code> </h6>
<table>
<thead>
<tr>
<th>API</th>
<th>説明</th>
<th>使用ファイル</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>getAuth</code></td>
<td>Authインスタンスを取得</td>
<td><code>firebase.ts</code></td>
</tr>
<tr>
<td><code>GoogleAuthProvider</code></td>
<td>Google認証プロバイダー</td>
<td><code>firebase.ts</code></td>
</tr>
<tr>
<td><code>signInWithPopup</code></td>
<td>ポップアップでソーシャルログイン</td>
<td><code>AdminAuthContext.tsx</code></td>
</tr>
<tr>
<td><code>signOut</code></td>
<td>ログアウト</td>
<td><code>AdminAuthContext.tsx</code></td>
</tr>
<tr>
<td><code>onAuthStateChanged</code></td>
<td>認証状態の変更を監視</td>
<td><code>AdminAuthContext.tsx</code></td>
</tr>
<tr>
<td><code>User</code></td>
<td>Firebaseユーザー型</td>
<td><code>AdminAuthContext.tsx</code></td>
</tr>
</tbody>
</table>
<pre data-role="codeBlock" data-info="typescript" class="language-typescript typescript"><code><span class="token comment">// 使用例</span>
<span class="token keyword keyword-const">const</span> app <span class="token operator">=</span> <span class="token function">initializeApp</span><span class="token punctuation">(</span>firebaseConfig<span class="token punctuation">)</span>
<span class="token keyword keyword-const">const</span> auth <span class="token operator">=</span> <span class="token function">getAuth</span><span class="token punctuation">(</span>app<span class="token punctuation">)</span>
<span class="token keyword keyword-const">const</span> provider <span class="token operator">=</span> <span class="token keyword keyword-new">new</span> <span class="token class-name">GoogleAuthProvider</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment">// ログイン</span>
<span class="token keyword keyword-const">const</span> result <span class="token operator">=</span> <span class="token keyword keyword-await">await</span> <span class="token function">signInWithPopup</span><span class="token punctuation">(</span>auth<span class="token punctuation">,</span> provider<span class="token punctuation">)</span>
<span class="token keyword keyword-const">const</span> user <span class="token operator">=</span> result<span class="token punctuation">.</span>user
<span class="token keyword keyword-const">const</span> token <span class="token operator">=</span> <span class="token keyword keyword-await">await</span> user<span class="token punctuation">.</span><span class="token function">getIdToken</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment">// 認証状態監視</span>
<span class="token function">onAuthStateChanged</span><span class="token punctuation">(</span>auth<span class="token punctuation">,</span> <span class="token punctuation">(</span>user<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>user<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">/* ログイン中 */</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><hr>
<h4 id="markdown処理関連">Markdown処理関連 </h4>
<h5 id="unified"><code>unified</code> </h5>
<p>テキスト処理のためのプラグインベースのエコシステム。AST（抽象構文木）を操作してテキストを変換。</p>
<pre data-role="codeBlock" data-info="typescript" class="language-typescript typescript"><code><span class="token comment">// 使用例: Markdown → HTML変換パイプライン</span>
<span class="token keyword keyword-const">const</span> result <span class="token operator">=</span> <span class="token keyword keyword-await">await</span> <span class="token function">unified</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>remarkParse<span class="token punctuation">)</span>      <span class="token comment">// Markdown → mdast</span>
  <span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>remarkGfm<span class="token punctuation">)</span>        <span class="token comment">// GFM拡張</span>
  <span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>remarkRehype<span class="token punctuation">)</span>     <span class="token comment">// mdast → hast</span>
  <span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>rehypeStringify<span class="token punctuation">)</span>  <span class="token comment">// hast → HTML文字列</span>
  <span class="token punctuation">.</span><span class="token function">process</span><span class="token punctuation">(</span>markdown<span class="token punctuation">)</span>
</code></pre><h5 id="remark-parse"><code>remark-parse</code> </h5>
<p>Markdownテキストをmdast（Markdown AST）にパース。</p>
<h5 id="remark-gfm"><code>remark-gfm</code> </h5>
<p>GitHub Flavored Markdown（GFM）をサポート。テーブル、取り消し線、タスクリスト、URL自動リンク等。</p>
<h5 id="remark-rehype"><code>remark-rehype</code> </h5>
<p>mdast（Markdown AST）をhast（HTML AST）に変換。</p>
<h5 id="rehype-stringify"><code>rehype-stringify</code> </h5>
<p>hast（HTML AST）をHTML文字列にシリアライズ。</p>
<h5 id="remark-math"><code>remark-math</code> </h5>
<p>Markdownで数式記法（<code>$...$</code>, <code>$$...$$</code>）をサポート。</p>
<h5 id="rehype-katex"><code>rehype-katex</code> </h5>
<p>hast内の数式ノードをKaTeXでレンダリング。</p>
<h5 id="katex"><code>katex</code> </h5>
<p>高速な数式レンダリングライブラリ。LaTeX記法をHTMLに変換。</p>
<pre data-role="codeBlock" data-info="typescript" class="language-typescript typescript"><code><span class="token comment">// 使用例（MarkdownEditor.tsx）</span>
<span class="token operator">&lt;</span>MDEditor<span class="token punctuation">.</span>Markdown
  source<span class="token operator">=</span><span class="token punctuation">{</span>content<span class="token punctuation">}</span>
  remarkPlugins<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">[</span>remarkMath<span class="token punctuation">]</span><span class="token punctuation">}</span>
  rehypePlugins<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">[</span>rehypeKatex<span class="token punctuation">]</span><span class="token punctuation">}</span>
<span class="token operator">/</span><span class="token operator">&gt;</span>
</code></pre><hr>
<h4 id="markdownエディタ">Markdownエディタ </h4>
<h5 id="uiwreact-md-editor"><code>@uiw/react-md-editor</code> </h5>
<p>React用のMarkdownエディタコンポーネント。リアルタイムプレビュー、ツールバー、カスタマイズ可能。</p>
<p><strong>インポートされるAPI:</strong></p>
<table>
<thead>
<tr>
<th>API</th>
<th>説明</th>
<th>使用ファイル</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>MDEditor</code></td>
<td>メインのエディタコンポーネント</td>
<td><code>MarkdownEditor.tsx</code></td>
</tr>
<tr>
<td><code>MDEditor.Markdown</code></td>
<td>Markdownプレビューコンポーネント</td>
<td><code>MarkdownEditor.tsx</code></td>
</tr>
<tr>
<td><code>commands</code></td>
<td>ツールバーコマンド（太字、イタリック等）</td>
<td><code>MarkdownEditor.tsx</code></td>
</tr>
</tbody>
</table>
<pre data-role="codeBlock" data-info="typescript" class="language-typescript typescript"><code><span class="token comment">// 使用例</span>
<span class="token operator">&lt;</span>MDEditor
  value<span class="token operator">=</span><span class="token punctuation">{</span>value<span class="token punctuation">}</span>
  onChange<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span>val<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">onChange</span><span class="token punctuation">(</span>val <span class="token operator">||</span> <span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">}</span>
  height<span class="token operator">=</span><span class="token punctuation">{</span><span class="token number">500</span><span class="token punctuation">}</span>
  preview<span class="token operator">=</span><span class="token string">"live"</span>
  commands<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">[</span>
    commands<span class="token punctuation">.</span>bold<span class="token punctuation">,</span>
    commands<span class="token punctuation">.</span>italic<span class="token punctuation">,</span>
    commands<span class="token punctuation">.</span>link<span class="token punctuation">,</span>
    commands<span class="token punctuation">.</span>code<span class="token punctuation">,</span>
    <span class="token comment">// ...</span>
  <span class="token punctuation">]</span><span class="token punctuation">}</span>
<span class="token operator">/</span><span class="token operator">&gt;</span>
</code></pre><hr>
<h4 id="ダイアグラム描画">ダイアグラム描画 </h4>
<h5 id="mermaid"><code>mermaid</code> </h5>
<p>テキストベースのダイアグラム描画ライブラリ。フローチャート、シーケンス図、クラス図等を生成。</p>
<p><strong>インポートされるAPI:</strong></p>
<table>
<thead>
<tr>
<th>API</th>
<th>説明</th>
<th>使用ファイル</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>mermaid.initialize</code></td>
<td>Mermaidの初期設定（テーマ等）</td>
<td><code>PostDetail.tsx</code>, <code>MermaidRenderer.tsx</code></td>
</tr>
<tr>
<td><code>mermaid.render</code></td>
<td>Mermaidコードを非同期でSVGにレンダリング</td>
<td><code>MermaidRenderer.tsx</code></td>
</tr>
</tbody>
</table>
<pre data-role="codeBlock" data-info="typescript" class="language-typescript typescript"><code><span class="token comment">// 使用例</span>
mermaid<span class="token punctuation">.</span><span class="token function">initialize</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  startOnLoad<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
  theme<span class="token operator">:</span> <span class="token string">'dark'</span><span class="token punctuation">,</span>
  themeVariables<span class="token operator">:</span> <span class="token punctuation">{</span>
    primaryColor<span class="token operator">:</span> <span class="token string">'#4f46e5'</span><span class="token punctuation">,</span>
    <span class="token comment">// ...</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token keyword keyword-const">const</span> <span class="token punctuation">{</span> svg <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword keyword-await">await</span> mermaid<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token string">'diagram-id'</span><span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">
  graph TD
    A[開始] --&gt; B[処理]
    B --&gt; C[終了]
</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
</code></pre><hr>
<h3 id="ファイル別インポート一覧">ファイル別インポート一覧 </h3>
<h4 id="srcmaintsx-1"><code>src/main.tsx</code> </h4>
<pre data-role="codeBlock" data-info="typescript" class="language-typescript typescript"><code><span class="token keyword keyword-import">import</span> <span class="token punctuation">{</span> BrowserRouter <span class="token punctuation">}</span> <span class="token keyword keyword-from">from</span> <span class="token string">'react-router-dom'</span>
<span class="token keyword keyword-import">import</span> <span class="token punctuation">{</span> createRoot<span class="token punctuation">,</span> hydrateRoot <span class="token punctuation">}</span> <span class="token keyword keyword-from">from</span> <span class="token string">'react-dom/client'</span>
<span class="token keyword keyword-import">import</span> AnimatedRoutes <span class="token keyword keyword-from">from</span> <span class="token string">'./components/AnimatedRoutes'</span>
<span class="token keyword keyword-import">import</span> GlobalBackground <span class="token keyword keyword-from">from</span> <span class="token string">'./components/GlobalBackground'</span>
<span class="token keyword keyword-import">import</span> ScrollTopHomeSwitch <span class="token keyword keyword-from">from</span> <span class="token string">'./components/ScrollTopHomeSwitch'</span>
<span class="token keyword keyword-import">import</span> <span class="token punctuation">{</span> AdminAuthProvider <span class="token punctuation">}</span> <span class="token keyword keyword-from">from</span> <span class="token string">'./contexts/AdminAuthContext'</span>
<span class="token keyword keyword-import">import</span> <span class="token string">'./index.css'</span>
</code></pre><h4 id="srcentry-servertsx-1"><code>src/entry-server.tsx</code> </h4>
<pre data-role="codeBlock" data-info="typescript" class="language-typescript typescript"><code><span class="token keyword keyword-import">import</span> <span class="token punctuation">{</span> renderToString <span class="token punctuation">}</span> <span class="token keyword keyword-from">from</span> <span class="token string">'react-dom/server'</span>
<span class="token keyword keyword-import">import</span> <span class="token punctuation">{</span> StaticRouter <span class="token punctuation">}</span> <span class="token keyword keyword-from">from</span> <span class="token string">'react-router'</span>
<span class="token keyword keyword-import">import</span> <span class="token punctuation">{</span> AdminAuthProvider <span class="token punctuation">}</span> <span class="token keyword keyword-from">from</span> <span class="token string">'./contexts/AdminAuthContext'</span>
<span class="token keyword keyword-import">import</span> GlobalBackground <span class="token keyword keyword-from">from</span> <span class="token string">'./components/GlobalBackground'</span>
<span class="token keyword keyword-import">import</span> ScrollTopHomeSwitch <span class="token keyword keyword-from">from</span> <span class="token string">'./components/ScrollTopHomeSwitch'</span>
<span class="token keyword keyword-import">import</span> ServerRoutes <span class="token keyword keyword-from">from</span> <span class="token string">'./components/ServerRoutes'</span>
</code></pre><h4 id="srcapptsx-1"><code>src/App.tsx</code> </h4>
<pre data-role="codeBlock" data-info="typescript" class="language-typescript typescript"><code><span class="token keyword keyword-import">import</span> <span class="token punctuation">{</span> useEffect<span class="token punctuation">,</span> useRef<span class="token punctuation">,</span> useCallback <span class="token punctuation">}</span> <span class="token keyword keyword-from">from</span> <span class="token string">'react'</span>
<span class="token keyword keyword-import">import</span> <span class="token punctuation">{</span> useNavigate <span class="token punctuation">}</span> <span class="token keyword keyword-from">from</span> <span class="token string">'react-router-dom'</span>
</code></pre><h4 id="srccontextsadminauthcontexttsx-1"><code>src/contexts/AdminAuthContext.tsx</code> </h4>
<pre data-role="codeBlock" data-info="typescript" class="language-typescript typescript"><code><span class="token keyword keyword-import">import</span> <span class="token punctuation">{</span> createContext<span class="token punctuation">,</span> useContext<span class="token punctuation">,</span> useState<span class="token punctuation">,</span> useCallback<span class="token punctuation">,</span> useEffect<span class="token punctuation">,</span> useRef<span class="token punctuation">,</span> <span class="token keyword keyword-type">type</span> <span class="token class-name">ReactNode</span> <span class="token punctuation">}</span> <span class="token keyword keyword-from">from</span> <span class="token string">'react'</span>
<span class="token keyword keyword-import">import</span> <span class="token punctuation">{</span> signInWithPopup<span class="token punctuation">,</span> signOut<span class="token punctuation">,</span> onAuthStateChanged<span class="token punctuation">,</span> <span class="token keyword keyword-type">type</span> <span class="token class-name">User</span> <span class="token punctuation">}</span> <span class="token keyword keyword-from">from</span> <span class="token string">'firebase/auth'</span>
<span class="token keyword keyword-import">import</span> <span class="token punctuation">{</span> auth<span class="token punctuation">,</span> googleProvider <span class="token punctuation">}</span> <span class="token keyword keyword-from">from</span> <span class="token string">'../lib/firebase'</span>
</code></pre><h4 id="srccomponentsanimatedroutestsx-1"><code>src/components/AnimatedRoutes.tsx</code> </h4>
<pre data-role="codeBlock" data-info="typescript" class="language-typescript typescript"><code><span class="token keyword keyword-import">import</span> <span class="token punctuation">{</span> Routes<span class="token punctuation">,</span> Route<span class="token punctuation">,</span> useLocation <span class="token punctuation">}</span> <span class="token keyword keyword-from">from</span> <span class="token string">'react-router-dom'</span>
<span class="token keyword keyword-import">import</span> <span class="token punctuation">{</span> lazy<span class="token punctuation">,</span> Suspense<span class="token punctuation">,</span> useEffect <span class="token punctuation">}</span> <span class="token keyword keyword-from">from</span> <span class="token string">'react'</span>
<span class="token keyword keyword-import">import</span> App <span class="token keyword keyword-from">from</span> <span class="token string">'../App'</span>
<span class="token keyword keyword-import">import</span> <span class="token punctuation">{</span> shouldPrefetch <span class="token punctuation">}</span> <span class="token keyword keyword-from">from</span> <span class="token string">'../lib/network'</span>
<span class="token keyword keyword-import">import</span> <span class="token punctuation">{</span> preload<span class="token punctuation">,</span> prefetch<span class="token punctuation">,</span> lazyLoad <span class="token punctuation">}</span> <span class="token keyword keyword-from">from</span> <span class="token string">'../lib/preload'</span>
</code></pre><h4 id="srccomponentsserverroutestsx-1"><code>src/components/ServerRoutes.tsx</code> </h4>
<pre data-role="codeBlock" data-info="typescript" class="language-typescript typescript"><code><span class="token keyword keyword-import">import</span> <span class="token punctuation">{</span> Routes<span class="token punctuation">,</span> Route<span class="token punctuation">,</span> useLocation <span class="token punctuation">}</span> <span class="token keyword keyword-from">from</span> <span class="token string">'react-router-dom'</span>
<span class="token keyword keyword-import">import</span> App <span class="token keyword keyword-from">from</span> <span class="token string">'../App'</span>
<span class="token keyword keyword-import">import</span> Home <span class="token keyword keyword-from">from</span> <span class="token string">'../routes/Home'</span>
<span class="token keyword keyword-import">import</span> Posts <span class="token keyword keyword-from">from</span> <span class="token string">'../routes/Posts'</span>
<span class="token keyword keyword-import">import</span> PostDetail <span class="token keyword keyword-from">from</span> <span class="token string">'../routes/PostDetail'</span>
<span class="token keyword keyword-import">import</span> Products <span class="token keyword keyword-from">from</span> <span class="token string">'../routes/Products'</span>
<span class="token keyword keyword-import">import</span> ProductDetail <span class="token keyword keyword-from">from</span> <span class="token string">'../routes/ProductDetail'</span>
<span class="token keyword keyword-import">import</span> Photos <span class="token keyword keyword-from">from</span> <span class="token string">'../routes/Photos'</span>
<span class="token keyword keyword-import">import</span> BBSList <span class="token keyword keyword-from">from</span> <span class="token string">'../routes/BBSList'</span>
<span class="token keyword keyword-import">import</span> BBSThread <span class="token keyword keyword-from">from</span> <span class="token string">'../routes/BBSThread'</span>
</code></pre><h4 id="srccomponentsglobalbackgroundtsx-1"><code>src/components/GlobalBackground.tsx</code> </h4>
<pre data-role="codeBlock" data-info="typescript" class="language-typescript typescript"><code><span class="token keyword keyword-import">import</span> <span class="token punctuation">{</span> useLocation <span class="token punctuation">}</span> <span class="token keyword keyword-from">from</span> <span class="token string">'react-router-dom'</span>
<span class="token keyword keyword-import">import</span> P5HypercubeBackground <span class="token keyword keyword-from">from</span> <span class="token string">'./P5HypercubeBackground'</span>
</code></pre><h4 id="srccomponentsp5hypercubebackgroundtsx-1"><code>src/components/P5HypercubeBackground.tsx</code> </h4>
<pre data-role="codeBlock" data-info="typescript" class="language-typescript typescript"><code><span class="token keyword keyword-import">import</span> <span class="token punctuation">{</span> useEffect<span class="token punctuation">,</span> useRef <span class="token punctuation">}</span> <span class="token keyword keyword-from">from</span> <span class="token string">'react'</span>
</code></pre><h4 id="srccomponentsscrolltophomeswitchtsx-1"><code>src/components/ScrollTopHomeSwitch.tsx</code> </h4>
<pre data-role="codeBlock" data-info="typescript" class="language-typescript typescript"><code><span class="token keyword keyword-import">import</span> <span class="token punctuation">{</span> useEffect<span class="token punctuation">,</span> useRef <span class="token punctuation">}</span> <span class="token keyword keyword-from">from</span> <span class="token string">'react'</span>
<span class="token keyword keyword-import">import</span> <span class="token punctuation">{</span> useLocation<span class="token punctuation">,</span> useNavigate <span class="token punctuation">}</span> <span class="token keyword keyword-from">from</span> <span class="token string">'react-router-dom'</span>
</code></pre><h4 id="srccomponentsaccesscountertsx-1"><code>src/components/AccessCounter.tsx</code> </h4>
<pre data-role="codeBlock" data-info="typescript" class="language-typescript typescript"><code><span class="token keyword keyword-import">import</span> <span class="token punctuation">{</span> useEffect<span class="token punctuation">,</span> useRef<span class="token punctuation">,</span> useState <span class="token punctuation">}</span> <span class="token keyword keyword-from">from</span> <span class="token string">'react'</span>
</code></pre><h4 id="srccomponentsclientonlytsx-1"><code>src/components/ClientOnly.tsx</code> </h4>
<pre data-role="codeBlock" data-info="typescript" class="language-typescript typescript"><code><span class="token keyword keyword-import">import</span> <span class="token punctuation">{</span> useEffect<span class="token punctuation">,</span> useState<span class="token punctuation">,</span> <span class="token keyword keyword-type">type</span> <span class="token class-name">ReactNode</span> <span class="token punctuation">}</span> <span class="token keyword keyword-from">from</span> <span class="token string">'react'</span>
</code></pre><h4 id="srccomponentssitefootertsx-1"><code>src/components/SiteFooter.tsx</code> </h4>
<pre data-role="codeBlock" data-info="typescript" class="language-typescript typescript"><code><span class="token keyword keyword-import">import</span> AccessCounter <span class="token keyword keyword-from">from</span> <span class="token string">'./AccessCounter'</span>
<span class="token keyword keyword-import">import</span> ClientOnly <span class="token keyword keyword-from">from</span> <span class="token string">'./ClientOnly'</span>
<span class="token keyword keyword-import">import</span> <span class="token punctuation">{</span> <span class="token constant">MAIN_TEXT_STYLE</span> <span class="token punctuation">}</span> <span class="token keyword keyword-from">from</span> <span class="token string">'../styles/typography'</span>
</code></pre><h4 id="srccomponentsprefetchlinktsx-1"><code>src/components/PrefetchLink.tsx</code> </h4>
<pre data-role="codeBlock" data-info="typescript" class="language-typescript typescript"><code><span class="token keyword keyword-import">import</span> <span class="token punctuation">{</span> Link<span class="token punctuation">,</span> <span class="token keyword keyword-type">type</span> <span class="token class-name">LinkProps</span> <span class="token punctuation">}</span> <span class="token keyword keyword-from">from</span> <span class="token string">'react-router-dom'</span>
<span class="token keyword keyword-import">import</span> <span class="token punctuation">{</span> useCallback<span class="token punctuation">,</span> useRef <span class="token punctuation">}</span> <span class="token keyword keyword-from">from</span> <span class="token string">'react'</span>
</code></pre><h4 id="srccomponentslightboxtsx-1"><code>src/components/Lightbox.tsx</code> </h4>
<pre data-role="codeBlock" data-info="typescript" class="language-typescript typescript"><code><span class="token keyword keyword-import">import</span> <span class="token punctuation">{</span> useEffect <span class="token punctuation">}</span> <span class="token keyword keyword-from">from</span> <span class="token string">'react'</span>
</code></pre><h4 id="srccomponentsmermaidrenderertsx-1"><code>src/components/MermaidRenderer.tsx</code> </h4>
<pre data-role="codeBlock" data-info="typescript" class="language-typescript typescript"><code><span class="token keyword keyword-import">import</span> <span class="token punctuation">{</span> useEffect<span class="token punctuation">,</span> useRef<span class="token punctuation">,</span> useState <span class="token punctuation">}</span> <span class="token keyword keyword-from">from</span> <span class="token string">'react'</span>
<span class="token keyword keyword-import">import</span> mermaid <span class="token keyword keyword-from">from</span> <span class="token string">'mermaid'</span>
</code></pre><h4 id="srccomponentsbackbuttontsx-1"><code>src/components/BackButton.tsx</code> </h4>
<pre data-role="codeBlock" data-info="typescript" class="language-typescript typescript"><code><span class="token keyword keyword-import">import</span> <span class="token punctuation">{</span> useCallback <span class="token punctuation">}</span> <span class="token keyword keyword-from">from</span> <span class="token string">'react'</span>
<span class="token keyword keyword-import">import</span> <span class="token punctuation">{</span> useNavigate <span class="token punctuation">}</span> <span class="token keyword keyword-from">from</span> <span class="token string">'react-router-dom'</span>
</code></pre><h4 id="srccomponentsadminmarkdowneditortsx-1"><code>src/components/admin/MarkdownEditor.tsx</code> </h4>
<pre data-role="codeBlock" data-info="typescript" class="language-typescript typescript"><code><span class="token keyword keyword-import">import</span> <span class="token punctuation">{</span> useState<span class="token punctuation">,</span> useCallback<span class="token punctuation">,</span> useRef<span class="token punctuation">,</span> useEffect<span class="token punctuation">,</span> useMemo <span class="token punctuation">}</span> <span class="token keyword keyword-from">from</span> <span class="token string">'react'</span>
<span class="token keyword keyword-import">import</span> MDEditor<span class="token punctuation">,</span> <span class="token punctuation">{</span> commands <span class="token punctuation">}</span> <span class="token keyword keyword-from">from</span> <span class="token string">'@uiw/react-md-editor'</span>
<span class="token keyword keyword-import">import</span> <span class="token punctuation">{</span> useAdminAuth <span class="token punctuation">}</span> <span class="token keyword keyword-from">from</span> <span class="token string">'../../contexts/AdminAuthContext'</span>
<span class="token keyword keyword-import">import</span> rehypeKatex <span class="token keyword keyword-from">from</span> <span class="token string">'rehype-katex'</span>
<span class="token keyword keyword-import">import</span> remarkMath <span class="token keyword keyword-from">from</span> <span class="token string">'remark-math'</span>
<span class="token keyword keyword-import">import</span> mermaid <span class="token keyword keyword-from">from</span> <span class="token string">'mermaid'</span>
<span class="token keyword keyword-import">import</span> <span class="token string">'katex/dist/katex.min.css'</span>
</code></pre><h4 id="srcrouteshometsx-1"><code>src/routes/Home.tsx</code> </h4>
<pre data-role="codeBlock" data-info="typescript" class="language-typescript typescript"><code><span class="token keyword keyword-import">import</span> <span class="token punctuation">{</span> useEffect<span class="token punctuation">,</span> useRef<span class="token punctuation">,</span> useState <span class="token punctuation">}</span> <span class="token keyword keyword-from">from</span> <span class="token string">'react'</span>
<span class="token keyword keyword-import">import</span> PrefetchLink <span class="token keyword keyword-from">from</span> <span class="token string">'../components/PrefetchLink'</span>
<span class="token keyword keyword-import">import</span> SiteFooter <span class="token keyword keyword-from">from</span> <span class="token string">'../components/SiteFooter'</span>
<span class="token keyword keyword-import">import</span> postsData <span class="token keyword keyword-from">from</span> <span class="token string">'../data/posts.json'</span> <span class="token keyword keyword-with">with</span> <span class="token punctuation">{</span> type<span class="token operator">:</span> <span class="token string">'json'</span> <span class="token punctuation">}</span>
<span class="token keyword keyword-import">import</span> <span class="token punctuation">{</span> usePageMeta <span class="token punctuation">}</span> <span class="token keyword keyword-from">from</span> <span class="token string">'../hooks/usePageMeta'</span>
<span class="token keyword keyword-import">import</span> <span class="token punctuation">{</span> useReveal <span class="token punctuation">}</span> <span class="token keyword keyword-from">from</span> <span class="token string">'../hooks/useReveal'</span>
<span class="token keyword keyword-import">import</span> <span class="token punctuation">{</span> useScrollToTop <span class="token punctuation">}</span> <span class="token keyword keyword-from">from</span> <span class="token string">'../hooks/useScrollToTop'</span>
<span class="token keyword keyword-import">import</span> <span class="token punctuation">{</span> <span class="token constant">CMS_ENDPOINT</span> <span class="token punctuation">}</span> <span class="token keyword keyword-from">from</span> <span class="token string">'../lib/endpoints'</span>
<span class="token keyword keyword-import">import</span> <span class="token punctuation">{</span> <span class="token constant">MAIN_TEXT_STYLE</span> <span class="token punctuation">}</span> <span class="token keyword keyword-from">from</span> <span class="token string">'../styles/typography'</span>
</code></pre><h4 id="srcroutespoststsx-1"><code>src/routes/Posts.tsx</code> </h4>
<pre data-role="codeBlock" data-info="typescript" class="language-typescript typescript"><code><span class="token keyword keyword-import">import</span> <span class="token punctuation">{</span> useSearchParams<span class="token punctuation">,</span> Link <span class="token punctuation">}</span> <span class="token keyword keyword-from">from</span> <span class="token string">'react-router-dom'</span>
<span class="token keyword keyword-import">import</span> <span class="token punctuation">{</span> useEffect<span class="token punctuation">,</span> useMemo<span class="token punctuation">,</span> useRef<span class="token punctuation">,</span> useCallback<span class="token punctuation">,</span> startTransition<span class="token punctuation">,</span> useState <span class="token punctuation">}</span> <span class="token keyword keyword-from">from</span> <span class="token string">'react'</span>
<span class="token keyword keyword-import">import</span> postsData <span class="token keyword keyword-from">from</span> <span class="token string">'../data/posts.json'</span> <span class="token keyword keyword-with">with</span> <span class="token punctuation">{</span> type<span class="token operator">:</span> <span class="token string">'json'</span> <span class="token punctuation">}</span>
<span class="token keyword keyword-import">import</span> PrefetchLink <span class="token keyword keyword-from">from</span> <span class="token string">'../components/PrefetchLink'</span>
<span class="token keyword keyword-import">import</span> SiteFooter <span class="token keyword keyword-from">from</span> <span class="token string">'../components/SiteFooter'</span>
<span class="token keyword keyword-import">import</span> <span class="token punctuation">{</span> useAdminAuth <span class="token punctuation">}</span> <span class="token keyword keyword-from">from</span> <span class="token string">'../contexts/AdminAuthContext'</span>
<span class="token keyword keyword-import">import</span> <span class="token punctuation">{</span> useReveal <span class="token punctuation">}</span> <span class="token keyword keyword-from">from</span> <span class="token string">'../hooks/useReveal'</span>
<span class="token keyword keyword-import">import</span> <span class="token punctuation">{</span> useScrollToTop <span class="token punctuation">}</span> <span class="token keyword keyword-from">from</span> <span class="token string">'../hooks/useScrollToTop'</span>
<span class="token keyword keyword-import">import</span> <span class="token punctuation">{</span> formatDraftDate <span class="token punctuation">}</span> <span class="token keyword keyword-from">from</span> <span class="token string">'../lib/draftStorage'</span>
<span class="token keyword keyword-import">import</span> <span class="token punctuation">{</span> <span class="token constant">CMS_ENDPOINT</span> <span class="token punctuation">}</span> <span class="token keyword keyword-from">from</span> <span class="token string">'../lib/endpoints'</span>
<span class="token keyword keyword-import">import</span> <span class="token punctuation">{</span> usePageMeta <span class="token punctuation">}</span> <span class="token keyword keyword-from">from</span> <span class="token string">'../hooks/usePageMeta'</span>
<span class="token keyword keyword-import">import</span> <span class="token punctuation">{</span> <span class="token constant">MAIN_FONT_STYLE</span><span class="token punctuation">,</span> <span class="token constant">MAIN_TEXT_STYLE</span> <span class="token punctuation">}</span> <span class="token keyword keyword-from">from</span> <span class="token string">'../styles/typography'</span>
</code></pre><h4 id="srcroutespostdetailtsx-1"><code>src/routes/PostDetail.tsx</code> </h4>
<pre data-role="codeBlock" data-info="typescript" class="language-typescript typescript"><code><span class="token keyword keyword-import">import</span> <span class="token punctuation">{</span> useLocation<span class="token punctuation">,</span> useParams<span class="token punctuation">,</span> Link <span class="token punctuation">}</span> <span class="token keyword keyword-from">from</span> <span class="token string">'react-router-dom'</span>
<span class="token keyword keyword-import">import</span> <span class="token punctuation">{</span> useEffect<span class="token punctuation">,</span> useMemo<span class="token punctuation">,</span> useRef<span class="token punctuation">,</span> useState<span class="token punctuation">,</span> useCallback<span class="token punctuation">,</span> startTransition <span class="token punctuation">}</span> <span class="token keyword keyword-from">from</span> <span class="token string">'react'</span>
<span class="token keyword keyword-import">import</span> postsData <span class="token keyword keyword-from">from</span> <span class="token string">'../data/posts.json'</span> <span class="token keyword keyword-with">with</span> <span class="token punctuation">{</span> type<span class="token operator">:</span> <span class="token string">'json'</span> <span class="token punctuation">}</span>
<span class="token keyword keyword-import">import</span> PrefetchLink <span class="token keyword keyword-from">from</span> <span class="token string">'../components/PrefetchLink'</span>
<span class="token keyword keyword-import">import</span> SiteFooter <span class="token keyword keyword-from">from</span> <span class="token string">'../components/SiteFooter'</span>
<span class="token keyword keyword-import">import</span> ClientOnly <span class="token keyword keyword-from">from</span> <span class="token string">'../components/ClientOnly'</span>
<span class="token keyword keyword-import">import</span> <span class="token punctuation">{</span> useMermaidBlocks <span class="token punctuation">}</span> <span class="token keyword keyword-from">from</span> <span class="token string">'../hooks/useMermaidBlocks'</span>
<span class="token keyword keyword-import">import</span> <span class="token punctuation">{</span> useReveal <span class="token punctuation">}</span> <span class="token keyword keyword-from">from</span> <span class="token string">'../hooks/useReveal'</span>
<span class="token keyword keyword-import">import</span> <span class="token punctuation">{</span> useScrollToTop <span class="token punctuation">}</span> <span class="token keyword keyword-from">from</span> <span class="token string">'../hooks/useScrollToTop'</span>
<span class="token keyword keyword-import">import</span> <span class="token punctuation">{</span> <span class="token constant">CMS_ENDPOINT</span><span class="token punctuation">,</span> <span class="token constant">GOOD_ENDPOINT</span> <span class="token punctuation">}</span> <span class="token keyword keyword-from">from</span> <span class="token string">'../lib/endpoints'</span>
<span class="token keyword keyword-import">import</span> <span class="token punctuation">{</span> usePageMeta <span class="token punctuation">}</span> <span class="token keyword keyword-from">from</span> <span class="token string">'../hooks/usePageMeta'</span>
<span class="token keyword keyword-import">import</span> <span class="token punctuation">{</span> <span class="token constant">MAIN_FONT_STYLE</span><span class="token punctuation">,</span> <span class="token constant">MAIN_TEXT_STYLE</span> <span class="token punctuation">}</span> <span class="token keyword keyword-from">from</span> <span class="token string">'../styles/typography'</span>
</code></pre><h4 id="srcroutesproductstsx-1"><code>src/routes/Products.tsx</code> </h4>
<pre data-role="codeBlock" data-info="typescript" class="language-typescript typescript"><code><span class="token keyword keyword-import">import</span> <span class="token punctuation">{</span> useEffect<span class="token punctuation">,</span> useRef<span class="token punctuation">,</span> useState <span class="token punctuation">}</span> <span class="token keyword keyword-from">from</span> <span class="token string">'react'</span>
<span class="token keyword keyword-import">import</span> <span class="token punctuation">{</span> Link <span class="token punctuation">}</span> <span class="token keyword keyword-from">from</span> <span class="token string">'react-router-dom'</span>
<span class="token keyword keyword-import">import</span> productsData <span class="token keyword keyword-from">from</span> <span class="token string">'../data/products.json'</span> <span class="token keyword keyword-with">with</span> <span class="token punctuation">{</span> type<span class="token operator">:</span> <span class="token string">'json'</span> <span class="token punctuation">}</span>
<span class="token keyword keyword-import">import</span> ArrowRightIcon <span class="token keyword keyword-from">from</span> <span class="token string">'../components/icons/ArrowRightIcon'</span>
<span class="token keyword keyword-import">import</span> PrefetchLink <span class="token keyword keyword-from">from</span> <span class="token string">'../components/PrefetchLink'</span>
<span class="token keyword keyword-import">import</span> SiteFooter <span class="token keyword keyword-from">from</span> <span class="token string">'../components/SiteFooter'</span>
<span class="token keyword keyword-import">import</span> <span class="token punctuation">{</span> useAdminAuth <span class="token punctuation">}</span> <span class="token keyword keyword-from">from</span> <span class="token string">'../contexts/AdminAuthContext'</span>
<span class="token keyword keyword-import">import</span> <span class="token punctuation">{</span> usePageMeta <span class="token punctuation">}</span> <span class="token keyword keyword-from">from</span> <span class="token string">'../hooks/usePageMeta'</span>
<span class="token keyword keyword-import">import</span> <span class="token punctuation">{</span> useReveal <span class="token punctuation">}</span> <span class="token keyword keyword-from">from</span> <span class="token string">'../hooks/useReveal'</span>
<span class="token keyword keyword-import">import</span> <span class="token punctuation">{</span> useScrollToTop <span class="token punctuation">}</span> <span class="token keyword keyword-from">from</span> <span class="token string">'../hooks/useScrollToTop'</span>
<span class="token keyword keyword-import">import</span> <span class="token punctuation">{</span> <span class="token constant">CMS_ENDPOINT</span> <span class="token punctuation">}</span> <span class="token keyword keyword-from">from</span> <span class="token string">'../lib/endpoints'</span>
<span class="token keyword keyword-import">import</span> <span class="token punctuation">{</span> <span class="token constant">MAIN_FONT_STYLE</span><span class="token punctuation">,</span> <span class="token constant">MAIN_TEXT_STYLE</span> <span class="token punctuation">}</span> <span class="token keyword keyword-from">from</span> <span class="token string">'../styles/typography'</span>
</code></pre><h4 id="srcroutesproductdetailtsx-1"><code>src/routes/ProductDetail.tsx</code> </h4>
<pre data-role="codeBlock" data-info="typescript" class="language-typescript typescript"><code><span class="token keyword keyword-import">import</span> <span class="token punctuation">{</span> useEffect<span class="token punctuation">,</span> useRef <span class="token punctuation">}</span> <span class="token keyword keyword-from">from</span> <span class="token string">'react'</span>
<span class="token keyword keyword-import">import</span> <span class="token punctuation">{</span> useParams<span class="token punctuation">,</span> Link <span class="token punctuation">}</span> <span class="token keyword keyword-from">from</span> <span class="token string">'react-router-dom'</span>
<span class="token keyword keyword-import">import</span> productsData <span class="token keyword keyword-from">from</span> <span class="token string">'../data/products.json'</span> <span class="token keyword keyword-with">with</span> <span class="token punctuation">{</span> type<span class="token operator">:</span> <span class="token string">'json'</span> <span class="token punctuation">}</span>
<span class="token keyword keyword-import">import</span> productPostsData <span class="token keyword keyword-from">from</span> <span class="token string">'../data/product-posts.json'</span> <span class="token keyword keyword-with">with</span> <span class="token punctuation">{</span> type<span class="token operator">:</span> <span class="token string">'json'</span> <span class="token punctuation">}</span>
<span class="token keyword keyword-import">import</span> PrefetchLink <span class="token keyword keyword-from">from</span> <span class="token string">'../components/PrefetchLink'</span>
<span class="token keyword keyword-import">import</span> SiteFooter <span class="token keyword keyword-from">from</span> <span class="token string">'../components/SiteFooter'</span>
<span class="token keyword keyword-import">import</span> <span class="token punctuation">{</span> useMermaidBlocks <span class="token punctuation">}</span> <span class="token keyword keyword-from">from</span> <span class="token string">'../hooks/useMermaidBlocks'</span>
<span class="token keyword keyword-import">import</span> <span class="token punctuation">{</span> usePageMeta <span class="token punctuation">}</span> <span class="token keyword keyword-from">from</span> <span class="token string">'../hooks/usePageMeta'</span>
<span class="token keyword keyword-import">import</span> <span class="token punctuation">{</span> useReveal <span class="token punctuation">}</span> <span class="token keyword keyword-from">from</span> <span class="token string">'../hooks/useReveal'</span>
<span class="token keyword keyword-import">import</span> <span class="token punctuation">{</span> useScrollToTop <span class="token punctuation">}</span> <span class="token keyword keyword-from">from</span> <span class="token string">'../hooks/useScrollToTop'</span>
<span class="token keyword keyword-import">import</span> <span class="token punctuation">{</span> <span class="token constant">MAIN_FONT_STYLE</span><span class="token punctuation">,</span> <span class="token constant">MAIN_TEXT_STYLE</span> <span class="token punctuation">}</span> <span class="token keyword keyword-from">from</span> <span class="token string">'../styles/typography'</span>
</code></pre><h4 id="srcroutesphotostsx-1"><code>src/routes/Photos.tsx</code> </h4>
<pre data-role="codeBlock" data-info="typescript" class="language-typescript typescript"><code><span class="token keyword keyword-import">import</span> Lightbox <span class="token keyword keyword-from">from</span> <span class="token string">'../components/Lightbox'</span>
<span class="token keyword keyword-import">import</span> PrefetchLink <span class="token keyword keyword-from">from</span> <span class="token string">'../components/PrefetchLink'</span>
<span class="token keyword keyword-import">import</span> SiteFooter <span class="token keyword keyword-from">from</span> <span class="token string">'../components/SiteFooter'</span>
<span class="token keyword keyword-import">import</span> <span class="token punctuation">{</span> useState<span class="token punctuation">,</span> useRef <span class="token punctuation">}</span> <span class="token keyword keyword-from">from</span> <span class="token string">'react'</span>
<span class="token keyword keyword-import">import</span> <span class="token punctuation">{</span> photos<span class="token punctuation">,</span> shotTags<span class="token punctuation">,</span> <span class="token keyword keyword-type">type</span> <span class="token class-name">Photo</span><span class="token punctuation">,</span> <span class="token keyword keyword-type">type</span> <span class="token class-name">PhotoRatio</span> <span class="token punctuation">}</span> <span class="token keyword keyword-from">from</span> <span class="token string">'../data/photos'</span>
<span class="token keyword keyword-import">import</span> <span class="token punctuation">{</span> usePageMeta <span class="token punctuation">}</span> <span class="token keyword keyword-from">from</span> <span class="token string">'../hooks/usePageMeta'</span>
<span class="token keyword keyword-import">import</span> <span class="token punctuation">{</span> useReveal <span class="token punctuation">}</span> <span class="token keyword keyword-from">from</span> <span class="token string">'../hooks/useReveal'</span>
<span class="token keyword keyword-import">import</span> <span class="token punctuation">{</span> useScrollToTop <span class="token punctuation">}</span> <span class="token keyword keyword-from">from</span> <span class="token string">'../hooks/useScrollToTop'</span>
<span class="token keyword keyword-import">import</span> <span class="token punctuation">{</span> <span class="token constant">MAIN_FONT_STYLE</span><span class="token punctuation">,</span> <span class="token constant">MAIN_TEXT_STYLE</span> <span class="token punctuation">}</span> <span class="token keyword keyword-from">from</span> <span class="token string">'../styles/typography'</span>
</code></pre><h4 id="srcroutesbbslisttsx-1"><code>src/routes/BBSList.tsx</code> </h4>
<pre data-role="codeBlock" data-info="typescript" class="language-typescript typescript"><code><span class="token keyword keyword-import">import</span> <span class="token punctuation">{</span> useEffect<span class="token punctuation">,</span> useRef<span class="token punctuation">,</span> useState<span class="token punctuation">,</span> useCallback <span class="token punctuation">}</span> <span class="token keyword keyword-from">from</span> <span class="token string">'react'</span>
<span class="token keyword keyword-import">import</span> <span class="token punctuation">{</span> Link <span class="token punctuation">}</span> <span class="token keyword keyword-from">from</span> <span class="token string">'react-router-dom'</span>
<span class="token keyword keyword-import">import</span> PrefetchLink <span class="token keyword keyword-from">from</span> <span class="token string">'../components/PrefetchLink'</span>
<span class="token keyword keyword-import">import</span> SiteFooter <span class="token keyword keyword-from">from</span> <span class="token string">'../components/SiteFooter'</span>
<span class="token keyword keyword-import">import</span> <span class="token punctuation">{</span> useAdminAuth <span class="token punctuation">}</span> <span class="token keyword keyword-from">from</span> <span class="token string">'../contexts/AdminAuthContext'</span>
<span class="token keyword keyword-import">import</span> <span class="token punctuation">{</span> usePageMeta <span class="token punctuation">}</span> <span class="token keyword keyword-from">from</span> <span class="token string">'../hooks/usePageMeta'</span>
<span class="token keyword keyword-import">import</span> <span class="token punctuation">{</span> useReveal <span class="token punctuation">}</span> <span class="token keyword keyword-from">from</span> <span class="token string">'../hooks/useReveal'</span>
<span class="token keyword keyword-import">import</span> <span class="token punctuation">{</span> useScrollToTop <span class="token punctuation">}</span> <span class="token keyword keyword-from">from</span> <span class="token string">'../hooks/useScrollToTop'</span>
<span class="token keyword keyword-import">import</span> <span class="token punctuation">{</span> <span class="token constant">BBS_ENDPOINT</span> <span class="token punctuation">}</span> <span class="token keyword keyword-from">from</span> <span class="token string">'../lib/endpoints'</span>
<span class="token keyword keyword-import">import</span> <span class="token punctuation">{</span> <span class="token constant">MAIN_FONT_STYLE</span><span class="token punctuation">,</span> <span class="token constant">MAIN_TEXT_STYLE</span> <span class="token punctuation">}</span> <span class="token keyword keyword-from">from</span> <span class="token string">'../styles/typography'</span>
</code></pre><h4 id="srcroutesbbsthreadtsx-1"><code>src/routes/BBSThread.tsx</code> </h4>
<pre data-role="codeBlock" data-info="typescript" class="language-typescript typescript"><code><span class="token keyword keyword-import">import</span> <span class="token punctuation">{</span> useEffect<span class="token punctuation">,</span> useRef<span class="token punctuation">,</span> useState<span class="token punctuation">,</span> useCallback <span class="token punctuation">}</span> <span class="token keyword keyword-from">from</span> <span class="token string">'react'</span>
<span class="token keyword keyword-import">import</span> <span class="token punctuation">{</span> useParams<span class="token punctuation">,</span> Link <span class="token punctuation">}</span> <span class="token keyword keyword-from">from</span> <span class="token string">'react-router-dom'</span>
<span class="token keyword keyword-import">import</span> PrefetchLink <span class="token keyword keyword-from">from</span> <span class="token string">'../components/PrefetchLink'</span>
<span class="token keyword keyword-import">import</span> SiteFooter <span class="token keyword keyword-from">from</span> <span class="token string">'../components/SiteFooter'</span>
<span class="token keyword keyword-import">import</span> <span class="token punctuation">{</span> useAdminAuth <span class="token punctuation">}</span> <span class="token keyword keyword-from">from</span> <span class="token string">'../contexts/AdminAuthContext'</span>
<span class="token keyword keyword-import">import</span> <span class="token punctuation">{</span> usePageMeta <span class="token punctuation">}</span> <span class="token keyword keyword-from">from</span> <span class="token string">'../hooks/usePageMeta'</span>
<span class="token keyword keyword-import">import</span> <span class="token punctuation">{</span> useReveal <span class="token punctuation">}</span> <span class="token keyword keyword-from">from</span> <span class="token string">'../hooks/useReveal'</span>
<span class="token keyword keyword-import">import</span> <span class="token punctuation">{</span> useScrollToTop <span class="token punctuation">}</span> <span class="token keyword keyword-from">from</span> <span class="token string">'../hooks/useScrollToTop'</span>
<span class="token keyword keyword-import">import</span> <span class="token punctuation">{</span> <span class="token constant">BBS_ENDPOINT</span> <span class="token punctuation">}</span> <span class="token keyword keyword-from">from</span> <span class="token string">'../lib/endpoints'</span>
<span class="token keyword keyword-import">import</span> <span class="token punctuation">{</span> <span class="token constant">MAIN_FONT_STYLE</span><span class="token punctuation">,</span> <span class="token constant">MAIN_TEXT_STYLE</span> <span class="token punctuation">}</span> <span class="token keyword keyword-from">from</span> <span class="token string">'../styles/typography'</span>
</code></pre><h4 id="srcroutesadminposteditortsx-1"><code>src/routes/admin/PostEditor.tsx</code> </h4>
<pre data-role="codeBlock" data-info="typescript" class="language-typescript typescript"><code><span class="token keyword keyword-import">import</span> <span class="token punctuation">{</span> useEffect<span class="token punctuation">,</span> useState<span class="token punctuation">,</span> useCallback<span class="token punctuation">,</span> useRef <span class="token punctuation">}</span> <span class="token keyword keyword-from">from</span> <span class="token string">'react'</span>
<span class="token keyword keyword-import">import</span> <span class="token punctuation">{</span> useParams<span class="token punctuation">,</span> useNavigate<span class="token punctuation">,</span> Link <span class="token punctuation">}</span> <span class="token keyword keyword-from">from</span> <span class="token string">'react-router-dom'</span>
<span class="token keyword keyword-import">import</span> <span class="token punctuation">{</span> useAdminAuth <span class="token punctuation">}</span> <span class="token keyword keyword-from">from</span> <span class="token string">'../../contexts/AdminAuthContext'</span>
<span class="token keyword keyword-import">import</span> MarkdownEditor <span class="token keyword keyword-from">from</span> <span class="token string">'../../components/admin/MarkdownEditor'</span>
<span class="token keyword keyword-import">import</span> <span class="token punctuation">{</span> unified <span class="token punctuation">}</span> <span class="token keyword keyword-from">from</span> <span class="token string">'unified'</span>
<span class="token keyword keyword-import">import</span> remarkParse <span class="token keyword keyword-from">from</span> <span class="token string">'remark-parse'</span>
<span class="token keyword keyword-import">import</span> remarkGfm <span class="token keyword keyword-from">from</span> <span class="token string">'remark-gfm'</span>
<span class="token keyword keyword-import">import</span> remarkRehype <span class="token keyword keyword-from">from</span> <span class="token string">'remark-rehype'</span>
<span class="token keyword keyword-import">import</span> rehypeStringify <span class="token keyword keyword-from">from</span> <span class="token string">'rehype-stringify'</span>
<span class="token keyword keyword-import">import</span> <span class="token punctuation">{</span> saveDraft<span class="token punctuation">,</span> loadDraft<span class="token punctuation">,</span> deleteDraft<span class="token punctuation">,</span> formatDraftDate<span class="token punctuation">,</span> <span class="token keyword keyword-type">type</span> <span class="token class-name">PostDraft</span> <span class="token punctuation">}</span> <span class="token keyword keyword-from">from</span> <span class="token string">'../../lib/draftStorage'</span>
</code></pre><h4 id="srcroutesadminproducteditortsx-1"><code>src/routes/admin/ProductEditor.tsx</code> </h4>
<pre data-role="codeBlock" data-info="typescript" class="language-typescript typescript"><code><span class="token keyword keyword-import">import</span> <span class="token punctuation">{</span> useEffect<span class="token punctuation">,</span> useState<span class="token punctuation">,</span> useCallback<span class="token punctuation">,</span> useRef <span class="token punctuation">}</span> <span class="token keyword keyword-from">from</span> <span class="token string">'react'</span>
<span class="token keyword keyword-import">import</span> <span class="token punctuation">{</span> useParams<span class="token punctuation">,</span> useNavigate<span class="token punctuation">,</span> Link <span class="token punctuation">}</span> <span class="token keyword keyword-from">from</span> <span class="token string">'react-router-dom'</span>
<span class="token keyword keyword-import">import</span> <span class="token punctuation">{</span> useAdminAuth <span class="token punctuation">}</span> <span class="token keyword keyword-from">from</span> <span class="token string">'../../contexts/AdminAuthContext'</span>
<span class="token keyword keyword-import">import</span> MarkdownEditor <span class="token keyword keyword-from">from</span> <span class="token string">'../../components/admin/MarkdownEditor'</span>
<span class="token keyword keyword-import">import</span> <span class="token punctuation">{</span> unified <span class="token punctuation">}</span> <span class="token keyword keyword-from">from</span> <span class="token string">'unified'</span>
<span class="token keyword keyword-import">import</span> remarkParse <span class="token keyword keyword-from">from</span> <span class="token string">'remark-parse'</span>
<span class="token keyword keyword-import">import</span> remarkGfm <span class="token keyword keyword-from">from</span> <span class="token string">'remark-gfm'</span>
<span class="token keyword keyword-import">import</span> remarkRehype <span class="token keyword keyword-from">from</span> <span class="token string">'remark-rehype'</span>
<span class="token keyword keyword-import">import</span> rehypeStringify <span class="token keyword keyword-from">from</span> <span class="token string">'rehype-stringify'</span>
<span class="token keyword keyword-import">import</span> <span class="token punctuation">{</span> saveDraft<span class="token punctuation">,</span> loadDraft<span class="token punctuation">,</span> deleteDraft<span class="token punctuation">,</span> formatDraftDate<span class="token punctuation">,</span> <span class="token keyword keyword-type">type</span> <span class="token class-name">ProductDraft</span> <span class="token punctuation">}</span> <span class="token keyword keyword-from">from</span> <span class="token string">'../../lib/draftStorage'</span>
</code></pre><h4 id="srclibfirebasets-1"><code>src/lib/firebase.ts</code> </h4>
<pre data-role="codeBlock" data-info="typescript" class="language-typescript typescript"><code><span class="token keyword keyword-import">import</span> <span class="token punctuation">{</span> initializeApp <span class="token punctuation">}</span> <span class="token keyword keyword-from">from</span> <span class="token string">'firebase/app'</span>
<span class="token keyword keyword-import">import</span> <span class="token punctuation">{</span> getAuth<span class="token punctuation">,</span> GoogleAuthProvider <span class="token punctuation">}</span> <span class="token keyword keyword-from">from</span> <span class="token string">'firebase/auth'</span>
</code></pre><hr>
<h3 id="環境変数">環境変数 </h3>
<table>
<thead>
<tr>
<th>変数名</th>
<th>説明</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>VITE_FIREBASE_API_KEY</code></td>
<td>Firebase APIキー</td>
</tr>
<tr>
<td><code>VITE_FIREBASE_AUTH_DOMAIN</code></td>
<td>Firebase認証ドメイン</td>
</tr>
<tr>
<td><code>VITE_FIREBASE_PROJECT_ID</code></td>
<td>FirebaseプロジェクトID</td>
</tr>
<tr>
<td><code>VITE_FIREBASE_STORAGE_BUCKET</code></td>
<td>Firebaseストレージバケット</td>
</tr>
<tr>
<td><code>VITE_FIREBASE_MESSAGING_SENDER_ID</code></td>
<td>FirebaseメッセージングID</td>
</tr>
<tr>
<td><code>VITE_FIREBASE_APP_ID</code></td>
<td>FirebaseアプリID</td>
</tr>
<tr>
<td><code>VITE_ADMIN_EMAILS</code></td>
<td>管理者メールアドレス（カンマ区切り）</td>
</tr>
<tr>
<td><code>VITE_CMS_ENDPOINT</code></td>
<td>CMS APIエンドポイント</td>
</tr>
<tr>
<td><code>VITE_GOOD_ENDPOINT</code></td>
<td>いいねAPIエンドポイント</td>
</tr>
<tr>
<td><code>VITE_BBS_ENDPOINT</code></td>
<td>BBS APIエンドポイント</td>
</tr>
</tbody>
</table>
<hr>
<h2 id="アーキテクチャ概要">アーキテクチャ概要 </h2>
<pre data-role="codeBlock" data-info="" class="language-text"><code>┌─────────────────────────────────────────────────────────────┐
│                      main.tsx                                │
│  ┌─────────────────────────────────────────────────────────┐ │
│  │ BrowserRouter                                           │ │
│  │  ├── AdminAuthProvider (認証コンテキスト)               │ │
│  │  │    ├── GlobalBackground (背景画像)                   │ │
│  │  │    ├── ScrollTopHomeSwitch (ジェスチャーナビ)        │ │
│  │  │    └── AnimatedRoutes (ルーティング)                 │ │
│  │  │         ├── App (/)                                  │ │
│  │  │         ├── Home (/home)                             │ │
│  │  │         ├── Posts (/posts)                           │ │
│  │  │         ├── PostDetail (/posts/:slug)                │ │
│  │  │         ├── Products (/products)                     │ │
│  │  │         ├── ProductDetail (/products/:slug)          │ │
│  │  │         ├── Photos (/photos)                         │ │
│  │  │         ├── BBSList (/bbs)                           │ │
│  │  │         ├── BBSThread (/bbs/:threadId)               │ │
│  │  │         ├── PostEditor (/admin/posts/...)            │ │
│  │  │         └── ProductEditor (/admin/products/...)      │ │
│  └─────────────────────────────────────────────────────────┘ │
└─────────────────────────────────────────────────────────────┘
</code></pre><hr>
<h2 id="特記事項">特記事項 </h2>
<h3 id="セッション管理">セッション管理 </h3>
<ol>
<li>ログイン時に1時間のセッションタイムアウトが開始</li>
<li>IDトークンは50分ごとに自動更新</li>
<li>ページリロード時もセッションは維持（リロード時から1時間）</li>
<li>セッション期限切れ時は自動ログアウト＆アラート</li>
</ol>
<h3 id="下書き保存">下書き保存 </h3>
<ol>
<li>編集中のデータはlocalStorageに自動保存可能</li>
<li>ログアウト時に下書きを自動保存</li>
<li>ページ読み込み時に下書きがあれば復元通知</li>
<li>サーバーより新しい下書きのみ復元</li>
</ol>
<h3 id="パフォーマンス最適化">パフォーマンス最適化 </h3>
<ol>
<li>全ルートの遅延読み込み（React.lazy）</li>
<li><code>preload</code>/<code>prefetch</code>による優先度付きロード（アイドル時の事前ロードを含む）</li>
<li>ホバー/フォーカス時のルートプリフェッチ（<code>PrefetchLink</code>）</li>
<li>背景画像のsrcset対応 + CSS変数による動的ブラー</li>
<li>SSG（SSRビルド + prerender）と <code>hydrateRoot</code> による初期表示最適化</li>
</ol>
<hr>
<h2 id="セキュリティ実装">セキュリティ実装 </h2>
<p>このセクションでは、haroin57-webで実装しているセキュリティ対策を初学者向けに詳しく解説します。</p>
<h3 id="1-なぜセキュリティが必要なのか">1. なぜセキュリティが必要なのか </h3>
<p>Webアプリケーションでは、「誰がリクエストを送っているか」を確認することが非常に重要です。例えば：</p>
<ul>
<li>記事の編集・削除は管理者だけができるべき</li>
<li>下書き記事は一般ユーザーには見せたくない</li>
<li>不正なリクエストからAPIを保護したい</li>
</ul>
<p>これらを実現するために、**認証（Authentication）<strong>と</strong>認可（Authorization）**という仕組みを使います。</p>
<table>
<thead>
<tr>
<th>用語</th>
<th>意味</th>
<th>例</th>
</tr>
</thead>
<tbody>
<tr>
<td>認証</td>
<td>「あなたは誰？」を確認する</td>
<td>ログインして本人確認</td>
</tr>
<tr>
<td>認可</td>
<td>「あなたはこれをしていい？」を確認する</td>
<td>管理者だけが編集可能</td>
</tr>
</tbody>
</table>
<hr>
<h3 id="2-jwtjson-web-tokenとは">2. JWT（JSON Web Token）とは </h3>
<h4 id="21-jwtの基本概念">2.1 JWTの基本概念 </h4>
<p>JWTは、ユーザー情報を安全にやり取りするための「デジタル身分証明書」のようなものです。</p>
<pre data-role="codeBlock" data-info="" class="language-text"><code>eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIxMjM0NTY3ODkwIiwibmFtZSI6IkpvaG4gRG9lIiwiYWRtaW4iOnRydWUsImlhdCI6MTUxNjIzOTAyMn0.POstGetfAytaZS82wHcjoTyoqhMyxXiWdR7Nn7A29DNSl0EiXLdwJ6xC6AfgZWF1bOsS_TuYI3OG85AmiExREkrS6tDfTQ2B3WXlrr-wp5AokiRbz3_oB4OxG-W9KcEEbDRcZc0nH3L7LzYptiy1PtAylQGxHTWZXtGz4ht0bAecBgmpdgXMguEIcoqPJ1n3pIWk_dUZegpqx0Lka21H6XxUTxiy8OcaarA8zdnPUnV6AmNP3ecFawIFYdvJB_cm-GvpCSbr8G8y_Mllj8f4x9nBH8pQux89_6gUY618iYv7tuPWBFfEbLxtF2pZS6YC1aSfLQxeNe8djT9YjpvRZA
</code></pre><p>一見すると意味不明な文字列ですが、実は3つの部分からできています：</p>
<pre data-role="codeBlock" data-info="" class="language-text"><code>[ヘッダー].[ペイロード].[署名]
</code></pre><p>それぞれ<strong>Base64URL</strong>という形式でエンコード（変換）されています。</p>
<h4 id="22-jwtの3つの構成要素">2.2 JWTの3つの構成要素 </h4>
<p><strong>① ヘッダー（Header）</strong></p>
<p>「このトークンは何の方式で署名されているか」を示します。</p>
<pre data-role="codeBlock" data-info="json" class="language-json json"><code><span class="token punctuation">{</span>
  <span class="token property">"alg"</span><span class="token operator">:</span> <span class="token string">"RS256"</span><span class="token punctuation">,</span>    <span class="token comment">// 署名アルゴリズム（RSA + SHA-256）</span>
  <span class="token property">"kid"</span><span class="token operator">:</span> <span class="token string">"abc123"</span><span class="token punctuation">,</span>   <span class="token comment">// 公開鍵のID（Key ID）</span>
  <span class="token property">"typ"</span><span class="token operator">:</span> <span class="token string">"JWT"</span>       <span class="token comment">// トークンの種類</span>
<span class="token punctuation">}</span>
</code></pre><p><strong>② ペイロード（Payload）</strong></p>
<p>ユーザー情報や有効期限などの「中身」が入っています。</p>
<pre data-role="codeBlock" data-info="json" class="language-json json"><code><span class="token punctuation">{</span>
  <span class="token property">"iss"</span><span class="token operator">:</span> <span class="token string">"https://securetoken.google.com/my-project"</span><span class="token punctuation">,</span>  <span class="token comment">// 発行者</span>
  <span class="token property">"aud"</span><span class="token operator">:</span> <span class="token string">"my-project"</span><span class="token punctuation">,</span>                                  <span class="token comment">// 対象者（誰向けか）</span>
  <span class="token property">"sub"</span><span class="token operator">:</span> <span class="token string">"user123"</span><span class="token punctuation">,</span>                                     <span class="token comment">// ユーザーID</span>
  <span class="token property">"email"</span><span class="token operator">:</span> <span class="token string">"user@example.com"</span><span class="token punctuation">,</span>                          <span class="token comment">// メールアドレス</span>
  <span class="token property">"email_verified"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>                               <span class="token comment">// メール確認済みか</span>
  <span class="token property">"iat"</span><span class="token operator">:</span> <span class="token number">1700000000</span><span class="token punctuation">,</span>                                    <span class="token comment">// 発行時刻</span>
  <span class="token property">"exp"</span><span class="token operator">:</span> <span class="token number">1700003600</span><span class="token punctuation">,</span>                                    <span class="token comment">// 有効期限</span>
  <span class="token property">"auth_time"</span><span class="token operator">:</span> <span class="token number">1699999000</span>                               <span class="token comment">// 認証した時刻</span>
<span class="token punctuation">}</span>
</code></pre><p><strong>③ 署名（Signature）</strong></p>
<p>「このトークンが本物であること」を証明する電子署名です。</p>
<pre data-role="codeBlock" data-info="" class="language-text"><code>署名 = RSA暗号化(ヘッダー + "." + ペイロード, 秘密鍵)
</code></pre><h4 id="23-なぜ署名が必要なのか">2.3 なぜ署名が必要なのか </h4>
<p>署名がなければ、悪意のあるユーザーが自分でトークンを作れてしまいます：</p>
<pre data-role="codeBlock" data-info="json" class="language-json json"><code><span class="token comment">// 悪意のあるユーザーが作った偽のペイロード</span>
<span class="token punctuation">{</span>
  <span class="token property">"email"</span><span class="token operator">:</span> <span class="token string">"admin@example.com"</span><span class="token punctuation">,</span>  <span class="token comment">// 管理者になりすまし！</span>
  <span class="token property">"email_verified"</span><span class="token operator">:</span> <span class="token boolean">true</span>
<span class="token punctuation">}</span>
</code></pre><p>しかし、署名があれば：</p>
<ol>
<li>トークンは<strong>秘密鍵</strong>で署名される（Firebaseだけが持っている）</li>
<li>サーバーは<strong>公開鍵</strong>で署名を検証できる</li>
<li>署名が合わなければ偽物と判断できる</li>
</ol>
<p>これを<strong>公開鍵暗号方式</strong>と呼びます。</p>
<hr>
<h3 id="3-firebase認証の仕組み">3. Firebase認証の仕組み </h3>
<h4 id="31-認証フロー全体像">3.1 認証フロー全体像 </h4>
<pre data-role="codeBlock" data-info="" class="language-text"><code>┌─────────────────────────────────────────────────────────────────────────┐
│                         認証フロー                                        │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                           │
│  ① ユーザーがGoogleログイン                                               │
│     ┌────────┐         ┌─────────────┐        ┌──────────────────┐      │
│     │ ブラウザ │ ──────▶ │   Firebase   │ ◀────▶ │   Google OAuth   │      │
│     └────────┘         └─────────────┘        └──────────────────┘      │
│                               │                                          │
│  ② FirebaseがIDトークン（JWT）を発行                                      │
│                               ▼                                          │
│     ┌────────┐         ┌─────────────┐                                  │
│     │ ブラウザ │ ◀────── │  IDトークン   │                                  │
│     └────────┘         └─────────────┘                                  │
│           │                                                              │
│  ③ ブラウザがAPIリクエスト時にトークンを添付                               │
│           │                                                              │
│           ▼                                                              │
│     ┌─────────────────────────────────────────────────────────────┐     │
│     │  Authorization: Bearer eyJhbGciOiJSUzI1NiIs...              │     │
│     └─────────────────────────────────────────────────────────────┘     │
│           │                                                              │
│  ④ Cloudflare Workerがトークンを検証                                     │
│           ▼                                                              │
│     ┌──────────────────┐      ┌───────────────────────────────────┐     │
│     │ Cloudflare Worker │ ◀─── │ Google公開鍵                       │     │
│     └──────────────────┘      │ (googleapis.com から取得)          │     │
│                                └───────────────────────────────────┘     │
│                                                                           │
└─────────────────────────────────────────────────────────────────────────┘
</code></pre><h4 id="32-フロントエンド側の実装">3.2 フロントエンド側の実装 </h4>
<p><strong><code>src/contexts/AdminAuthContext.tsx</code></strong> で認証状態を管理しています：</p>
<pre data-role="codeBlock" data-info="typescript" class="language-typescript typescript"><code><span class="token comment">// Googleログイン処理</span>
<span class="token keyword keyword-const">const</span> <span class="token function-variable function">loginWithGoogle</span> <span class="token operator">=</span> <span class="token keyword keyword-async">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword keyword-const">const</span> provider <span class="token operator">=</span> <span class="token keyword keyword-new">new</span> <span class="token class-name">GoogleAuthProvider</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token keyword keyword-const">const</span> result <span class="token operator">=</span> <span class="token keyword keyword-await">await</span> <span class="token function">signInWithPopup</span><span class="token punctuation">(</span>auth<span class="token punctuation">,</span> provider<span class="token punctuation">)</span>

  <span class="token comment">// FirebaseからIDトークンを取得</span>
  <span class="token keyword keyword-const">const</span> token <span class="token operator">=</span> <span class="token keyword keyword-await">await</span> result<span class="token punctuation">.</span>user<span class="token punctuation">.</span><span class="token function">getIdToken</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token function">setIdToken</span><span class="token punctuation">(</span>token<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><p><strong>APIリクエスト時のトークン送信：</strong></p>
<pre data-role="codeBlock" data-info="typescript" class="language-typescript typescript"><code><span class="token comment">// 管理者APIを呼び出す例</span>
<span class="token keyword keyword-const">const</span> response <span class="token operator">=</span> <span class="token keyword keyword-await">await</span> <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">'/api/cms/posts/drafts'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  headers<span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token string-property property">'Authorization'</span><span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Bearer </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>idToken<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span>  <span class="token comment">// ここでトークンを送る</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><p><code>Bearer</code> は「持参人」という意味で、「このトークンを持っている人を認証してください」という意味になります。</p>
<hr>
<h3 id="4-サーバー側のトークン検証詳細解説">4. サーバー側のトークン検証（詳細解説） </h3>
<p><code>src/pv-worker.ts</code> で実装している検証処理を詳しく見ていきます。</p>
<h4 id="41-検証の全体像">4.1 検証の全体像 </h4>
<pre data-role="codeBlock" data-info="typescript" class="language-typescript typescript"><code><span class="token keyword keyword-async">async</span> <span class="token keyword keyword-function">function</span> <span class="token function">verifyFirebaseToken</span><span class="token punctuation">(</span>token<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span> env<span class="token operator">:</span> Env<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Promise</span><span class="token operator">&lt;</span>FirebaseTokenPayload <span class="token operator">|</span> <span class="token keyword keyword-null">null</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// 1. トークンを3つの部分に分割</span>
  <span class="token keyword keyword-const">const</span> parts <span class="token operator">=</span> token<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">'.'</span><span class="token punctuation">)</span>
  <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>parts<span class="token punctuation">.</span>length <span class="token operator">!==</span> <span class="token number">3</span><span class="token punctuation">)</span> <span class="token keyword keyword-return">return</span> <span class="token keyword keyword-null">null</span>  <span class="token comment">// JWTは必ず3部構成</span>

  <span class="token comment">// 2. ヘッダーの検証</span>
  <span class="token comment">// 3. ペイロードの検証（各クレーム）</span>
  <span class="token comment">// 4. 署名の検証</span>

  <span class="token keyword keyword-return">return</span> payload  <span class="token comment">// 全て通過したら成功</span>
<span class="token punctuation">}</span>
</code></pre><h4 id="42-各検証項目の詳細">4.2 各検証項目の詳細 </h4>
<p><strong>① アルゴリズムの検証（alg）</strong></p>
<pre data-role="codeBlock" data-info="typescript" class="language-typescript typescript"><code><span class="token keyword keyword-const">const</span> header <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span><span class="token function">base64UrlDecode</span><span class="token punctuation">(</span>parts<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment">// RS256以外は拒否（ダウングレード攻撃防止）</span>
<span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>header<span class="token punctuation">.</span>alg <span class="token operator">!==</span> <span class="token string">'RS256'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Invalid algorithm:'</span><span class="token punctuation">,</span> header<span class="token punctuation">.</span>alg<span class="token punctuation">)</span>
  <span class="token keyword keyword-return">return</span> <span class="token keyword keyword-null">null</span>
<span class="token punctuation">}</span>
</code></pre><p>なぜこれが必要？<br>
→ 攻撃者が <code>alg: "none"</code> を指定して「署名なしでOK」と偽装する攻撃を防ぐため。</p>
<p><strong>② 有効期限の検証（exp）</strong></p>
<pre data-role="codeBlock" data-info="typescript" class="language-typescript typescript"><code><span class="token keyword keyword-const">const</span> now <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">floor</span><span class="token punctuation">(</span>Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">1000</span><span class="token punctuation">)</span>  <span class="token comment">// 現在時刻（UNIX時間）</span>

<span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>payload<span class="token punctuation">.</span>exp <span class="token operator">||</span> payload<span class="token punctuation">.</span>exp <span class="token operator">&lt;</span> now<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Token expired'</span><span class="token punctuation">)</span>
  <span class="token keyword keyword-return">return</span> <span class="token keyword keyword-null">null</span>
<span class="token punctuation">}</span>
</code></pre><p><code>exp</code>（expiration）は「このトークンはいつまで有効か」を示します。期限切れトークンは無効です。</p>
<p><strong>③ 発行時刻の検証（iat）</strong></p>
<pre data-role="codeBlock" data-info="typescript" class="language-typescript typescript"><code><span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>payload<span class="token punctuation">.</span>iat <span class="token operator">||</span> payload<span class="token punctuation">.</span>iat <span class="token operator">&gt;</span> now<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Invalid iat:'</span><span class="token punctuation">,</span> payload<span class="token punctuation">.</span>iat<span class="token punctuation">)</span>
  <span class="token keyword keyword-return">return</span> <span class="token keyword keyword-null">null</span>
<span class="token punctuation">}</span>
</code></pre><p><code>iat</code>（issued at）は「トークンがいつ発行されたか」。未来の時刻で発行されたトークンは不正です。</p>
<p><strong>④ 認証時刻の検証（auth_time）</strong></p>
<pre data-role="codeBlock" data-info="typescript" class="language-typescript typescript"><code><span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>payload<span class="token punctuation">.</span>auth_time <span class="token operator">||</span> payload<span class="token punctuation">.</span>auth_time <span class="token operator">&gt;</span> now<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Invalid auth_time:'</span><span class="token punctuation">,</span> payload<span class="token punctuation">.</span>auth_time<span class="token punctuation">)</span>
  <span class="token keyword keyword-return">return</span> <span class="token keyword keyword-null">null</span>
<span class="token punctuation">}</span>
</code></pre><p>ユーザーが実際にログインした時刻も過去である必要があります。</p>
<p><strong>⑤ 発行者の検証（iss）</strong></p>
<pre data-role="codeBlock" data-info="typescript" class="language-typescript typescript"><code><span class="token keyword keyword-const">const</span> expectedIssuer <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">https://securetoken.google.com/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>env<span class="token punctuation">.</span><span class="token constant">FIREBASE_PROJECT_ID</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span>
<span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>payload<span class="token punctuation">.</span>iss <span class="token operator">!==</span> expectedIssuer<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Invalid issuer:'</span><span class="token punctuation">,</span> payload<span class="token punctuation">.</span>iss<span class="token punctuation">)</span>
  <span class="token keyword keyword-return">return</span> <span class="token keyword keyword-null">null</span>
<span class="token punctuation">}</span>
</code></pre><p><code>iss</code>（issuer）は「誰がこのトークンを発行したか」。Firebase以外が発行したトークンは拒否します。</p>
<p><strong>⑥ 対象者の検証（aud）</strong></p>
<pre data-role="codeBlock" data-info="typescript" class="language-typescript typescript"><code><span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>payload<span class="token punctuation">.</span>aud <span class="token operator">!==</span> env<span class="token punctuation">.</span><span class="token constant">FIREBASE_PROJECT_ID</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Invalid audience:'</span><span class="token punctuation">,</span> payload<span class="token punctuation">.</span>aud<span class="token punctuation">)</span>
  <span class="token keyword keyword-return">return</span> <span class="token keyword keyword-null">null</span>
<span class="token punctuation">}</span>
</code></pre><p><code>aud</code>（audience）は「このトークンは誰向けか」。自分のプロジェクト向けでないトークンは拒否します。</p>
<p><strong>⑦ ユーザーIDの検証（sub）</strong></p>
<pre data-role="codeBlock" data-info="typescript" class="language-typescript typescript"><code><span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>payload<span class="token punctuation">.</span>sub <span class="token operator">||</span> <span class="token keyword keyword-typeof">typeof</span> payload<span class="token punctuation">.</span>sub <span class="token operator">!==</span> <span class="token string">'string'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Invalid sub'</span><span class="token punctuation">)</span>
  <span class="token keyword keyword-return">return</span> <span class="token keyword keyword-null">null</span>
<span class="token punctuation">}</span>
</code></pre><p><code>sub</code>（subject）はユーザーの一意識別子。必ず存在する必要があります。</p>
<p><strong>⑧ メール確認済みの検証（email_verified）</strong></p>
<pre data-role="codeBlock" data-info="typescript" class="language-typescript typescript"><code><span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>payload<span class="token punctuation">.</span>email_verified<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Email not verified'</span><span class="token punctuation">)</span>
  <span class="token keyword keyword-return">return</span> <span class="token keyword keyword-null">null</span>
<span class="token punctuation">}</span>
</code></pre><p>メールアドレスが確認されていないユーザーは管理者として認めません。</p>
<hr>
<h3 id="5-rs256署名検証の仕組み">5. RS256署名検証の仕組み </h3>
<h4 id="51-公開鍵暗号方式とは">5.1 公開鍵暗号方式とは </h4>
<pre data-role="codeBlock" data-info="" class="language-text"><code>┌─────────────────────────────────────────────────────────────────────────┐
│                    公開鍵暗号方式の仕組み                                  │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                           │
│   【署名の作成】Firebase側（秘密鍵を持っている）                           │
│                                                                           │
│   ┌────────────────┐    ┌─────────┐    ┌──────────────┐                 │
│   │ ヘッダー.ペイロード │ ─▶ │ RSA暗号 │ ─▶ │    署名      │                 │
│   └────────────────┘    └─────────┘    └──────────────┘                 │
│                              ▲                                            │
│                              │                                            │
│                         ┌─────────┐                                      │
│                         │ 秘密鍵  │ ← Firebaseだけが持っている             │
│                         └─────────┘                                      │
│                                                                           │
│   【署名の検証】Worker側（公開鍵で検証）                                    │
│                                                                           │
│   ┌────────────────┐    ┌─────────┐    ┌──────────────┐                 │
│   │ ヘッダー.ペイロード │ ─▶ │ RSA検証 │ ◀─ │    署名      │                 │
│   └────────────────┘    └─────────┘    └──────────────┘                 │
│                              ▲              結果: ✓ 一致 / ✗ 不一致       │
│                              │                                            │
│                         ┌─────────┐                                      │
│                         │ 公開鍵  │ ← Googleから誰でも取得可能             │
│                         └─────────┘                                      │
│                                                                           │
└─────────────────────────────────────────────────────────────────────────┘
</code></pre><h4 id="52-google公開鍵の取得">5.2 Google公開鍵の取得 </h4>
<pre data-role="codeBlock" data-info="typescript" class="language-typescript typescript"><code><span class="token keyword keyword-const">const</span> <span class="token constant">GOOGLE_CERTS_URL</span> <span class="token operator">=</span> <span class="token string">'https://www.googleapis.com/robot/v1/metadata/x509/securetoken@system.gserviceaccount.com'</span>

<span class="token keyword keyword-async">async</span> <span class="token keyword keyword-function">function</span> <span class="token function">getGooglePublicKeys</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Promise</span><span class="token operator">&lt;</span>Record<span class="token operator">&lt;</span><span class="token builtin">string</span><span class="token punctuation">,</span> CryptoKey<span class="token operator">&gt;&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// キャッシュが有効ならそれを使う</span>
  <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>publicKeyCache <span class="token operator">&amp;&amp;</span> publicKeyCache<span class="token punctuation">.</span>expiresAt <span class="token operator">&gt;</span> Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword keyword-return">return</span> publicKeyCache<span class="token punctuation">.</span>keys
  <span class="token punctuation">}</span>

  <span class="token comment">// Googleから証明書を取得</span>
  <span class="token keyword keyword-const">const</span> response <span class="token operator">=</span> <span class="token keyword keyword-await">await</span> <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token constant">GOOGLE_CERTS_URL</span><span class="token punctuation">)</span>
  <span class="token keyword keyword-const">const</span> certs <span class="token operator">=</span> <span class="token keyword keyword-await">await</span> response<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

  <span class="token comment">// Cache-Controlヘッダーからキャッシュ期間を取得</span>
  <span class="token keyword keyword-const">const</span> cacheControl <span class="token operator">=</span> response<span class="token punctuation">.</span>headers<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'Cache-Control'</span><span class="token punctuation">)</span>
  <span class="token keyword keyword-const">const</span> maxAge <span class="token operator">=</span> <span class="token comment">/* max-ageの値を抽出 */</span>

  <span class="token comment">// 証明書をCryptoKeyオブジェクトに変換</span>
  <span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span><span class="token keyword keyword-const">const</span> <span class="token punctuation">[</span>kid<span class="token punctuation">,</span> pem<span class="token punctuation">]</span> <span class="token keyword keyword-of">of</span> Object<span class="token punctuation">.</span><span class="token function">entries</span><span class="token punctuation">(</span>certs<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    keys<span class="token punctuation">[</span>kid<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword keyword-await">await</span> <span class="token function">importPublicKeyFromCert</span><span class="token punctuation">(</span>pem<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// キャッシュを更新</span>
  publicKeyCache <span class="token operator">=</span> <span class="token punctuation">{</span> keys<span class="token punctuation">,</span> expiresAt<span class="token operator">:</span> Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> maxAge <span class="token operator">*</span> <span class="token number">1000</span> <span class="token punctuation">}</span>

  <span class="token keyword keyword-return">return</span> keys
<span class="token punctuation">}</span>
</code></pre><p><strong>なぜキャッシュが必要？</strong></p>
<ul>
<li>毎回Googleにアクセスするとレスポンスが遅くなる</li>
<li>Googleの公開鍵は頻繁には変わらない（数時間〜数日）</li>
<li><code>Cache-Control</code>ヘッダーの<code>max-age</code>に従ってキャッシュ</li>
</ul>
<h4 id="53-署名検証の実装">5.3 署名検証の実装 </h4>
<pre data-role="codeBlock" data-info="typescript" class="language-typescript typescript"><code><span class="token comment">// 署名検証（RS256）</span>
<span class="token keyword keyword-const">const</span> publicKeys <span class="token operator">=</span> <span class="token keyword keyword-await">await</span> <span class="token function">getGooglePublicKeys</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword keyword-const">const</span> publicKey <span class="token operator">=</span> publicKeys<span class="token punctuation">[</span>header<span class="token punctuation">.</span>kid<span class="token punctuation">]</span>  <span class="token comment">// kidで公開鍵を特定</span>

<span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>publicKey<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Public key not found for kid:'</span><span class="token punctuation">,</span> header<span class="token punctuation">.</span>kid<span class="token punctuation">)</span>
  <span class="token keyword keyword-return">return</span> <span class="token keyword keyword-null">null</span>
<span class="token punctuation">}</span>

<span class="token comment">// 署名対象データ: ヘッダー.ペイロード</span>
<span class="token keyword keyword-const">const</span> signedData <span class="token operator">=</span> <span class="token keyword keyword-new">new</span> <span class="token class-name">TextEncoder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">encode</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>parts<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">.</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>parts<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>

<span class="token comment">// 署名をBase64URLからバイナリに変換</span>
<span class="token keyword keyword-const">const</span> signature <span class="token operator">=</span> <span class="token function">base64UrlToArrayBuffer</span><span class="token punctuation">(</span>parts<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

<span class="token comment">// WebCrypto APIで検証</span>
<span class="token keyword keyword-const">const</span> isValid <span class="token operator">=</span> <span class="token keyword keyword-await">await</span> crypto<span class="token punctuation">.</span>subtle<span class="token punctuation">.</span><span class="token function">verify</span><span class="token punctuation">(</span>
  <span class="token punctuation">{</span> name<span class="token operator">:</span> <span class="token string">'RSASSA-PKCS1-v1_5'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  publicKey<span class="token punctuation">,</span>
  signature<span class="token punctuation">,</span>
  signedData
<span class="token punctuation">)</span>

<span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>isValid<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Invalid signature'</span><span class="token punctuation">)</span>
  <span class="token keyword keyword-return">return</span> <span class="token keyword keyword-null">null</span>
<span class="token punctuation">}</span>
</code></pre><p><strong>WebCrypto API</strong> はブラウザやCloudflare Workersで使える標準的な暗号化API。外部ライブラリ不要で署名検証ができます。</p>
<hr>
<h3 id="6-x509証明書の解析">6. X.509証明書の解析 </h3>
<p>Googleから取得する公開鍵はPEM形式のX.509証明書として提供されます。</p>
<h4 id="61-証明書の形式">6.1 証明書の形式 </h4>
<pre data-role="codeBlock" data-info="" class="language-text"><code>-----BEGIN CERTIFICATE-----
MIIDJjCCAg6gAwIBAgIIYS...（Base64エンコードされたバイナリ）
-----END CERTIFICATE-----
</code></pre><h4 id="62-証明書からの公開鍵抽出">6.2 証明書からの公開鍵抽出 </h4>
<pre data-role="codeBlock" data-info="typescript" class="language-typescript typescript"><code><span class="token keyword keyword-async">async</span> <span class="token keyword keyword-function">function</span> <span class="token function">importPublicKeyFromCert</span><span class="token punctuation">(</span>pem<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Promise</span><span class="token operator">&lt;</span>CryptoKey<span class="token operator">&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// 1. PEMヘッダー/フッターを削除</span>
  <span class="token keyword keyword-const">const</span> pemContents <span class="token operator">=</span> pem
    <span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">-----BEGIN CERTIFICATE-----</span><span class="token regex-delimiter">/</span><span class="token regex-flags">g</span></span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">-----END CERTIFICATE-----</span><span class="token regex-delimiter">/</span><span class="token regex-flags">g</span></span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\s</span><span class="token regex-delimiter">/</span><span class="token regex-flags">g</span></span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span>

  <span class="token comment">// 2. Base64デコードしてバイナリに変換</span>
  <span class="token keyword keyword-const">const</span> binaryDer <span class="token operator">=</span> <span class="token function">atob</span><span class="token punctuation">(</span>pemContents<span class="token punctuation">)</span>
  <span class="token keyword keyword-const">const</span> bytes <span class="token operator">=</span> <span class="token keyword keyword-new">new</span> <span class="token class-name">Uint8Array</span><span class="token punctuation">(</span>binaryDer<span class="token punctuation">.</span>length<span class="token punctuation">)</span>
  <span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span><span class="token keyword keyword-let">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> binaryDer<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    bytes<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> binaryDer<span class="token punctuation">.</span><span class="token function">charCodeAt</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// 3. ASN.1 DER形式の証明書から公開鍵部分（SPKI）を抽出</span>
  <span class="token keyword keyword-const">const</span> spki <span class="token operator">=</span> <span class="token function">extractSpkiFromCertificate</span><span class="token punctuation">(</span>bytes<span class="token punctuation">)</span>

  <span class="token comment">// 4. WebCrypto APIでCryptoKeyオブジェクトに変換</span>
  <span class="token keyword keyword-return">return</span> <span class="token keyword keyword-await">await</span> crypto<span class="token punctuation">.</span>subtle<span class="token punctuation">.</span><span class="token function">importKey</span><span class="token punctuation">(</span>
    <span class="token string">'spki'</span><span class="token punctuation">,</span>                                    <span class="token comment">// 形式</span>
    spki<span class="token punctuation">,</span>                                      <span class="token comment">// 公開鍵データ</span>
    <span class="token punctuation">{</span> name<span class="token operator">:</span> <span class="token string">'RSASSA-PKCS1-v1_5'</span><span class="token punctuation">,</span> hash<span class="token operator">:</span> <span class="token string">'SHA-256'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>  <span class="token comment">// アルゴリズム</span>
    <span class="token boolean">false</span><span class="token punctuation">,</span>                                     <span class="token comment">// エクスポート不可</span>
    <span class="token punctuation">[</span><span class="token string">'verify'</span><span class="token punctuation">]</span>                                 <span class="token comment">// 検証用途</span>
  <span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><h4 id="63-asn1とは">6.3 ASN.1とは </h4>
<p>ASN.1（Abstract Syntax Notation One）は、データ構造を定義するための標準規格です。X.509証明書はASN.1のDER（Distinguished Encoding Rules）形式でエンコードされています。</p>
<pre data-role="codeBlock" data-info="" class="language-text"><code>証明書の構造（簡略化）:
SEQUENCE {
  tbsCertificate: SEQUENCE {
    version [0]: INTEGER
    serialNumber: INTEGER
    signature: AlgorithmIdentifier
    issuer: Name
    validity: Validity
    subject: Name
    subjectPublicKeyInfo: SEQUENCE {  ← これを抽出
      algorithm: AlgorithmIdentifier
      subjectPublicKey: BIT STRING
    }
  }
  signatureAlgorithm: AlgorithmIdentifier
  signatureValue: BIT STRING
}
</code></pre><hr>
<h3 id="7-管理者認可の仕組み">7. 管理者認可の仕組み </h3>
<p>トークンが有効でも、そのユーザーが「管理者かどうか」の確認が別途必要です。</p>
<pre data-role="codeBlock" data-info="typescript" class="language-typescript typescript"><code><span class="token keyword keyword-async">async</span> <span class="token keyword keyword-function">function</span> <span class="token function">checkAdminAuth</span><span class="token punctuation">(</span>req<span class="token operator">:</span> Request<span class="token punctuation">,</span> env<span class="token operator">:</span> Env<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Promise</span><span class="token operator">&lt;</span><span class="token builtin">boolean</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword keyword-const">const</span> authHeader <span class="token operator">=</span> req<span class="token punctuation">.</span>headers<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'Authorization'</span><span class="token punctuation">)</span>

  <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>authHeader<span class="token operator">?.</span><span class="token function">startsWith</span><span class="token punctuation">(</span><span class="token string">'Bearer '</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword keyword-const">const</span> token <span class="token operator">=</span> authHeader<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">)</span>  <span class="token comment">// "Bearer "を除去</span>
    <span class="token keyword keyword-const">const</span> payload <span class="token operator">=</span> <span class="token keyword keyword-await">await</span> <span class="token function">verifyFirebaseToken</span><span class="token punctuation">(</span>token<span class="token punctuation">,</span> env<span class="token punctuation">)</span>

    <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>payload<span class="token operator">?.</span>email<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// 環境変数で設定した管理者メールリストと照合</span>
      <span class="token keyword keyword-const">const</span> adminEmails <span class="token operator">=</span> <span class="token punctuation">(</span>env<span class="token punctuation">.</span><span class="token constant">ADMIN_EMAILS</span> <span class="token operator">||</span> <span class="token string">''</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">','</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>e <span class="token operator">=&gt;</span> e<span class="token punctuation">.</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toLowerCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

      <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>adminEmails<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span>payload<span class="token punctuation">.</span>email<span class="token punctuation">.</span><span class="token function">toLowerCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword keyword-return">return</span> <span class="token boolean">true</span>  <span class="token comment">// 管理者として認証成功</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token keyword keyword-return">return</span> <span class="token boolean">false</span>  <span class="token comment">// 管理者ではない</span>
<span class="token punctuation">}</span>
</code></pre><p><strong>環境変数の設定例（Cloudflare Dashboard）:</strong></p>
<pre data-role="codeBlock" data-info="" class="language-text"><code>ADMIN_EMAILS = "admin1@example.com,admin2@example.com"
FIREBASE_PROJECT_ID = "my-firebase-project"
</code></pre><hr>
<h3 id="8-セキュリティのベストプラクティス">8. セキュリティのベストプラクティス </h3>
<h4 id="81-実装されている対策一覧">8.1 実装されている対策一覧 </h4>
<table>
<thead>
<tr>
<th>対策</th>
<th>目的</th>
<th>実装箇所</th>
</tr>
</thead>
<tbody>
<tr>
<td>RS256署名検証</td>
<td>トークン偽造防止</td>
<td><code>verifyFirebaseToken()</code></td>
</tr>
<tr>
<td>アルゴリズム固定（RS256）</td>
<td>ダウングレード攻撃防止</td>
<td>ヘッダー検証</td>
</tr>
<tr>
<td>有効期限チェック（exp）</td>
<td>期限切れトークン拒否</td>
<td>ペイロード検証</td>
</tr>
<tr>
<td>発行者検証（iss）</td>
<td>不正発行元トークン拒否</td>
<td>ペイロード検証</td>
</tr>
<tr>
<td>対象者検証（aud）</td>
<td>他プロジェクト向けトークン拒否</td>
<td>ペイロード検証</td>
</tr>
<tr>
<td>公開鍵キャッシュ</td>
<td>パフォーマンス最適化</td>
<td><code>getGooglePublicKeys()</code></td>
</tr>
<tr>
<td>CORS設定</td>
<td>クロスサイトリクエスト制御</td>
<td><code>corsHeaders</code></td>
</tr>
<tr>
<td>管理者メールリスト</td>
<td>認可制御</td>
<td><code>checkAdminAuth()</code></td>
</tr>
</tbody>
</table>
<h4 id="82-やってはいけないこと">8.2 やってはいけないこと </h4>
<pre data-role="codeBlock" data-info="typescript" class="language-typescript typescript"><code><span class="token comment">// ❌ 署名を検証せずにペイロードを信用する</span>
<span class="token keyword keyword-const">const</span> payload <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span><span class="token function">atob</span><span class="token punctuation">(</span>token<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">'.'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>payload<span class="token punctuation">.</span>email <span class="token operator">===</span> <span class="token string">'admin@example.com'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 危険！誰でもこのペイロードを作れる</span>
<span class="token punctuation">}</span>

<span class="token comment">// ❌ アルゴリズムを動的に決める</span>
<span class="token keyword keyword-const">const</span> alg <span class="token operator">=</span> header<span class="token punctuation">.</span>alg  <span class="token comment">// 攻撃者が "none" を指定できてしまう</span>

<span class="token comment">// ❌ 有効期限をチェックしない</span>
<span class="token comment">// 一度発行されたトークンが永久に有効になってしまう</span>
</code></pre><h4 id="83-本番環境でのチェックリスト">8.3 本番環境でのチェックリスト </h4>
<ul>
<li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox"> <code>FIREBASE_PROJECT_ID</code> が正しく設定されているか</li>
<li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox"> <code>ADMIN_EMAILS</code> に管理者のメールのみが含まれているか</li>
<li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox"> HTTPS経由でのみAPIにアクセスできるか</li>
<li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox"> 本番環境の秘密情報がログに出力されていないか</li>
<li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox"> 公開鍵のキャッシュが正しく動作しているか</li>
</ul>
<hr>
<h3 id="9-トラブルシューティング">9. トラブルシューティング </h3>
<h4 id="91-よくあるエラーと対処法">9.1 よくあるエラーと対処法 </h4>
<table>
<thead>
<tr>
<th>エラーメッセージ</th>
<th>原因</th>
<th>対処法</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>Token expired</code></td>
<td>トークンの有効期限切れ</td>
<td>フロントエンドで<code>getIdToken(true)</code>を呼んで再取得</td>
</tr>
<tr>
<td><code>Invalid issuer</code></td>
<td><code>FIREBASE_PROJECT_ID</code>の設定ミス</td>
<td>環境変数を確認</td>
</tr>
<tr>
<td><code>Invalid audience</code></td>
<td>別プロジェクトのトークン</td>
<td>FirebaseプロジェクトIDを確認</td>
</tr>
<tr>
<td><code>Public key not found</code></td>
<td>Google公開鍵の取得失敗</td>
<td>ネットワーク接続を確認、キャッシュをクリア</td>
</tr>
<tr>
<td><code>Invalid signature</code></td>
<td>トークンが改ざんされている</td>
<td>正規のログインフローを使用しているか確認</td>
</tr>
</tbody>
</table>
<h4 id="92-デバッグ方法">9.2 デバッグ方法 </h4>
<pre data-role="codeBlock" data-info="typescript" class="language-typescript typescript"><code><span class="token comment">// トークンの中身を確認（開発時のみ）</span>
<span class="token keyword keyword-const">const</span> parts <span class="token operator">=</span> token<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">'.'</span><span class="token punctuation">)</span>
<span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Header:'</span><span class="token punctuation">,</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span><span class="token function">atob</span><span class="token punctuation">(</span>parts<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Payload:'</span><span class="token punctuation">,</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span><span class="token function">atob</span><span class="token punctuation">(</span>parts<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre><p><strong>注意:</strong> 本番環境ではトークンをログに出力しないでください。</p>
<hr>
<h3 id="10-参考リンク">10. 参考リンク </h3>
<ul>
<li><a href="https://firebase.google.com/docs/auth/admin/verify-id-tokens">Firebase公式: IDトークンの検証</a></li>
<li><a href="https://jwt.io/">JWT.io: JWTのデバッグツール</a></li>
<li><a href="https://developer.mozilla.org/ja/docs/Web/API/Web_Crypto_API">MDN: Web Crypto API</a></li>
<li><a href="https://datatracker.ietf.org/doc/html/rfc7519">RFC 7519: JSON Web Token (JWT)</a></li>
</ul>
<hr>
<h2 id="pv-workerts-詳細解説">pv-worker.ts 詳細解説 </h2>
<p><code>src/pv-worker.ts</code> はCloudflare Workerとして動作するバックエンドAPIです。PVカウンター、いいねボタン、BBS、CMSの4つの機能を1つのWorkerで提供しています。</p>
<h3 id="1-概要とアーキテクチャ">1. 概要とアーキテクチャ </h3>
<pre data-role="codeBlock" data-info="" class="language-text"><code>┌─────────────────────────────────────────────────────────────────┐
│                    Cloudflare Worker                             │
│                      (pv-worker.ts)                              │
├─────────────────────────────────────────────────────────────────┤
│  /api/pv     → PVカウンター（アクセス数カウント）                  │
│  /api/good   → Goodボタン（いいね機能）                          │
│  /api/bbs/*  → BBS（掲示板機能）                                 │
│  /api/cms/*  → CMS（記事・プロダクト管理）                        │
├─────────────────────────────────────────────────────────────────┤
│                          Bindings                                │
│  ├── HAROIN_PV (KV Namespace) - データストレージ                  │
│  ├── CMS_IMAGES (R2 Bucket) - 画像ストレージ                     │
│  └── 環境変数: ADMIN_SECRET, FIREBASE_PROJECT_ID, ADMIN_EMAILS   │
└─────────────────────────────────────────────────────────────────┘
</code></pre><h3 id="2-型定義">2. 型定義 </h3>
<h4 id="21-環境変数の型">2.1 環境変数の型 </h4>
<pre data-role="codeBlock" data-info="typescript" class="language-typescript typescript"><code><span class="token keyword keyword-type">type</span> <span class="token class-name">Env</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token constant">HAROIN_PV</span><span class="token operator">:</span> KVNamespace           <span class="token comment">// Cloudflare KV（データ保存）</span>
  <span class="token constant">CMS_IMAGES</span><span class="token operator">?</span><span class="token operator">:</span> R2Bucket            <span class="token comment">// R2バケット（画像アップロード用）</span>
  <span class="token constant">ALLOWED_ORIGIN</span><span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">string</span>          <span class="token comment">// CORSで許可するオリジン</span>
  <span class="token constant">ADMIN_SECRET</span><span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">string</span>            <span class="token comment">// 管理者用シークレットキー</span>
  <span class="token constant">FIREBASE_PROJECT_ID</span><span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">string</span>     <span class="token comment">// Firebase プロジェクトID</span>
  <span class="token constant">ADMIN_EMAILS</span><span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">string</span>            <span class="token comment">// 管理者メールアドレス（カンマ区切り）</span>
  <span class="token constant">R2_PUBLIC_URL</span><span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">string</span>           <span class="token comment">// R2の公開URL</span>
<span class="token punctuation">}</span>
</code></pre><h4 id="22-bbsの型">2.2 BBSの型 </h4>
<pre data-role="codeBlock" data-info="typescript" class="language-typescript typescript"><code><span class="token keyword keyword-type">type</span> <span class="token class-name">Thread</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
  id<span class="token operator">:</span> <span class="token builtin">string</span>           <span class="token comment">// スレッドID（例: "m1abc2def"）</span>
  title<span class="token operator">:</span> <span class="token builtin">string</span>        <span class="token comment">// スレッドタイトル</span>
  createdAt<span class="token operator">:</span> <span class="token builtin">string</span>    <span class="token comment">// 作成日時（ISO 8601形式）</span>
  createdBy<span class="token operator">:</span> <span class="token builtin">string</span>    <span class="token comment">// 作成者名</span>
  postCount<span class="token operator">:</span> <span class="token builtin">number</span>    <span class="token comment">// 投稿数</span>
  lastPostAt<span class="token operator">:</span> <span class="token builtin">string</span>   <span class="token comment">// 最終投稿日時</span>
<span class="token punctuation">}</span>

<span class="token keyword keyword-type">type</span> <span class="token class-name">Post</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
  id<span class="token operator">:</span> <span class="token builtin">number</span>           <span class="token comment">// 投稿番号（1から連番）</span>
  name<span class="token operator">:</span> <span class="token builtin">string</span>         <span class="token comment">// 投稿者名</span>
  date<span class="token operator">:</span> <span class="token builtin">string</span>         <span class="token comment">// 投稿日時（2ch形式: "2025/01/15(水) 12:34:56.78"）</span>
  userId<span class="token operator">:</span> <span class="token builtin">string</span>       <span class="token comment">// ユーザーID（IPベースで生成、9文字）</span>
  content<span class="token operator">:</span> <span class="token builtin">string</span>      <span class="token comment">// 投稿内容</span>
<span class="token punctuation">}</span>
</code></pre><h4 id="23-cmsの型">2.3 CMSの型 </h4>
<pre data-role="codeBlock" data-info="typescript" class="language-typescript typescript"><code><span class="token keyword keyword-type">type</span> <span class="token class-name">CMSPostMeta</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
  slug<span class="token operator">:</span> <span class="token builtin">string</span>                    <span class="token comment">// URL識別子</span>
  title<span class="token operator">:</span> <span class="token builtin">string</span>                   <span class="token comment">// タイトル</span>
  summary<span class="token operator">:</span> <span class="token builtin">string</span>                 <span class="token comment">// 概要</span>
  createdAt<span class="token operator">:</span> <span class="token builtin">string</span>               <span class="token comment">// 作成日時</span>
  updatedAt<span class="token operator">:</span> <span class="token builtin">string</span>               <span class="token comment">// 更新日時</span>
  tags<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">[</span><span class="token punctuation">]</span>                  <span class="token comment">// タグ配列</span>
  status<span class="token operator">:</span> <span class="token string">'draft'</span> <span class="token operator">|</span> <span class="token string">'published'</span>   <span class="token comment">// 公開状態</span>
<span class="token punctuation">}</span>

<span class="token keyword keyword-type">type</span> <span class="token class-name">CMSPost</span> <span class="token operator">=</span> CMSPostMeta <span class="token operator">&amp;</span> <span class="token punctuation">{</span>
  markdown<span class="token operator">:</span> <span class="token builtin">string</span>    <span class="token comment">// Markdownソース</span>
  html<span class="token operator">:</span> <span class="token builtin">string</span>        <span class="token comment">// レンダリング済みHTML</span>
<span class="token punctuation">}</span>

<span class="token keyword keyword-type">type</span> <span class="token class-name">CMSProductMeta</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
  slug<span class="token operator">:</span> <span class="token builtin">string</span>          <span class="token comment">// URL識別子</span>
  name<span class="token operator">:</span> <span class="token builtin">string</span>          <span class="token comment">// プロダクト名</span>
  description<span class="token operator">:</span> <span class="token builtin">string</span>   <span class="token comment">// 説明</span>
  language<span class="token operator">:</span> <span class="token builtin">string</span>      <span class="token comment">// 使用言語</span>
  tags<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">[</span><span class="token punctuation">]</span>        <span class="token comment">// タグ配列</span>
  url<span class="token operator">:</span> <span class="token builtin">string</span>           <span class="token comment">// GitHubリポジトリURL</span>
  demo<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">string</span>         <span class="token comment">// デモURL（オプション）</span>
  createdAt<span class="token operator">:</span> <span class="token builtin">string</span>
  updatedAt<span class="token operator">:</span> <span class="token builtin">string</span>
<span class="token punctuation">}</span>
</code></pre><h3 id="3-ユーティリティ関数">3. ユーティリティ関数 </h3>
<h4 id="31-cors処理">3.1 CORS処理 </h4>
<pre data-role="codeBlock" data-info="typescript" class="language-typescript typescript"><code><span class="token keyword keyword-function">function</span> <span class="token function">buildCorsHeaders</span><span class="token punctuation">(</span>origin<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword keyword-return">return</span> <span class="token punctuation">{</span>
    <span class="token string-property property">'access-control-allow-origin'</span><span class="token operator">:</span> origin<span class="token punctuation">,</span>
    <span class="token string-property property">'access-control-allow-methods'</span><span class="token operator">:</span> <span class="token string">'GET, POST, PUT, PATCH, DELETE, OPTIONS'</span><span class="token punctuation">,</span>
    <span class="token string-property property">'access-control-allow-headers'</span><span class="token operator">:</span> <span class="token string">'Content-Type, X-Admin-Secret, Authorization'</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><p>すべてのレスポンスにCORSヘッダーを付与。<code>X-Admin-Secret</code>と<code>Authorization</code>ヘッダーを許可。</p>
<h4 id="32-ユーザーid生成">3.2 ユーザーID生成 </h4>
<pre data-role="codeBlock" data-info="typescript" class="language-typescript typescript"><code><span class="token keyword keyword-function">function</span> <span class="token function">generateUserId</span><span class="token punctuation">(</span>ip<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">string</span> <span class="token punctuation">{</span>
  <span class="token keyword keyword-const">const</span> hash <span class="token operator">=</span> <span class="token function">simpleHash</span><span class="token punctuation">(</span>ip<span class="token punctuation">)</span>
  <span class="token keyword keyword-return">return</span> hash<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">)</span>  <span class="token comment">// 9文字のID</span>
<span class="token punctuation">}</span>

<span class="token keyword keyword-function">function</span> <span class="token function">simpleHash</span><span class="token punctuation">(</span>str<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">string</span> <span class="token punctuation">{</span>
  <span class="token comment">// 簡易ハッシュ関数</span>
  <span class="token comment">// IPアドレスから決定論的なIDを生成</span>
<span class="token punctuation">}</span>
</code></pre><p>IPアドレスをハッシュ化して匿名のユーザーIDを生成。同じIPからは常に同じIDになる。</p>
<h4 id="33-日時フォーマット2ch形式">3.3 日時フォーマット（2ch形式） </h4>
<pre data-role="codeBlock" data-info="typescript" class="language-typescript typescript"><code><span class="token keyword keyword-function">function</span> <span class="token function">formatDate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">string</span> <span class="token punctuation">{</span>
  <span class="token comment">// UTC → JST（UTC+9）に変換</span>
  <span class="token comment">// 出力例: "2025/01/15(水) 12:34:56.78"</span>
<span class="token punctuation">}</span>
</code></pre><p>日本時間で2ch風の日時フォーマットを生成。</p>
<h3 id="4-pvカウンター-api">4. PVカウンター API </h3>
<h4 id="エンドポイント-post-apipv">エンドポイント: <code>POST /api/pv</code> </h4>
<pre data-role="codeBlock" data-info="typescript" class="language-typescript typescript"><code><span class="token keyword keyword-async">async</span> <span class="token keyword keyword-function">function</span> <span class="token function">handlePv</span><span class="token punctuation">(</span>req<span class="token operator">:</span> Request<span class="token punctuation">,</span> env<span class="token operator">:</span> Env<span class="token punctuation">,</span> corsHeaders<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Promise</span><span class="token operator">&lt;</span>Response<span class="token operator">&gt;</span>
</code></pre><p><strong>処理フロー:</strong></p>
<ol>
<li>IPアドレスからレート制限キーを生成</li>
<li>60秒以内に同一IPからのリクエストがあればカウントせず現在値を返却</li>
<li>レート制限に引っかからなければカウントを+1</li>
<li>新しい合計値を返却</li>
</ol>
<p><strong>KVキー:</strong></p>
<ul>
<li><code>rl:{ip}</code> - レート制限フラグ（TTL: 60秒）</li>
<li><code>total</code> - 合計PV数</li>
</ul>
<p><strong>レスポンス例:</strong></p>
<pre data-role="codeBlock" data-info="json" class="language-json json"><code><span class="token punctuation">{</span> <span class="token property">"total"</span><span class="token operator">:</span> <span class="token number">12345</span> <span class="token punctuation">}</span>
</code></pre><h3 id="5-goodボタン-api">5. Goodボタン API </h3>
<h4 id="エンドポイント-post-apigood">エンドポイント: <code>POST /api/good</code> </h4>
<pre data-role="codeBlock" data-info="typescript" class="language-typescript typescript"><code><span class="token keyword keyword-async">async</span> <span class="token keyword keyword-function">function</span> <span class="token function">handleGood</span><span class="token punctuation">(</span>req<span class="token operator">:</span> Request<span class="token punctuation">,</span> env<span class="token operator">:</span> Env<span class="token punctuation">,</span> corsHeaders<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Promise</span><span class="token operator">&lt;</span>Response<span class="token operator">&gt;</span>
</code></pre><p><strong>リクエストボディ:</strong></p>
<pre data-role="codeBlock" data-info="json" class="language-json json"><code><span class="token punctuation">{</span>
  <span class="token property">"slug"</span><span class="token operator">:</span> <span class="token string">"my-article"</span><span class="token punctuation">,</span>
  <span class="token property">"action"</span><span class="token operator">:</span> <span class="token string">"vote"</span> | <span class="token string">"unvote"</span> | <span class="token string">"get"</span>
<span class="token punctuation">}</span>
</code></pre><p><strong>処理フロー:</strong></p>
<ol>
<li><code>action: "get"</code> → 現在のいいね数と投票済みかを返却</li>
<li><code>action: "vote"</code> → いいね数+1、IP記録</li>
<li><code>action: "unvote"</code> → いいね数-1、IP記録削除</li>
</ol>
<p><strong>KVキー:</strong></p>
<ul>
<li><code>good:{slug}:count</code> - いいね総数</li>
<li><code>good:{slug}:ip:{ip}</code> - 投票済みフラグ</li>
</ul>
<p><strong>レスポンス例:</strong></p>
<pre data-role="codeBlock" data-info="json" class="language-json json"><code><span class="token punctuation">{</span> <span class="token property">"total"</span><span class="token operator">:</span> <span class="token number">42</span><span class="token punctuation">,</span> <span class="token property">"voted"</span><span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span>
</code></pre><h3 id="6-bbs-api">6. BBS API </h3>
<h4 id="61-スレッド一覧取得">6.1 スレッド一覧取得 </h4>
<pre data-role="codeBlock" data-info="" class="language-text"><code>GET /api/bbs/threads
</code></pre><p>最終投稿日時順にソートされたスレッド一覧を返却。</p>
<h4 id="62-スレッド作成">6.2 スレッド作成 </h4>
<pre data-role="codeBlock" data-info="" class="language-text"><code>POST /api/bbs/threads
Body: { "title": "スレタイ", "name": "名前", "content": "本文" }
</code></pre><p>レート制限: 同一IPから60秒に1回まで。最大100スレッドまで。</p>
<h4 id="63-スレッド取得">6.3 スレッド取得 </h4>
<pre data-role="codeBlock" data-info="" class="language-text"><code>GET /api/bbs/threads/:id
</code></pre><p>スレッドメタ情報と全投稿を返却。</p>
<h4 id="64-投稿追加">6.4 投稿追加 </h4>
<pre data-role="codeBlock" data-info="" class="language-text"><code>POST /api/bbs/threads/:id/posts
Body: { "name": "名前", "content": "本文" }
</code></pre><p>レート制限: 同一IPから60秒に1回まで。1スレッド最大1000投稿まで。</p>
<h4 id="65-スレッド削除管理者のみ">6.5 スレッド削除（管理者のみ） </h4>
<pre data-role="codeBlock" data-info="" class="language-text"><code>DELETE /api/bbs/threads/:id
Headers: Authorization: Bearer {Firebase IDトークン}
</code></pre><h4 id="66-投稿削除管理者のみ">6.6 投稿削除（管理者のみ） </h4>
<pre data-role="codeBlock" data-info="" class="language-text"><code>DELETE /api/bbs/threads/:id/posts/:postId
Headers: Authorization: Bearer {Firebase IDトークン}
</code></pre><p>投稿内容を「この投稿は削除されました」に置換。</p>
<h3 id="7-cms-api">7. CMS API </h3>
<h4 id="71-記事一覧">7.1 記事一覧 </h4>
<pre data-role="codeBlock" data-info="" class="language-text"><code>GET /api/cms/posts
</code></pre><p>公開済み（<code>status: "published"</code>）の記事のみ返却。作成日時降順。</p>
<h4 id="72-下書き一覧管理者のみ">7.2 下書き一覧（管理者のみ） </h4>
<pre data-role="codeBlock" data-info="" class="language-text"><code>GET /api/cms/posts/drafts
Headers: Authorization: Bearer {Firebase IDトークン}
</code></pre><h4 id="73-記事詳細">7.3 記事詳細 </h4>
<pre data-role="codeBlock" data-info="" class="language-text"><code>GET /api/cms/posts/:slug
</code></pre><p>下書き記事は管理者のみ閲覧可能。</p>
<h4 id="74-記事作成管理者のみ">7.4 記事作成（管理者のみ） </h4>
<pre data-role="codeBlock" data-info="" class="language-text"><code>POST /api/cms/posts
Headers: Authorization: Bearer {Firebase IDトークン}
Body: {
  "slug": "my-article",
  "title": "タイトル",
  "summary": "概要",
  "markdown": "# 本文...",
  "html": "&lt;h1&gt;本文...&lt;/h1&gt;",
  "tags": ["React", "TypeScript"],
  "status": "draft" | "published"
}
</code></pre><h4 id="75-記事更新管理者のみ">7.5 記事更新（管理者のみ） </h4>
<pre data-role="codeBlock" data-info="" class="language-text"><code>PUT /api/cms/posts/:slug
Headers: Authorization: Bearer {Firebase IDトークン}
</code></pre><h4 id="76-記事ステータス変更管理者のみ">7.6 記事ステータス変更（管理者のみ） </h4>
<pre data-role="codeBlock" data-info="" class="language-text"><code>PATCH /api/cms/posts/:slug/status
Headers: Authorization: Bearer {Firebase IDトークン}
Body: { "status": "draft" | "published" }
</code></pre><h4 id="77-記事削除管理者のみ">7.7 記事削除（管理者のみ） </h4>
<pre data-role="codeBlock" data-info="" class="language-text"><code>DELETE /api/cms/posts/:slug
Headers: Authorization: Bearer {Firebase IDトークン}
</code></pre><h4 id="78-プロダクトapi">7.8 プロダクトAPI </h4>
<p>記事と同様の構造で <code>/api/cms/products/*</code> エンドポイントを提供。</p>
<h4 id="79-画像アップロード管理者のみ">7.9 画像アップロード（管理者のみ） </h4>
<pre data-role="codeBlock" data-info="" class="language-text"><code>POST /api/cms/upload
Headers:
  Authorization: Bearer {Firebase IDトークン}
  Content-Type: image/png (または image/jpeg など)
Body: バイナリ画像データ
</code></pre><p>R2バケットに保存し、公開URLを返却。</p>
<pre data-role="codeBlock" data-info="json" class="language-json json"><code><span class="token punctuation">{</span>
  <span class="token property">"key"</span><span class="token operator">:</span> <span class="token string">"1705312345678-abc123.png"</span><span class="token punctuation">,</span>
  <span class="token property">"url"</span><span class="token operator">:</span> <span class="token string">"https://images.haroin57.com/1705312345678-abc123.png"</span>
<span class="token punctuation">}</span>
</code></pre><h3 id="8-管理者認証">8. 管理者認証 </h3>
<h4 id="81-認証方式">8.1 認証方式 </h4>
<p>2つの認証方式をOR条件でサポート：</p>
<pre data-role="codeBlock" data-info="typescript" class="language-typescript typescript"><code><span class="token keyword keyword-async">async</span> <span class="token keyword keyword-function">function</span> <span class="token function">checkAdminAuth</span><span class="token punctuation">(</span>req<span class="token operator">:</span> Request<span class="token punctuation">,</span> env<span class="token operator">:</span> Env<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Promise</span><span class="token operator">&lt;</span><span class="token builtin">boolean</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// 方法1: Firebase認証（ブラウザからのリクエスト用）</span>
  <span class="token keyword keyword-const">const</span> authHeader <span class="token operator">=</span> req<span class="token punctuation">.</span>headers<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'Authorization'</span><span class="token punctuation">)</span>
  <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>authHeader<span class="token operator">?.</span><span class="token function">startsWith</span><span class="token punctuation">(</span><span class="token string">'Bearer '</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword keyword-const">const</span> token <span class="token operator">=</span> authHeader<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">)</span>
    <span class="token keyword keyword-const">const</span> payload <span class="token operator">=</span> <span class="token keyword keyword-await">await</span> <span class="token function">verifyFirebaseToken</span><span class="token punctuation">(</span>token<span class="token punctuation">,</span> env<span class="token punctuation">)</span>
    <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>payload<span class="token operator">?.</span>email <span class="token operator">&amp;&amp;</span> adminEmails<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span>payload<span class="token punctuation">.</span>email<span class="token punctuation">.</span><span class="token function">toLowerCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword keyword-return">return</span> <span class="token boolean">true</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// 方法2: ADMIN_SECRET（CLIツールからのリクエスト用）</span>
  <span class="token keyword keyword-const">const</span> secret <span class="token operator">=</span> req<span class="token punctuation">.</span>headers<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'X-Admin-Secret'</span><span class="token punctuation">)</span>
  <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>env<span class="token punctuation">.</span><span class="token constant">ADMIN_SECRET</span> <span class="token operator">&amp;&amp;</span> secret <span class="token operator">===</span> env<span class="token punctuation">.</span><span class="token constant">ADMIN_SECRET</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword keyword-return">return</span> <span class="token boolean">true</span>
  <span class="token punctuation">}</span>

  <span class="token keyword keyword-return">return</span> <span class="token boolean">false</span>
<span class="token punctuation">}</span>
</code></pre><table>
<thead>
<tr>
<th>方式</th>
<th>ヘッダー</th>
<th>用途</th>
</tr>
</thead>
<tbody>
<tr>
<td>Firebase認証</td>
<td><code>Authorization: Bearer {token}</code></td>
<td>ブラウザからのリクエスト</td>
</tr>
<tr>
<td>ADMIN_SECRET</td>
<td><code>X-Admin-Secret: {secret}</code></td>
<td>CLIツール・スクリプト</td>
</tr>
</tbody>
</table>
<h4 id="82-firebase-idトークン検証">8.2 Firebase IDトークン検証 </h4>
<p><code>verifyFirebaseToken</code>関数で以下を検証：</p>
<ol>
<li><strong>JWTの構造解析</strong>: Header.Payload.Signatureに分解</li>
<li><strong>アルゴリズム検証</strong>: <code>alg === "RS256"</code> のみ許可</li>
<li><strong>時刻検証</strong>:
<ul>
<li><code>exp &gt; now</code> (有効期限チェック)</li>
<li><code>iat &lt;= now</code> (発行時刻チェック)</li>
<li><code>auth_time &lt;= now</code> (認証時刻チェック)</li>
</ul>
</li>
<li><strong>発行者検証</strong>: <code>iss === "https://securetoken.google.com/{project_id}"</code></li>
<li><strong>オーディエンス検証</strong>: <code>aud === project_id</code></li>
<li><strong>メール検証</strong>: <code>email_verified === true</code></li>
<li><strong>RS256署名検証</strong>: Googleの公開鍵で署名を検証</li>
</ol>
<h4 id="83-公開鍵の取得とキャッシュ">8.3 公開鍵の取得とキャッシュ </h4>
<pre data-role="codeBlock" data-info="typescript" class="language-typescript typescript"><code><span class="token keyword keyword-const">const</span> <span class="token constant">GOOGLE_CERTS_URL</span> <span class="token operator">=</span> <span class="token string">'https://www.googleapis.com/robot/v1/metadata/x509/securetoken@system.gserviceaccount.com'</span>

<span class="token keyword keyword-async">async</span> <span class="token keyword keyword-function">function</span> <span class="token function">getGooglePublicKeys</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Promise</span><span class="token operator">&lt;</span>Record<span class="token operator">&lt;</span><span class="token builtin">string</span><span class="token punctuation">,</span> CryptoKey<span class="token operator">&gt;&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// キャッシュが有効な場合はそれを返す</span>
  <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>publicKeyCache <span class="token operator">&amp;&amp;</span> publicKeyCache<span class="token punctuation">.</span>expiresAt <span class="token operator">&gt;</span> now<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword keyword-return">return</span> publicKeyCache<span class="token punctuation">.</span>keys
  <span class="token punctuation">}</span>

  <span class="token comment">// Googleから証明書を取得</span>
  <span class="token keyword keyword-const">const</span> response <span class="token operator">=</span> <span class="token keyword keyword-await">await</span> <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token constant">GOOGLE_CERTS_URL</span><span class="token punctuation">)</span>
  <span class="token keyword keyword-const">const</span> certs <span class="token operator">=</span> <span class="token keyword keyword-await">await</span> response<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

  <span class="token comment">// X.509証明書からCryptoKeyに変換</span>
  <span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span><span class="token keyword keyword-const">const</span> <span class="token punctuation">[</span>kid<span class="token punctuation">,</span> pem<span class="token punctuation">]</span> <span class="token keyword keyword-of">of</span> Object<span class="token punctuation">.</span><span class="token function">entries</span><span class="token punctuation">(</span>certs<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    keys<span class="token punctuation">[</span>kid<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword keyword-await">await</span> <span class="token function">importPublicKeyFromCert</span><span class="token punctuation">(</span>pem<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// Cache-Controlヘッダーに基づいてキャッシュ</span>
  publicKeyCache <span class="token operator">=</span> <span class="token punctuation">{</span> keys<span class="token punctuation">,</span> expiresAt<span class="token operator">:</span> now <span class="token operator">+</span> maxAge <span class="token operator">*</span> <span class="token number">1000</span> <span class="token punctuation">}</span>
  <span class="token keyword keyword-return">return</span> keys
<span class="token punctuation">}</span>
</code></pre><ul>
<li>Googleの公開鍵は定期的にローテーションされる</li>
<li>JWTヘッダーの<code>kid</code>で対応する公開鍵を特定</li>
<li><code>Cache-Control</code>ヘッダーに基づいてキャッシュ</li>
</ul>
<h4 id="84-x509証明書の解析">8.4 X.509証明書の解析 </h4>
<pre data-role="codeBlock" data-info="typescript" class="language-typescript typescript"><code><span class="token keyword keyword-function">function</span> <span class="token function">extractSpkiFromCertificate</span><span class="token punctuation">(</span>certBytes<span class="token operator">:</span> Uint8Array<span class="token punctuation">)</span><span class="token operator">:</span> ArrayBuffer <span class="token punctuation">{</span>
  <span class="token comment">// ASN.1 DER形式のX.509証明書をパース</span>
  <span class="token comment">// tbsCertificate内のsubjectPublicKeyInfo（7番目のフィールド）を抽出</span>
  <span class="token comment">// Web Crypto APIで使えるSPKI形式に変換</span>
<span class="token punctuation">}</span>
</code></pre><p>GoogleはPEM形式のX.509証明書を提供するため、ASN.1パースが必要。</p>
<h3 id="9-corsとセキュリティ">9. CORSとセキュリティ </h3>
<h4 id="91-originrefererチェック">9.1 Origin/Refererチェック </h4>
<pre data-role="codeBlock" data-info="typescript" class="language-typescript typescript"><code><span class="token keyword keyword-const">const</span> allowedOrigin <span class="token operator">=</span> env<span class="token punctuation">.</span><span class="token constant">ALLOWED_ORIGIN</span> <span class="token operator">||</span> <span class="token string">'https://haroin57.com'</span>

<span class="token keyword keyword-const">const</span> isAllowed <span class="token operator">=</span>
  origin <span class="token operator">===</span> allowedOrigin <span class="token operator">||</span>
  <span class="token punctuation">(</span>origin <span class="token operator">===</span> <span class="token string">''</span> <span class="token operator">&amp;&amp;</span> referer<span class="token punctuation">.</span><span class="token function">startsWith</span><span class="token punctuation">(</span>allowedOrigin<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">||</span>
  <span class="token punctuation">(</span>origin <span class="token operator">===</span> <span class="token string">''</span> <span class="token operator">&amp;&amp;</span> referer <span class="token operator">===</span> <span class="token string">''</span><span class="token punctuation">)</span>

<span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>isAllowed<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword keyword-return">return</span> <span class="token keyword keyword-new">new</span> <span class="token class-name">Response</span><span class="token punctuation">(</span><span class="token string">'forbidden'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> status<span class="token operator">:</span> <span class="token number">403</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><p>許可されたオリジン以外からのリクエストを拒否。</p>
<h4 id="92-preflight対応">9.2 Preflight対応 </h4>
<pre data-role="codeBlock" data-info="typescript" class="language-typescript typescript"><code><span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>req<span class="token punctuation">.</span>method <span class="token operator">===</span> <span class="token string">'OPTIONS'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword keyword-return">return</span> <span class="token keyword keyword-new">new</span> <span class="token class-name">Response</span><span class="token punctuation">(</span><span class="token keyword keyword-null">null</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> status<span class="token operator">:</span> <span class="token number">204</span><span class="token punctuation">,</span> headers<span class="token operator">:</span> corsHeaders <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><h3 id="10-kvデータ構造">10. KVデータ構造 </h3>
<pre data-role="codeBlock" data-info="" class="language-text"><code>HAROIN_PV KV Namespace
├── total                           # 合計PV数
├── rl:{ip}                         # レート制限フラグ（TTL: 60秒）
├── good:{slug}:count               # いいね数
├── good:{slug}:ip:{ip}             # 投票済みフラグ
├── bbs:threads:list                # スレッド一覧（JSON配列）
├── bbs:thread:{id}:meta            # スレッドメタ情報
├── bbs:thread:{id}:posts           # スレッド投稿一覧
├── bbs:rl:thread:{ip}              # スレッド作成レート制限
├── bbs:rl:post:{ip}                # 投稿レート制限
├── cms:posts:list                  # 記事メタ一覧
├── cms:post:{slug}                 # 記事データ
├── cms:products:list               # プロダクトメタ一覧
└── cms:product:{slug}              # プロダクトデータ
</code></pre><h3 id="11-デプロイ">11. デプロイ </h3>
<pre data-role="codeBlock" data-info="bash" class="language-bash bash"><code><span class="token comment"># wrangler.pv.jsonc を使用してデプロイ</span>
wrangler deploy <span class="token parameter variable">--config</span> wrangler.pv.jsonc
</code></pre><h4 id="wranglerpvjsonc">wrangler.pv.jsonc </h4>
<pre data-role="codeBlock" data-info="jsonc" class="language-jsonc jsonc"><code>{
  "name": "haroin-pv",
  "main": "src/pv-worker.ts",
  "compatibility_date": "2025-12-02",
  "kv_namespaces": [
    { "binding": "HAROIN_PV", "id": "..." }
  ],
  "r2_buckets": [
    { "binding": "CMS_IMAGES", "bucket_name": "haroin-cms-images" }
  ],
  "vars": {
    "R2_PUBLIC_URL": "https://images.haroin57.com"
  }
}
</code></pre><h4 id="secrets機密情報">Secrets（機密情報） </h4>
<pre data-role="codeBlock" data-info="bash" class="language-bash bash"><code>wrangler secret put ADMIN_SECRET
wrangler secret put FIREBASE_PROJECT_ID
wrangler secret put ADMIN_EMAILS
</code></pre><hr>
<h2 id="ローカル記事のデプロイ">ローカル記事のデプロイ </h2>
<p>ローカル環境で作成したMarkdownファイルをCloudflare KVのCMSにデプロイするための機能について解説します。</p>
<h3 id="1-概要">1. 概要 </h3>
<p>Web上のエディタだけでなく、VSCodeなどのローカルエディタで記事を書き、それをコマンド一つでCMSにデプロイできます。これにより：</p>
<ul>
<li>使い慣れたエディタで執筆可能</li>
<li>Gitでの記事バージョン管理</li>
<li>複数記事の一括デプロイ</li>
<li>CI/CDパイプラインとの連携</li>
</ul>
<h3 id="2-markdownファイルの形式">2. Markdownファイルの形式 </h3>
<p>記事は<code>content/posts/</code>ディレクトリにMarkdownファイルとして配置します。</p>
<h4 id="21-ディレクトリ構造">2.1 ディレクトリ構造 </h4>
<pre data-role="codeBlock" data-info="" class="language-text"><code>content/
└── posts/
    ├── my-first-article.md
    ├── react-tutorial.md
    └── typescript-tips.md
</code></pre><p>ファイル名（拡張子を除く）が記事のslug（URL識別子）になります。</p>
<h4 id="22-frontmatterメタデータ">2.2 frontmatter（メタデータ） </h4>
<p>各Markdownファイルの先頭にYAML形式でメタデータを記述します：</p>
<pre data-role="codeBlock" data-info="yaml" class="language-yaml yaml"><code><span class="token punctuation">---</span>
<span class="token key atrule">title</span><span class="token punctuation">:</span> <span class="token string">"記事タイトル"</span>
<span class="token key atrule">summary</span><span class="token punctuation">:</span> <span class="token string">"記事の概要（一覧ページで表示される説明文）"</span>
<span class="token key atrule">date</span><span class="token punctuation">:</span> <span class="token string">"2025-01-15"</span>
<span class="token key atrule">tags</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> React
  <span class="token punctuation">-</span> TypeScript
  <span class="token punctuation">-</span> Tutorial
<span class="token key atrule">status</span><span class="token punctuation">:</span> published  <span class="token comment"># オプション: published または draft</span>
<span class="token punctuation">---</span>

本文をここに書きます<span class="token punctuation">...</span>
</code></pre><table>
<thead>
<tr>
<th>フィールド</th>
<th>必須</th>
<th>説明</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>title</code></td>
<td>◯</td>
<td>記事のタイトル</td>
</tr>
<tr>
<td><code>summary</code></td>
<td>△</td>
<td>記事の概要（省略可）</td>
</tr>
<tr>
<td><code>date</code></td>
<td>△</td>
<td>作成日（YYYY-MM-DD形式）</td>
</tr>
<tr>
<td><code>tags</code></td>
<td>△</td>
<td>タグの配列</td>
</tr>
<tr>
<td><code>status</code></td>
<td>△</td>
<td><code>published</code>（公開）または <code>draft</code>（下書き）</td>
</tr>
</tbody>
</table>
<h3 id="3-デプロイスクリプトの使い方">3. デプロイスクリプトの使い方 </h3>
<h4 id="31-firebase-idトークンの取得">3.1 Firebase IDトークンの取得 </h4>
<p>デプロイには管理者認証が必要です。ブラウザの開発者ツールで以下を実行してトークンを取得します：</p>
<pre data-role="codeBlock" data-info="javascript" class="language-javascript javascript"><code><span class="token comment">// Firebaseにログイン済みの状態で実行</span>
<span class="token keyword keyword-const">const</span> user <span class="token operator">=</span> firebase<span class="token punctuation">.</span><span class="token method function property-access">auth</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token property-access">currentUser</span><span class="token punctuation">;</span>
<span class="token keyword keyword-const">const</span> token <span class="token operator">=</span> <span class="token keyword control-flow keyword-await">await</span> user<span class="token punctuation">.</span><span class="token method function property-access">getIdToken</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span>token<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><p>または、Webサイトにログイン後、コンソールで：</p>
<pre data-role="codeBlock" data-info="javascript" class="language-javascript javascript"><code><span class="token comment">// AdminAuthContextを使用している場合</span>
<span class="token keyword keyword-const">const</span> <span class="token punctuation">{</span> idToken <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">useAdminAuth</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span>idToken<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><h4 id="32-基本的な使い方">3.2 基本的な使い方 </h4>
<pre data-role="codeBlock" data-info="bash" class="language-bash bash"><code><span class="token comment"># 環境変数にトークンを設定</span>
<span class="token builtin class-name">export</span> <span class="token assign-left variable">FIREBASE_ID_TOKEN</span><span class="token operator">=</span><span class="token string">"取得したトークン"</span>

<span class="token comment"># content/posts/ 配下のすべての記事をデプロイ</span>
npx tsx scripts/deploy-posts.ts

<span class="token comment"># 特定のファイルのみデプロイ</span>
npx tsx scripts/deploy-posts.ts <span class="token parameter variable">--file</span> content/posts/my-article.md

<span class="token comment"># 下書きとしてデプロイ</span>
npx tsx scripts/deploy-posts.ts <span class="token parameter variable">--draft</span>

<span class="token comment"># ドライラン（実際にはデプロイせず確認のみ）</span>
npx tsx scripts/deploy-posts.ts --dry-run
</code></pre><h4 id="33-コマンドラインオプション">3.3 コマンドラインオプション </h4>
<table>
<thead>
<tr>
<th>オプション</th>
<th>説明</th>
<th>例</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>--file &lt;path&gt;</code></td>
<td>指定したファイルのみをデプロイ</td>
<td><code>--file content/posts/article.md</code></td>
</tr>
<tr>
<td><code>--draft</code></td>
<td>下書きとしてデプロイ（frontmatterのstatusを上書き）</td>
<td><code>--draft</code></td>
</tr>
<tr>
<td><code>--dry-run</code></td>
<td>実際にはデプロイせず、処理内容を表示</td>
<td><code>--dry-run</code></td>
</tr>
<tr>
<td><code>--endpoint &lt;url&gt;</code></td>
<td>CMS APIのエンドポイント</td>
<td><code>--endpoint http://localhost:8787/api/cms</code></td>
</tr>
<tr>
<td><code>--token &lt;token&gt;</code></td>
<td>Firebase IDトークン（環境変数の代わりに指定）</td>
<td><code>--token eyJhbGci...</code></td>
</tr>
</tbody>
</table>
<h4 id="34-環境変数">3.4 環境変数 </h4>
<table>
<thead>
<tr>
<th>変数名</th>
<th>説明</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>FIREBASE_ID_TOKEN</code></td>
<td>Firebase IDトークン（認証用）</td>
</tr>
<tr>
<td><code>CMS_ENDPOINT</code></td>
<td>CMS APIのエンドポイント（デフォルト: <a href="https://haroin57.com/api/cms%EF%BC%89">https://haroin57.com/api/cms）</a></td>
</tr>
</tbody>
</table>
<h3 id="4-使用例">4. 使用例 </h3>
<h4 id="41-新しい記事を書いて公開する">4.1 新しい記事を書いて公開する </h4>
<pre data-role="codeBlock" data-info="bash" class="language-bash bash"><code><span class="token comment"># 1. 記事ファイルを作成</span>
<span class="token function">cat</span> <span class="token operator">&gt;</span> content/posts/new-article.md <span class="token operator">&lt;&lt;</span> <span class="token string">'EOF'
---
title: "新しい記事"
summary: "この記事では..."
date: "2025-01-15"
tags:
  - Tech
---

## はじめに

記事の本文をここに書きます。
EOF</span>

<span class="token comment"># 2. デプロイ</span>
<span class="token builtin class-name">export</span> <span class="token assign-left variable">FIREBASE_ID_TOKEN</span><span class="token operator">=</span><span class="token string">"your-token"</span>
npx tsx scripts/deploy-posts.ts <span class="token parameter variable">--file</span> content/posts/new-article.md
</code></pre><h4 id="42-下書きとして保存し-後で公開する">4.2 下書きとして保存し、後で公開する </h4>
<pre data-role="codeBlock" data-info="bash" class="language-bash bash"><code><span class="token comment"># 下書きとしてデプロイ</span>
npx tsx scripts/deploy-posts.ts <span class="token parameter variable">--file</span> content/posts/draft-article.md <span class="token parameter variable">--draft</span>

<span class="token comment"># 後で公開する場合は、frontmatterのstatusをpublishedに変更して再デプロイ</span>
<span class="token comment"># または、Webの管理画面からステータスを変更</span>
</code></pre><h4 id="43-すべての記事を一括更新">4.3 すべての記事を一括更新 </h4>
<pre data-role="codeBlock" data-info="bash" class="language-bash bash"><code><span class="token comment"># 既存の記事も含めてすべてデプロイ</span>
npx tsx scripts/deploy-posts.ts

<span class="token comment"># まずドライランで確認</span>
npx tsx scripts/deploy-posts.ts --dry-run
</code></pre><h3 id="5-markdownの記法">5. Markdownの記法 </h3>
<p>デプロイスクリプトは、Webエディタと同じMarkdown変換処理を使用しています。</p>
<h4 id="51-サポートされる構文">5.1 サポートされる構文 </h4>
<ul>
<li><strong>GitHub Flavored Markdown (GFM)</strong>: テーブル、取り消し線、タスクリストなど</li>
<li><strong>目次の自動生成</strong>: <code>## 目次</code> という見出しの後に自動的に目次が挿入されます</li>
<li><strong>コードハイライト</strong>: シンタックスハイライト付きコードブロック</li>
<li><strong>数式 (KaTeX)</strong>: <code>$inline$</code> や <code>$$display$$</code> 形式の数式</li>
<li><strong>Mermaidダイアグラム</strong>: <code>mermaid</code> コードブロック</li>
<li><strong>アドモニション</strong>: <code>[!NOTE]</code>、<code>[!WARNING]</code>、<code>[!CALLOUT]</code></li>
</ul>
<h4 id="52-アドモニションの例">5.2 アドモニションの例 </h4>
<pre data-role="codeBlock" data-info="markdown" class="language-markdown markdown"><code><span class="token blockquote punctuation">&gt;</span> [!NOTE]
<span class="token blockquote punctuation">&gt;</span> これはメモです。重要な情報を強調したいときに使用します。

<span class="token blockquote punctuation">&gt;</span> [!WARNING]
<span class="token blockquote punctuation">&gt;</span> これは警告です。注意が必要な内容を示します。

<span class="token blockquote punctuation">&gt;</span> [!CALLOUT] タイトル
<span class="token blockquote punctuation">&gt;</span> これはコールアウトです。特に目立たせたい内容に使用します。
</code></pre><h3 id="6-トラブルシューティング">6. トラブルシューティング </h3>
<h4 id="61-認証エラー">6.1 認証エラー </h4>
<pre data-role="codeBlock" data-info="" class="language-text"><code>Error: unauthorized
</code></pre><p><strong>原因</strong>: トークンが無効または期限切れ</p>
<p><strong>対処法</strong>:</p>
<ol>
<li>新しいトークンを取得する</li>
<li>トークンが正しく設定されているか確認</li>
<li>管理者メールリストに登録されているか確認</li>
</ol>
<h4 id="62-記事が見つからない">6.2 記事が見つからない </h4>
<pre data-role="codeBlock" data-info="" class="language-text"><code>Error: post not found
</code></pre><p><strong>原因</strong>: 更新しようとした記事が存在しない</p>
<p><strong>対処法</strong>: スクリプトは自動的に新規作成か更新かを判定するため、通常は発生しません。APIエンドポイントを確認してください。</p>
<h4 id="63-frontmatterのパースエラー">6.3 frontmatterのパースエラー </h4>
<p><strong>原因</strong>: YAMLの形式が正しくない</p>
<p><strong>対処法</strong>:</p>
<ul>
<li>インデントが正しいか確認（スペース2つ）</li>
<li>特殊文字を含むタイトルは引用符で囲む</li>
<li>日付は <code>"YYYY-MM-DD"</code> 形式で記述</li>
</ul>
<h3 id="7-cicdとの連携">7. CI/CDとの連携 </h3>
<p>GitHub Actionsでの自動デプロイ例：</p>
<pre data-role="codeBlock" data-info="yaml" class="language-yaml yaml"><code><span class="token key atrule">name</span><span class="token punctuation">:</span> Deploy Posts

<span class="token key atrule">on</span><span class="token punctuation">:</span>
  <span class="token key atrule">push</span><span class="token punctuation">:</span>
    <span class="token key atrule">paths</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token string">'content/posts/**'</span>
    <span class="token key atrule">branches</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> main

<span class="token key atrule">jobs</span><span class="token punctuation">:</span>
  <span class="token key atrule">deploy</span><span class="token punctuation">:</span>
    <span class="token key atrule">runs-on</span><span class="token punctuation">:</span> ubuntu<span class="token punctuation">-</span>latest
    <span class="token key atrule">steps</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">uses</span><span class="token punctuation">:</span> actions/checkout@v4

      <span class="token punctuation">-</span> <span class="token key atrule">uses</span><span class="token punctuation">:</span> actions/setup<span class="token punctuation">-</span>node@v4
        <span class="token key atrule">with</span><span class="token punctuation">:</span>
          <span class="token key atrule">node-version</span><span class="token punctuation">:</span> <span class="token string">'20'</span>

      <span class="token punctuation">-</span> <span class="token key atrule">run</span><span class="token punctuation">:</span> npm ci

      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Deploy posts
        <span class="token key atrule">env</span><span class="token punctuation">:</span>
          <span class="token key atrule">FIREBASE_ID_TOKEN</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span><span class="token punctuation">{</span> secrets.FIREBASE_ID_TOKEN <span class="token punctuation">}</span><span class="token punctuation">}</span>
        <span class="token key atrule">run</span><span class="token punctuation">:</span> npx tsx scripts/deploy<span class="token punctuation">-</span>posts.ts
</code></pre><p><strong>注意</strong>: CI/CDでのトークン管理には注意が必要です。長期間有効なサービスアカウントトークンの使用を検討してください。</p>
</div>
      </div>
      
      
    
    
    
    
    
    
  
    </body></html>