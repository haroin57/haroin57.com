---
title: "HAPPYでClaude Codeをスマホから操作する環境を構築した"
summary: "Claude CodeのセッションをスマホからリモートでモニタリングするためのHAPPYツール群を自前サーバーで構築した話"
date: "2026-01-02"
tags:
  - Claude Code
  - インフラ
  - VPS
  - Docker
---

## 目次

- [HAPPYとは](#happyとは)
- [主な機能](#主な機能)
  - [セッション共有・リモート操作](#セッション共有リモート操作)
  - [モバイル認証（鍵ベース）](#モバイル認証鍵ベース)
  - [Codexモード（自律実行）](#codexモード自律実行)
  - [Push通知](#push通知)
  - [マルチデバイス管理](#マルチデバイス管理)
- [環境構築で行ったこと](#環境構築で行ったこと)
  - [インフラ・ネットワーク](#インフラネットワーク)
  - [リバースプロキシ（Caddy）](#リバースプロキシcaddy)
  - [happy-serverのデプロイ](#happy-serverのデプロイ)
  - [happy-cliのセットアップ](#happy-cliのセットアップ)
  - [モバイルアプリの接続](#モバイルアプリの接続)
- [現在の状態](#現在の状態)
- [想定ユースケース](#想定ユースケース)

<br/>

## HAPPYとは

**HAPPY** は PC 上の Claude Code / Codex セッションを、スマートフォンから安全に操作・監視するためのツール群だ。

長時間のコード生成タスクを放置して実行したり、外出先から進捗を確認したり、危険な操作が実行される前にスマホで承認したりできる。

HAPPYは以下の3つのコンポーネントで構成されている。

| コンポーネント | 役割 |
|---------------|------|
| **happy-cli** | PC上でClaude Code / Codexを起動・制御するCLI |
| **HAPPYモバイルアプリ** | iOS/Androidで認証・操作・通知を行うクライアント |
| **happy-server** | 認証・セッション管理・通知・データ永続化を担当するバックエンド |

<br/>

## 主な機能

### セッション共有・リモート操作

PC上で動作するClaude Codeセッションをスマホから確認・操作できる。

QRコードまたは認証フローで安全に接続し、リアルタイムでセッションの状態を監視可能。

### モバイル認証（鍵ベース）

公開鍵を用いた認証リクエストで、スマホ側で承認するまでCLIは待機する。

危険な操作（ファイル削除やシステム変更など）が実行される前に、追加の承認を求めることもできる。

### Codexモード（自律実行）

長時間タスクや調査・リファクタリング向けの自動実行モード。

進捗や完了をモバイルへ通知してくれるので、PCの前に張り付いている必要がない。

### Push通知

処理完了・エラー・任意メッセージをスマホへ即座に送信。

バックグラウンドで実行しているタスクの状況をリアルタイムで把握できる。

### マルチデバイス管理

複数端末の接続・失効管理に対応。

セッション単位での細かい制御が可能。

<br/>

## 環境構築で行ったこと

今回、HAPPYを自前のVPS上で稼働させた。その手順を記録しておく。

### インフラ・ネットワーク

まずUbuntu VPSを用意した。

Cloudflare DNSを設定し、Proxy（Full Strict）モードで通信を保護。独自ドメイン `api.haroin57.com` をVPSに向けた。

### リバースプロキシ（Caddy）

**Caddy** をsystemdサービスとして導入。

HTTPS終端にはCloudflare Origin CA証明書を使用し、 `api.haroin57.com → localhost:3005` へリバースプロキシする構成にした。

Caddyは設定がシンプルで、自動的にHTTPS証明書の管理もしてくれるので便利だ。

### happy-serverのデプロイ

GitHubリポジトリからcloneして、Docker / docker composeで起動。

構成は以下の通り：

- **Node.js** (APIサーバー)
- **PostgreSQL** (Prisma ORM経由)
- **Redis** (セッション・キャッシュ)
- **MinIO** (オブジェクトストレージ)

Prisma migrationを適用してDB初期化し、APIが `http://127.0.0.1:3005` で正常起動することを確認した。

```bash
# docker composeで一発起動
docker compose up -d

# Prisma migrationの実行
npx prisma migrate deploy
```

### happy-cliのセットアップ

npmでグローバルインストール。

```bash
npm install -g happy-cli
```

環境変数で自前サーバーを指定：

```bash
export HAPPY_SERVER_URL=https://api.haroin57.com
```

`happy auth` コマンドで認証フローを開始。

### モバイルアプリの接続

iOS用のHAPPYアプリをインストール。

CLIの認証要求をモバイル側で承認し、自前のhappy-serverとの接続を確認できた。

<br/>

## 現在の状態

- **happy-server**: 自前VPS上で稼働中
- **HTTPS + 独自ドメイン**: 外部公開済み
- **接続**: happy-cli ↔ HAPPYモバイルアプリ ↔ happy-server の三者間で疎通成功
- **動作確認**: Claude Codeセッションをモバイルからリモートでモニタリングできるようになった

<br/>

## 想定ユースケース

HAPPYを使うと、以下のようなワークフローが可能になる。

1. **長時間のコード生成・修正を放置実行**
   - 大規模なリファクタリングや、時間のかかるテスト実行を夜間に回す
   - 完了したらスマホに通知が届く

2. **外出先からの進捗確認・追加指示**
   - 電車の中やカフェからでもセッションの状態をチェック
   - 必要に応じて追加の指示を送れる

3. **危険操作のリモート承認**
   - ファイル削除やデータベース操作など、慎重さが求められる処理の前に承認要求
   - 意図しない操作を未然に防げる

4. **通知ベースの非同期開発フロー**
   - PCに張り付かずとも開発を進められる
   - 通知で必要なタイミングにだけ対応

これでClaude Codeを使った開発がさらに柔軟になった。
