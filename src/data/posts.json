[
  {
    "slug": "haroin57-web-architecture",
    "title": "README",
    "summary": "haroin57-webの技術構成、コンポーネント設計、ルーティングについて詳しく解説",
    "createdAt": "2025-12-21",
    "tags": [
      "React",
      "TypeScript",
      "Architecture",
      "Cloudflare"
    ],
    "html": "<p>このサイト（haroin57.com）の技術構成について解説する。Vite + React + TypeScript + Tailwind CSSで構築され、Cloudflare Pagesでホスティングされている。</p>\n<h2 id=\"目次\">目次</h2>\n<div class=\"toc-box\"><ul>\n<li><a href=\"#%E3%83%97%E3%83%AD%E3%82%B8%E3%82%A7%E3%82%AF%E3%83%88%E6%A7%8B%E6%88%90\">プロジェクト構成</a></li>\n<li><a href=\"#%E3%82%A8%E3%83%B3%E3%83%88%E3%83%AA%E3%83%BC%E3%83%9D%E3%82%A4%E3%83%B3%E3%83%88\">エントリーポイント</a></li>\n<li><a href=\"#maintsx\">main.tsx</a></li>\n<li><a href=\"#apptsx\">App.tsx</a></li>\n<li><a href=\"#%E8%AA%8D%E8%A8%BC%E3%82%B3%E3%83%B3%E3%83%86%E3%82%AD%E3%82%B9%E3%83%88\">認証コンテキスト</a></li>\n<li><a href=\"#adminauthcontexttsx\">AdminAuthContext.tsx</a></li>\n<li><a href=\"#%E3%82%B3%E3%83%B3%E3%83%9D%E3%83%BC%E3%83%8D%E3%83%B3%E3%83%88\">コンポーネント</a></li>\n<li><a href=\"#animatedroutestsx\">AnimatedRoutes.tsx</a></li>\n<li><a href=\"#globalbackgroundtsx\">GlobalBackground.tsx</a></li>\n<li><a href=\"#scrolltophomeswitchtsx\">ScrollTopHomeSwitch.tsx</a></li>\n<li><a href=\"#accesscountertsx\">AccessCounter.tsx</a></li>\n<li><a href=\"#prefetchlinktsx\">PrefetchLink.tsx</a></li>\n<li><a href=\"#lightboxtsx\">Lightbox.tsx</a></li>\n<li><a href=\"#mermaidrenderertsx\">MermaidRenderer.tsx</a></li>\n<li><a href=\"#%E3%83%9A%E3%83%BC%E3%82%B8%E3%82%B3%E3%83%B3%E3%83%9D%E3%83%BC%E3%83%8D%E3%83%B3%E3%83%88\">ページコンポーネント</a></li>\n<li><a href=\"#hometsx\">Home.tsx</a></li>\n<li><a href=\"#poststsx\">Posts.tsx</a></li>\n<li><a href=\"#postdetailtsx\">PostDetail.tsx</a></li>\n<li><a href=\"#bbslisttsx--bbsthreadtsx\">BBSList.tsx / BBSThread.tsx</a></li>\n<li><a href=\"#%E7%AE%A1%E7%90%86%E8%80%85%E6%A9%9F%E8%83%BD\">管理者機能</a></li>\n<li><a href=\"#posteditortsx\">PostEditor.tsx</a></li>\n<li><a href=\"#markdowneditortsx\">MarkdownEditor.tsx</a></li>\n<li><a href=\"#%E3%83%A9%E3%82%A4%E3%83%96%E3%83%A9%E3%83%AA%E3%83%A6%E3%83%BC%E3%83%86%E3%82%A3%E3%83%AA%E3%83%86%E3%82%A3\">ライブラリ・ユーティリティ</a></li>\n<li><a href=\"#firebasets\">firebase.ts</a></li>\n<li><a href=\"#draftstoragets\">draftStorage.ts</a></li>\n<li><a href=\"#%E3%83%87%E3%83%BC%E3%82%BF%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB\">データファイル</a></li>\n<li><a href=\"#photosts\">photos.ts</a></li>\n<li><a href=\"#%E4%BE%9D%E5%AD%98%E9%96%A2%E4%BF%82%E4%B8%80%E8%A6%A7\">依存関係一覧</a></li>\n<li><a href=\"#react%E9%96%A2%E9%80%A3\">React関連</a></li>\n<li><a href=\"#firebase\">Firebase</a></li>\n<li><a href=\"#markdown%E3%82%B3%E3%83%B3%E3%83%86%E3%83%B3%E3%83%84\">Markdown/コンテンツ</a></li>\n<li><a href=\"#%E3%82%B9%E3%82%BF%E3%82%A4%E3%83%AA%E3%83%B3%E3%82%B0\">スタイリング</a></li>\n<li><a href=\"#%E3%83%AD%E3%83%BC%E3%82%AB%E3%83%AB%E8%A8%98%E4%BA%8B%E3%81%AE%E3%83%87%E3%83%97%E3%83%AD%E3%82%A4\">ローカル記事のデプロイ</a></li>\n<li><a href=\"#%E6%A6%82%E8%A6%81\">概要</a></li>\n<li><a href=\"#markdown%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E3%81%AE%E5%BD%A2%E5%BC%8F\">Markdownファイルの形式</a></li>\n<li><a href=\"#%E3%83%87%E3%82%A3%E3%83%AC%E3%82%AF%E3%83%88%E3%83%AA%E6%A7%8B%E9%80%A0\">ディレクトリ構造</a></li>\n<li><a href=\"#frontmatter%E3%83%A1%E3%82%BF%E3%83%87%E3%83%BC%E3%82%BF\">frontmatter（メタデータ）</a></li>\n<li><a href=\"#%E3%83%87%E3%83%97%E3%83%AD%E3%82%A4%E3%82%B9%E3%82%AF%E3%83%AA%E3%83%97%E3%83%88%E3%81%AE%E4%BD%BF%E3%81%84%E6%96%B9\">デプロイスクリプトの使い方</a></li>\n<li><a href=\"#firebase-id%E3%83%88%E3%83%BC%E3%82%AF%E3%83%B3%E3%81%AE%E5%8F%96%E5%BE%97\">Firebase IDトークンの取得</a></li>\n<li><a href=\"#%E5%9F%BA%E6%9C%AC%E7%9A%84%E3%81%AA%E4%BD%BF%E3%81%84%E6%96%B9\">基本的な使い方</a></li>\n<li><a href=\"#%E3%82%B3%E3%83%9E%E3%83%B3%E3%83%89%E3%83%A9%E3%82%A4%E3%83%B3%E3%82%AA%E3%83%97%E3%82%B7%E3%83%A7%E3%83%B3\">コマンドラインオプション</a></li>\n<li><a href=\"#%E7%92%B0%E5%A2%83%E5%A4%89%E6%95%B0\">環境変数</a></li>\n<li><a href=\"#%E4%BD%BF%E7%94%A8%E4%BE%8B\">使用例</a></li>\n<li><a href=\"#%E6%96%B0%E3%81%97%E3%81%84%E8%A8%98%E4%BA%8B%E3%82%92%E6%9B%B8%E3%81%84%E3%81%A6%E5%85%AC%E9%96%8B%E3%81%99%E3%82%8B\">新しい記事を書いて公開する</a></li>\n<li><a href=\"#%E4%B8%8B%E6%9B%B8%E3%81%8D%E3%81%A8%E3%81%97%E3%81%A6%E4%BF%9D%E5%AD%98%E3%81%97%E5%BE%8C%E3%81%A7%E5%85%AC%E9%96%8B%E3%81%99%E3%82%8B\">下書きとして保存し、後で公開する</a></li>\n<li><a href=\"#%E3%81%99%E3%81%B9%E3%81%A6%E3%81%AE%E8%A8%98%E4%BA%8B%E3%82%92%E4%B8%80%E6%8B%AC%E6%9B%B4%E6%96%B0\">すべての記事を一括更新</a></li>\n<li><a href=\"#markdown%E3%81%AE%E8%A8%98%E6%B3%95\">Markdownの記法</a></li>\n<li><a href=\"#%E3%82%B5%E3%83%9D%E3%83%BC%E3%83%88%E3%81%95%E3%82%8C%E3%82%8B%E6%A7%8B%E6%96%87\">サポートされる構文</a></li>\n<li><a href=\"#%E3%82%A2%E3%83%89%E3%83%A2%E3%83%8B%E3%82%B7%E3%83%A7%E3%83%B3%E3%81%AE%E4%BE%8B\">アドモニションの例</a></li>\n<li><a href=\"#%E3%83%88%E3%83%A9%E3%83%96%E3%83%AB%E3%82%B7%E3%83%A5%E3%83%BC%E3%83%86%E3%82%A3%E3%83%B3%E3%82%B0\">トラブルシューティング</a></li>\n<li><a href=\"#%E8%AA%8D%E8%A8%BC%E3%82%A8%E3%83%A9%E3%83%BC\">認証エラー</a></li>\n<li><a href=\"#frontmatter%E3%81%AE%E3%83%91%E3%83%BC%E3%82%B9%E3%82%A8%E3%83%A9%E3%83%BC\">frontmatterのパースエラー</a></li>\n<li><a href=\"#cicd%E3%81%A8%E3%81%AE%E9%80%A3%E6%90%BA\">CI/CDとの連携</a></li>\n</ul></div>\n<br>\n<h2 id=\"プロジェクト構成\">プロジェクト構成</h2>\n<figure class=\"mdn-code\" data-rehype-pretty-code-figure=\"\"><div class=\"mdn-code-header\"><div class=\"mdn-code-lang\">TEXT</div><div class=\"mdn-code-actions\"><button type=\"button\" class=\"mdn-code-copy\" aria-label=\"Copy code to clipboard\">Copy</button></div></div><pre tabindex=\"0\" data-language=\"plaintext\" data-theme=\"github-dark-dimmed\"><code data-language=\"plaintext\" data-theme=\"github-dark-dimmed\" style=\"display: grid;\"><span data-line=\"\"><span>src/</span></span>\n<span data-line=\"\"><span>├── main.tsx                    # アプリケーションエントリーポイント</span></span>\n<span data-line=\"\"><span>├── App.tsx                     # ランディングページ（トップページ）</span></span>\n<span data-line=\"\"><span>├── index.css                   # グローバルスタイル</span></span>\n<span data-line=\"\"><span>├── contexts/</span></span>\n<span data-line=\"\"><span>│   └── AdminAuthContext.tsx    # Firebase認証コンテキスト</span></span>\n<span data-line=\"\"><span>├── components/</span></span>\n<span data-line=\"\"><span>│   ├── AnimatedRoutes.tsx      # ルーティング・ページ遷移アニメーション</span></span>\n<span data-line=\"\"><span>│   ├── GlobalBackground.tsx    # 背景画像管理</span></span>\n<span data-line=\"\"><span>│   ├── ScrollTopHomeSwitch.tsx # スクロール/スワイプによるページ切り替え</span></span>\n<span data-line=\"\"><span>│   ├── AccessCounter.tsx       # PVカウンター</span></span>\n<span data-line=\"\"><span>│   ├── PrefetchLink.tsx        # プリフェッチ対応リンク</span></span>\n<span data-line=\"\"><span>│   ├── Lightbox.tsx            # 画像モーダル</span></span>\n<span data-line=\"\"><span>│   ├── MermaidRenderer.tsx     # Mermaidダイアグラム描画</span></span>\n<span data-line=\"\"><span>│   ├── BackButton.tsx          # 戻るボタン</span></span>\n<span data-line=\"\"><span>│   └── admin/</span></span>\n<span data-line=\"\"><span>│       └── MarkdownEditor.tsx  # Markdownエディタ（画像アップロード対応）</span></span>\n<span data-line=\"\"><span>├── routes/</span></span>\n<span data-line=\"\"><span>│   ├── Home.tsx                # ホームページ（コンテンツ一覧）</span></span>\n<span data-line=\"\"><span>│   ├── Posts.tsx               # 記事一覧ページ</span></span>\n<span data-line=\"\"><span>│   ├── PostDetail.tsx          # 記事詳細ページ</span></span>\n<span data-line=\"\"><span>│   ├── Products.tsx            # プロダクト一覧ページ</span></span>\n<span data-line=\"\"><span>│   ├── ProductDetail.tsx       # プロダクト詳細ページ</span></span>\n<span data-line=\"\"><span>│   ├── Photos.tsx              # 写真ギャラリーページ</span></span>\n<span data-line=\"\"><span>│   ├── BBSList.tsx             # BBS スレッド一覧ページ</span></span>\n<span data-line=\"\"><span>│   ├── BBSThread.tsx           # BBS スレッド詳細ページ</span></span>\n<span data-line=\"\"><span>│   └── admin/</span></span>\n<span data-line=\"\"><span>│       ├── PostEditor.tsx      # 記事編集ページ</span></span>\n<span data-line=\"\"><span>│       └── ProductEditor.tsx   # プロダクト編集ページ</span></span>\n<span data-line=\"\"><span>├── lib/</span></span>\n<span data-line=\"\"><span>│   ├── firebase.ts             # Firebase初期化</span></span>\n<span data-line=\"\"><span>│   └── draftStorage.ts         # 下書き保存ユーティリティ</span></span>\n<span data-line=\"\"><span>└── data/</span></span>\n<span data-line=\"\"><span>    ├── posts.json              # 記事データ（ビルド時生成）</span></span>\n<span data-line=\"\"><span>    ├── products.json           # プロダクトデータ</span></span>\n<span data-line=\"\"><span>    ├── product-posts.json      # プロダクト詳細記事</span></span>\n<span data-line=\"\"><span>    └── photos.ts               # 写真データ定義</span></span></code></pre></figure>\n<br>\n<h2 id=\"エントリーポイント\">エントリーポイント</h2>\n<h3 id=\"maintsx\">main.tsx</h3>\n<p>アプリケーションのエントリーポイント。</p>\n<figure class=\"mdn-code\" data-rehype-pretty-code-figure=\"\"><div class=\"mdn-code-header\"><div class=\"mdn-code-lang\">TS</div><div class=\"mdn-code-actions\"><button type=\"button\" class=\"mdn-code-copy\" aria-label=\"Copy code to clipboard\">Copy</button></div></div><pre tabindex=\"0\" data-language=\"typescript\" data-theme=\"github-dark-dimmed\"><code data-language=\"typescript\" data-theme=\"github-dark-dimmed\" style=\"display: grid;\"><span data-line=\"\"><span style=\"color:#DCBDFB\">createRoot</span><span style=\"color:#ADBAC7\">(document.</span><span style=\"color:#DCBDFB\">getElementById</span><span style=\"color:#ADBAC7\">(</span><span style=\"color:#96D0FF\">'root'</span><span style=\"color:#ADBAC7\">)</span><span style=\"color:#F47067\">!</span><span style=\"color:#ADBAC7\">).</span><span style=\"color:#DCBDFB\">render</span><span style=\"color:#ADBAC7\">(</span></span>\n<span data-line=\"\"><span style=\"color:#ADBAC7\">  &#x3C;</span><span style=\"color:#F69D50\">BrowserRouter</span><span style=\"color:#ADBAC7\">></span></span>\n<span data-line=\"\"><span style=\"color:#ADBAC7\">    &#x3C;</span><span style=\"color:#F69D50\">AdminAuthProvider</span><span style=\"color:#ADBAC7\">></span></span>\n<span data-line=\"\"><span style=\"color:#F47067\">      &#x3C;</span><span style=\"color:#ADBAC7\">GlobalBackground </span><span style=\"color:#F47067\">/></span></span>\n<span data-line=\"\"><span style=\"color:#F47067\">      &#x3C;</span><span style=\"color:#ADBAC7\">ScrollTopHomeSwitch </span><span style=\"color:#F47067\">/></span></span>\n<span data-line=\"\"><span style=\"color:#F47067\">      &#x3C;</span><span style=\"color:#ADBAC7\">AnimatedRoutes </span><span style=\"color:#F47067\">/></span></span>\n<span data-line=\"\"><span style=\"color:#F47067\">    &#x3C;/</span><span style=\"color:#ADBAC7\">AdminAuthProvider</span><span style=\"color:#F47067\">></span></span>\n<span data-line=\"\"><span style=\"color:#F47067\">  &#x3C;/</span><span style=\"color:#ADBAC7\">BrowserRouter</span><span style=\"color:#F47067\">></span></span>\n<span data-line=\"\"><span style=\"color:#ADBAC7\">)</span></span></code></pre></figure>\n<p><strong>依存関係:</strong></p>\n<ul>\n<li><span data-rehype-pretty-code-figure=\"\"><code data-language=\"plaintext\" data-theme=\"github-dark-dimmed\"><span data-line=\"\"><span>react-dom/client</span></span></code></span>: <span data-rehype-pretty-code-figure=\"\"><code data-language=\"plaintext\" data-theme=\"github-dark-dimmed\"><span data-line=\"\"><span>createRoot</span></span></code></span></li>\n<li><span data-rehype-pretty-code-figure=\"\"><code data-language=\"plaintext\" data-theme=\"github-dark-dimmed\"><span data-line=\"\"><span>react-router-dom</span></span></code></span>: <span data-rehype-pretty-code-figure=\"\"><code data-language=\"plaintext\" data-theme=\"github-dark-dimmed\"><span data-line=\"\"><span>BrowserRouter</span></span></code></span></li>\n<li><span data-rehype-pretty-code-figure=\"\"><code data-language=\"plaintext\" data-theme=\"github-dark-dimmed\"><span data-line=\"\"><span>./components/AnimatedRoutes</span></span></code></span></li>\n<li><span data-rehype-pretty-code-figure=\"\"><code data-language=\"plaintext\" data-theme=\"github-dark-dimmed\"><span data-line=\"\"><span>./components/GlobalBackground</span></span></code></span></li>\n<li><span data-rehype-pretty-code-figure=\"\"><code data-language=\"plaintext\" data-theme=\"github-dark-dimmed\"><span data-line=\"\"><span>./components/ScrollTopHomeSwitch</span></span></code></span></li>\n<li><span data-rehype-pretty-code-figure=\"\"><code data-language=\"plaintext\" data-theme=\"github-dark-dimmed\"><span data-line=\"\"><span>./contexts/AdminAuthContext</span></span></code></span></li>\n</ul>\n<h3 id=\"apptsx\">App.tsx</h3>\n<p>ランディングページ（ルートパス <span data-rehype-pretty-code-figure=\"\"><code data-language=\"plaintext\" data-theme=\"github-dark-dimmed\"><span data-line=\"\"><span>/</span></span></code></span>）のコンポーネント。</p>\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n<div class=\"table-wrapper\"><table><thead><tr><th>関数名</th><th>説明</th></tr></thead><tbody><tr><td><span data-rehype-pretty-code-figure=\"\"><code data-language=\"plaintext\" data-theme=\"github-dark-dimmed\"><span data-line=\"\"><span>App()</span></span></code></span></td><td>ランディングページをレンダリング。ヒーローセクションと「進む」ボタンを表示</td></tr><tr><td><span data-rehype-pretty-code-figure=\"\"><code data-language=\"plaintext\" data-theme=\"github-dark-dimmed\"><span data-line=\"\"><span>handleNavigate()</span></span></code></span></td><td><span data-rehype-pretty-code-figure=\"\"><code data-language=\"plaintext\" data-theme=\"github-dark-dimmed\"><span data-line=\"\"><span>/home</span></span></code></span> へナビゲート</td></tr></tbody></table></div>\n<p><strong>機能:</strong></p>\n<ul>\n<li>reveal要素のアニメーション表示（<span data-rehype-pretty-code-figure=\"\"><code data-language=\"plaintext\" data-theme=\"github-dark-dimmed\"><span data-line=\"\"><span>queueMicrotask</span></span></code></span>で即座にクラス追加）</li>\n<li>ページ読み込み時にスクロール位置をトップにリセット</li>\n<li>ホバーアニメーション付きの進むボタン</li>\n</ul>\n<br>\n<h2 id=\"認証コンテキスト\">認証コンテキスト</h2>\n<h3 id=\"adminauthcontexttsx\">AdminAuthContext.tsx</h3>\n<p>Firebase認証とセッション管理を提供するReactコンテキスト。</p>\n<p><strong>定数:</strong></p>\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n<div class=\"table-wrapper\"><table><thead><tr><th>定数名</th><th>値</th><th>説明</th></tr></thead><tbody><tr><td><span data-rehype-pretty-code-figure=\"\"><code data-language=\"plaintext\" data-theme=\"github-dark-dimmed\"><span data-line=\"\"><span>SESSION_TIMEOUT_MS</span></span></code></span></td><td><span data-rehype-pretty-code-figure=\"\"><code data-language=\"plaintext\" data-theme=\"github-dark-dimmed\"><span data-line=\"\"><span>60 * 60 * 1000</span></span></code></span></td><td>セッションタイムアウト（1時間）</td></tr><tr><td><span data-rehype-pretty-code-figure=\"\"><code data-language=\"plaintext\" data-theme=\"github-dark-dimmed\"><span data-line=\"\"><span>ADMIN_EMAILS</span></span></code></span></td><td>環境変数から取得</td><td>管理者メールアドレスリスト</td></tr></tbody></table></div>\n<p><strong>型定義:</strong></p>\n<figure class=\"mdn-code\" data-rehype-pretty-code-figure=\"\"><div class=\"mdn-code-header\"><div class=\"mdn-code-lang\">TS</div><div class=\"mdn-code-actions\"><button type=\"button\" class=\"mdn-code-copy\" aria-label=\"Copy code to clipboard\">Copy</button></div></div><pre tabindex=\"0\" data-language=\"typescript\" data-theme=\"github-dark-dimmed\"><code data-language=\"typescript\" data-theme=\"github-dark-dimmed\" style=\"display: grid;\"><span data-line=\"\"><span style=\"color:#F47067\">type</span><span style=\"color:#F69D50\"> BeforeLogoutCallback</span><span style=\"color:#F47067\"> =</span><span style=\"color:#ADBAC7\"> () </span><span style=\"color:#F47067\">=></span><span style=\"color:#6CB6FF\"> void</span><span style=\"color:#F47067\"> |</span><span style=\"color:#F69D50\"> Promise</span><span style=\"color:#ADBAC7\">&#x3C;</span><span style=\"color:#6CB6FF\">void</span><span style=\"color:#ADBAC7\">></span></span>\n<span data-line=\"\"> </span>\n<span data-line=\"\"><span style=\"color:#F47067\">type</span><span style=\"color:#F69D50\"> AdminAuthContextType</span><span style=\"color:#F47067\"> =</span><span style=\"color:#ADBAC7\"> {</span></span>\n<span data-line=\"\"><span style=\"color:#F69D50\">  isAdmin</span><span style=\"color:#F47067\">:</span><span style=\"color:#6CB6FF\"> boolean</span><span style=\"color:#768390\">           // 管理者かどうか</span></span>\n<span data-line=\"\"><span style=\"color:#F69D50\">  user</span><span style=\"color:#F47067\">:</span><span style=\"color:#F69D50\"> User</span><span style=\"color:#F47067\"> |</span><span style=\"color:#6CB6FF\"> null</span><span style=\"color:#768390\">          // Firebaseユーザー</span></span>\n<span data-line=\"\"><span style=\"color:#F69D50\">  idToken</span><span style=\"color:#F47067\">:</span><span style=\"color:#6CB6FF\"> string</span><span style=\"color:#F47067\"> |</span><span style=\"color:#6CB6FF\"> null</span><span style=\"color:#768390\">     // Firebase IDトークン</span></span>\n<span data-line=\"\"><span style=\"color:#F69D50\">  isLoading</span><span style=\"color:#F47067\">:</span><span style=\"color:#6CB6FF\"> boolean</span><span style=\"color:#768390\">         // 認証状態読み込み中</span></span>\n<span data-line=\"\"><span style=\"color:#F69D50\">  sessionExpiresAt</span><span style=\"color:#F47067\">:</span><span style=\"color:#6CB6FF\"> number</span><span style=\"color:#F47067\"> |</span><span style=\"color:#6CB6FF\"> null</span><span style=\"color:#768390\">  // セッション期限</span></span>\n<span data-line=\"\"><span style=\"color:#DCBDFB\">  loginWithGoogle</span><span style=\"color:#F47067\">:</span><span style=\"color:#ADBAC7\"> () </span><span style=\"color:#F47067\">=></span><span style=\"color:#F69D50\"> Promise</span><span style=\"color:#ADBAC7\">&#x3C;</span><span style=\"color:#6CB6FF\">boolean</span><span style=\"color:#ADBAC7\">>  </span><span style=\"color:#768390\">// Googleログイン</span></span>\n<span data-line=\"\"><span style=\"color:#DCBDFB\">  logout</span><span style=\"color:#F47067\">:</span><span style=\"color:#ADBAC7\"> () </span><span style=\"color:#F47067\">=></span><span style=\"color:#F69D50\"> Promise</span><span style=\"color:#ADBAC7\">&#x3C;</span><span style=\"color:#6CB6FF\">void</span><span style=\"color:#ADBAC7\">>              </span><span style=\"color:#768390\">// ログアウト</span></span>\n<span data-line=\"\"><span style=\"color:#DCBDFB\">  registerBeforeLogout</span><span style=\"color:#F47067\">:</span><span style=\"color:#ADBAC7\"> (</span><span style=\"color:#F69D50\">callback</span><span style=\"color:#F47067\">:</span><span style=\"color:#F69D50\"> BeforeLogoutCallback</span><span style=\"color:#ADBAC7\">) </span><span style=\"color:#F47067\">=></span><span style=\"color:#ADBAC7\"> () </span><span style=\"color:#F47067\">=></span><span style=\"color:#6CB6FF\"> void</span></span>\n<span data-line=\"\"><span style=\"color:#ADBAC7\">}</span></span></code></pre></figure>\n<p><strong>関数:</strong></p>\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n<div class=\"table-wrapper\"><table><thead><tr><th>関数名</th><th>説明</th></tr></thead><tbody><tr><td><span data-rehype-pretty-code-figure=\"\"><code data-language=\"plaintext\" data-theme=\"github-dark-dimmed\"><span data-line=\"\"><span>AdminAuthProvider({ children })</span></span></code></span></td><td>認証コンテキストプロバイダー</td></tr><tr><td><span data-rehype-pretty-code-figure=\"\"><code data-language=\"plaintext\" data-theme=\"github-dark-dimmed\"><span data-line=\"\"><span>useAdminAuth()</span></span></code></span></td><td>認証コンテキストを取得するフック</td></tr><tr><td><span data-rehype-pretty-code-figure=\"\"><code data-language=\"plaintext\" data-theme=\"github-dark-dimmed\"><span data-line=\"\"><span>loginWithGoogle()</span></span></code></span></td><td>Googleポップアップでログイン。管理者でなければ即サインアウト</td></tr><tr><td><span data-rehype-pretty-code-figure=\"\"><code data-language=\"plaintext\" data-theme=\"github-dark-dimmed\"><span data-line=\"\"><span>logout(skipCallbacks?)</span></span></code></span></td><td>ログアウト処理。登録済みコールバックを先に実行</td></tr><tr><td><span data-rehype-pretty-code-figure=\"\"><code data-language=\"plaintext\" data-theme=\"github-dark-dimmed\"><span data-line=\"\"><span>startSessionTimeout()</span></span></code></span></td><td>1時間のセッションタイムアウトを設定</td></tr><tr><td><span data-rehype-pretty-code-figure=\"\"><code data-language=\"plaintext\" data-theme=\"github-dark-dimmed\"><span data-line=\"\"><span>registerBeforeLogout(callback)</span></span></code></span></td><td>ログアウト前に実行するコールバックを登録</td></tr></tbody></table></div>\n<p><strong>機能:</strong></p>\n<ul>\n<li>Firebase認証状態の監視（<span data-rehype-pretty-code-figure=\"\"><code data-language=\"plaintext\" data-theme=\"github-dark-dimmed\"><span data-line=\"\"><span>onAuthStateChanged</span></span></code></span>）</li>\n<li>IDトークンの自動更新（50分ごと）</li>\n<li>1時間のセッションタイムアウト</li>\n<li>ページリロード時のセッション維持</li>\n<li>ログアウト前コールバックシステム（下書き自動保存用）</li>\n</ul>\n<br>\n<h2 id=\"コンポーネント\">コンポーネント</h2>\n<h3 id=\"animatedroutestsx\">AnimatedRoutes.tsx</h3>\n<p>ルーティングとページ遷移アニメーションを管理。</p>\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n<div class=\"table-wrapper\"><table><thead><tr><th>定数名</th><th>値</th><th>説明</th></tr></thead><tbody><tr><td><span data-rehype-pretty-code-figure=\"\"><code data-language=\"plaintext\" data-theme=\"github-dark-dimmed\"><span data-line=\"\"><span>TRANSITION_DURATION</span></span></code></span></td><td><span data-rehype-pretty-code-figure=\"\"><code data-language=\"plaintext\" data-theme=\"github-dark-dimmed\"><span data-line=\"\"><span>400</span></span></code></span></td><td>CSSTransitionのタイムアウト（ms）</td></tr><tr><td><span data-rehype-pretty-code-figure=\"\"><code data-language=\"plaintext\" data-theme=\"github-dark-dimmed\"><span data-line=\"\"><span>ROUTE_TRANSITIONING_DURATION</span></span></code></span></td><td><span data-rehype-pretty-code-figure=\"\"><code data-language=\"plaintext\" data-theme=\"github-dark-dimmed\"><span data-line=\"\"><span>500</span></span></code></span></td><td>遷移中クラス付与時間（ms）</td></tr></tbody></table></div>\n<p><strong>遅延読み込みルート:</strong></p>\n<figure class=\"mdn-code\" data-rehype-pretty-code-figure=\"\"><div class=\"mdn-code-header\"><div class=\"mdn-code-lang\">TS</div><div class=\"mdn-code-actions\"><button type=\"button\" class=\"mdn-code-copy\" aria-label=\"Copy code to clipboard\">Copy</button></div></div><pre tabindex=\"0\" data-language=\"typescript\" data-theme=\"github-dark-dimmed\"><code data-language=\"typescript\" data-theme=\"github-dark-dimmed\" style=\"display: grid;\"><span data-line=\"\"><span style=\"color:#F47067\">const</span><span style=\"color:#DCBDFB\"> loadHome</span><span style=\"color:#F47067\"> =</span><span style=\"color:#ADBAC7\"> () </span><span style=\"color:#F47067\">=></span><span style=\"color:#F47067\"> import</span><span style=\"color:#ADBAC7\">(</span><span style=\"color:#96D0FF\">'../routes/Home'</span><span style=\"color:#ADBAC7\">)</span></span>\n<span data-line=\"\"><span style=\"color:#F47067\">const</span><span style=\"color:#DCBDFB\"> loadPosts</span><span style=\"color:#F47067\"> =</span><span style=\"color:#ADBAC7\"> () </span><span style=\"color:#F47067\">=></span><span style=\"color:#F47067\"> import</span><span style=\"color:#ADBAC7\">(</span><span style=\"color:#96D0FF\">'../routes/Posts'</span><span style=\"color:#ADBAC7\">)</span></span>\n<span data-line=\"\"><span style=\"color:#F47067\">const</span><span style=\"color:#DCBDFB\"> loadPostDetail</span><span style=\"color:#F47067\"> =</span><span style=\"color:#ADBAC7\"> () </span><span style=\"color:#F47067\">=></span><span style=\"color:#F47067\"> import</span><span style=\"color:#ADBAC7\">(</span><span style=\"color:#96D0FF\">'../routes/PostDetail'</span><span style=\"color:#ADBAC7\">)</span></span>\n<span data-line=\"\"><span style=\"color:#F47067\">const</span><span style=\"color:#DCBDFB\"> loadProducts</span><span style=\"color:#F47067\"> =</span><span style=\"color:#ADBAC7\"> () </span><span style=\"color:#F47067\">=></span><span style=\"color:#F47067\"> import</span><span style=\"color:#ADBAC7\">(</span><span style=\"color:#96D0FF\">'../routes/Products'</span><span style=\"color:#ADBAC7\">)</span></span>\n<span data-line=\"\"><span style=\"color:#F47067\">const</span><span style=\"color:#DCBDFB\"> loadProductDetail</span><span style=\"color:#F47067\"> =</span><span style=\"color:#ADBAC7\"> () </span><span style=\"color:#F47067\">=></span><span style=\"color:#F47067\"> import</span><span style=\"color:#ADBAC7\">(</span><span style=\"color:#96D0FF\">'../routes/ProductDetail'</span><span style=\"color:#ADBAC7\">)</span></span>\n<span data-line=\"\"><span style=\"color:#F47067\">const</span><span style=\"color:#DCBDFB\"> loadPhotos</span><span style=\"color:#F47067\"> =</span><span style=\"color:#ADBAC7\"> () </span><span style=\"color:#F47067\">=></span><span style=\"color:#F47067\"> import</span><span style=\"color:#ADBAC7\">(</span><span style=\"color:#96D0FF\">'../routes/Photos'</span><span style=\"color:#ADBAC7\">)</span></span>\n<span data-line=\"\"><span style=\"color:#F47067\">const</span><span style=\"color:#DCBDFB\"> loadBBSList</span><span style=\"color:#F47067\"> =</span><span style=\"color:#ADBAC7\"> () </span><span style=\"color:#F47067\">=></span><span style=\"color:#F47067\"> import</span><span style=\"color:#ADBAC7\">(</span><span style=\"color:#96D0FF\">'../routes/BBSList'</span><span style=\"color:#ADBAC7\">)</span></span>\n<span data-line=\"\"><span style=\"color:#F47067\">const</span><span style=\"color:#DCBDFB\"> loadBBSThread</span><span style=\"color:#F47067\"> =</span><span style=\"color:#ADBAC7\"> () </span><span style=\"color:#F47067\">=></span><span style=\"color:#F47067\"> import</span><span style=\"color:#ADBAC7\">(</span><span style=\"color:#96D0FF\">'../routes/BBSThread'</span><span style=\"color:#ADBAC7\">)</span></span>\n<span data-line=\"\"><span style=\"color:#F47067\">const</span><span style=\"color:#DCBDFB\"> loadPostEditor</span><span style=\"color:#F47067\"> =</span><span style=\"color:#ADBAC7\"> () </span><span style=\"color:#F47067\">=></span><span style=\"color:#F47067\"> import</span><span style=\"color:#ADBAC7\">(</span><span style=\"color:#96D0FF\">'../routes/admin/PostEditor'</span><span style=\"color:#ADBAC7\">)</span></span>\n<span data-line=\"\"><span style=\"color:#F47067\">const</span><span style=\"color:#DCBDFB\"> loadProductEditor</span><span style=\"color:#F47067\"> =</span><span style=\"color:#ADBAC7\"> () </span><span style=\"color:#F47067\">=></span><span style=\"color:#F47067\"> import</span><span style=\"color:#ADBAC7\">(</span><span style=\"color:#96D0FF\">'../routes/admin/ProductEditor'</span><span style=\"color:#ADBAC7\">)</span></span></code></pre></figure>\n<p><strong>機能:</strong></p>\n<ul>\n<li>React.lazyによる全ルートの遅延読み込み</li>\n<li><span data-rehype-pretty-code-figure=\"\"><code data-language=\"plaintext\" data-theme=\"github-dark-dimmed\"><span data-line=\"\"><span>requestIdleCallback</span></span></code></span>を使用した全ルートの事前プリロード</li>\n<li>nodeRefキャッシュによるCSSTransitionの最適化</li>\n<li>遷移中に<span data-rehype-pretty-code-figure=\"\"><code data-language=\"plaintext\" data-theme=\"github-dark-dimmed\"><span data-line=\"\"><span>route-transitioning</span></span></code></span>クラスを付与</li>\n</ul>\n<h3 id=\"globalbackgroundtsx\">GlobalBackground.tsx</h3>\n<p>レスポンシブ背景画像を管理。</p>\n<figure class=\"mdn-code\" data-rehype-pretty-code-figure=\"\"><div class=\"mdn-code-header\"><div class=\"mdn-code-lang\">TS</div><div class=\"mdn-code-actions\"><button type=\"button\" class=\"mdn-code-copy\" aria-label=\"Copy code to clipboard\">Copy</button></div></div><pre tabindex=\"0\" data-language=\"typescript\" data-theme=\"github-dark-dimmed\"><code data-language=\"typescript\" data-theme=\"github-dark-dimmed\" style=\"display: grid;\"><span data-line=\"\"><span style=\"color:#F47067\">const</span><span style=\"color:#6CB6FF\"> BACKGROUND_SRC</span><span style=\"color:#F47067\"> =</span><span style=\"color:#96D0FF\"> '/background-1920.webp'</span></span>\n<span data-line=\"\"><span style=\"color:#F47067\">const</span><span style=\"color:#6CB6FF\"> BACKGROUND_SRCSET</span><span style=\"color:#F47067\"> =</span><span style=\"color:#ADBAC7\"> [</span></span>\n<span data-line=\"\"><span style=\"color:#96D0FF\">  '/background-1280.webp 1280w'</span><span style=\"color:#ADBAC7\">,</span></span>\n<span data-line=\"\"><span style=\"color:#96D0FF\">  '/background-1920.webp 1920w'</span><span style=\"color:#ADBAC7\">,</span></span>\n<span data-line=\"\"><span style=\"color:#96D0FF\">  '/background-2560.webp 2560w'</span><span style=\"color:#ADBAC7\">,</span></span>\n<span data-line=\"\"><span style=\"color:#96D0FF\">  '/background-3840.webp 3840w'</span><span style=\"color:#ADBAC7\">,</span></span>\n<span data-line=\"\"><span style=\"color:#ADBAC7\">].</span><span style=\"color:#DCBDFB\">join</span><span style=\"color:#ADBAC7\">(</span><span style=\"color:#96D0FF\">', '</span><span style=\"color:#ADBAC7\">)</span></span></code></pre></figure>\n<p><strong>機能:</strong></p>\n<ul>\n<li>srcsetによるレスポンシブ画像読み込み</li>\n<li>パスに応じた透明度変更（<span data-rehype-pretty-code-figure=\"\"><code data-language=\"plaintext\" data-theme=\"github-dark-dimmed\"><span data-line=\"\"><span>/</span></span></code></span>では1、それ以外では0.45）</li>\n<li>CSS変数による動的ブラー・スケール適用</li>\n</ul>\n<h3 id=\"scrolltophomeswitchtsx\">ScrollTopHomeSwitch.tsx</h3>\n<p>スクロール/スワイプジェスチャーで<span data-rehype-pretty-code-figure=\"\"><code data-language=\"plaintext\" data-theme=\"github-dark-dimmed\"><span data-line=\"\"><span>/</span></span></code></span>と<span data-rehype-pretty-code-figure=\"\"><code data-language=\"plaintext\" data-theme=\"github-dark-dimmed\"><span data-line=\"\"><span>/home</span></span></code></span>間を切り替え。</p>\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n<div class=\"table-wrapper\"><table><thead><tr><th>定数名</th><th>値</th><th>説明</th></tr></thead><tbody><tr><td><span data-rehype-pretty-code-figure=\"\"><code data-language=\"plaintext\" data-theme=\"github-dark-dimmed\"><span data-line=\"\"><span>TOP_PATH</span></span></code></span></td><td><span data-rehype-pretty-code-figure=\"\"><code data-language=\"plaintext\" data-theme=\"github-dark-dimmed\"><span data-line=\"\"><span>'/'</span></span></code></span></td><td>トップページパス</td></tr><tr><td><span data-rehype-pretty-code-figure=\"\"><code data-language=\"plaintext\" data-theme=\"github-dark-dimmed\"><span data-line=\"\"><span>HOME_PATH</span></span></code></span></td><td><span data-rehype-pretty-code-figure=\"\"><code data-language=\"plaintext\" data-theme=\"github-dark-dimmed\"><span data-line=\"\"><span>'/home'</span></span></code></span></td><td>ホームページパス</td></tr></tbody></table></div>\n<p><strong>機能:</strong></p>\n<ul>\n<li>ホイールスクロールで累積値120px以上で遷移</li>\n<li>タッチスワイプで72px以上で遷移</li>\n<li>900msのクールダウン</li>\n<li>入力要素やカスタム属性付き要素は無視</li>\n</ul>\n<h3 id=\"accesscountertsx\">AccessCounter.tsx</h3>\n<p>PV（ページビュー）カウンターを表示。</p>\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n<div class=\"table-wrapper\"><table><thead><tr><th>定数名</th><th>値</th><th>説明</th></tr></thead><tbody><tr><td><span data-rehype-pretty-code-figure=\"\"><code data-language=\"plaintext\" data-theme=\"github-dark-dimmed\"><span data-line=\"\"><span>API_ENDPOINT</span></span></code></span></td><td><span data-rehype-pretty-code-figure=\"\"><code data-language=\"plaintext\" data-theme=\"github-dark-dimmed\"><span data-line=\"\"><span>'/api/pv'</span></span></code></span></td><td>PVカウントAPI</td></tr><tr><td><span data-rehype-pretty-code-figure=\"\"><code data-language=\"plaintext\" data-theme=\"github-dark-dimmed\"><span data-line=\"\"><span>CACHE_KEY</span></span></code></span></td><td><span data-rehype-pretty-code-figure=\"\"><code data-language=\"plaintext\" data-theme=\"github-dark-dimmed\"><span data-line=\"\"><span>'haroin-pv-last'</span></span></code></span></td><td>localStorageキャッシュキー</td></tr></tbody></table></div>\n<p><strong>機能:</strong></p>\n<ul>\n<li>初回レンダリング時にAPIへPOSTリクエスト</li>\n<li>localStorageにカウントをキャッシュ</li>\n<li>オフライン時はキャッシュ値を表示</li>\n</ul>\n<h3 id=\"prefetchlinktsx\">PrefetchLink.tsx</h3>\n<p>ホバー/フォーカス時にルートチャンクをプリフェッチするリンクコンポーネント。</p>\n<figure class=\"mdn-code\" data-rehype-pretty-code-figure=\"\"><div class=\"mdn-code-header\"><div class=\"mdn-code-lang\">TS</div><div class=\"mdn-code-actions\"><button type=\"button\" class=\"mdn-code-copy\" aria-label=\"Copy code to clipboard\">Copy</button></div></div><pre tabindex=\"0\" data-language=\"typescript\" data-theme=\"github-dark-dimmed\"><code data-language=\"typescript\" data-theme=\"github-dark-dimmed\" style=\"display: grid;\"><span data-line=\"\"><span style=\"color:#F47067\">interface</span><span style=\"color:#F69D50\"> PrefetchLinkProps</span><span style=\"color:#F47067\"> extends</span><span style=\"color:#6CB6FF\"> LinkProps</span><span style=\"color:#ADBAC7\"> {</span></span>\n<span data-line=\"\"><span style=\"color:#F69D50\">  enablePrefetch</span><span style=\"color:#F47067\">?:</span><span style=\"color:#6CB6FF\"> boolean</span><span style=\"color:#768390\">  // プリフェッチを有効にするか（デフォルト: true）</span></span>\n<span data-line=\"\"><span style=\"color:#ADBAC7\">}</span></span></code></pre></figure>\n<p><strong>機能:</strong></p>\n<ul>\n<li>ホバー・フォーカスでルートチャンクを動的インポート</li>\n<li>一度プリフェッチしたらスキップ</li>\n</ul>\n<h3 id=\"lightboxtsx\">Lightbox.tsx</h3>\n<p>画像モーダル（ライトボックス）コンポーネント。</p>\n<figure class=\"mdn-code\" data-rehype-pretty-code-figure=\"\"><div class=\"mdn-code-header\"><div class=\"mdn-code-lang\">TS</div><div class=\"mdn-code-actions\"><button type=\"button\" class=\"mdn-code-copy\" aria-label=\"Copy code to clipboard\">Copy</button></div></div><pre tabindex=\"0\" data-language=\"typescript\" data-theme=\"github-dark-dimmed\"><code data-language=\"typescript\" data-theme=\"github-dark-dimmed\" style=\"display: grid;\"><span data-line=\"\"><span style=\"color:#F47067\">type</span><span style=\"color:#F69D50\"> LightboxProps</span><span style=\"color:#F47067\"> =</span><span style=\"color:#ADBAC7\"> {</span></span>\n<span data-line=\"\"><span style=\"color:#F69D50\">  isOpen</span><span style=\"color:#F47067\">:</span><span style=\"color:#6CB6FF\"> boolean</span><span style=\"color:#768390\">           // モーダル表示状態</span></span>\n<span data-line=\"\"><span style=\"color:#DCBDFB\">  onClose</span><span style=\"color:#F47067\">:</span><span style=\"color:#ADBAC7\"> () </span><span style=\"color:#F47067\">=></span><span style=\"color:#6CB6FF\"> void</span><span style=\"color:#768390\">       // 閉じるコールバック</span></span>\n<span data-line=\"\"><span style=\"color:#F69D50\">  imageSrc</span><span style=\"color:#F47067\">:</span><span style=\"color:#6CB6FF\"> string</span><span style=\"color:#768390\">          // 画像URL</span></span>\n<span data-line=\"\"><span style=\"color:#F69D50\">  imageAlt</span><span style=\"color:#F47067\">:</span><span style=\"color:#6CB6FF\"> string</span><span style=\"color:#768390\">          // 画像alt</span></span>\n<span data-line=\"\"><span style=\"color:#F69D50\">  children</span><span style=\"color:#F47067\">?:</span><span style=\"color:#F69D50\"> React</span><span style=\"color:#ADBAC7\">.</span><span style=\"color:#F69D50\">ReactNode</span><span style=\"color:#768390\">  // 追加コンテンツ</span></span>\n<span data-line=\"\"><span style=\"color:#ADBAC7\">}</span></span></code></pre></figure>\n<p><strong>機能:</strong></p>\n<ul>\n<li>Escapeキーで閉じる</li>\n<li>背景クリックで閉じる</li>\n<li>閉じるボタン</li>\n<li>画像下に追加情報を表示可能</li>\n</ul>\n<h3 id=\"mermaidrenderertsx\">MermaidRenderer.tsx</h3>\n<p>Mermaidダイアグラムをレンダリング。</p>\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n<div class=\"table-wrapper\"><table><thead><tr><th>コンポーネント名</th><th>Props</th><th>説明</th></tr></thead><tbody><tr><td><span data-rehype-pretty-code-figure=\"\"><code data-language=\"plaintext\" data-theme=\"github-dark-dimmed\"><span data-line=\"\"><span>MermaidRenderer</span></span></code></span></td><td><span data-rehype-pretty-code-figure=\"\"><code data-language=\"plaintext\" data-theme=\"github-dark-dimmed\"><span data-line=\"\"><span>{ chart, className }</span></span></code></span></td><td>Mermaidコードをレンダリング</td></tr><tr><td><span data-rehype-pretty-code-figure=\"\"><code data-language=\"plaintext\" data-theme=\"github-dark-dimmed\"><span data-line=\"\"><span>MermaidBlock</span></span></code></span></td><td><span data-rehype-pretty-code-figure=\"\"><code data-language=\"plaintext\" data-theme=\"github-dark-dimmed\"><span data-line=\"\"><span>{ code }</span></span></code></span></td><td>Markdownから抽出されたMermaidブロック用ラッパー</td></tr></tbody></table></div>\n<p><strong>機能:</strong></p>\n<ul>\n<li>mermaidライブラリを使用した非同期レンダリング</li>\n<li>ダークテーマ設定</li>\n<li>エラー時はエラーメッセージと元コードを表示</li>\n</ul>\n<br>\n<h2 id=\"ページコンポーネント\">ページコンポーネント</h2>\n<h3 id=\"hometsx\">Home.tsx</h3>\n<p>ホームページ（コンテンツ一覧）。</p>\n<figure class=\"mdn-code\" data-rehype-pretty-code-figure=\"\"><div class=\"mdn-code-header\"><div class=\"mdn-code-lang\">TS</div><div class=\"mdn-code-actions\"><button type=\"button\" class=\"mdn-code-copy\" aria-label=\"Copy code to clipboard\">Copy</button></div></div><pre tabindex=\"0\" data-language=\"typescript\" data-theme=\"github-dark-dimmed\"><code data-language=\"typescript\" data-theme=\"github-dark-dimmed\" style=\"display: grid;\"><span data-line=\"\"><span style=\"color:#F47067\">type</span><span style=\"color:#F69D50\"> Interest</span><span style=\"color:#F47067\"> =</span><span style=\"color:#ADBAC7\"> { </span><span style=\"color:#F69D50\">title</span><span style=\"color:#F47067\">:</span><span style=\"color:#6CB6FF\"> string</span><span style=\"color:#ADBAC7\">; </span><span style=\"color:#F69D50\">text</span><span style=\"color:#F47067\">:</span><span style=\"color:#6CB6FF\"> string</span><span style=\"color:#ADBAC7\"> }</span></span>\n<span data-line=\"\"><span style=\"color:#F47067\">type</span><span style=\"color:#F69D50\"> PostMeta</span><span style=\"color:#F47067\"> =</span><span style=\"color:#ADBAC7\"> { </span><span style=\"color:#F69D50\">slug</span><span style=\"color:#F47067\">?:</span><span style=\"color:#6CB6FF\"> string</span><span style=\"color:#ADBAC7\">; </span><span style=\"color:#F69D50\">title</span><span style=\"color:#F47067\">?:</span><span style=\"color:#6CB6FF\"> string</span><span style=\"color:#ADBAC7\">; </span><span style=\"color:#F69D50\">createdAt</span><span style=\"color:#F47067\">?:</span><span style=\"color:#6CB6FF\"> string</span><span style=\"color:#ADBAC7\"> }</span></span></code></pre></figure>\n<p><strong>機能:</strong></p>\n<ul>\n<li>Interests（興味分野）の折りたたみ表示</li>\n<li>最新記事5件の表示</li>\n<li>Products, Photos, BBSへのリンク</li>\n<li>フッター（AccessCounter、SNSリンク）</li>\n</ul>\n<h3 id=\"poststsx\">Posts.tsx</h3>\n<p>記事一覧ページ。</p>\n<p><strong>機能:</strong></p>\n<ul>\n<li>CMS APIから記事一覧を取得（フォールバック: 静的JSON）</li>\n<li>タグによるフィルタリング</li>\n<li>管理者UI（新規作成、編集、ログアウト）</li>\n</ul>\n<h3 id=\"postdetailtsx\">PostDetail.tsx</h3>\n<p>記事詳細ページ。</p>\n<p><strong>機能:</strong></p>\n<ul>\n<li>Mermaidダイアグラムのレンダリング</li>\n<li>コードブロックのコピーボタン</li>\n<li>スクロールに応じた背景ブラー効果</li>\n<li>Good（いいね）機能</li>\n<li>X（Twitter）シェアボタン</li>\n<li>OGP/Twitterカードのメタタグ設定</li>\n</ul>\n<h3 id=\"bbslisttsx--bbsthreadtsx\">BBSList.tsx / BBSThread.tsx</h3>\n<p>BBS（掲示板）機能。</p>\n<p><strong>BBSList機能:</strong></p>\n<ul>\n<li>スレッド一覧表示</li>\n<li>スレッド作成フォーム</li>\n<li>管理者ログイン/ログアウト</li>\n<li>管理者によるスレッド削除</li>\n</ul>\n<p><strong>BBSThread機能:</strong></p>\n<ul>\n<li>投稿一覧表示</li>\n<li>アンカーリンク（>>数字）のクリックでスムーズスクロール</li>\n<li>投稿フォーム</li>\n<li>管理者による投稿削除</li>\n</ul>\n<br>\n<h2 id=\"管理者機能\">管理者機能</h2>\n<h3 id=\"posteditortsx\">PostEditor.tsx</h3>\n<p>記事編集ページ。</p>\n<figure class=\"mdn-code\" data-rehype-pretty-code-figure=\"\"><div class=\"mdn-code-header\"><div class=\"mdn-code-lang\">TS</div><div class=\"mdn-code-actions\"><button type=\"button\" class=\"mdn-code-copy\" aria-label=\"Copy code to clipboard\">Copy</button></div></div><pre tabindex=\"0\" data-language=\"typescript\" data-theme=\"github-dark-dimmed\"><code data-language=\"typescript\" data-theme=\"github-dark-dimmed\" style=\"display: grid;\"><span data-line=\"\"><span style=\"color:#F47067\">type</span><span style=\"color:#F69D50\"> PostData</span><span style=\"color:#F47067\"> =</span><span style=\"color:#ADBAC7\"> {</span></span>\n<span data-line=\"\"><span style=\"color:#F69D50\">  slug</span><span style=\"color:#F47067\">:</span><span style=\"color:#6CB6FF\"> string</span></span>\n<span data-line=\"\"><span style=\"color:#F69D50\">  title</span><span style=\"color:#F47067\">:</span><span style=\"color:#6CB6FF\"> string</span></span>\n<span data-line=\"\"><span style=\"color:#F69D50\">  summary</span><span style=\"color:#F47067\">:</span><span style=\"color:#6CB6FF\"> string</span></span>\n<span data-line=\"\"><span style=\"color:#F69D50\">  markdown</span><span style=\"color:#F47067\">:</span><span style=\"color:#6CB6FF\"> string</span></span>\n<span data-line=\"\"><span style=\"color:#F69D50\">  html</span><span style=\"color:#F47067\">:</span><span style=\"color:#6CB6FF\"> string</span></span>\n<span data-line=\"\"><span style=\"color:#F69D50\">  tags</span><span style=\"color:#F47067\">:</span><span style=\"color:#6CB6FF\"> string</span><span style=\"color:#ADBAC7\">[]</span></span>\n<span data-line=\"\"><span style=\"color:#F69D50\">  createdAt</span><span style=\"color:#F47067\">:</span><span style=\"color:#6CB6FF\"> string</span></span>\n<span data-line=\"\"><span style=\"color:#F69D50\">  updatedAt</span><span style=\"color:#F47067\">:</span><span style=\"color:#6CB6FF\"> string</span></span>\n<span data-line=\"\"><span style=\"color:#ADBAC7\">}</span></span></code></pre></figure>\n<p><strong>機能:</strong></p>\n<ul>\n<li>新規作成/編集の両対応</li>\n<li>下書きの自動保存・復元</li>\n<li>ログアウト前に下書き自動保存</li>\n<li>Markdownエディタ</li>\n<li>フォーム検証</li>\n</ul>\n<h3 id=\"markdowneditortsx\">MarkdownEditor.tsx</h3>\n<p>管理者用Markdownエディタ。</p>\n<p><strong>機能:</strong></p>\n<ul>\n<li><span data-rehype-pretty-code-figure=\"\"><code data-language=\"plaintext\" data-theme=\"github-dark-dimmed\"><span data-line=\"\"><span>@uiw/react-md-editor</span></span></code></span>ベースのエディタ</li>\n<li>ライブプレビュー</li>\n<li>Frontmatterのパースと表示</li>\n<li>Mermaidダイアグラムのプレビュー</li>\n<li>KaTeX数式のプレビュー</li>\n<li>画像のドラッグ&#x26;ドロップ/ペーストアップロード</li>\n</ul>\n<br>\n<h2 id=\"ライブラリユーティリティ\">ライブラリ・ユーティリティ</h2>\n<h3 id=\"firebasets\">firebase.ts</h3>\n<p>Firebase初期化。</p>\n<figure class=\"mdn-code\" data-rehype-pretty-code-figure=\"\"><div class=\"mdn-code-header\"><div class=\"mdn-code-lang\">TS</div><div class=\"mdn-code-actions\"><button type=\"button\" class=\"mdn-code-copy\" aria-label=\"Copy code to clipboard\">Copy</button></div></div><pre tabindex=\"0\" data-language=\"typescript\" data-theme=\"github-dark-dimmed\"><code data-language=\"typescript\" data-theme=\"github-dark-dimmed\" style=\"display: grid;\"><span data-line=\"\"><span style=\"color:#F47067\">const</span><span style=\"color:#6CB6FF\"> firebaseConfig</span><span style=\"color:#F47067\"> =</span><span style=\"color:#ADBAC7\"> {</span></span>\n<span data-line=\"\"><span style=\"color:#ADBAC7\">  apiKey: </span><span style=\"color:#F47067\">import</span><span style=\"color:#ADBAC7\">.</span><span style=\"color:#6CB6FF\">meta</span><span style=\"color:#ADBAC7\">.env.</span><span style=\"color:#6CB6FF\">VITE_FIREBASE_API_KEY</span><span style=\"color:#ADBAC7\">,</span></span>\n<span data-line=\"\"><span style=\"color:#ADBAC7\">  authDomain: </span><span style=\"color:#F47067\">import</span><span style=\"color:#ADBAC7\">.</span><span style=\"color:#6CB6FF\">meta</span><span style=\"color:#ADBAC7\">.env.</span><span style=\"color:#6CB6FF\">VITE_FIREBASE_AUTH_DOMAIN</span><span style=\"color:#ADBAC7\">,</span></span>\n<span data-line=\"\"><span style=\"color:#ADBAC7\">  projectId: </span><span style=\"color:#F47067\">import</span><span style=\"color:#ADBAC7\">.</span><span style=\"color:#6CB6FF\">meta</span><span style=\"color:#ADBAC7\">.env.</span><span style=\"color:#6CB6FF\">VITE_FIREBASE_PROJECT_ID</span><span style=\"color:#ADBAC7\">,</span></span>\n<span data-line=\"\"><span style=\"color:#ADBAC7\">  storageBucket: </span><span style=\"color:#F47067\">import</span><span style=\"color:#ADBAC7\">.</span><span style=\"color:#6CB6FF\">meta</span><span style=\"color:#ADBAC7\">.env.</span><span style=\"color:#6CB6FF\">VITE_FIREBASE_STORAGE_BUCKET</span><span style=\"color:#ADBAC7\">,</span></span>\n<span data-line=\"\"><span style=\"color:#ADBAC7\">  messagingSenderId: </span><span style=\"color:#F47067\">import</span><span style=\"color:#ADBAC7\">.</span><span style=\"color:#6CB6FF\">meta</span><span style=\"color:#ADBAC7\">.env.</span><span style=\"color:#6CB6FF\">VITE_FIREBASE_MESSAGING_SENDER_ID</span><span style=\"color:#ADBAC7\">,</span></span>\n<span data-line=\"\"><span style=\"color:#ADBAC7\">  appId: </span><span style=\"color:#F47067\">import</span><span style=\"color:#ADBAC7\">.</span><span style=\"color:#6CB6FF\">meta</span><span style=\"color:#ADBAC7\">.env.</span><span style=\"color:#6CB6FF\">VITE_FIREBASE_APP_ID</span><span style=\"color:#ADBAC7\">,</span></span>\n<span data-line=\"\"><span style=\"color:#ADBAC7\">}</span></span>\n<span data-line=\"\"> </span>\n<span data-line=\"\"><span style=\"color:#F47067\">export</span><span style=\"color:#F47067\"> const</span><span style=\"color:#6CB6FF\"> auth</span><span style=\"color:#F47067\"> =</span><span style=\"color:#DCBDFB\"> getAuth</span><span style=\"color:#ADBAC7\">(app)</span></span>\n<span data-line=\"\"><span style=\"color:#F47067\">export</span><span style=\"color:#F47067\"> const</span><span style=\"color:#6CB6FF\"> googleProvider</span><span style=\"color:#F47067\"> =</span><span style=\"color:#F47067\"> new</span><span style=\"color:#DCBDFB\"> GoogleAuthProvider</span><span style=\"color:#ADBAC7\">()</span></span></code></pre></figure>\n<h3 id=\"draftstoragets\">draftStorage.ts</h3>\n<p>下書き保存ユーティリティ。localStorageを使用。</p>\n<figure class=\"mdn-code\" data-rehype-pretty-code-figure=\"\"><div class=\"mdn-code-header\"><div class=\"mdn-code-lang\">TS</div><div class=\"mdn-code-actions\"><button type=\"button\" class=\"mdn-code-copy\" aria-label=\"Copy code to clipboard\">Copy</button></div></div><pre tabindex=\"0\" data-language=\"typescript\" data-theme=\"github-dark-dimmed\"><code data-language=\"typescript\" data-theme=\"github-dark-dimmed\" style=\"display: grid;\"><span data-line=\"\"><span style=\"color:#F47067\">export</span><span style=\"color:#F47067\"> type</span><span style=\"color:#F69D50\"> PostDraft</span><span style=\"color:#F47067\"> =</span><span style=\"color:#ADBAC7\"> {</span></span>\n<span data-line=\"\"><span style=\"color:#F69D50\">  slug</span><span style=\"color:#F47067\">:</span><span style=\"color:#6CB6FF\"> string</span></span>\n<span data-line=\"\"><span style=\"color:#F69D50\">  title</span><span style=\"color:#F47067\">:</span><span style=\"color:#6CB6FF\"> string</span></span>\n<span data-line=\"\"><span style=\"color:#F69D50\">  summary</span><span style=\"color:#F47067\">:</span><span style=\"color:#6CB6FF\"> string</span></span>\n<span data-line=\"\"><span style=\"color:#F69D50\">  tags</span><span style=\"color:#F47067\">:</span><span style=\"color:#6CB6FF\"> string</span></span>\n<span data-line=\"\"><span style=\"color:#F69D50\">  markdown</span><span style=\"color:#F47067\">:</span><span style=\"color:#6CB6FF\"> string</span></span>\n<span data-line=\"\"><span style=\"color:#F69D50\">  savedAt</span><span style=\"color:#F47067\">:</span><span style=\"color:#6CB6FF\"> number</span></span>\n<span data-line=\"\"><span style=\"color:#ADBAC7\">}</span></span></code></pre></figure>\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n<div class=\"table-wrapper\"><table><thead><tr><th>関数名</th><th>説明</th></tr></thead><tbody><tr><td><span data-rehype-pretty-code-figure=\"\"><code data-language=\"plaintext\" data-theme=\"github-dark-dimmed\"><span data-line=\"\"><span>getDraftKey(type, slug)</span></span></code></span></td><td>下書きキーを生成</td></tr><tr><td><span data-rehype-pretty-code-figure=\"\"><code data-language=\"plaintext\" data-theme=\"github-dark-dimmed\"><span data-line=\"\"><span>saveDraft&#x3C;T>(type, slug, data)</span></span></code></span></td><td>下書きを保存</td></tr><tr><td><span data-rehype-pretty-code-figure=\"\"><code data-language=\"plaintext\" data-theme=\"github-dark-dimmed\"><span data-line=\"\"><span>loadDraft&#x3C;T>(type, slug)</span></span></code></span></td><td>下書きを読み込み</td></tr><tr><td><span data-rehype-pretty-code-figure=\"\"><code data-language=\"plaintext\" data-theme=\"github-dark-dimmed\"><span data-line=\"\"><span>deleteDraft(type, slug)</span></span></code></span></td><td>下書きを削除</td></tr><tr><td><span data-rehype-pretty-code-figure=\"\"><code data-language=\"plaintext\" data-theme=\"github-dark-dimmed\"><span data-line=\"\"><span>getAllDrafts()</span></span></code></span></td><td>全下書きを取得</td></tr><tr><td><span data-rehype-pretty-code-figure=\"\"><code data-language=\"plaintext\" data-theme=\"github-dark-dimmed\"><span data-line=\"\"><span>hasDraft(type, slug)</span></span></code></span></td><td>下書きが存在するか</td></tr><tr><td><span data-rehype-pretty-code-figure=\"\"><code data-language=\"plaintext\" data-theme=\"github-dark-dimmed\"><span data-line=\"\"><span>formatDraftDate(savedAt)</span></span></code></span></td><td>保存日時をフォーマット</td></tr></tbody></table></div>\n<br>\n<h2 id=\"データファイル\">データファイル</h2>\n<h3 id=\"photosts\">photos.ts</h3>\n<p>写真データ定義。</p>\n<figure class=\"mdn-code\" data-rehype-pretty-code-figure=\"\"><div class=\"mdn-code-header\"><div class=\"mdn-code-lang\">TS</div><div class=\"mdn-code-actions\"><button type=\"button\" class=\"mdn-code-copy\" aria-label=\"Copy code to clipboard\">Copy</button></div></div><pre tabindex=\"0\" data-language=\"typescript\" data-theme=\"github-dark-dimmed\"><code data-language=\"typescript\" data-theme=\"github-dark-dimmed\" style=\"display: grid;\"><span data-line=\"\"><span style=\"color:#F47067\">export</span><span style=\"color:#F47067\"> type</span><span style=\"color:#F69D50\"> PhotoRatio</span><span style=\"color:#F47067\"> =</span><span style=\"color:#96D0FF\"> 'portrait'</span><span style=\"color:#F47067\"> |</span><span style=\"color:#96D0FF\"> 'landscape'</span><span style=\"color:#F47067\"> |</span><span style=\"color:#96D0FF\"> 'square'</span></span>\n<span data-line=\"\"> </span>\n<span data-line=\"\"><span style=\"color:#F47067\">export</span><span style=\"color:#F47067\"> type</span><span style=\"color:#F69D50\"> Photo</span><span style=\"color:#F47067\"> =</span><span style=\"color:#ADBAC7\"> {</span></span>\n<span data-line=\"\"><span style=\"color:#F69D50\">  src</span><span style=\"color:#F47067\">:</span><span style=\"color:#6CB6FF\"> string</span><span style=\"color:#768390\">      // 画像ファイルパス</span></span>\n<span data-line=\"\"><span style=\"color:#F69D50\">  title</span><span style=\"color:#F47067\">:</span><span style=\"color:#6CB6FF\"> string</span><span style=\"color:#768390\">    // 写真タイトル</span></span>\n<span data-line=\"\"><span style=\"color:#F69D50\">  location</span><span style=\"color:#F47067\">:</span><span style=\"color:#6CB6FF\"> string</span><span style=\"color:#768390\"> // 撮影場所</span></span>\n<span data-line=\"\"><span style=\"color:#F69D50\">  date</span><span style=\"color:#F47067\">:</span><span style=\"color:#6CB6FF\"> string</span><span style=\"color:#768390\">     // 撮影日（YYYY-MM-DD形式）</span></span>\n<span data-line=\"\"><span style=\"color:#F69D50\">  camera</span><span style=\"color:#F47067\">:</span><span style=\"color:#6CB6FF\"> string</span><span style=\"color:#768390\">   // カメラ種類</span></span>\n<span data-line=\"\"><span style=\"color:#F69D50\">  lens</span><span style=\"color:#F47067\">:</span><span style=\"color:#6CB6FF\"> string</span><span style=\"color:#768390\">     // レンズ情報</span></span>\n<span data-line=\"\"><span style=\"color:#F69D50\">  exposure</span><span style=\"color:#F47067\">:</span><span style=\"color:#6CB6FF\"> string</span><span style=\"color:#768390\"> // 露出情報</span></span>\n<span data-line=\"\"><span style=\"color:#F69D50\">  note</span><span style=\"color:#F47067\">:</span><span style=\"color:#6CB6FF\"> string</span><span style=\"color:#768390\">     // 写真の説明文</span></span>\n<span data-line=\"\"><span style=\"color:#F69D50\">  ratio</span><span style=\"color:#F47067\">:</span><span style=\"color:#F69D50\"> PhotoRatio</span><span style=\"color:#768390\"> // アスペクト比</span></span>\n<span data-line=\"\"><span style=\"color:#F69D50\">  tone</span><span style=\"color:#F47067\">:</span><span style=\"color:#6CB6FF\"> string</span><span style=\"color:#768390\">     // アクセントカラー（HEX形式）</span></span>\n<span data-line=\"\"><span style=\"color:#ADBAC7\">}</span></span></code></pre></figure>\n<br>\n<h2 id=\"依存関係一覧\">依存関係一覧</h2>\n<h3 id=\"react関連\">React関連</h3>\n<ul>\n<li><span data-rehype-pretty-code-figure=\"\"><code data-language=\"plaintext\" data-theme=\"github-dark-dimmed\"><span data-line=\"\"><span>react</span></span></code></span> - UIライブラリ</li>\n<li><span data-rehype-pretty-code-figure=\"\"><code data-language=\"plaintext\" data-theme=\"github-dark-dimmed\"><span data-line=\"\"><span>react-dom</span></span></code></span> - DOM操作</li>\n<li><span data-rehype-pretty-code-figure=\"\"><code data-language=\"plaintext\" data-theme=\"github-dark-dimmed\"><span data-line=\"\"><span>react-router-dom</span></span></code></span> - ルーティング</li>\n<li><span data-rehype-pretty-code-figure=\"\"><code data-language=\"plaintext\" data-theme=\"github-dark-dimmed\"><span data-line=\"\"><span>react-transition-group</span></span></code></span> - ページ遷移アニメーション</li>\n</ul>\n<h3 id=\"firebase\">Firebase</h3>\n<ul>\n<li><span data-rehype-pretty-code-figure=\"\"><code data-language=\"plaintext\" data-theme=\"github-dark-dimmed\"><span data-line=\"\"><span>firebase/app</span></span></code></span> - Firebase初期化</li>\n<li><span data-rehype-pretty-code-figure=\"\"><code data-language=\"plaintext\" data-theme=\"github-dark-dimmed\"><span data-line=\"\"><span>firebase/auth</span></span></code></span> - 認証</li>\n</ul>\n<h3 id=\"markdownコンテンツ\">Markdown/コンテンツ</h3>\n<ul>\n<li><span data-rehype-pretty-code-figure=\"\"><code data-language=\"plaintext\" data-theme=\"github-dark-dimmed\"><span data-line=\"\"><span>@uiw/react-md-editor</span></span></code></span> - Markdownエディタ</li>\n<li><span data-rehype-pretty-code-figure=\"\"><code data-language=\"plaintext\" data-theme=\"github-dark-dimmed\"><span data-line=\"\"><span>unified</span></span></code></span>, <span data-rehype-pretty-code-figure=\"\"><code data-language=\"plaintext\" data-theme=\"github-dark-dimmed\"><span data-line=\"\"><span>remark-*</span></span></code></span>, <span data-rehype-pretty-code-figure=\"\"><code data-language=\"plaintext\" data-theme=\"github-dark-dimmed\"><span data-line=\"\"><span>rehype-*</span></span></code></span> - Markdownパイプライン</li>\n<li><span data-rehype-pretty-code-figure=\"\"><code data-language=\"plaintext\" data-theme=\"github-dark-dimmed\"><span data-line=\"\"><span>mermaid</span></span></code></span> - ダイアグラム描画</li>\n<li><span data-rehype-pretty-code-figure=\"\"><code data-language=\"plaintext\" data-theme=\"github-dark-dimmed\"><span data-line=\"\"><span>rehype-katex</span></span></code></span>, <span data-rehype-pretty-code-figure=\"\"><code data-language=\"plaintext\" data-theme=\"github-dark-dimmed\"><span data-line=\"\"><span>remark-math</span></span></code></span> - 数式レンダリング</li>\n</ul>\n<h3 id=\"スタイリング\">スタイリング</h3>\n<ul>\n<li><span data-rehype-pretty-code-figure=\"\"><code data-language=\"plaintext\" data-theme=\"github-dark-dimmed\"><span data-line=\"\"><span>tailwindcss</span></span></code></span> - CSSフレームワーク</li>\n</ul>\n<hr>\n<br>\n<h2 id=\"ローカル記事のデプロイ\">ローカル記事のデプロイ</h2>\n<p>ローカル環境で作成したMarkdownファイルをCloudflare KVのCMSにデプロイするための機能について解説する。</p>\n<h3 id=\"概要\">概要</h3>\n<p>Web上のエディタだけでなく、VSCodeなどのローカルエディタで記事を書き、それをコマンド一つでCMSにデプロイできる。これにより：</p>\n<ul>\n<li>使い慣れたエディタで執筆可能</li>\n<li>Gitでの記事バージョン管理</li>\n<li>複数記事の一括デプロイ</li>\n<li>CI/CDパイプラインとの連携</li>\n</ul>\n<h3 id=\"markdownファイルの形式\">Markdownファイルの形式</h3>\n<p>記事は<span data-rehype-pretty-code-figure=\"\"><code data-language=\"plaintext\" data-theme=\"github-dark-dimmed\"><span data-line=\"\"><span>content/posts/</span></span></code></span>ディレクトリにMarkdownファイルとして配置する。</p>\n<h4 id=\"ディレクトリ構造\">ディレクトリ構造</h4>\n<figure class=\"mdn-code\" data-rehype-pretty-code-figure=\"\"><div class=\"mdn-code-header\"><div class=\"mdn-code-lang\">TEXT</div><div class=\"mdn-code-actions\"><button type=\"button\" class=\"mdn-code-copy\" aria-label=\"Copy code to clipboard\">Copy</button></div></div><pre tabindex=\"0\" data-language=\"plaintext\" data-theme=\"github-dark-dimmed\"><code data-language=\"plaintext\" data-theme=\"github-dark-dimmed\" style=\"display: grid;\"><span data-line=\"\"><span>content/</span></span>\n<span data-line=\"\"><span>└── posts/</span></span>\n<span data-line=\"\"><span>    ├── my-first-article.md</span></span>\n<span data-line=\"\"><span>    ├── react-tutorial.md</span></span>\n<span data-line=\"\"><span>    └── typescript-tips.md</span></span></code></pre></figure>\n<p>ファイル名（拡張子を除く）が記事のslug（URL識別子）になる。</p>\n<h4 id=\"frontmatterメタデータ\">frontmatter（メタデータ）</h4>\n<p>各Markdownファイルの先頭にYAML形式でメタデータを記述：</p>\n<figure class=\"mdn-code\" data-rehype-pretty-code-figure=\"\"><div class=\"mdn-code-header\"><div class=\"mdn-code-lang\">YAML</div><div class=\"mdn-code-actions\"><button type=\"button\" class=\"mdn-code-copy\" aria-label=\"Copy code to clipboard\">Copy</button></div></div><pre tabindex=\"0\" data-language=\"yaml\" data-theme=\"github-dark-dimmed\"><code data-language=\"yaml\" data-theme=\"github-dark-dimmed\" style=\"display: grid;\"><span data-line=\"\"><span style=\"color:#6CB6FF\">---</span></span>\n<span data-line=\"\"><span style=\"color:#8DDB8C\">title</span><span style=\"color:#ADBAC7\">: </span><span style=\"color:#96D0FF\">\"記事タイトル\"</span></span>\n<span data-line=\"\"><span style=\"color:#8DDB8C\">summary</span><span style=\"color:#ADBAC7\">: </span><span style=\"color:#96D0FF\">\"記事の概要（一覧ページで表示される説明文）\"</span></span>\n<span data-line=\"\"><span style=\"color:#8DDB8C\">date</span><span style=\"color:#ADBAC7\">: </span><span style=\"color:#96D0FF\">\"2025-01-15\"</span></span>\n<span data-line=\"\"><span style=\"color:#8DDB8C\">tags</span><span style=\"color:#ADBAC7\">:</span></span>\n<span data-line=\"\"><span style=\"color:#ADBAC7\">  - </span><span style=\"color:#96D0FF\">React</span></span>\n<span data-line=\"\"><span style=\"color:#ADBAC7\">  - </span><span style=\"color:#96D0FF\">TypeScript</span></span>\n<span data-line=\"\"><span style=\"color:#ADBAC7\">  - </span><span style=\"color:#96D0FF\">Tutorial</span></span>\n<span data-line=\"\"><span style=\"color:#8DDB8C\">status</span><span style=\"color:#ADBAC7\">: </span><span style=\"color:#96D0FF\">published</span><span style=\"color:#768390\">  # オプション: published または draft</span></span>\n<span data-line=\"\"><span style=\"color:#6CB6FF\">---</span></span>\n<span data-line=\"\"> </span>\n<span data-line=\"\"><span style=\"color:#96D0FF\">本文をここに書きます...</span></span></code></pre></figure>\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n<div class=\"table-wrapper\"><table><thead><tr><th>フィールド</th><th>必須</th><th>説明</th></tr></thead><tbody><tr><td><span data-rehype-pretty-code-figure=\"\"><code data-language=\"plaintext\" data-theme=\"github-dark-dimmed\"><span data-line=\"\"><span>title</span></span></code></span></td><td>◯</td><td>記事のタイトル</td></tr><tr><td><span data-rehype-pretty-code-figure=\"\"><code data-language=\"plaintext\" data-theme=\"github-dark-dimmed\"><span data-line=\"\"><span>summary</span></span></code></span></td><td>△</td><td>記事の概要（省略可）</td></tr><tr><td><span data-rehype-pretty-code-figure=\"\"><code data-language=\"plaintext\" data-theme=\"github-dark-dimmed\"><span data-line=\"\"><span>date</span></span></code></span></td><td>△</td><td>作成日（YYYY-MM-DD形式）</td></tr><tr><td><span data-rehype-pretty-code-figure=\"\"><code data-language=\"plaintext\" data-theme=\"github-dark-dimmed\"><span data-line=\"\"><span>tags</span></span></code></span></td><td>△</td><td>タグの配列</td></tr><tr><td><span data-rehype-pretty-code-figure=\"\"><code data-language=\"plaintext\" data-theme=\"github-dark-dimmed\"><span data-line=\"\"><span>status</span></span></code></span></td><td>△</td><td><span data-rehype-pretty-code-figure=\"\"><code data-language=\"plaintext\" data-theme=\"github-dark-dimmed\"><span data-line=\"\"><span>published</span></span></code></span>（公開）または <span data-rehype-pretty-code-figure=\"\"><code data-language=\"plaintext\" data-theme=\"github-dark-dimmed\"><span data-line=\"\"><span>draft</span></span></code></span>（下書き）</td></tr></tbody></table></div>\n<h3 id=\"デプロイスクリプトの使い方\">デプロイスクリプトの使い方</h3>\n<h4 id=\"firebase-idトークンの取得\">Firebase IDトークンの取得</h4>\n<p>デプロイには管理者認証が必要。ブラウザの開発者ツールで以下を実行してトークンを取得：</p>\n<figure class=\"mdn-code\" data-rehype-pretty-code-figure=\"\"><div class=\"mdn-code-header\"><div class=\"mdn-code-lang\">JS</div><div class=\"mdn-code-actions\"><button type=\"button\" class=\"mdn-code-copy\" aria-label=\"Copy code to clipboard\">Copy</button></div></div><pre tabindex=\"0\" data-language=\"javascript\" data-theme=\"github-dark-dimmed\"><code data-language=\"javascript\" data-theme=\"github-dark-dimmed\" style=\"display: grid;\"><span data-line=\"\"><span style=\"color:#768390\">// Firebaseにログイン済みの状態で実行</span></span>\n<span data-line=\"\"><span style=\"color:#F47067\">const</span><span style=\"color:#6CB6FF\"> user</span><span style=\"color:#F47067\"> =</span><span style=\"color:#ADBAC7\"> firebase.</span><span style=\"color:#DCBDFB\">auth</span><span style=\"color:#ADBAC7\">().currentUser;</span></span>\n<span data-line=\"\"><span style=\"color:#F47067\">const</span><span style=\"color:#6CB6FF\"> token</span><span style=\"color:#F47067\"> =</span><span style=\"color:#F47067\"> await</span><span style=\"color:#ADBAC7\"> user.</span><span style=\"color:#DCBDFB\">getIdToken</span><span style=\"color:#ADBAC7\">();</span></span>\n<span data-line=\"\"><span style=\"color:#ADBAC7\">console.</span><span style=\"color:#DCBDFB\">log</span><span style=\"color:#ADBAC7\">(token);</span></span></code></pre></figure>\n<h4 id=\"基本的な使い方\">基本的な使い方</h4>\n<figure class=\"mdn-code\" data-rehype-pretty-code-figure=\"\"><div class=\"mdn-code-header\"><div class=\"mdn-code-lang\">Bash</div><div class=\"mdn-code-actions\"><button type=\"button\" class=\"mdn-code-copy\" aria-label=\"Copy code to clipboard\">Copy</button></div></div><pre tabindex=\"0\" data-language=\"bash\" data-theme=\"github-dark-dimmed\"><code data-language=\"bash\" data-theme=\"github-dark-dimmed\" style=\"display: grid;\"><span data-line=\"\"><span style=\"color:#768390\"># 環境変数にトークンを設定</span></span>\n<span data-line=\"\"><span style=\"color:#F47067\">export</span><span style=\"color:#ADBAC7\"> FIREBASE_ID_TOKEN</span><span style=\"color:#F47067\">=</span><span style=\"color:#96D0FF\">\"取得したトークン\"</span></span>\n<span data-line=\"\"> </span>\n<span data-line=\"\"><span style=\"color:#768390\"># content/posts/ 配下のすべての記事をデプロイ</span></span>\n<span data-line=\"\"><span style=\"color:#F69D50\">npx</span><span style=\"color:#96D0FF\"> tsx</span><span style=\"color:#96D0FF\"> scripts/deploy-posts.ts</span></span>\n<span data-line=\"\"> </span>\n<span data-line=\"\"><span style=\"color:#768390\"># 特定のファイルのみデプロイ</span></span>\n<span data-line=\"\"><span style=\"color:#F69D50\">npx</span><span style=\"color:#96D0FF\"> tsx</span><span style=\"color:#96D0FF\"> scripts/deploy-posts.ts</span><span style=\"color:#6CB6FF\"> --file</span><span style=\"color:#96D0FF\"> content/posts/my-article.md</span></span>\n<span data-line=\"\"> </span>\n<span data-line=\"\"><span style=\"color:#768390\"># 下書きとしてデプロイ</span></span>\n<span data-line=\"\"><span style=\"color:#F69D50\">npx</span><span style=\"color:#96D0FF\"> tsx</span><span style=\"color:#96D0FF\"> scripts/deploy-posts.ts</span><span style=\"color:#6CB6FF\"> --draft</span></span>\n<span data-line=\"\"> </span>\n<span data-line=\"\"><span style=\"color:#768390\"># ドライラン（実際にはデプロイせず確認のみ）</span></span>\n<span data-line=\"\"><span style=\"color:#F69D50\">npx</span><span style=\"color:#96D0FF\"> tsx</span><span style=\"color:#96D0FF\"> scripts/deploy-posts.ts</span><span style=\"color:#6CB6FF\"> --dry-run</span></span></code></pre></figure>\n<h4 id=\"コマンドラインオプション\">コマンドラインオプション</h4>\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n<div class=\"table-wrapper\"><table><thead><tr><th>オプション</th><th>説明</th><th>例</th></tr></thead><tbody><tr><td><span data-rehype-pretty-code-figure=\"\"><code data-language=\"plaintext\" data-theme=\"github-dark-dimmed\"><span data-line=\"\"><span>--file &#x3C;path></span></span></code></span></td><td>指定したファイルのみをデプロイ</td><td><span data-rehype-pretty-code-figure=\"\"><code data-language=\"plaintext\" data-theme=\"github-dark-dimmed\"><span data-line=\"\"><span>--file content/posts/article.md</span></span></code></span></td></tr><tr><td><span data-rehype-pretty-code-figure=\"\"><code data-language=\"plaintext\" data-theme=\"github-dark-dimmed\"><span data-line=\"\"><span>--draft</span></span></code></span></td><td>下書きとしてデプロイ（frontmatterのstatusを上書き）</td><td><span data-rehype-pretty-code-figure=\"\"><code data-language=\"plaintext\" data-theme=\"github-dark-dimmed\"><span data-line=\"\"><span>--draft</span></span></code></span></td></tr><tr><td><span data-rehype-pretty-code-figure=\"\"><code data-language=\"plaintext\" data-theme=\"github-dark-dimmed\"><span data-line=\"\"><span>--dry-run</span></span></code></span></td><td>実際にはデプロイせず、処理内容を表示</td><td><span data-rehype-pretty-code-figure=\"\"><code data-language=\"plaintext\" data-theme=\"github-dark-dimmed\"><span data-line=\"\"><span>--dry-run</span></span></code></span></td></tr><tr><td><span data-rehype-pretty-code-figure=\"\"><code data-language=\"plaintext\" data-theme=\"github-dark-dimmed\"><span data-line=\"\"><span>--endpoint &#x3C;url></span></span></code></span></td><td>CMS APIのエンドポイント</td><td><span data-rehype-pretty-code-figure=\"\"><code data-language=\"plaintext\" data-theme=\"github-dark-dimmed\"><span data-line=\"\"><span>--endpoint http://localhost:8787/api/cms</span></span></code></span></td></tr><tr><td><span data-rehype-pretty-code-figure=\"\"><code data-language=\"plaintext\" data-theme=\"github-dark-dimmed\"><span data-line=\"\"><span>--token &#x3C;token></span></span></code></span></td><td>Firebase IDトークン（環境変数の代わりに指定）</td><td><span data-rehype-pretty-code-figure=\"\"><code data-language=\"plaintext\" data-theme=\"github-dark-dimmed\"><span data-line=\"\"><span>--token eyJhbGci...</span></span></code></span></td></tr></tbody></table></div>\n<h4 id=\"環境変数\">環境変数</h4>\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n<div class=\"table-wrapper\"><table><thead><tr><th>変数名</th><th>説明</th></tr></thead><tbody><tr><td><span data-rehype-pretty-code-figure=\"\"><code data-language=\"plaintext\" data-theme=\"github-dark-dimmed\"><span data-line=\"\"><span>FIREBASE_ID_TOKEN</span></span></code></span></td><td>Firebase IDトークン（認証用）</td></tr><tr><td><span data-rehype-pretty-code-figure=\"\"><code data-language=\"plaintext\" data-theme=\"github-dark-dimmed\"><span data-line=\"\"><span>CMS_ENDPOINT</span></span></code></span></td><td>CMS APIのエンドポイント（デフォルト: <a href=\"https://haroin57.com/api/cms%EF%BC%89\">https://haroin57.com/api/cms）</a></td></tr></tbody></table></div>\n<h3 id=\"使用例\">使用例</h3>\n<h4 id=\"新しい記事を書いて公開する\">新しい記事を書いて公開する</h4>\n<figure class=\"mdn-code\" data-rehype-pretty-code-figure=\"\"><div class=\"mdn-code-header\"><div class=\"mdn-code-lang\">Bash</div><div class=\"mdn-code-actions\"><button type=\"button\" class=\"mdn-code-copy\" aria-label=\"Copy code to clipboard\">Copy</button></div></div><pre tabindex=\"0\" data-language=\"bash\" data-theme=\"github-dark-dimmed\"><code data-language=\"bash\" data-theme=\"github-dark-dimmed\" style=\"display: grid;\"><span data-line=\"\"><span style=\"color:#768390\"># 1. 記事ファイルを作成</span></span>\n<span data-line=\"\"><span style=\"color:#F69D50\">cat</span><span style=\"color:#F47067\"> ></span><span style=\"color:#96D0FF\"> content/posts/new-article.md</span><span style=\"color:#F47067\"> &#x3C;&#x3C;</span><span style=\"color:#ADBAC7\"> 'EOF'</span></span>\n<span data-line=\"\"><span style=\"color:#96D0FF\">---</span></span>\n<span data-line=\"\"><span style=\"color:#96D0FF\">title: \"新しい記事\"</span></span>\n<span data-line=\"\"><span style=\"color:#96D0FF\">summary: \"この記事では...\"</span></span>\n<span data-line=\"\"><span style=\"color:#96D0FF\">date: \"2025-01-15\"</span></span>\n<span data-line=\"\"><span style=\"color:#96D0FF\">tags:</span></span>\n<span data-line=\"\"><span style=\"color:#96D0FF\">  - Tech</span></span>\n<span data-line=\"\"><span style=\"color:#96D0FF\">---</span></span>\n<span data-line=\"\"> </span>\n<span data-line=\"\"><span style=\"color:#96D0FF\">## はじめに</span></span>\n<span data-line=\"\"> </span>\n<span data-line=\"\"><span style=\"color:#96D0FF\">記事の本文をここに書きます。</span></span>\n<span data-line=\"\"><span style=\"color:#ADBAC7\">EOF</span></span>\n<span data-line=\"\"> </span>\n<span data-line=\"\"><span style=\"color:#768390\"># 2. デプロイ</span></span>\n<span data-line=\"\"><span style=\"color:#F47067\">export</span><span style=\"color:#ADBAC7\"> FIREBASE_ID_TOKEN</span><span style=\"color:#F47067\">=</span><span style=\"color:#96D0FF\">\"your-token\"</span></span>\n<span data-line=\"\"><span style=\"color:#F69D50\">npx</span><span style=\"color:#96D0FF\"> tsx</span><span style=\"color:#96D0FF\"> scripts/deploy-posts.ts</span><span style=\"color:#6CB6FF\"> --file</span><span style=\"color:#96D0FF\"> content/posts/new-article.md</span></span></code></pre></figure>\n<h4 id=\"下書きとして保存し後で公開する\">下書きとして保存し、後で公開する</h4>\n<figure class=\"mdn-code\" data-rehype-pretty-code-figure=\"\"><div class=\"mdn-code-header\"><div class=\"mdn-code-lang\">Bash</div><div class=\"mdn-code-actions\"><button type=\"button\" class=\"mdn-code-copy\" aria-label=\"Copy code to clipboard\">Copy</button></div></div><pre tabindex=\"0\" data-language=\"bash\" data-theme=\"github-dark-dimmed\"><code data-language=\"bash\" data-theme=\"github-dark-dimmed\" style=\"display: grid;\"><span data-line=\"\"><span style=\"color:#768390\"># 下書きとしてデプロイ</span></span>\n<span data-line=\"\"><span style=\"color:#F69D50\">npx</span><span style=\"color:#96D0FF\"> tsx</span><span style=\"color:#96D0FF\"> scripts/deploy-posts.ts</span><span style=\"color:#6CB6FF\"> --file</span><span style=\"color:#96D0FF\"> content/posts/draft-article.md</span><span style=\"color:#6CB6FF\"> --draft</span></span>\n<span data-line=\"\"> </span>\n<span data-line=\"\"><span style=\"color:#768390\"># 後で公開する場合は、frontmatterのstatusをpublishedに変更して再デプロイ</span></span>\n<span data-line=\"\"><span style=\"color:#768390\"># または、Webの管理画面からステータスを変更</span></span></code></pre></figure>\n<h4 id=\"すべての記事を一括更新\">すべての記事を一括更新</h4>\n<figure class=\"mdn-code\" data-rehype-pretty-code-figure=\"\"><div class=\"mdn-code-header\"><div class=\"mdn-code-lang\">Bash</div><div class=\"mdn-code-actions\"><button type=\"button\" class=\"mdn-code-copy\" aria-label=\"Copy code to clipboard\">Copy</button></div></div><pre tabindex=\"0\" data-language=\"bash\" data-theme=\"github-dark-dimmed\"><code data-language=\"bash\" data-theme=\"github-dark-dimmed\" style=\"display: grid;\"><span data-line=\"\"><span style=\"color:#768390\"># 既存の記事も含めてすべてデプロイ</span></span>\n<span data-line=\"\"><span style=\"color:#F69D50\">npx</span><span style=\"color:#96D0FF\"> tsx</span><span style=\"color:#96D0FF\"> scripts/deploy-posts.ts</span></span>\n<span data-line=\"\"> </span>\n<span data-line=\"\"><span style=\"color:#768390\"># まずドライランで確認</span></span>\n<span data-line=\"\"><span style=\"color:#F69D50\">npx</span><span style=\"color:#96D0FF\"> tsx</span><span style=\"color:#96D0FF\"> scripts/deploy-posts.ts</span><span style=\"color:#6CB6FF\"> --dry-run</span></span></code></pre></figure>\n<h3 id=\"markdownの記法\">Markdownの記法</h3>\n<p>デプロイスクリプトは、Webエディタと同じMarkdown変換処理を使用している。</p>\n<h4 id=\"サポートされる構文\">サポートされる構文</h4>\n<ul>\n<li><strong>GitHub Flavored Markdown (GFM)</strong>: テーブル、取り消し線、タスクリストなど</li>\n<li><strong>目次の自動生成</strong>: <span data-rehype-pretty-code-figure=\"\"><code data-language=\"plaintext\" data-theme=\"github-dark-dimmed\"><span data-line=\"\"><span>## 目次</span></span></code></span> という見出しの後に自動的に目次が挿入される</li>\n<li><strong>コードハイライト</strong>: シンタックスハイライト付きコードブロック</li>\n<li><strong>数式 (KaTeX)</strong>: <span data-rehype-pretty-code-figure=\"\"><code data-language=\"plaintext\" data-theme=\"github-dark-dimmed\"><span data-line=\"\"><span>$inline$</span></span></code></span> や <span data-rehype-pretty-code-figure=\"\"><code data-language=\"plaintext\" data-theme=\"github-dark-dimmed\"><span data-line=\"\"><span>$$display$$</span></span></code></span> 形式の数式</li>\n<li><strong>Mermaidダイアグラム</strong>: <span data-rehype-pretty-code-figure=\"\"><code data-language=\"plaintext\" data-theme=\"github-dark-dimmed\"><span data-line=\"\"><span>mermaid</span></span></code></span> コードブロック</li>\n<li><strong>アドモニション</strong>: <span data-rehype-pretty-code-figure=\"\"><code data-language=\"plaintext\" data-theme=\"github-dark-dimmed\"><span data-line=\"\"><span>[!NOTE]</span></span></code></span>、<span data-rehype-pretty-code-figure=\"\"><code data-language=\"plaintext\" data-theme=\"github-dark-dimmed\"><span data-line=\"\"><span>[!WARNING]</span></span></code></span>、<span data-rehype-pretty-code-figure=\"\"><code data-language=\"plaintext\" data-theme=\"github-dark-dimmed\"><span data-line=\"\"><span>[!CALLOUT]</span></span></code></span></li>\n</ul>\n<h4 id=\"アドモニションの例\">アドモニションの例</h4>\n<figure class=\"mdn-code\" data-rehype-pretty-code-figure=\"\"><div class=\"mdn-code-header\"><div class=\"mdn-code-lang\">MD</div><div class=\"mdn-code-actions\"><button type=\"button\" class=\"mdn-code-copy\" aria-label=\"Copy code to clipboard\">Copy</button></div></div><pre tabindex=\"0\" data-language=\"markdown\" data-theme=\"github-dark-dimmed\"><code data-language=\"markdown\" data-theme=\"github-dark-dimmed\" style=\"display: grid;\"><span data-line=\"\"><span style=\"color:#8DDB8C\">> [</span><span style=\"color:#96D0FF\">!NOTE</span><span style=\"color:#8DDB8C\">]</span></span>\n<span data-line=\"\"><span style=\"color:#8DDB8C\">> これはメモです。重要な情報を強調したいときに使用します。</span></span>\n<span data-line=\"\"> </span>\n<span data-line=\"\"><span style=\"color:#8DDB8C\">> [</span><span style=\"color:#96D0FF\">!WARNING</span><span style=\"color:#8DDB8C\">]</span></span>\n<span data-line=\"\"><span style=\"color:#8DDB8C\">> これは警告です。注意が必要な内容を示します。</span></span>\n<span data-line=\"\"> </span>\n<span data-line=\"\"><span style=\"color:#8DDB8C\">> [</span><span style=\"color:#96D0FF\">!CALLOUT</span><span style=\"color:#8DDB8C\">] タイトル</span></span>\n<span data-line=\"\"><span style=\"color:#8DDB8C\">> これはコールアウトです。特に目立たせたい内容に使用します。</span></span></code></pre></figure>\n<h3 id=\"トラブルシューティング\">トラブルシューティング</h3>\n<h4 id=\"認証エラー\">認証エラー</h4>\n<figure class=\"mdn-code\" data-rehype-pretty-code-figure=\"\"><div class=\"mdn-code-header\"><div class=\"mdn-code-lang\">TEXT</div><div class=\"mdn-code-actions\"><button type=\"button\" class=\"mdn-code-copy\" aria-label=\"Copy code to clipboard\">Copy</button></div></div><pre tabindex=\"0\" data-language=\"plaintext\" data-theme=\"github-dark-dimmed\"><code data-language=\"plaintext\" data-theme=\"github-dark-dimmed\" style=\"display: grid;\"><span data-line=\"\"><span>Error: unauthorized</span></span></code></pre></figure>\n<p><strong>原因</strong>: トークンが無効または期限切れ</p>\n<p><strong>対処法</strong>:</p>\n<ol>\n<li>新しいトークンを取得する</li>\n<li>トークンが正しく設定されているか確認</li>\n<li>管理者メールリストに登録されているか確認</li>\n</ol>\n<h4 id=\"frontmatterのパースエラー\">frontmatterのパースエラー</h4>\n<p><strong>原因</strong>: YAMLの形式が正しくない</p>\n<p><strong>対処法</strong>:</p>\n<ul>\n<li>インデントが正しいか確認（スペース2つ）</li>\n<li>特殊文字を含むタイトルは引用符で囲む</li>\n<li>日付は <span data-rehype-pretty-code-figure=\"\"><code data-language=\"plaintext\" data-theme=\"github-dark-dimmed\"><span data-line=\"\"><span>\"YYYY-MM-DD\"</span></span></code></span> 形式で記述</li>\n</ul>\n<h3 id=\"cicdとの連携\">CI/CDとの連携</h3>\n<p>GitHub Actionsでの自動デプロイ例：</p>\n<figure class=\"mdn-code\" data-rehype-pretty-code-figure=\"\"><div class=\"mdn-code-header\"><div class=\"mdn-code-lang\">YAML</div><div class=\"mdn-code-actions\"><button type=\"button\" class=\"mdn-code-copy\" aria-label=\"Copy code to clipboard\">Copy</button></div></div><pre tabindex=\"0\" data-language=\"yaml\" data-theme=\"github-dark-dimmed\"><code data-language=\"yaml\" data-theme=\"github-dark-dimmed\" style=\"display: grid;\"><span data-line=\"\"><span style=\"color:#8DDB8C\">name</span><span style=\"color:#ADBAC7\">: </span><span style=\"color:#96D0FF\">Deploy Posts</span></span>\n<span data-line=\"\"> </span>\n<span data-line=\"\"><span style=\"color:#6CB6FF\">on</span><span style=\"color:#ADBAC7\">:</span></span>\n<span data-line=\"\"><span style=\"color:#8DDB8C\">  push</span><span style=\"color:#ADBAC7\">:</span></span>\n<span data-line=\"\"><span style=\"color:#8DDB8C\">    paths</span><span style=\"color:#ADBAC7\">:</span></span>\n<span data-line=\"\"><span style=\"color:#ADBAC7\">      - </span><span style=\"color:#96D0FF\">'content/posts/**'</span></span>\n<span data-line=\"\"><span style=\"color:#8DDB8C\">    branches</span><span style=\"color:#ADBAC7\">:</span></span>\n<span data-line=\"\"><span style=\"color:#ADBAC7\">      - </span><span style=\"color:#96D0FF\">main</span></span>\n<span data-line=\"\"> </span>\n<span data-line=\"\"><span style=\"color:#8DDB8C\">jobs</span><span style=\"color:#ADBAC7\">:</span></span>\n<span data-line=\"\"><span style=\"color:#8DDB8C\">  deploy</span><span style=\"color:#ADBAC7\">:</span></span>\n<span data-line=\"\"><span style=\"color:#8DDB8C\">    runs-on</span><span style=\"color:#ADBAC7\">: </span><span style=\"color:#96D0FF\">ubuntu-latest</span></span>\n<span data-line=\"\"><span style=\"color:#8DDB8C\">    steps</span><span style=\"color:#ADBAC7\">:</span></span>\n<span data-line=\"\"><span style=\"color:#ADBAC7\">      - </span><span style=\"color:#8DDB8C\">uses</span><span style=\"color:#ADBAC7\">: </span><span style=\"color:#96D0FF\">actions/checkout@v4</span></span>\n<span data-line=\"\"> </span>\n<span data-line=\"\"><span style=\"color:#ADBAC7\">      - </span><span style=\"color:#8DDB8C\">uses</span><span style=\"color:#ADBAC7\">: </span><span style=\"color:#96D0FF\">actions/setup-node@v4</span></span>\n<span data-line=\"\"><span style=\"color:#8DDB8C\">        with</span><span style=\"color:#ADBAC7\">:</span></span>\n<span data-line=\"\"><span style=\"color:#8DDB8C\">          node-version</span><span style=\"color:#ADBAC7\">: </span><span style=\"color:#96D0FF\">'20'</span></span>\n<span data-line=\"\"> </span>\n<span data-line=\"\"><span style=\"color:#ADBAC7\">      - </span><span style=\"color:#8DDB8C\">run</span><span style=\"color:#ADBAC7\">: </span><span style=\"color:#96D0FF\">npm ci</span></span>\n<span data-line=\"\"> </span>\n<span data-line=\"\"><span style=\"color:#ADBAC7\">      - </span><span style=\"color:#8DDB8C\">name</span><span style=\"color:#ADBAC7\">: </span><span style=\"color:#96D0FF\">Deploy posts</span></span>\n<span data-line=\"\"><span style=\"color:#8DDB8C\">        env</span><span style=\"color:#ADBAC7\">:</span></span>\n<span data-line=\"\"><span style=\"color:#8DDB8C\">          FIREBASE_ID_TOKEN</span><span style=\"color:#ADBAC7\">: </span><span style=\"color:#96D0FF\">${{ secrets.FIREBASE_ID_TOKEN }}</span></span>\n<span data-line=\"\"><span style=\"color:#8DDB8C\">        run</span><span style=\"color:#ADBAC7\">: </span><span style=\"color:#96D0FF\">npx tsx scripts/deploy-posts.ts</span></span></code></pre></figure>\n<p><strong>注意</strong>: CI/CDでのトークン管理には注意が必要。長期間有効なサービスアカウントトークンの使用を検討すること。</p>"
  },
  {
    "slug": "jwt-security-implementation",
    "title": "README3",
    "summary": "Firebase認証、JWT検証、RS256署名、Cloudflare Workersでのセキュリティ実装を詳しく解説",
    "createdAt": "2025-12-21",
    "tags": [
      "Security",
      "JWT",
      "Firebase",
      "Cloudflare"
    ],
    "html": "<p>このサイトで実装しているセキュリティ対策を初学者向けに詳しく解説する。</p>\n<h2 id=\"目次\">目次</h2>\n<div class=\"toc-box\"><ul>\n<li><a href=\"#%E3%81%AA%E3%81%9C%E3%82%BB%E3%82%AD%E3%83%A5%E3%83%AA%E3%83%86%E3%82%A3%E3%81%8C%E5%BF%85%E8%A6%81%E3%81%AA%E3%81%AE%E3%81%8B\">なぜセキュリティが必要なのか</a></li>\n<li><a href=\"#jwtjson-web-token%E3%81%A8%E3%81%AF\">JWT（JSON Web Token）とは</a></li>\n<li><a href=\"#%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5\">基本概念</a></li>\n<li><a href=\"#jwt%E3%81%AE3%E3%81%A4%E3%81%AE%E6%A7%8B%E6%88%90%E8%A6%81%E7%B4%A0\">JWTの3つの構成要素</a></li>\n<li><a href=\"#%E3%81%AA%E3%81%9C%E7%BD%B2%E5%90%8D%E3%81%8C%E5%BF%85%E8%A6%81%E3%81%AA%E3%81%AE%E3%81%8B\">なぜ署名が必要なのか</a></li>\n<li><a href=\"#firebase%E8%AA%8D%E8%A8%BC%E3%81%AE%E4%BB%95%E7%B5%84%E3%81%BF\">Firebase認証の仕組み</a></li>\n<li><a href=\"#%E8%AA%8D%E8%A8%BC%E3%83%95%E3%83%AD%E3%83%BC%E5%85%A8%E4%BD%93%E5%83%8F\">認証フロー全体像</a></li>\n<li><a href=\"#%E3%83%95%E3%83%AD%E3%83%B3%E3%83%88%E3%82%A8%E3%83%B3%E3%83%89%E5%81%B4%E3%81%AE%E5%AE%9F%E8%A3%85\">フロントエンド側の実装</a></li>\n<li><a href=\"#%E3%82%B5%E3%83%BC%E3%83%90%E3%83%BC%E5%81%B4%E3%81%AE%E3%83%88%E3%83%BC%E3%82%AF%E3%83%B3%E6%A4%9C%E8%A8%BC\">サーバー側のトークン検証</a></li>\n<li><a href=\"#%E6%A4%9C%E8%A8%BC%E3%81%AE%E5%85%A8%E4%BD%93%E5%83%8F\">検証の全体像</a></li>\n<li><a href=\"#%E5%90%84%E6%A4%9C%E8%A8%BC%E9%A0%85%E7%9B%AE%E3%81%AE%E8%A9%B3%E7%B4%B0\">各検証項目の詳細</a></li>\n<li><a href=\"#rs256%E7%BD%B2%E5%90%8D%E6%A4%9C%E8%A8%BC%E3%81%AE%E4%BB%95%E7%B5%84%E3%81%BF\">RS256署名検証の仕組み</a></li>\n<li><a href=\"#%E5%85%AC%E9%96%8B%E9%8D%B5%E6%9A%97%E5%8F%B7%E6%96%B9%E5%BC%8F%E3%81%A8%E3%81%AF\">公開鍵暗号方式とは</a></li>\n<li><a href=\"#google%E5%85%AC%E9%96%8B%E9%8D%B5%E3%81%AE%E5%8F%96%E5%BE%97\">Google公開鍵の取得</a></li>\n<li><a href=\"#%E7%BD%B2%E5%90%8D%E6%A4%9C%E8%A8%BC%E3%81%AE%E5%AE%9F%E8%A3%85\">署名検証の実装</a></li>\n<li><a href=\"#x509%E8%A8%BC%E6%98%8E%E6%9B%B8%E3%81%AE%E8%A7%A3%E6%9E%90\">X.509証明書の解析</a></li>\n<li><a href=\"#%E8%A8%BC%E6%98%8E%E6%9B%B8%E3%81%AE%E5%BD%A2%E5%BC%8F\">証明書の形式</a></li>\n<li><a href=\"#%E8%A8%BC%E6%98%8E%E6%9B%B8%E3%81%8B%E3%82%89%E3%81%AE%E5%85%AC%E9%96%8B%E9%8D%B5%E6%8A%BD%E5%87%BA\">証明書からの公開鍵抽出</a></li>\n<li><a href=\"#%E7%AE%A1%E7%90%86%E8%80%85%E8%AA%8D%E5%8F%AF%E3%81%AE%E4%BB%95%E7%B5%84%E3%81%BF\">管理者認可の仕組み</a></li>\n<li><a href=\"#%E3%82%BB%E3%82%AD%E3%83%A5%E3%83%AA%E3%83%86%E3%82%A3%E3%81%AE%E3%83%99%E3%82%B9%E3%83%88%E3%83%97%E3%83%A9%E3%82%AF%E3%83%86%E3%82%A3%E3%82%B9\">セキュリティのベストプラクティス</a></li>\n<li><a href=\"#%E5%AE%9F%E8%A3%85%E3%81%95%E3%82%8C%E3%81%A6%E3%81%84%E3%82%8B%E5%AF%BE%E7%AD%96%E4%B8%80%E8%A6%A7\">実装されている対策一覧</a></li>\n<li><a href=\"#%E3%82%84%E3%81%A3%E3%81%A6%E3%81%AF%E3%81%84%E3%81%91%E3%81%AA%E3%81%84%E3%81%93%E3%81%A8\">やってはいけないこと</a></li>\n<li><a href=\"#%E6%9C%AC%E7%95%AA%E7%92%B0%E5%A2%83%E3%81%A7%E3%81%AE%E3%83%81%E3%82%A7%E3%83%83%E3%82%AF%E3%83%AA%E3%82%B9%E3%83%88\">本番環境でのチェックリスト</a></li>\n<li><a href=\"#%E3%83%88%E3%83%A9%E3%83%96%E3%83%AB%E3%82%B7%E3%83%A5%E3%83%BC%E3%83%86%E3%82%A3%E3%83%B3%E3%82%B0\">トラブルシューティング</a></li>\n<li><a href=\"#%E3%82%88%E3%81%8F%E3%81%82%E3%82%8B%E3%82%A8%E3%83%A9%E3%83%BC%E3%81%A8%E5%AF%BE%E5%87%A6%E6%B3%95\">よくあるエラーと対処法</a></li>\n<li><a href=\"#%E3%83%87%E3%83%90%E3%83%83%E3%82%B0%E6%96%B9%E6%B3%95\">デバッグ方法</a></li>\n<li><a href=\"#%E5%8F%82%E8%80%83%E3%83%AA%E3%83%B3%E3%82%AF\">参考リンク</a></li>\n</ul></div>\n<br>\n<h2 id=\"なぜセキュリティが必要なのか\">なぜセキュリティが必要なのか</h2>\n<p>Webアプリケーションでは、「誰がリクエストを送っているか」を確認することが非常に重要。</p>\n<ul>\n<li>記事の編集・削除は管理者だけができるべき</li>\n<li>下書き記事は一般ユーザーには見せたくない</li>\n<li>不正なリクエストからAPIを保護したい</li>\n</ul>\n<p>これらを実現するために、<strong>認証（Authentication）</strong> と <strong>認可（Authorization）</strong> という仕組みを使う。</p>\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n<div class=\"table-wrapper\"><table><thead><tr><th>用語</th><th>意味</th><th>例</th></tr></thead><tbody><tr><td>認証</td><td>「あなたは誰？」を確認する</td><td>ログインして本人確認</td></tr><tr><td>認可</td><td>「あなたはこれをしていい？」を確認する</td><td>管理者だけが編集可能</td></tr></tbody></table></div>\n<hr>\n<br>\n<h2 id=\"jwtjson-web-tokenとは\">JWT（JSON Web Token）とは</h2>\n<h3 id=\"基本概念\">基本概念</h3>\n<p>JWTは、ユーザー情報を安全にやり取りするための「デジタル身分証明書」のようなもの。</p>\n<figure class=\"mdn-code\" data-rehype-pretty-code-figure=\"\"><div class=\"mdn-code-header\"><div class=\"mdn-code-lang\">TEXT</div><div class=\"mdn-code-actions\"><button type=\"button\" class=\"mdn-code-copy\" aria-label=\"Copy code to clipboard\">Copy</button></div></div><pre tabindex=\"0\" data-language=\"plaintext\" data-theme=\"github-dark-dimmed\"><code data-language=\"plaintext\" data-theme=\"github-dark-dimmed\" style=\"display: grid;\"><span data-line=\"\"><span>eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIxMjM0NTY3ODkwIn0.signature...</span></span></code></pre></figure>\n<p>一見すると意味不明な文字列だが、実は3つの部分からできている：</p>\n<figure class=\"mdn-code\" data-rehype-pretty-code-figure=\"\"><div class=\"mdn-code-header\"><div class=\"mdn-code-lang\">TEXT</div><div class=\"mdn-code-actions\"><button type=\"button\" class=\"mdn-code-copy\" aria-label=\"Copy code to clipboard\">Copy</button></div></div><pre tabindex=\"0\" data-language=\"plaintext\" data-theme=\"github-dark-dimmed\"><code data-language=\"plaintext\" data-theme=\"github-dark-dimmed\" style=\"display: grid;\"><span data-line=\"\"><span>[ヘッダー].[ペイロード].[署名]</span></span></code></pre></figure>\n<p>それぞれ<strong>Base64URL</strong>という形式でエンコード（変換）されている。</p>\n<h3 id=\"jwtの3つの構成要素\">JWTの3つの構成要素</h3>\n<p><strong>① ヘッダー（Header）</strong></p>\n<p>「このトークンは何の方式で署名されているか」を示す。</p>\n<figure class=\"mdn-code\" data-rehype-pretty-code-figure=\"\"><div class=\"mdn-code-header\"><div class=\"mdn-code-lang\">JSON</div><div class=\"mdn-code-actions\"><button type=\"button\" class=\"mdn-code-copy\" aria-label=\"Copy code to clipboard\">Copy</button></div></div><pre tabindex=\"0\" data-language=\"json\" data-theme=\"github-dark-dimmed\"><code data-language=\"json\" data-theme=\"github-dark-dimmed\" style=\"display: grid;\"><span data-line=\"\"><span style=\"color:#ADBAC7\">{</span></span>\n<span data-line=\"\"><span style=\"color:#8DDB8C\">  \"alg\"</span><span style=\"color:#ADBAC7\">: </span><span style=\"color:#96D0FF\">\"RS256\"</span><span style=\"color:#ADBAC7\">,    </span><span style=\"color:#768390\">// 署名アルゴリズム（RSA + SHA-256）</span></span>\n<span data-line=\"\"><span style=\"color:#8DDB8C\">  \"kid\"</span><span style=\"color:#ADBAC7\">: </span><span style=\"color:#96D0FF\">\"abc123\"</span><span style=\"color:#ADBAC7\">,   </span><span style=\"color:#768390\">// 公開鍵のID（Key ID）</span></span>\n<span data-line=\"\"><span style=\"color:#8DDB8C\">  \"typ\"</span><span style=\"color:#ADBAC7\">: </span><span style=\"color:#96D0FF\">\"JWT\"</span><span style=\"color:#768390\">       // トークンの種類</span></span>\n<span data-line=\"\"><span style=\"color:#ADBAC7\">}</span></span></code></pre></figure>\n<p><strong>② ペイロード（Payload）</strong></p>\n<p>ユーザー情報や有効期限などの「中身」が入っている。</p>\n<figure class=\"mdn-code\" data-rehype-pretty-code-figure=\"\"><div class=\"mdn-code-header\"><div class=\"mdn-code-lang\">JSON</div><div class=\"mdn-code-actions\"><button type=\"button\" class=\"mdn-code-copy\" aria-label=\"Copy code to clipboard\">Copy</button></div></div><pre tabindex=\"0\" data-language=\"json\" data-theme=\"github-dark-dimmed\"><code data-language=\"json\" data-theme=\"github-dark-dimmed\" style=\"display: grid;\"><span data-line=\"\"><span style=\"color:#ADBAC7\">{</span></span>\n<span data-line=\"\"><span style=\"color:#8DDB8C\">  \"iss\"</span><span style=\"color:#ADBAC7\">: </span><span style=\"color:#96D0FF\">\"https://securetoken.google.com/my-project\"</span><span style=\"color:#ADBAC7\">,  </span><span style=\"color:#768390\">// 発行者</span></span>\n<span data-line=\"\"><span style=\"color:#8DDB8C\">  \"aud\"</span><span style=\"color:#ADBAC7\">: </span><span style=\"color:#96D0FF\">\"my-project\"</span><span style=\"color:#ADBAC7\">,                                  </span><span style=\"color:#768390\">// 対象者（誰向けか）</span></span>\n<span data-line=\"\"><span style=\"color:#8DDB8C\">  \"sub\"</span><span style=\"color:#ADBAC7\">: </span><span style=\"color:#96D0FF\">\"user123\"</span><span style=\"color:#ADBAC7\">,                                     </span><span style=\"color:#768390\">// ユーザーID</span></span>\n<span data-line=\"\"><span style=\"color:#8DDB8C\">  \"email\"</span><span style=\"color:#ADBAC7\">: </span><span style=\"color:#96D0FF\">\"user@example.com\"</span><span style=\"color:#ADBAC7\">,                          </span><span style=\"color:#768390\">// メールアドレス</span></span>\n<span data-line=\"\"><span style=\"color:#8DDB8C\">  \"email_verified\"</span><span style=\"color:#ADBAC7\">: </span><span style=\"color:#6CB6FF\">true</span><span style=\"color:#ADBAC7\">,                               </span><span style=\"color:#768390\">// メール確認済みか</span></span>\n<span data-line=\"\"><span style=\"color:#8DDB8C\">  \"iat\"</span><span style=\"color:#ADBAC7\">: </span><span style=\"color:#6CB6FF\">1700000000</span><span style=\"color:#ADBAC7\">,                                    </span><span style=\"color:#768390\">// 発行時刻</span></span>\n<span data-line=\"\"><span style=\"color:#8DDB8C\">  \"exp\"</span><span style=\"color:#ADBAC7\">: </span><span style=\"color:#6CB6FF\">1700003600</span><span style=\"color:#ADBAC7\">,                                    </span><span style=\"color:#768390\">// 有効期限</span></span>\n<span data-line=\"\"><span style=\"color:#8DDB8C\">  \"auth_time\"</span><span style=\"color:#ADBAC7\">: </span><span style=\"color:#6CB6FF\">1699999000</span><span style=\"color:#768390\">                               // 認証した時刻</span></span>\n<span data-line=\"\"><span style=\"color:#ADBAC7\">}</span></span></code></pre></figure>\n<p><strong>③ 署名（Signature）</strong></p>\n<p>「このトークンが本物であること」を証明する電子署名。</p>\n<figure class=\"mdn-code\" data-rehype-pretty-code-figure=\"\"><div class=\"mdn-code-header\"><div class=\"mdn-code-lang\">TEXT</div><div class=\"mdn-code-actions\"><button type=\"button\" class=\"mdn-code-copy\" aria-label=\"Copy code to clipboard\">Copy</button></div></div><pre tabindex=\"0\" data-language=\"plaintext\" data-theme=\"github-dark-dimmed\"><code data-language=\"plaintext\" data-theme=\"github-dark-dimmed\" style=\"display: grid;\"><span data-line=\"\"><span>署名 = RSA暗号化(ヘッダー + \".\" + ペイロード, 秘密鍵)</span></span></code></pre></figure>\n<h3 id=\"なぜ署名が必要なのか\">なぜ署名が必要なのか</h3>\n<p>署名がなければ、悪意のあるユーザーが自分でトークンを作れてしまう：</p>\n<figure class=\"mdn-code\" data-rehype-pretty-code-figure=\"\"><div class=\"mdn-code-header\"><div class=\"mdn-code-lang\">JSON</div><div class=\"mdn-code-actions\"><button type=\"button\" class=\"mdn-code-copy\" aria-label=\"Copy code to clipboard\">Copy</button></div></div><pre tabindex=\"0\" data-language=\"json\" data-theme=\"github-dark-dimmed\"><code data-language=\"json\" data-theme=\"github-dark-dimmed\" style=\"display: grid;\"><span data-line=\"\"><span style=\"color:#768390\">// 悪意のあるユーザーが作った偽のペイロード</span></span>\n<span data-line=\"\"><span style=\"color:#ADBAC7\">{</span></span>\n<span data-line=\"\"><span style=\"color:#8DDB8C\">  \"email\"</span><span style=\"color:#ADBAC7\">: </span><span style=\"color:#96D0FF\">\"admin@example.com\"</span><span style=\"color:#ADBAC7\">,  </span><span style=\"color:#768390\">// 管理者になりすまし！</span></span>\n<span data-line=\"\"><span style=\"color:#8DDB8C\">  \"email_verified\"</span><span style=\"color:#ADBAC7\">: </span><span style=\"color:#6CB6FF\">true</span></span>\n<span data-line=\"\"><span style=\"color:#ADBAC7\">}</span></span></code></pre></figure>\n<p>しかし、署名があれば：</p>\n<ol>\n<li>トークンは<strong>秘密鍵</strong>で署名される（Firebaseだけが持っている）</li>\n<li>サーバーは<strong>公開鍵</strong>で署名を検証できる</li>\n<li>署名が合わなければ偽物と判断できる</li>\n</ol>\n<p>これを<strong>公開鍵暗号方式</strong>と呼ぶ。</p>\n<hr>\n<br>\n<h2 id=\"firebase認証の仕組み\">Firebase認証の仕組み</h2>\n<h3 id=\"認証フロー全体像\">認証フロー全体像</h3>\n<figure class=\"mdn-code\" data-rehype-pretty-code-figure=\"\"><div class=\"mdn-code-header\"><div class=\"mdn-code-lang\">TEXT</div><div class=\"mdn-code-actions\"><button type=\"button\" class=\"mdn-code-copy\" aria-label=\"Copy code to clipboard\">Copy</button></div></div><pre tabindex=\"0\" data-language=\"plaintext\" data-theme=\"github-dark-dimmed\"><code data-language=\"plaintext\" data-theme=\"github-dark-dimmed\" style=\"display: grid;\"><span data-line=\"\"><span>① ユーザーがGoogleログイン</span></span>\n<span data-line=\"\"><span>   ブラウザ ──────▶ Firebase ◀────▶ Google OAuth</span></span>\n<span data-line=\"\"> </span>\n<span data-line=\"\"><span>② FirebaseがIDトークン（JWT）を発行</span></span>\n<span data-line=\"\"><span>   ブラウザ ◀────── IDトークン</span></span>\n<span data-line=\"\"> </span>\n<span data-line=\"\"><span>③ ブラウザがAPIリクエスト時にトークンを添付</span></span>\n<span data-line=\"\"><span>   Authorization: Bearer eyJhbGciOiJSUzI1NiIs...</span></span>\n<span data-line=\"\"> </span>\n<span data-line=\"\"><span>④ Cloudflare Workerがトークンを検証</span></span>\n<span data-line=\"\"><span>   Worker ◀─── Google公開鍵 (googleapis.comから取得)</span></span></code></pre></figure>\n<h3 id=\"フロントエンド側の実装\">フロントエンド側の実装</h3>\n<p><span data-rehype-pretty-code-figure=\"\"><code data-language=\"plaintext\" data-theme=\"github-dark-dimmed\"><span data-line=\"\"><span>src/contexts/AdminAuthContext.tsx</span></span></code></span> で認証状態を管理：</p>\n<figure class=\"mdn-code\" data-rehype-pretty-code-figure=\"\"><div class=\"mdn-code-header\"><div class=\"mdn-code-lang\">TS</div><div class=\"mdn-code-actions\"><button type=\"button\" class=\"mdn-code-copy\" aria-label=\"Copy code to clipboard\">Copy</button></div></div><pre tabindex=\"0\" data-language=\"typescript\" data-theme=\"github-dark-dimmed\"><code data-language=\"typescript\" data-theme=\"github-dark-dimmed\" style=\"display: grid;\"><span data-line=\"\"><span style=\"color:#768390\">// Googleログイン処理</span></span>\n<span data-line=\"\"><span style=\"color:#F47067\">const</span><span style=\"color:#DCBDFB\"> loginWithGoogle</span><span style=\"color:#F47067\"> =</span><span style=\"color:#F47067\"> async</span><span style=\"color:#ADBAC7\"> () </span><span style=\"color:#F47067\">=></span><span style=\"color:#ADBAC7\"> {</span></span>\n<span data-line=\"\"><span style=\"color:#F47067\">  const</span><span style=\"color:#6CB6FF\"> provider</span><span style=\"color:#F47067\"> =</span><span style=\"color:#F47067\"> new</span><span style=\"color:#DCBDFB\"> GoogleAuthProvider</span><span style=\"color:#ADBAC7\">()</span></span>\n<span data-line=\"\"><span style=\"color:#F47067\">  const</span><span style=\"color:#6CB6FF\"> result</span><span style=\"color:#F47067\"> =</span><span style=\"color:#F47067\"> await</span><span style=\"color:#DCBDFB\"> signInWithPopup</span><span style=\"color:#ADBAC7\">(auth, provider)</span></span>\n<span data-line=\"\"> </span>\n<span data-line=\"\"><span style=\"color:#768390\">  // FirebaseからIDトークンを取得</span></span>\n<span data-line=\"\"><span style=\"color:#F47067\">  const</span><span style=\"color:#6CB6FF\"> token</span><span style=\"color:#F47067\"> =</span><span style=\"color:#F47067\"> await</span><span style=\"color:#ADBAC7\"> result.user.</span><span style=\"color:#DCBDFB\">getIdToken</span><span style=\"color:#ADBAC7\">()</span></span>\n<span data-line=\"\"><span style=\"color:#DCBDFB\">  setIdToken</span><span style=\"color:#ADBAC7\">(token)</span></span>\n<span data-line=\"\"><span style=\"color:#ADBAC7\">}</span></span></code></pre></figure>\n<p><strong>APIリクエスト時のトークン送信：</strong></p>\n<figure class=\"mdn-code\" data-rehype-pretty-code-figure=\"\"><div class=\"mdn-code-header\"><div class=\"mdn-code-lang\">TS</div><div class=\"mdn-code-actions\"><button type=\"button\" class=\"mdn-code-copy\" aria-label=\"Copy code to clipboard\">Copy</button></div></div><pre tabindex=\"0\" data-language=\"typescript\" data-theme=\"github-dark-dimmed\"><code data-language=\"typescript\" data-theme=\"github-dark-dimmed\" style=\"display: grid;\"><span data-line=\"\"><span style=\"color:#768390\">// 管理者APIを呼び出す例</span></span>\n<span data-line=\"\"><span style=\"color:#F47067\">const</span><span style=\"color:#6CB6FF\"> response</span><span style=\"color:#F47067\"> =</span><span style=\"color:#F47067\"> await</span><span style=\"color:#DCBDFB\"> fetch</span><span style=\"color:#ADBAC7\">(</span><span style=\"color:#96D0FF\">'/api/cms/posts/drafts'</span><span style=\"color:#ADBAC7\">, {</span></span>\n<span data-line=\"\"><span style=\"color:#ADBAC7\">  headers: {</span></span>\n<span data-line=\"\"><span style=\"color:#96D0FF\">    'Authorization'</span><span style=\"color:#ADBAC7\">: </span><span style=\"color:#96D0FF\">`Bearer ${</span><span style=\"color:#ADBAC7\">idToken</span><span style=\"color:#96D0FF\">}`</span><span style=\"color:#768390\">  // ここでトークンを送る</span></span>\n<span data-line=\"\"><span style=\"color:#ADBAC7\">  }</span></span>\n<span data-line=\"\"><span style=\"color:#ADBAC7\">})</span></span></code></pre></figure>\n<p><span data-rehype-pretty-code-figure=\"\"><code data-language=\"plaintext\" data-theme=\"github-dark-dimmed\"><span data-line=\"\"><span>Bearer</span></span></code></span> は「持参人」という意味で、「このトークンを持っている人を認証してください」という意味。</p>\n<hr>\n<br>\n<h2 id=\"サーバー側のトークン検証\">サーバー側のトークン検証</h2>\n<p><span data-rehype-pretty-code-figure=\"\"><code data-language=\"plaintext\" data-theme=\"github-dark-dimmed\"><span data-line=\"\"><span>src/pv-worker.ts</span></span></code></span> で実装している検証処理を詳しく見ていく。</p>\n<h3 id=\"検証の全体像\">検証の全体像</h3>\n<figure class=\"mdn-code\" data-rehype-pretty-code-figure=\"\"><div class=\"mdn-code-header\"><div class=\"mdn-code-lang\">TS</div><div class=\"mdn-code-actions\"><button type=\"button\" class=\"mdn-code-copy\" aria-label=\"Copy code to clipboard\">Copy</button></div></div><pre tabindex=\"0\" data-language=\"typescript\" data-theme=\"github-dark-dimmed\"><code data-language=\"typescript\" data-theme=\"github-dark-dimmed\" style=\"display: grid;\"><span data-line=\"\"><span style=\"color:#F47067\">async</span><span style=\"color:#F47067\"> function</span><span style=\"color:#DCBDFB\"> verifyFirebaseToken</span><span style=\"color:#ADBAC7\">(</span><span style=\"color:#F69D50\">token</span><span style=\"color:#F47067\">:</span><span style=\"color:#6CB6FF\"> string</span><span style=\"color:#ADBAC7\">, </span><span style=\"color:#F69D50\">env</span><span style=\"color:#F47067\">:</span><span style=\"color:#F69D50\"> Env</span><span style=\"color:#ADBAC7\">)</span><span style=\"color:#F47067\">:</span><span style=\"color:#F69D50\"> Promise</span><span style=\"color:#ADBAC7\">&#x3C;</span><span style=\"color:#F69D50\">FirebaseTokenPayload</span><span style=\"color:#F47067\"> |</span><span style=\"color:#6CB6FF\"> null</span><span style=\"color:#ADBAC7\">> {</span></span>\n<span data-line=\"\"><span style=\"color:#768390\">  // 1. トークンを3つの部分に分割</span></span>\n<span data-line=\"\"><span style=\"color:#F47067\">  const</span><span style=\"color:#6CB6FF\"> parts</span><span style=\"color:#F47067\"> =</span><span style=\"color:#ADBAC7\"> token.</span><span style=\"color:#DCBDFB\">split</span><span style=\"color:#ADBAC7\">(</span><span style=\"color:#96D0FF\">'.'</span><span style=\"color:#ADBAC7\">)</span></span>\n<span data-line=\"\"><span style=\"color:#F47067\">  if</span><span style=\"color:#ADBAC7\"> (parts.</span><span style=\"color:#6CB6FF\">length</span><span style=\"color:#F47067\"> !==</span><span style=\"color:#6CB6FF\"> 3</span><span style=\"color:#ADBAC7\">) </span><span style=\"color:#F47067\">return</span><span style=\"color:#6CB6FF\"> null</span><span style=\"color:#768390\">  // JWTは必ず3部構成</span></span>\n<span data-line=\"\"> </span>\n<span data-line=\"\"><span style=\"color:#768390\">  // 2. ヘッダーの検証</span></span>\n<span data-line=\"\"><span style=\"color:#768390\">  // 3. ペイロードの検証（各クレーム）</span></span>\n<span data-line=\"\"><span style=\"color:#768390\">  // 4. 署名の検証</span></span>\n<span data-line=\"\"> </span>\n<span data-line=\"\"><span style=\"color:#F47067\">  return</span><span style=\"color:#ADBAC7\"> payload  </span><span style=\"color:#768390\">// 全て通過したら成功</span></span>\n<span data-line=\"\"><span style=\"color:#ADBAC7\">}</span></span></code></pre></figure>\n<h3 id=\"各検証項目の詳細\">各検証項目の詳細</h3>\n<p><strong>① アルゴリズムの検証（alg）</strong></p>\n<figure class=\"mdn-code\" data-rehype-pretty-code-figure=\"\"><div class=\"mdn-code-header\"><div class=\"mdn-code-lang\">TS</div><div class=\"mdn-code-actions\"><button type=\"button\" class=\"mdn-code-copy\" aria-label=\"Copy code to clipboard\">Copy</button></div></div><pre tabindex=\"0\" data-language=\"typescript\" data-theme=\"github-dark-dimmed\"><code data-language=\"typescript\" data-theme=\"github-dark-dimmed\" style=\"display: grid;\"><span data-line=\"\"><span style=\"color:#F47067\">const</span><span style=\"color:#6CB6FF\"> header</span><span style=\"color:#F47067\"> =</span><span style=\"color:#6CB6FF\"> JSON</span><span style=\"color:#ADBAC7\">.</span><span style=\"color:#DCBDFB\">parse</span><span style=\"color:#ADBAC7\">(</span><span style=\"color:#DCBDFB\">base64UrlDecode</span><span style=\"color:#ADBAC7\">(parts[</span><span style=\"color:#6CB6FF\">0</span><span style=\"color:#ADBAC7\">]))</span></span>\n<span data-line=\"\"> </span>\n<span data-line=\"\"><span style=\"color:#768390\">// RS256以外は拒否（ダウングレード攻撃防止）</span></span>\n<span data-line=\"\"><span style=\"color:#F47067\">if</span><span style=\"color:#ADBAC7\"> (header.alg </span><span style=\"color:#F47067\">!==</span><span style=\"color:#96D0FF\"> 'RS256'</span><span style=\"color:#ADBAC7\">) {</span></span>\n<span data-line=\"\"><span style=\"color:#ADBAC7\">  console.</span><span style=\"color:#DCBDFB\">log</span><span style=\"color:#ADBAC7\">(</span><span style=\"color:#96D0FF\">'Invalid algorithm:'</span><span style=\"color:#ADBAC7\">, header.alg)</span></span>\n<span data-line=\"\"><span style=\"color:#F47067\">  return</span><span style=\"color:#6CB6FF\"> null</span></span>\n<span data-line=\"\"><span style=\"color:#ADBAC7\">}</span></span></code></pre></figure>\n<p>なぜこれが必要？\n→ 攻撃者が <span data-rehype-pretty-code-figure=\"\"><code data-language=\"plaintext\" data-theme=\"github-dark-dimmed\"><span data-line=\"\"><span>alg: \"none\"</span></span></code></span> を指定して「署名なしでOK」と偽装する攻撃を防ぐため。</p>\n<p><strong>② 有効期限の検証（exp）</strong></p>\n<figure class=\"mdn-code\" data-rehype-pretty-code-figure=\"\"><div class=\"mdn-code-header\"><div class=\"mdn-code-lang\">TS</div><div class=\"mdn-code-actions\"><button type=\"button\" class=\"mdn-code-copy\" aria-label=\"Copy code to clipboard\">Copy</button></div></div><pre tabindex=\"0\" data-language=\"typescript\" data-theme=\"github-dark-dimmed\"><code data-language=\"typescript\" data-theme=\"github-dark-dimmed\" style=\"display: grid;\"><span data-line=\"\"><span style=\"color:#F47067\">const</span><span style=\"color:#6CB6FF\"> now</span><span style=\"color:#F47067\"> =</span><span style=\"color:#ADBAC7\"> Math.</span><span style=\"color:#DCBDFB\">floor</span><span style=\"color:#ADBAC7\">(Date.</span><span style=\"color:#DCBDFB\">now</span><span style=\"color:#ADBAC7\">() </span><span style=\"color:#F47067\">/</span><span style=\"color:#6CB6FF\"> 1000</span><span style=\"color:#ADBAC7\">)  </span><span style=\"color:#768390\">// 現在時刻（UNIX時間）</span></span>\n<span data-line=\"\"> </span>\n<span data-line=\"\"><span style=\"color:#F47067\">if</span><span style=\"color:#ADBAC7\"> (</span><span style=\"color:#F47067\">!</span><span style=\"color:#ADBAC7\">payload.exp </span><span style=\"color:#F47067\">||</span><span style=\"color:#ADBAC7\"> payload.exp </span><span style=\"color:#F47067\">&#x3C;</span><span style=\"color:#ADBAC7\"> now) {</span></span>\n<span data-line=\"\"><span style=\"color:#ADBAC7\">  console.</span><span style=\"color:#DCBDFB\">log</span><span style=\"color:#ADBAC7\">(</span><span style=\"color:#96D0FF\">'Token expired'</span><span style=\"color:#ADBAC7\">)</span></span>\n<span data-line=\"\"><span style=\"color:#F47067\">  return</span><span style=\"color:#6CB6FF\"> null</span></span>\n<span data-line=\"\"><span style=\"color:#ADBAC7\">}</span></span></code></pre></figure>\n<p><span data-rehype-pretty-code-figure=\"\"><code data-language=\"plaintext\" data-theme=\"github-dark-dimmed\"><span data-line=\"\"><span>exp</span></span></code></span>（expiration）は「このトークンはいつまで有効か」を示す。期限切れトークンは無効。</p>\n<p><strong>③ 発行時刻の検証（iat）</strong></p>\n<figure class=\"mdn-code\" data-rehype-pretty-code-figure=\"\"><div class=\"mdn-code-header\"><div class=\"mdn-code-lang\">TS</div><div class=\"mdn-code-actions\"><button type=\"button\" class=\"mdn-code-copy\" aria-label=\"Copy code to clipboard\">Copy</button></div></div><pre tabindex=\"0\" data-language=\"typescript\" data-theme=\"github-dark-dimmed\"><code data-language=\"typescript\" data-theme=\"github-dark-dimmed\" style=\"display: grid;\"><span data-line=\"\"><span style=\"color:#F47067\">if</span><span style=\"color:#ADBAC7\"> (</span><span style=\"color:#F47067\">!</span><span style=\"color:#ADBAC7\">payload.iat </span><span style=\"color:#F47067\">||</span><span style=\"color:#ADBAC7\"> payload.iat </span><span style=\"color:#F47067\">></span><span style=\"color:#ADBAC7\"> now) {</span></span>\n<span data-line=\"\"><span style=\"color:#ADBAC7\">  console.</span><span style=\"color:#DCBDFB\">log</span><span style=\"color:#ADBAC7\">(</span><span style=\"color:#96D0FF\">'Invalid iat:'</span><span style=\"color:#ADBAC7\">, payload.iat)</span></span>\n<span data-line=\"\"><span style=\"color:#F47067\">  return</span><span style=\"color:#6CB6FF\"> null</span></span>\n<span data-line=\"\"><span style=\"color:#ADBAC7\">}</span></span></code></pre></figure>\n<p><span data-rehype-pretty-code-figure=\"\"><code data-language=\"plaintext\" data-theme=\"github-dark-dimmed\"><span data-line=\"\"><span>iat</span></span></code></span>（issued at）は「トークンがいつ発行されたか」。未来の時刻で発行されたトークンは不正。</p>\n<p><strong>④ 発行者の検証（iss）</strong></p>\n<figure class=\"mdn-code\" data-rehype-pretty-code-figure=\"\"><div class=\"mdn-code-header\"><div class=\"mdn-code-lang\">TS</div><div class=\"mdn-code-actions\"><button type=\"button\" class=\"mdn-code-copy\" aria-label=\"Copy code to clipboard\">Copy</button></div></div><pre tabindex=\"0\" data-language=\"typescript\" data-theme=\"github-dark-dimmed\"><code data-language=\"typescript\" data-theme=\"github-dark-dimmed\" style=\"display: grid;\"><span data-line=\"\"><span style=\"color:#F47067\">const</span><span style=\"color:#6CB6FF\"> expectedIssuer</span><span style=\"color:#F47067\"> =</span><span style=\"color:#96D0FF\"> `https://securetoken.google.com/${</span><span style=\"color:#ADBAC7\">env</span><span style=\"color:#96D0FF\">.</span><span style=\"color:#6CB6FF\">FIREBASE_PROJECT_ID</span><span style=\"color:#96D0FF\">}`</span></span>\n<span data-line=\"\"><span style=\"color:#F47067\">if</span><span style=\"color:#ADBAC7\"> (payload.iss </span><span style=\"color:#F47067\">!==</span><span style=\"color:#ADBAC7\"> expectedIssuer) {</span></span>\n<span data-line=\"\"><span style=\"color:#ADBAC7\">  console.</span><span style=\"color:#DCBDFB\">log</span><span style=\"color:#ADBAC7\">(</span><span style=\"color:#96D0FF\">'Invalid issuer:'</span><span style=\"color:#ADBAC7\">, payload.iss)</span></span>\n<span data-line=\"\"><span style=\"color:#F47067\">  return</span><span style=\"color:#6CB6FF\"> null</span></span>\n<span data-line=\"\"><span style=\"color:#ADBAC7\">}</span></span></code></pre></figure>\n<p><span data-rehype-pretty-code-figure=\"\"><code data-language=\"plaintext\" data-theme=\"github-dark-dimmed\"><span data-line=\"\"><span>iss</span></span></code></span>（issuer）は「誰がこのトークンを発行したか」。Firebase以外が発行したトークンは拒否。</p>\n<p><strong>⑤ 対象者の検証（aud）</strong></p>\n<figure class=\"mdn-code\" data-rehype-pretty-code-figure=\"\"><div class=\"mdn-code-header\"><div class=\"mdn-code-lang\">TS</div><div class=\"mdn-code-actions\"><button type=\"button\" class=\"mdn-code-copy\" aria-label=\"Copy code to clipboard\">Copy</button></div></div><pre tabindex=\"0\" data-language=\"typescript\" data-theme=\"github-dark-dimmed\"><code data-language=\"typescript\" data-theme=\"github-dark-dimmed\" style=\"display: grid;\"><span data-line=\"\"><span style=\"color:#F47067\">if</span><span style=\"color:#ADBAC7\"> (payload.aud </span><span style=\"color:#F47067\">!==</span><span style=\"color:#ADBAC7\"> env.</span><span style=\"color:#6CB6FF\">FIREBASE_PROJECT_ID</span><span style=\"color:#ADBAC7\">) {</span></span>\n<span data-line=\"\"><span style=\"color:#ADBAC7\">  console.</span><span style=\"color:#DCBDFB\">log</span><span style=\"color:#ADBAC7\">(</span><span style=\"color:#96D0FF\">'Invalid audience:'</span><span style=\"color:#ADBAC7\">, payload.aud)</span></span>\n<span data-line=\"\"><span style=\"color:#F47067\">  return</span><span style=\"color:#6CB6FF\"> null</span></span>\n<span data-line=\"\"><span style=\"color:#ADBAC7\">}</span></span></code></pre></figure>\n<p><span data-rehype-pretty-code-figure=\"\"><code data-language=\"plaintext\" data-theme=\"github-dark-dimmed\"><span data-line=\"\"><span>aud</span></span></code></span>（audience）は「このトークンは誰向けか」。自分のプロジェクト向けでないトークンは拒否。</p>\n<p><strong>⑥ メール確認済みの検証（email_verified）</strong></p>\n<figure class=\"mdn-code\" data-rehype-pretty-code-figure=\"\"><div class=\"mdn-code-header\"><div class=\"mdn-code-lang\">TS</div><div class=\"mdn-code-actions\"><button type=\"button\" class=\"mdn-code-copy\" aria-label=\"Copy code to clipboard\">Copy</button></div></div><pre tabindex=\"0\" data-language=\"typescript\" data-theme=\"github-dark-dimmed\"><code data-language=\"typescript\" data-theme=\"github-dark-dimmed\" style=\"display: grid;\"><span data-line=\"\"><span style=\"color:#F47067\">if</span><span style=\"color:#ADBAC7\"> (</span><span style=\"color:#F47067\">!</span><span style=\"color:#ADBAC7\">payload.email_verified) {</span></span>\n<span data-line=\"\"><span style=\"color:#ADBAC7\">  console.</span><span style=\"color:#DCBDFB\">log</span><span style=\"color:#ADBAC7\">(</span><span style=\"color:#96D0FF\">'Email not verified'</span><span style=\"color:#ADBAC7\">)</span></span>\n<span data-line=\"\"><span style=\"color:#F47067\">  return</span><span style=\"color:#6CB6FF\"> null</span></span>\n<span data-line=\"\"><span style=\"color:#ADBAC7\">}</span></span></code></pre></figure>\n<p>メールアドレスが確認されていないユーザーは管理者として認めない。</p>\n<hr>\n<br>\n<h2 id=\"rs256署名検証の仕組み\">RS256署名検証の仕組み</h2>\n<h3 id=\"公開鍵暗号方式とは\">公開鍵暗号方式とは</h3>\n<figure class=\"mdn-code\" data-rehype-pretty-code-figure=\"\"><div class=\"mdn-code-header\"><div class=\"mdn-code-lang\">TEXT</div><div class=\"mdn-code-actions\"><button type=\"button\" class=\"mdn-code-copy\" aria-label=\"Copy code to clipboard\">Copy</button></div></div><pre tabindex=\"0\" data-language=\"plaintext\" data-theme=\"github-dark-dimmed\"><code data-language=\"plaintext\" data-theme=\"github-dark-dimmed\" style=\"display: grid;\"><span data-line=\"\"><span>【署名の作成】Firebase側（秘密鍵を持っている）</span></span>\n<span data-line=\"\"> </span>\n<span data-line=\"\"><span>   ヘッダー.ペイロード ─▶ RSA暗号 ─▶ 署名</span></span>\n<span data-line=\"\"><span>                              ▲</span></span>\n<span data-line=\"\"><span>                              │</span></span>\n<span data-line=\"\"><span>                         秘密鍵 ← Firebaseだけが持っている</span></span>\n<span data-line=\"\"> </span>\n<span data-line=\"\"><span>【署名の検証】Worker側（公開鍵で検証）</span></span>\n<span data-line=\"\"> </span>\n<span data-line=\"\"><span>   ヘッダー.ペイロード ─▶ RSA検証 ◀─ 署名</span></span>\n<span data-line=\"\"><span>                              ▲        結果: ✓ 一致 / ✗ 不一致</span></span>\n<span data-line=\"\"><span>                              │</span></span>\n<span data-line=\"\"><span>                         公開鍵 ← Googleから誰でも取得可能</span></span></code></pre></figure>\n<h3 id=\"google公開鍵の取得\">Google公開鍵の取得</h3>\n<figure class=\"mdn-code\" data-rehype-pretty-code-figure=\"\"><div class=\"mdn-code-header\"><div class=\"mdn-code-lang\">TS</div><div class=\"mdn-code-actions\"><button type=\"button\" class=\"mdn-code-copy\" aria-label=\"Copy code to clipboard\">Copy</button></div></div><pre tabindex=\"0\" data-language=\"typescript\" data-theme=\"github-dark-dimmed\"><code data-language=\"typescript\" data-theme=\"github-dark-dimmed\" style=\"display: grid;\"><span data-line=\"\"><span style=\"color:#F47067\">const</span><span style=\"color:#6CB6FF\"> GOOGLE_CERTS_URL</span><span style=\"color:#F47067\"> =</span><span style=\"color:#96D0FF\"> 'https://www.googleapis.com/robot/v1/metadata/x509/securetoken@system.gserviceaccount.com'</span></span>\n<span data-line=\"\"> </span>\n<span data-line=\"\"><span style=\"color:#F47067\">async</span><span style=\"color:#F47067\"> function</span><span style=\"color:#DCBDFB\"> getGooglePublicKeys</span><span style=\"color:#ADBAC7\">()</span><span style=\"color:#F47067\">:</span><span style=\"color:#F69D50\"> Promise</span><span style=\"color:#ADBAC7\">&#x3C;</span><span style=\"color:#F69D50\">Record</span><span style=\"color:#ADBAC7\">&#x3C;</span><span style=\"color:#6CB6FF\">string</span><span style=\"color:#ADBAC7\">, </span><span style=\"color:#F69D50\">CryptoKey</span><span style=\"color:#ADBAC7\">>> {</span></span>\n<span data-line=\"\"><span style=\"color:#768390\">  // キャッシュが有効ならそれを使う</span></span>\n<span data-line=\"\"><span style=\"color:#F47067\">  if</span><span style=\"color:#ADBAC7\"> (publicKeyCache </span><span style=\"color:#F47067\">&#x26;&#x26;</span><span style=\"color:#ADBAC7\"> publicKeyCache.expiresAt </span><span style=\"color:#F47067\">></span><span style=\"color:#ADBAC7\"> Date.</span><span style=\"color:#DCBDFB\">now</span><span style=\"color:#ADBAC7\">()) {</span></span>\n<span data-line=\"\"><span style=\"color:#F47067\">    return</span><span style=\"color:#ADBAC7\"> publicKeyCache.keys</span></span>\n<span data-line=\"\"><span style=\"color:#ADBAC7\">  }</span></span>\n<span data-line=\"\"> </span>\n<span data-line=\"\"><span style=\"color:#768390\">  // Googleから証明書を取得</span></span>\n<span data-line=\"\"><span style=\"color:#F47067\">  const</span><span style=\"color:#6CB6FF\"> response</span><span style=\"color:#F47067\"> =</span><span style=\"color:#F47067\"> await</span><span style=\"color:#DCBDFB\"> fetch</span><span style=\"color:#ADBAC7\">(</span><span style=\"color:#6CB6FF\">GOOGLE_CERTS_URL</span><span style=\"color:#ADBAC7\">)</span></span>\n<span data-line=\"\"><span style=\"color:#F47067\">  const</span><span style=\"color:#6CB6FF\"> certs</span><span style=\"color:#F47067\"> =</span><span style=\"color:#F47067\"> await</span><span style=\"color:#ADBAC7\"> response.</span><span style=\"color:#DCBDFB\">json</span><span style=\"color:#ADBAC7\">()</span></span>\n<span data-line=\"\"> </span>\n<span data-line=\"\"><span style=\"color:#768390\">  // Cache-Controlヘッダーからキャッシュ期間を取得</span></span>\n<span data-line=\"\"><span style=\"color:#F47067\">  const</span><span style=\"color:#6CB6FF\"> cacheControl</span><span style=\"color:#F47067\"> =</span><span style=\"color:#ADBAC7\"> response.headers.</span><span style=\"color:#DCBDFB\">get</span><span style=\"color:#ADBAC7\">(</span><span style=\"color:#96D0FF\">'Cache-Control'</span><span style=\"color:#ADBAC7\">)</span></span>\n<span data-line=\"\"><span style=\"color:#F47067\">  const</span><span style=\"color:#6CB6FF\"> maxAge</span><span style=\"color:#F47067\"> =</span><span style=\"color:#768390\"> /* max-ageの値を抽出 */</span></span>\n<span data-line=\"\"> </span>\n<span data-line=\"\"><span style=\"color:#768390\">  // 証明書をCryptoKeyオブジェクトに変換</span></span>\n<span data-line=\"\"><span style=\"color:#F47067\">  for</span><span style=\"color:#ADBAC7\"> (</span><span style=\"color:#F47067\">const</span><span style=\"color:#ADBAC7\"> [</span><span style=\"color:#6CB6FF\">kid</span><span style=\"color:#ADBAC7\">, </span><span style=\"color:#6CB6FF\">pem</span><span style=\"color:#ADBAC7\">] </span><span style=\"color:#F47067\">of</span><span style=\"color:#ADBAC7\"> Object.</span><span style=\"color:#DCBDFB\">entries</span><span style=\"color:#ADBAC7\">(certs)) {</span></span>\n<span data-line=\"\"><span style=\"color:#ADBAC7\">    keys[kid] </span><span style=\"color:#F47067\">=</span><span style=\"color:#F47067\"> await</span><span style=\"color:#DCBDFB\"> importPublicKeyFromCert</span><span style=\"color:#ADBAC7\">(pem)</span></span>\n<span data-line=\"\"><span style=\"color:#ADBAC7\">  }</span></span>\n<span data-line=\"\"> </span>\n<span data-line=\"\"><span style=\"color:#768390\">  // キャッシュを更新</span></span>\n<span data-line=\"\"><span style=\"color:#ADBAC7\">  publicKeyCache </span><span style=\"color:#F47067\">=</span><span style=\"color:#ADBAC7\"> { keys, expiresAt: Date.</span><span style=\"color:#DCBDFB\">now</span><span style=\"color:#ADBAC7\">() </span><span style=\"color:#F47067\">+</span><span style=\"color:#ADBAC7\"> maxAge </span><span style=\"color:#F47067\">*</span><span style=\"color:#6CB6FF\"> 1000</span><span style=\"color:#ADBAC7\"> }</span></span>\n<span data-line=\"\"> </span>\n<span data-line=\"\"><span style=\"color:#F47067\">  return</span><span style=\"color:#ADBAC7\"> keys</span></span>\n<span data-line=\"\"><span style=\"color:#ADBAC7\">}</span></span></code></pre></figure>\n<p><strong>なぜキャッシュが必要？</strong></p>\n<ul>\n<li>毎回Googleにアクセスするとレスポンスが遅くなる</li>\n<li>Googleの公開鍵は頻繁には変わらない（数時間〜数日）</li>\n<li><span data-rehype-pretty-code-figure=\"\"><code data-language=\"plaintext\" data-theme=\"github-dark-dimmed\"><span data-line=\"\"><span>Cache-Control</span></span></code></span>ヘッダーの<span data-rehype-pretty-code-figure=\"\"><code data-language=\"plaintext\" data-theme=\"github-dark-dimmed\"><span data-line=\"\"><span>max-age</span></span></code></span>に従ってキャッシュ</li>\n</ul>\n<h3 id=\"署名検証の実装\">署名検証の実装</h3>\n<figure class=\"mdn-code\" data-rehype-pretty-code-figure=\"\"><div class=\"mdn-code-header\"><div class=\"mdn-code-lang\">TS</div><div class=\"mdn-code-actions\"><button type=\"button\" class=\"mdn-code-copy\" aria-label=\"Copy code to clipboard\">Copy</button></div></div><pre tabindex=\"0\" data-language=\"typescript\" data-theme=\"github-dark-dimmed\"><code data-language=\"typescript\" data-theme=\"github-dark-dimmed\" style=\"display: grid;\"><span data-line=\"\"><span style=\"color:#768390\">// 署名検証（RS256）</span></span>\n<span data-line=\"\"><span style=\"color:#F47067\">const</span><span style=\"color:#6CB6FF\"> publicKeys</span><span style=\"color:#F47067\"> =</span><span style=\"color:#F47067\"> await</span><span style=\"color:#DCBDFB\"> getGooglePublicKeys</span><span style=\"color:#ADBAC7\">()</span></span>\n<span data-line=\"\"><span style=\"color:#F47067\">const</span><span style=\"color:#6CB6FF\"> publicKey</span><span style=\"color:#F47067\"> =</span><span style=\"color:#ADBAC7\"> publicKeys[header.kid]  </span><span style=\"color:#768390\">// kidで公開鍵を特定</span></span>\n<span data-line=\"\"> </span>\n<span data-line=\"\"><span style=\"color:#F47067\">if</span><span style=\"color:#ADBAC7\"> (</span><span style=\"color:#F47067\">!</span><span style=\"color:#ADBAC7\">publicKey) {</span></span>\n<span data-line=\"\"><span style=\"color:#ADBAC7\">  console.</span><span style=\"color:#DCBDFB\">log</span><span style=\"color:#ADBAC7\">(</span><span style=\"color:#96D0FF\">'Public key not found for kid:'</span><span style=\"color:#ADBAC7\">, header.kid)</span></span>\n<span data-line=\"\"><span style=\"color:#F47067\">  return</span><span style=\"color:#6CB6FF\"> null</span></span>\n<span data-line=\"\"><span style=\"color:#ADBAC7\">}</span></span>\n<span data-line=\"\"> </span>\n<span data-line=\"\"><span style=\"color:#768390\">// 署名対象データ: ヘッダー.ペイロード</span></span>\n<span data-line=\"\"><span style=\"color:#F47067\">const</span><span style=\"color:#6CB6FF\"> signedData</span><span style=\"color:#F47067\"> =</span><span style=\"color:#F47067\"> new</span><span style=\"color:#DCBDFB\"> TextEncoder</span><span style=\"color:#ADBAC7\">().</span><span style=\"color:#DCBDFB\">encode</span><span style=\"color:#ADBAC7\">(</span><span style=\"color:#96D0FF\">`${</span><span style=\"color:#ADBAC7\">parts</span><span style=\"color:#96D0FF\">[</span><span style=\"color:#6CB6FF\">0</span><span style=\"color:#96D0FF\">]</span><span style=\"color:#96D0FF\">}.${</span><span style=\"color:#ADBAC7\">parts</span><span style=\"color:#96D0FF\">[</span><span style=\"color:#6CB6FF\">1</span><span style=\"color:#96D0FF\">]</span><span style=\"color:#96D0FF\">}`</span><span style=\"color:#ADBAC7\">)</span></span>\n<span data-line=\"\"> </span>\n<span data-line=\"\"><span style=\"color:#768390\">// 署名をBase64URLからバイナリに変換</span></span>\n<span data-line=\"\"><span style=\"color:#F47067\">const</span><span style=\"color:#6CB6FF\"> signature</span><span style=\"color:#F47067\"> =</span><span style=\"color:#DCBDFB\"> base64UrlToArrayBuffer</span><span style=\"color:#ADBAC7\">(parts[</span><span style=\"color:#6CB6FF\">2</span><span style=\"color:#ADBAC7\">])</span></span>\n<span data-line=\"\"> </span>\n<span data-line=\"\"><span style=\"color:#768390\">// WebCrypto APIで検証</span></span>\n<span data-line=\"\"><span style=\"color:#F47067\">const</span><span style=\"color:#6CB6FF\"> isValid</span><span style=\"color:#F47067\"> =</span><span style=\"color:#F47067\"> await</span><span style=\"color:#ADBAC7\"> crypto.subtle.</span><span style=\"color:#DCBDFB\">verify</span><span style=\"color:#ADBAC7\">(</span></span>\n<span data-line=\"\"><span style=\"color:#ADBAC7\">  { name: </span><span style=\"color:#96D0FF\">'RSASSA-PKCS1-v1_5'</span><span style=\"color:#ADBAC7\"> },</span></span>\n<span data-line=\"\"><span style=\"color:#ADBAC7\">  publicKey,</span></span>\n<span data-line=\"\"><span style=\"color:#ADBAC7\">  signature,</span></span>\n<span data-line=\"\"><span style=\"color:#ADBAC7\">  signedData</span></span>\n<span data-line=\"\"><span style=\"color:#ADBAC7\">)</span></span>\n<span data-line=\"\"> </span>\n<span data-line=\"\"><span style=\"color:#F47067\">if</span><span style=\"color:#ADBAC7\"> (</span><span style=\"color:#F47067\">!</span><span style=\"color:#ADBAC7\">isValid) {</span></span>\n<span data-line=\"\"><span style=\"color:#ADBAC7\">  console.</span><span style=\"color:#DCBDFB\">log</span><span style=\"color:#ADBAC7\">(</span><span style=\"color:#96D0FF\">'Invalid signature'</span><span style=\"color:#ADBAC7\">)</span></span>\n<span data-line=\"\"><span style=\"color:#F47067\">  return</span><span style=\"color:#6CB6FF\"> null</span></span>\n<span data-line=\"\"><span style=\"color:#ADBAC7\">}</span></span></code></pre></figure>\n<p><strong>WebCrypto API</strong> はブラウザやCloudflare Workersで使える標準的な暗号化API。外部ライブラリ不要で署名検証ができる。</p>\n<hr>\n<br>\n<h2 id=\"x509証明書の解析\">X.509証明書の解析</h2>\n<p>Googleから取得する公開鍵はPEM形式のX.509証明書として提供される。</p>\n<h3 id=\"証明書の形式\">証明書の形式</h3>\n<figure class=\"mdn-code\" data-rehype-pretty-code-figure=\"\"><div class=\"mdn-code-header\"><div class=\"mdn-code-lang\">TEXT</div><div class=\"mdn-code-actions\"><button type=\"button\" class=\"mdn-code-copy\" aria-label=\"Copy code to clipboard\">Copy</button></div></div><pre tabindex=\"0\" data-language=\"plaintext\" data-theme=\"github-dark-dimmed\"><code data-language=\"plaintext\" data-theme=\"github-dark-dimmed\" style=\"display: grid;\"><span data-line=\"\"><span>-----BEGIN CERTIFICATE-----</span></span>\n<span data-line=\"\"><span>MIIDJjCCAg6gAwIBAgIIYS...（Base64エンコードされたバイナリ）</span></span>\n<span data-line=\"\"><span>-----END CERTIFICATE-----</span></span></code></pre></figure>\n<h3 id=\"証明書からの公開鍵抽出\">証明書からの公開鍵抽出</h3>\n<figure class=\"mdn-code\" data-rehype-pretty-code-figure=\"\"><div class=\"mdn-code-header\"><div class=\"mdn-code-lang\">TS</div><div class=\"mdn-code-actions\"><button type=\"button\" class=\"mdn-code-copy\" aria-label=\"Copy code to clipboard\">Copy</button></div></div><pre tabindex=\"0\" data-language=\"typescript\" data-theme=\"github-dark-dimmed\"><code data-language=\"typescript\" data-theme=\"github-dark-dimmed\" style=\"display: grid;\"><span data-line=\"\"><span style=\"color:#F47067\">async</span><span style=\"color:#F47067\"> function</span><span style=\"color:#DCBDFB\"> importPublicKeyFromCert</span><span style=\"color:#ADBAC7\">(</span><span style=\"color:#F69D50\">pem</span><span style=\"color:#F47067\">:</span><span style=\"color:#6CB6FF\"> string</span><span style=\"color:#ADBAC7\">)</span><span style=\"color:#F47067\">:</span><span style=\"color:#F69D50\"> Promise</span><span style=\"color:#ADBAC7\">&#x3C;</span><span style=\"color:#F69D50\">CryptoKey</span><span style=\"color:#ADBAC7\">> {</span></span>\n<span data-line=\"\"><span style=\"color:#768390\">  // 1. PEMヘッダー/フッターを削除</span></span>\n<span data-line=\"\"><span style=\"color:#F47067\">  const</span><span style=\"color:#6CB6FF\"> pemContents</span><span style=\"color:#F47067\"> =</span><span style=\"color:#ADBAC7\"> pem</span></span>\n<span data-line=\"\"><span style=\"color:#ADBAC7\">    .</span><span style=\"color:#DCBDFB\">replace</span><span style=\"color:#ADBAC7\">(</span><span style=\"color:#96D0FF\">/-----BEGIN CERTIFICATE-----/</span><span style=\"color:#F47067\">g</span><span style=\"color:#ADBAC7\">, </span><span style=\"color:#96D0FF\">''</span><span style=\"color:#ADBAC7\">)</span></span>\n<span data-line=\"\"><span style=\"color:#ADBAC7\">    .</span><span style=\"color:#DCBDFB\">replace</span><span style=\"color:#ADBAC7\">(</span><span style=\"color:#96D0FF\">/-----END CERTIFICATE-----/</span><span style=\"color:#F47067\">g</span><span style=\"color:#ADBAC7\">, </span><span style=\"color:#96D0FF\">''</span><span style=\"color:#ADBAC7\">)</span></span>\n<span data-line=\"\"><span style=\"color:#ADBAC7\">    .</span><span style=\"color:#DCBDFB\">replace</span><span style=\"color:#ADBAC7\">(</span><span style=\"color:#96D0FF\">/</span><span style=\"color:#6CB6FF\">\\s</span><span style=\"color:#96D0FF\">/</span><span style=\"color:#F47067\">g</span><span style=\"color:#ADBAC7\">, </span><span style=\"color:#96D0FF\">''</span><span style=\"color:#ADBAC7\">)</span></span>\n<span data-line=\"\"> </span>\n<span data-line=\"\"><span style=\"color:#768390\">  // 2. Base64デコードしてバイナリに変換</span></span>\n<span data-line=\"\"><span style=\"color:#F47067\">  const</span><span style=\"color:#6CB6FF\"> binaryDer</span><span style=\"color:#F47067\"> =</span><span style=\"color:#DCBDFB\"> atob</span><span style=\"color:#ADBAC7\">(pemContents)</span></span>\n<span data-line=\"\"><span style=\"color:#F47067\">  const</span><span style=\"color:#6CB6FF\"> bytes</span><span style=\"color:#F47067\"> =</span><span style=\"color:#F47067\"> new</span><span style=\"color:#DCBDFB\"> Uint8Array</span><span style=\"color:#ADBAC7\">(binaryDer.</span><span style=\"color:#6CB6FF\">length</span><span style=\"color:#ADBAC7\">)</span></span>\n<span data-line=\"\"><span style=\"color:#F47067\">  for</span><span style=\"color:#ADBAC7\"> (</span><span style=\"color:#F47067\">let</span><span style=\"color:#ADBAC7\"> i </span><span style=\"color:#F47067\">=</span><span style=\"color:#6CB6FF\"> 0</span><span style=\"color:#ADBAC7\">; i </span><span style=\"color:#F47067\">&#x3C;</span><span style=\"color:#ADBAC7\"> binaryDer.</span><span style=\"color:#6CB6FF\">length</span><span style=\"color:#ADBAC7\">; i</span><span style=\"color:#F47067\">++</span><span style=\"color:#ADBAC7\">) {</span></span>\n<span data-line=\"\"><span style=\"color:#ADBAC7\">    bytes[i] </span><span style=\"color:#F47067\">=</span><span style=\"color:#ADBAC7\"> binaryDer.</span><span style=\"color:#DCBDFB\">charCodeAt</span><span style=\"color:#ADBAC7\">(i)</span></span>\n<span data-line=\"\"><span style=\"color:#ADBAC7\">  }</span></span>\n<span data-line=\"\"> </span>\n<span data-line=\"\"><span style=\"color:#768390\">  // 3. ASN.1 DER形式の証明書から公開鍵部分（SPKI）を抽出</span></span>\n<span data-line=\"\"><span style=\"color:#F47067\">  const</span><span style=\"color:#6CB6FF\"> spki</span><span style=\"color:#F47067\"> =</span><span style=\"color:#DCBDFB\"> extractSpkiFromCertificate</span><span style=\"color:#ADBAC7\">(bytes)</span></span>\n<span data-line=\"\"> </span>\n<span data-line=\"\"><span style=\"color:#768390\">  // 4. WebCrypto APIでCryptoKeyオブジェクトに変換</span></span>\n<span data-line=\"\"><span style=\"color:#F47067\">  return</span><span style=\"color:#F47067\"> await</span><span style=\"color:#ADBAC7\"> crypto.subtle.</span><span style=\"color:#DCBDFB\">importKey</span><span style=\"color:#ADBAC7\">(</span></span>\n<span data-line=\"\"><span style=\"color:#96D0FF\">    'spki'</span><span style=\"color:#ADBAC7\">,                                    </span><span style=\"color:#768390\">// 形式</span></span>\n<span data-line=\"\"><span style=\"color:#ADBAC7\">    spki,                                      </span><span style=\"color:#768390\">// 公開鍵データ</span></span>\n<span data-line=\"\"><span style=\"color:#ADBAC7\">    { name: </span><span style=\"color:#96D0FF\">'RSASSA-PKCS1-v1_5'</span><span style=\"color:#ADBAC7\">, hash: </span><span style=\"color:#96D0FF\">'SHA-256'</span><span style=\"color:#ADBAC7\"> },  </span><span style=\"color:#768390\">// アルゴリズム</span></span>\n<span data-line=\"\"><span style=\"color:#6CB6FF\">    false</span><span style=\"color:#ADBAC7\">,                                     </span><span style=\"color:#768390\">// エクスポート不可</span></span>\n<span data-line=\"\"><span style=\"color:#ADBAC7\">    [</span><span style=\"color:#96D0FF\">'verify'</span><span style=\"color:#ADBAC7\">]                                 </span><span style=\"color:#768390\">// 検証用途</span></span>\n<span data-line=\"\"><span style=\"color:#ADBAC7\">  )</span></span>\n<span data-line=\"\"><span style=\"color:#ADBAC7\">}</span></span></code></pre></figure>\n<hr>\n<br>\n<h2 id=\"管理者認可の仕組み\">管理者認可の仕組み</h2>\n<p>トークンが有効でも、そのユーザーが「管理者かどうか」の確認が別途必要。</p>\n<figure class=\"mdn-code\" data-rehype-pretty-code-figure=\"\"><div class=\"mdn-code-header\"><div class=\"mdn-code-lang\">TS</div><div class=\"mdn-code-actions\"><button type=\"button\" class=\"mdn-code-copy\" aria-label=\"Copy code to clipboard\">Copy</button></div></div><pre tabindex=\"0\" data-language=\"typescript\" data-theme=\"github-dark-dimmed\"><code data-language=\"typescript\" data-theme=\"github-dark-dimmed\" style=\"display: grid;\"><span data-line=\"\"><span style=\"color:#F47067\">async</span><span style=\"color:#F47067\"> function</span><span style=\"color:#DCBDFB\"> checkAdminAuth</span><span style=\"color:#ADBAC7\">(</span><span style=\"color:#F69D50\">req</span><span style=\"color:#F47067\">:</span><span style=\"color:#F69D50\"> Request</span><span style=\"color:#ADBAC7\">, </span><span style=\"color:#F69D50\">env</span><span style=\"color:#F47067\">:</span><span style=\"color:#F69D50\"> Env</span><span style=\"color:#ADBAC7\">)</span><span style=\"color:#F47067\">:</span><span style=\"color:#F69D50\"> Promise</span><span style=\"color:#ADBAC7\">&#x3C;</span><span style=\"color:#6CB6FF\">boolean</span><span style=\"color:#ADBAC7\">> {</span></span>\n<span data-line=\"\"><span style=\"color:#F47067\">  const</span><span style=\"color:#6CB6FF\"> authHeader</span><span style=\"color:#F47067\"> =</span><span style=\"color:#ADBAC7\"> req.headers.</span><span style=\"color:#DCBDFB\">get</span><span style=\"color:#ADBAC7\">(</span><span style=\"color:#96D0FF\">'Authorization'</span><span style=\"color:#ADBAC7\">)</span></span>\n<span data-line=\"\"> </span>\n<span data-line=\"\"><span style=\"color:#F47067\">  if</span><span style=\"color:#ADBAC7\"> (authHeader?.</span><span style=\"color:#DCBDFB\">startsWith</span><span style=\"color:#ADBAC7\">(</span><span style=\"color:#96D0FF\">'Bearer '</span><span style=\"color:#ADBAC7\">)) {</span></span>\n<span data-line=\"\"><span style=\"color:#F47067\">    const</span><span style=\"color:#6CB6FF\"> token</span><span style=\"color:#F47067\"> =</span><span style=\"color:#ADBAC7\"> authHeader.</span><span style=\"color:#DCBDFB\">slice</span><span style=\"color:#ADBAC7\">(</span><span style=\"color:#6CB6FF\">7</span><span style=\"color:#ADBAC7\">)  </span><span style=\"color:#768390\">// \"Bearer \"を除去</span></span>\n<span data-line=\"\"><span style=\"color:#F47067\">    const</span><span style=\"color:#6CB6FF\"> payload</span><span style=\"color:#F47067\"> =</span><span style=\"color:#F47067\"> await</span><span style=\"color:#DCBDFB\"> verifyFirebaseToken</span><span style=\"color:#ADBAC7\">(token, env)</span></span>\n<span data-line=\"\"> </span>\n<span data-line=\"\"><span style=\"color:#F47067\">    if</span><span style=\"color:#ADBAC7\"> (payload?.email) {</span></span>\n<span data-line=\"\"><span style=\"color:#768390\">      // 環境変数で設定した管理者メールリストと照合</span></span>\n<span data-line=\"\"><span style=\"color:#F47067\">      const</span><span style=\"color:#6CB6FF\"> adminEmails</span><span style=\"color:#F47067\"> =</span><span style=\"color:#ADBAC7\"> (env.</span><span style=\"color:#6CB6FF\">ADMIN_EMAILS</span><span style=\"color:#F47067\"> ||</span><span style=\"color:#96D0FF\"> ''</span><span style=\"color:#ADBAC7\">)</span></span>\n<span data-line=\"\"><span style=\"color:#ADBAC7\">        .</span><span style=\"color:#DCBDFB\">split</span><span style=\"color:#ADBAC7\">(</span><span style=\"color:#96D0FF\">','</span><span style=\"color:#ADBAC7\">)</span></span>\n<span data-line=\"\"><span style=\"color:#ADBAC7\">        .</span><span style=\"color:#DCBDFB\">map</span><span style=\"color:#ADBAC7\">(</span><span style=\"color:#F69D50\">e</span><span style=\"color:#F47067\"> =></span><span style=\"color:#ADBAC7\"> e.</span><span style=\"color:#DCBDFB\">trim</span><span style=\"color:#ADBAC7\">().</span><span style=\"color:#DCBDFB\">toLowerCase</span><span style=\"color:#ADBAC7\">())</span></span>\n<span data-line=\"\"> </span>\n<span data-line=\"\"><span style=\"color:#F47067\">      if</span><span style=\"color:#ADBAC7\"> (adminEmails.</span><span style=\"color:#DCBDFB\">includes</span><span style=\"color:#ADBAC7\">(payload.email.</span><span style=\"color:#DCBDFB\">toLowerCase</span><span style=\"color:#ADBAC7\">())) {</span></span>\n<span data-line=\"\"><span style=\"color:#F47067\">        return</span><span style=\"color:#6CB6FF\"> true</span><span style=\"color:#768390\">  // 管理者として認証成功</span></span>\n<span data-line=\"\"><span style=\"color:#ADBAC7\">      }</span></span>\n<span data-line=\"\"><span style=\"color:#ADBAC7\">    }</span></span>\n<span data-line=\"\"><span style=\"color:#ADBAC7\">  }</span></span>\n<span data-line=\"\"> </span>\n<span data-line=\"\"><span style=\"color:#F47067\">  return</span><span style=\"color:#6CB6FF\"> false</span><span style=\"color:#768390\">  // 管理者ではない</span></span>\n<span data-line=\"\"><span style=\"color:#ADBAC7\">}</span></span></code></pre></figure>\n<p><strong>環境変数の設定例（Cloudflare Dashboard）:</strong></p>\n<figure class=\"mdn-code\" data-rehype-pretty-code-figure=\"\"><div class=\"mdn-code-header\"><div class=\"mdn-code-lang\">TEXT</div><div class=\"mdn-code-actions\"><button type=\"button\" class=\"mdn-code-copy\" aria-label=\"Copy code to clipboard\">Copy</button></div></div><pre tabindex=\"0\" data-language=\"plaintext\" data-theme=\"github-dark-dimmed\"><code data-language=\"plaintext\" data-theme=\"github-dark-dimmed\" style=\"display: grid;\"><span data-line=\"\"><span>ADMIN_EMAILS = \"admin1@example.com,admin2@example.com\"</span></span>\n<span data-line=\"\"><span>FIREBASE_PROJECT_ID = \"my-firebase-project\"</span></span></code></pre></figure>\n<hr>\n<br>\n<h2 id=\"セキュリティのベストプラクティス\">セキュリティのベストプラクティス</h2>\n<h3 id=\"実装されている対策一覧\">実装されている対策一覧</h3>\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n<div class=\"table-wrapper\"><table><thead><tr><th>対策</th><th>目的</th><th>実装箇所</th></tr></thead><tbody><tr><td>RS256署名検証</td><td>トークン偽造防止</td><td><span data-rehype-pretty-code-figure=\"\"><code data-language=\"plaintext\" data-theme=\"github-dark-dimmed\"><span data-line=\"\"><span>verifyFirebaseToken()</span></span></code></span></td></tr><tr><td>アルゴリズム固定（RS256）</td><td>ダウングレード攻撃防止</td><td>ヘッダー検証</td></tr><tr><td>有効期限チェック（exp）</td><td>期限切れトークン拒否</td><td>ペイロード検証</td></tr><tr><td>発行者検証（iss）</td><td>不正発行元トークン拒否</td><td>ペイロード検証</td></tr><tr><td>対象者検証（aud）</td><td>他プロジェクト向けトークン拒否</td><td>ペイロード検証</td></tr><tr><td>公開鍵キャッシュ</td><td>パフォーマンス最適化</td><td><span data-rehype-pretty-code-figure=\"\"><code data-language=\"plaintext\" data-theme=\"github-dark-dimmed\"><span data-line=\"\"><span>getGooglePublicKeys()</span></span></code></span></td></tr><tr><td>CORS設定</td><td>クロスサイトリクエスト制御</td><td><span data-rehype-pretty-code-figure=\"\"><code data-language=\"plaintext\" data-theme=\"github-dark-dimmed\"><span data-line=\"\"><span>corsHeaders</span></span></code></span></td></tr><tr><td>管理者メールリスト</td><td>認可制御</td><td><span data-rehype-pretty-code-figure=\"\"><code data-language=\"plaintext\" data-theme=\"github-dark-dimmed\"><span data-line=\"\"><span>checkAdminAuth()</span></span></code></span></td></tr></tbody></table></div>\n<h3 id=\"やってはいけないこと\">やってはいけないこと</h3>\n<figure class=\"mdn-code\" data-rehype-pretty-code-figure=\"\"><div class=\"mdn-code-header\"><div class=\"mdn-code-lang\">TS</div><div class=\"mdn-code-actions\"><button type=\"button\" class=\"mdn-code-copy\" aria-label=\"Copy code to clipboard\">Copy</button></div></div><pre tabindex=\"0\" data-language=\"typescript\" data-theme=\"github-dark-dimmed\"><code data-language=\"typescript\" data-theme=\"github-dark-dimmed\" style=\"display: grid;\"><span data-line=\"\"><span style=\"color:#768390\">// 署名を検証せずにペイロードを信用する</span></span>\n<span data-line=\"\"><span style=\"color:#F47067\">const</span><span style=\"color:#6CB6FF\"> payload</span><span style=\"color:#F47067\"> =</span><span style=\"color:#6CB6FF\"> JSON</span><span style=\"color:#ADBAC7\">.</span><span style=\"color:#DCBDFB\">parse</span><span style=\"color:#ADBAC7\">(</span><span style=\"color:#DCBDFB\">atob</span><span style=\"color:#ADBAC7\">(token.</span><span style=\"color:#DCBDFB\">split</span><span style=\"color:#ADBAC7\">(</span><span style=\"color:#96D0FF\">'.'</span><span style=\"color:#ADBAC7\">)[</span><span style=\"color:#6CB6FF\">1</span><span style=\"color:#ADBAC7\">]))</span></span>\n<span data-line=\"\"><span style=\"color:#F47067\">if</span><span style=\"color:#ADBAC7\"> (payload.email </span><span style=\"color:#F47067\">===</span><span style=\"color:#96D0FF\"> 'admin@example.com'</span><span style=\"color:#ADBAC7\">) {</span></span>\n<span data-line=\"\"><span style=\"color:#768390\">  // 危険！誰でもこのペイロードを作れる</span></span>\n<span data-line=\"\"><span style=\"color:#ADBAC7\">}</span></span>\n<span data-line=\"\"> </span>\n<span data-line=\"\"><span style=\"color:#768390\">// アルゴリズムを動的に決める</span></span>\n<span data-line=\"\"><span style=\"color:#F47067\">const</span><span style=\"color:#6CB6FF\"> alg</span><span style=\"color:#F47067\"> =</span><span style=\"color:#ADBAC7\"> header.alg  </span><span style=\"color:#768390\">// 攻撃者が \"none\" を指定できてしまう</span></span>\n<span data-line=\"\"> </span>\n<span data-line=\"\"><span style=\"color:#768390\">// 有効期限をチェックしない</span></span>\n<span data-line=\"\"><span style=\"color:#768390\">// 一度発行されたトークンが永久に有効になってしまう</span></span></code></pre></figure>\n<h3 id=\"本番環境でのチェックリスト\">本番環境でのチェックリスト</h3>\n<ul>\n<li><span data-rehype-pretty-code-figure=\"\"><code data-language=\"plaintext\" data-theme=\"github-dark-dimmed\"><span data-line=\"\"><span>FIREBASE_PROJECT_ID</span></span></code></span> が正しく設定されているか</li>\n<li><span data-rehype-pretty-code-figure=\"\"><code data-language=\"plaintext\" data-theme=\"github-dark-dimmed\"><span data-line=\"\"><span>ADMIN_EMAILS</span></span></code></span> に管理者のメールのみが含まれているか</li>\n<li>HTTPS経由でのみAPIにアクセスできるか</li>\n<li>本番環境の秘密情報がログに出力されていないか</li>\n<li>公開鍵のキャッシュが正しく動作しているか</li>\n</ul>\n<hr>\n<br>\n<h2 id=\"トラブルシューティング\">トラブルシューティング</h2>\n<h3 id=\"よくあるエラーと対処法\">よくあるエラーと対処法</h3>\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n<div class=\"table-wrapper\"><table><thead><tr><th>エラーメッセージ</th><th>原因</th><th>対処法</th></tr></thead><tbody><tr><td><span data-rehype-pretty-code-figure=\"\"><code data-language=\"plaintext\" data-theme=\"github-dark-dimmed\"><span data-line=\"\"><span>Token expired</span></span></code></span></td><td>トークンの有効期限切れ</td><td>フロントエンドで<span data-rehype-pretty-code-figure=\"\"><code data-language=\"plaintext\" data-theme=\"github-dark-dimmed\"><span data-line=\"\"><span>getIdToken(true)</span></span></code></span>を呼んで再取得</td></tr><tr><td><span data-rehype-pretty-code-figure=\"\"><code data-language=\"plaintext\" data-theme=\"github-dark-dimmed\"><span data-line=\"\"><span>Invalid issuer</span></span></code></span></td><td><span data-rehype-pretty-code-figure=\"\"><code data-language=\"plaintext\" data-theme=\"github-dark-dimmed\"><span data-line=\"\"><span>FIREBASE_PROJECT_ID</span></span></code></span>の設定ミス</td><td>環境変数を確認</td></tr><tr><td><span data-rehype-pretty-code-figure=\"\"><code data-language=\"plaintext\" data-theme=\"github-dark-dimmed\"><span data-line=\"\"><span>Invalid audience</span></span></code></span></td><td>別プロジェクトのトークン</td><td>FirebaseプロジェクトIDを確認</td></tr><tr><td><span data-rehype-pretty-code-figure=\"\"><code data-language=\"plaintext\" data-theme=\"github-dark-dimmed\"><span data-line=\"\"><span>Public key not found</span></span></code></span></td><td>Google公開鍵の取得失敗</td><td>ネットワーク接続を確認、キャッシュをクリア</td></tr><tr><td><span data-rehype-pretty-code-figure=\"\"><code data-language=\"plaintext\" data-theme=\"github-dark-dimmed\"><span data-line=\"\"><span>Invalid signature</span></span></code></span></td><td>トークンが改ざんされている</td><td>正規のログインフローを使用しているか確認</td></tr></tbody></table></div>\n<h3 id=\"デバッグ方法\">デバッグ方法</h3>\n<figure class=\"mdn-code\" data-rehype-pretty-code-figure=\"\"><div class=\"mdn-code-header\"><div class=\"mdn-code-lang\">TS</div><div class=\"mdn-code-actions\"><button type=\"button\" class=\"mdn-code-copy\" aria-label=\"Copy code to clipboard\">Copy</button></div></div><pre tabindex=\"0\" data-language=\"typescript\" data-theme=\"github-dark-dimmed\"><code data-language=\"typescript\" data-theme=\"github-dark-dimmed\" style=\"display: grid;\"><span data-line=\"\"><span style=\"color:#768390\">// トークンの中身を確認（開発時のみ）</span></span>\n<span data-line=\"\"><span style=\"color:#F47067\">const</span><span style=\"color:#6CB6FF\"> parts</span><span style=\"color:#F47067\"> =</span><span style=\"color:#ADBAC7\"> token.</span><span style=\"color:#DCBDFB\">split</span><span style=\"color:#ADBAC7\">(</span><span style=\"color:#96D0FF\">'.'</span><span style=\"color:#ADBAC7\">)</span></span>\n<span data-line=\"\"><span style=\"color:#ADBAC7\">console.</span><span style=\"color:#DCBDFB\">log</span><span style=\"color:#ADBAC7\">(</span><span style=\"color:#96D0FF\">'Header:'</span><span style=\"color:#ADBAC7\">, </span><span style=\"color:#6CB6FF\">JSON</span><span style=\"color:#ADBAC7\">.</span><span style=\"color:#DCBDFB\">parse</span><span style=\"color:#ADBAC7\">(</span><span style=\"color:#DCBDFB\">atob</span><span style=\"color:#ADBAC7\">(parts[</span><span style=\"color:#6CB6FF\">0</span><span style=\"color:#ADBAC7\">])))</span></span>\n<span data-line=\"\"><span style=\"color:#ADBAC7\">console.</span><span style=\"color:#DCBDFB\">log</span><span style=\"color:#ADBAC7\">(</span><span style=\"color:#96D0FF\">'Payload:'</span><span style=\"color:#ADBAC7\">, </span><span style=\"color:#6CB6FF\">JSON</span><span style=\"color:#ADBAC7\">.</span><span style=\"color:#DCBDFB\">parse</span><span style=\"color:#ADBAC7\">(</span><span style=\"color:#DCBDFB\">atob</span><span style=\"color:#ADBAC7\">(parts[</span><span style=\"color:#6CB6FF\">1</span><span style=\"color:#ADBAC7\">])))</span></span></code></pre></figure>\n<p><strong>注意:</strong> 本番環境ではトークンをログに出力しないこと。</p>\n<hr>\n<br>\n<h2 id=\"参考リンク\">参考リンク</h2>\n<ul>\n<li><a href=\"https://firebase.google.com/docs/auth/admin/verify-id-tokens\">Firebase公式: IDトークンの検証</a></li>\n<li><a href=\"https://jwt.io/\">JWT.io: JWTのデバッグツール</a></li>\n<li><a href=\"https://developer.mozilla.org/ja/docs/Web/API/Web_Crypto_API\">MDN: Web Crypto API</a></li>\n<li><a href=\"https://datatracker.ietf.org/doc/html/rfc7519\">RFC 7519: JSON Web Token (JWT)</a></li>\n</ul>"
  },
  {
    "slug": "react-hooks-tutorial",
    "title": "README2",
    "summary": "useState, useEffect, useMemo, useCallbackなど、React Hooksを初学者向けに詳しく解説",
    "createdAt": "2025-12-21",
    "tags": [
      "React",
      "TypeScript",
      "Hooks",
      "Tutorial"
    ],
    "html": "<p>React Hooksは関数コンポーネントで状態管理や副作用処理を可能にする機能。このサイトで使用しているHooksを詳しく解説する。</p>\n<h2 id=\"目次\">目次</h2>\n<div class=\"toc-box\"><ul>\n<li><a href=\"#usestate---%E7%8A%B6%E6%85%8B%E7%AE%A1%E7%90%86%E3%83%95%E3%83%83%E3%82%AF\">useState - 状態管理フック</a></li>\n<li><a href=\"#%E5%9F%BA%E6%9C%AC%E7%9A%84%E3%81%AA%E4%BD%BF%E3%81%84%E6%96%B9\">基本的な使い方</a></li>\n<li><a href=\"#%E6%A7%8B%E6%96%87%E3%81%AE%E8%AA%AD%E3%81%BF%E6%96%B9\">構文の読み方</a></li>\n<li><a href=\"#%E6%9C%AC%E3%83%97%E3%83%AD%E3%82%B8%E3%82%A7%E3%82%AF%E3%83%88%E3%81%A7%E3%81%AE%E4%BD%BF%E7%94%A8%E4%BE%8B\">本プロジェクトでの使用例</a></li>\n<li><a href=\"#useeffect---%E5%89%AF%E4%BD%9C%E7%94%A8%E3%83%95%E3%83%83%E3%82%AF\">useEffect - 副作用フック</a></li>\n<li><a href=\"#%E5%9F%BA%E6%9C%AC%E3%83%91%E3%82%BF%E3%83%BC%E3%83%B3\">基本パターン</a></li>\n<li><a href=\"#%E4%BE%9D%E5%AD%98%E9%85%8D%E5%88%97%E3%81%A8%E3%81%AF\">依存配列とは</a></li>\n<li><a href=\"#%E6%9C%AC%E3%83%97%E3%83%AD%E3%82%B8%E3%82%A7%E3%82%AF%E3%83%88%E3%81%A7%E3%81%AE%E4%BD%BF%E7%94%A8%E4%BE%8B-1\">本プロジェクトでの使用例</a></li>\n<li><a href=\"#usecallback---%E9%96%A2%E6%95%B0%E3%83%A1%E3%83%A2%E5%8C%96%E3%83%95%E3%83%83%E3%82%AF\">useCallback - 関数メモ化フック</a></li>\n<li><a href=\"#%E3%81%AA%E3%81%9C%E5%BF%85%E8%A6%81%E3%81%AA%E3%81%AE%E3%81%8B\">なぜ必要なのか</a></li>\n<li><a href=\"#%E6%9C%AC%E3%83%97%E3%83%AD%E3%82%B8%E3%82%A7%E3%82%AF%E3%83%88%E3%81%A7%E3%81%AE%E4%BD%BF%E7%94%A8%E4%BE%8B-2\">本プロジェクトでの使用例</a></li>\n<li><a href=\"#usememo---%E5%80%A4%E3%83%A1%E3%83%A2%E5%8C%96%E3%83%95%E3%83%83%E3%82%AF\">useMemo - 値メモ化フック</a></li>\n<li><a href=\"#%E5%9F%BA%E6%9C%AC%E7%9A%84%E3%81%AA%E4%BD%BF%E3%81%84%E6%96%B9-1\">基本的な使い方</a></li>\n<li><a href=\"#usecallback%E3%81%A8usememo%E3%81%AE%E9%81%95%E3%81%84\">useCallbackとuseMemoの違い</a></li>\n<li><a href=\"#%E6%9C%AC%E3%83%97%E3%83%AD%E3%82%B8%E3%82%A7%E3%82%AF%E3%83%88%E3%81%A7%E3%81%AE%E4%BD%BF%E7%94%A8%E4%BE%8B-3\">本プロジェクトでの使用例</a></li>\n<li><a href=\"#useref---%E5%8F%82%E7%85%A7%E3%83%95%E3%83%83%E3%82%AF\">useRef - 参照フック</a></li>\n<li><a href=\"#%E4%B8%BB%E3%81%AA%E7%94%A8%E9%80%94\">主な用途</a></li>\n<li><a href=\"#usestate%E3%81%A8useref%E3%81%AE%E4%BD%BF%E3%81%84%E5%88%86%E3%81%91\">useStateとuseRefの使い分け</a></li>\n<li><a href=\"#%E6%9C%AC%E3%83%97%E3%83%AD%E3%82%B8%E3%82%A7%E3%82%AF%E3%83%88%E3%81%A7%E3%81%AE%E4%BD%BF%E7%94%A8%E4%BE%8B-4\">本プロジェクトでの使用例</a></li>\n<li><a href=\"#usecontext---%E3%82%B3%E3%83%B3%E3%83%86%E3%82%AD%E3%82%B9%E3%83%88%E6%B6%88%E8%B2%BB%E3%83%95%E3%83%83%E3%82%AF\">useContext - コンテキスト消費フック</a></li>\n<li><a href=\"#%E3%81%AA%E3%81%9C%E5%BF%85%E8%A6%81%E3%81%AA%E3%81%AE%E3%81%8B-1\">なぜ必要なのか</a></li>\n<li><a href=\"#%E6%9C%AC%E3%83%97%E3%83%AD%E3%82%B8%E3%82%A7%E3%82%AF%E3%83%88%E3%81%A7%E3%81%AE%E4%BD%BF%E7%94%A8%E4%BE%8B-5\">本プロジェクトでの使用例</a></li>\n<li><a href=\"#lazy-%E3%81%A8-suspense---%E9%81%85%E5%BB%B6%E8%AA%AD%E3%81%BF%E8%BE%BC%E3%81%BF\">lazy と Suspense - 遅延読み込み</a></li>\n<li><a href=\"#lazy---%E3%82%B3%E3%83%BC%E3%83%89%E5%88%86%E5%89%B2\">lazy - コード分割</a></li>\n<li><a href=\"#suspense---%E3%83%AD%E3%83%BC%E3%83%87%E3%82%A3%E3%83%B3%E3%82%B0%E8%A1%A8%E7%A4%BA\">Suspense - ローディング表示</a></li>\n<li><a href=\"#%E6%9C%AC%E3%83%97%E3%83%AD%E3%82%B8%E3%82%A7%E3%82%AF%E3%83%88%E3%81%A7%E3%81%AE%E4%BD%BF%E7%94%A8%E4%BE%8B-6\">本プロジェクトでの使用例</a></li>\n<li><a href=\"#uselayouteffect---%E5%90%8C%E6%9C%9F%E7%9A%84%E5%89%AF%E4%BD%9C%E7%94%A8%E3%83%95%E3%83%83%E3%82%AF\">useLayoutEffect - 同期的副作用フック</a></li>\n<li><a href=\"#useeffect%E3%81%A8%E3%81%AE%E9%81%95%E3%81%84\">useEffectとの違い</a></li>\n<li><a href=\"#%E4%BD%BF%E3%81%84%E5%88%86%E3%81%91\">使い分け</a></li>\n<li><a href=\"#%E6%9C%AC%E3%83%97%E3%83%AD%E3%82%B8%E3%82%A7%E3%82%AF%E3%83%88%E3%81%A7%E3%81%AE%E4%BD%BF%E7%94%A8%E4%BE%8B-7\">本プロジェクトでの使用例</a></li>\n<li><a href=\"#starttransition---%E4%BD%8E%E5%84%AA%E5%85%88%E5%BA%A6%E6%9B%B4%E6%96%B0\">startTransition - 低優先度更新</a></li>\n<li><a href=\"#%E3%81%AA%E3%81%9C%E5%BF%85%E8%A6%81%E3%81%AA%E3%81%AE%E3%81%8B-2\">なぜ必要なのか</a></li>\n<li><a href=\"#%E6%9C%AC%E3%83%97%E3%83%AD%E3%82%B8%E3%82%A7%E3%82%AF%E3%83%88%E3%81%A7%E3%81%AE%E4%BD%BF%E7%94%A8%E4%BE%8B-8\">本プロジェクトでの使用例</a></li>\n</ul></div>\n<br>\n<h2 id=\"usestate---状態管理フック\">useState - 状態管理フック</h2>\n<p>コンポーネント内で変更可能な「状態」を保持。値が変わると自動で再レンダリングされる。</p>\n<h3 id=\"基本的な使い方\">基本的な使い方</h3>\n<figure class=\"mdn-code\" data-rehype-pretty-code-figure=\"\"><div class=\"mdn-code-header\"><div class=\"mdn-code-lang\">TS</div><div class=\"mdn-code-actions\"><button type=\"button\" class=\"mdn-code-copy\" aria-label=\"Copy code to clipboard\">Copy</button></div></div><pre tabindex=\"0\" data-language=\"typescript\" data-theme=\"github-dark-dimmed\"><code data-language=\"typescript\" data-theme=\"github-dark-dimmed\" style=\"display: grid;\"><span data-line=\"\"><span style=\"color:#F47067\">const</span><span style=\"color:#ADBAC7\"> [</span><span style=\"color:#6CB6FF\">count</span><span style=\"color:#ADBAC7\">, </span><span style=\"color:#6CB6FF\">setCount</span><span style=\"color:#ADBAC7\">] </span><span style=\"color:#F47067\">=</span><span style=\"color:#DCBDFB\"> useState</span><span style=\"color:#ADBAC7\">(</span><span style=\"color:#6CB6FF\">0</span><span style=\"color:#ADBAC7\">)</span></span>\n<span data-line=\"\"> </span>\n<span data-line=\"\"><span style=\"color:#768390\">// 値を直接設定</span></span>\n<span data-line=\"\"><span style=\"color:#DCBDFB\">setCount</span><span style=\"color:#ADBAC7\">(</span><span style=\"color:#6CB6FF\">5</span><span style=\"color:#ADBAC7\">)</span></span>\n<span data-line=\"\"> </span>\n<span data-line=\"\"><span style=\"color:#768390\">// 前の値を使って更新</span></span>\n<span data-line=\"\"><span style=\"color:#DCBDFB\">setCount</span><span style=\"color:#ADBAC7\">((</span><span style=\"color:#F69D50\">prev</span><span style=\"color:#ADBAC7\">) </span><span style=\"color:#F47067\">=></span><span style=\"color:#ADBAC7\"> prev </span><span style=\"color:#F47067\">+</span><span style=\"color:#6CB6FF\"> 1</span><span style=\"color:#ADBAC7\">)</span></span></code></pre></figure>\n<h3 id=\"構文の読み方\">構文の読み方</h3>\n<ul>\n<li><span data-rehype-pretty-code-figure=\"\"><code data-language=\"plaintext\" data-theme=\"github-dark-dimmed\"><span data-line=\"\"><span>const [state, setState]</span></span></code></span> → 分割代入。配列の1番目が現在値、2番目が更新関数</li>\n<li><span data-rehype-pretty-code-figure=\"\"><code data-language=\"plaintext\" data-theme=\"github-dark-dimmed\"><span data-line=\"\"><span>useState(initialValue)</span></span></code></span> → 初期値を引数に渡す</li>\n<li><span data-rehype-pretty-code-figure=\"\"><code data-language=\"plaintext\" data-theme=\"github-dark-dimmed\"><span data-line=\"\"><span>setState(newValue)</span></span></code></span> → 新しい値を設定すると再レンダリングが発生</li>\n</ul>\n<h3 id=\"本プロジェクトでの使用例\">本プロジェクトでの使用例</h3>\n<figure class=\"mdn-code\" data-rehype-pretty-code-figure=\"\"><div class=\"mdn-code-header\"><div class=\"mdn-code-lang\">TS</div><div class=\"mdn-code-actions\"><button type=\"button\" class=\"mdn-code-copy\" aria-label=\"Copy code to clipboard\">Copy</button></div></div><pre tabindex=\"0\" data-language=\"typescript\" data-theme=\"github-dark-dimmed\"><code data-language=\"typescript\" data-theme=\"github-dark-dimmed\" style=\"display: grid;\"><span data-line=\"\"><span style=\"color:#768390\">// Posts.tsx - 投稿一覧の管理</span></span>\n<span data-line=\"\"><span style=\"color:#F47067\">const</span><span style=\"color:#ADBAC7\"> [</span><span style=\"color:#6CB6FF\">posts</span><span style=\"color:#ADBAC7\">, </span><span style=\"color:#6CB6FF\">setPosts</span><span style=\"color:#ADBAC7\">] </span><span style=\"color:#F47067\">=</span><span style=\"color:#DCBDFB\"> useState</span><span style=\"color:#ADBAC7\">&#x3C;</span><span style=\"color:#F69D50\">PostMeta</span><span style=\"color:#ADBAC7\">[]>(initialPosts)</span></span>\n<span data-line=\"\"> </span>\n<span data-line=\"\"><span style=\"color:#768390\">// 楽観的更新の例（APIレスポンス前にUIを更新）</span></span>\n<span data-line=\"\"><span style=\"color:#F47067\">const</span><span style=\"color:#6CB6FF\"> newPosts</span><span style=\"color:#F47067\"> =</span><span style=\"color:#ADBAC7\"> posts.</span><span style=\"color:#DCBDFB\">filter</span><span style=\"color:#ADBAC7\">((</span><span style=\"color:#F69D50\">p</span><span style=\"color:#ADBAC7\">) </span><span style=\"color:#F47067\">=></span><span style=\"color:#ADBAC7\"> p.slug </span><span style=\"color:#F47067\">!==</span><span style=\"color:#ADBAC7\"> slug)</span></span>\n<span data-line=\"\"><span style=\"color:#DCBDFB\">setPosts</span><span style=\"color:#ADBAC7\">(newPosts)</span></span></code></pre></figure>\n<figure class=\"mdn-code\" data-rehype-pretty-code-figure=\"\"><div class=\"mdn-code-header\"><div class=\"mdn-code-lang\">TS</div><div class=\"mdn-code-actions\"><button type=\"button\" class=\"mdn-code-copy\" aria-label=\"Copy code to clipboard\">Copy</button></div></div><pre tabindex=\"0\" data-language=\"typescript\" data-theme=\"github-dark-dimmed\"><code data-language=\"typescript\" data-theme=\"github-dark-dimmed\" style=\"display: grid;\"><span data-line=\"\"><span style=\"color:#768390\">// AdminAuthContext.tsx - 認証状態の管理</span></span>\n<span data-line=\"\"><span style=\"color:#F47067\">const</span><span style=\"color:#ADBAC7\"> [</span><span style=\"color:#6CB6FF\">isAdmin</span><span style=\"color:#ADBAC7\">, </span><span style=\"color:#6CB6FF\">setIsAdmin</span><span style=\"color:#ADBAC7\">] </span><span style=\"color:#F47067\">=</span><span style=\"color:#DCBDFB\"> useState</span><span style=\"color:#ADBAC7\">(</span><span style=\"color:#6CB6FF\">false</span><span style=\"color:#ADBAC7\">)</span></span>\n<span data-line=\"\"><span style=\"color:#F47067\">const</span><span style=\"color:#ADBAC7\"> [</span><span style=\"color:#6CB6FF\">user</span><span style=\"color:#ADBAC7\">, </span><span style=\"color:#6CB6FF\">setUser</span><span style=\"color:#ADBAC7\">] </span><span style=\"color:#F47067\">=</span><span style=\"color:#DCBDFB\"> useState</span><span style=\"color:#ADBAC7\">&#x3C;</span><span style=\"color:#F69D50\">User</span><span style=\"color:#F47067\"> |</span><span style=\"color:#6CB6FF\"> null</span><span style=\"color:#ADBAC7\">>(</span><span style=\"color:#6CB6FF\">null</span><span style=\"color:#ADBAC7\">)</span></span>\n<span data-line=\"\"><span style=\"color:#F47067\">const</span><span style=\"color:#ADBAC7\"> [</span><span style=\"color:#6CB6FF\">idToken</span><span style=\"color:#ADBAC7\">, </span><span style=\"color:#6CB6FF\">setIdToken</span><span style=\"color:#ADBAC7\">] </span><span style=\"color:#F47067\">=</span><span style=\"color:#DCBDFB\"> useState</span><span style=\"color:#ADBAC7\">&#x3C;</span><span style=\"color:#6CB6FF\">string</span><span style=\"color:#F47067\"> |</span><span style=\"color:#6CB6FF\"> null</span><span style=\"color:#ADBAC7\">>(</span><span style=\"color:#6CB6FF\">null</span><span style=\"color:#ADBAC7\">)</span></span></code></pre></figure>\n<hr>\n<br>\n<h2 id=\"useeffect---副作用フック\">useEffect - 副作用フック</h2>\n<p>コンポーネントのレンダリング後に実行される処理を定義。</p>\n<h3 id=\"基本パターン\">基本パターン</h3>\n<figure class=\"mdn-code\" data-rehype-pretty-code-figure=\"\"><div class=\"mdn-code-header\"><div class=\"mdn-code-lang\">TS</div><div class=\"mdn-code-actions\"><button type=\"button\" class=\"mdn-code-copy\" aria-label=\"Copy code to clipboard\">Copy</button></div></div><pre tabindex=\"0\" data-language=\"typescript\" data-theme=\"github-dark-dimmed\"><code data-language=\"typescript\" data-theme=\"github-dark-dimmed\" style=\"display: grid;\"><span data-line=\"\"><span style=\"color:#768390\">// パターン1: 毎回実行</span></span>\n<span data-line=\"\"><span style=\"color:#DCBDFB\">useEffect</span><span style=\"color:#ADBAC7\">(() </span><span style=\"color:#F47067\">=></span><span style=\"color:#ADBAC7\"> {</span></span>\n<span data-line=\"\"><span style=\"color:#ADBAC7\">  console.</span><span style=\"color:#DCBDFB\">log</span><span style=\"color:#ADBAC7\">(</span><span style=\"color:#96D0FF\">'レンダリングのたびに実行'</span><span style=\"color:#ADBAC7\">)</span></span>\n<span data-line=\"\"><span style=\"color:#ADBAC7\">})</span></span>\n<span data-line=\"\"> </span>\n<span data-line=\"\"><span style=\"color:#768390\">// パターン2: マウント時のみ</span></span>\n<span data-line=\"\"><span style=\"color:#DCBDFB\">useEffect</span><span style=\"color:#ADBAC7\">(() </span><span style=\"color:#F47067\">=></span><span style=\"color:#ADBAC7\"> {</span></span>\n<span data-line=\"\"><span style=\"color:#ADBAC7\">  console.</span><span style=\"color:#DCBDFB\">log</span><span style=\"color:#ADBAC7\">(</span><span style=\"color:#96D0FF\">'初回マウント時のみ実行'</span><span style=\"color:#ADBAC7\">)</span></span>\n<span data-line=\"\"><span style=\"color:#ADBAC7\">}, [])</span></span>\n<span data-line=\"\"> </span>\n<span data-line=\"\"><span style=\"color:#768390\">// パターン3: 依存値が変わった時</span></span>\n<span data-line=\"\"><span style=\"color:#DCBDFB\">useEffect</span><span style=\"color:#ADBAC7\">(() </span><span style=\"color:#F47067\">=></span><span style=\"color:#ADBAC7\"> {</span></span>\n<span data-line=\"\"><span style=\"color:#ADBAC7\">  console.</span><span style=\"color:#DCBDFB\">log</span><span style=\"color:#ADBAC7\">(</span><span style=\"color:#96D0FF\">'countが変わるたびに実行'</span><span style=\"color:#ADBAC7\">)</span></span>\n<span data-line=\"\"><span style=\"color:#ADBAC7\">}, [count])</span></span>\n<span data-line=\"\"> </span>\n<span data-line=\"\"><span style=\"color:#768390\">// パターン4: クリーンアップ付き</span></span>\n<span data-line=\"\"><span style=\"color:#DCBDFB\">useEffect</span><span style=\"color:#ADBAC7\">(() </span><span style=\"color:#F47067\">=></span><span style=\"color:#ADBAC7\"> {</span></span>\n<span data-line=\"\"><span style=\"color:#F47067\">  const</span><span style=\"color:#6CB6FF\"> timer</span><span style=\"color:#F47067\"> =</span><span style=\"color:#DCBDFB\"> setInterval</span><span style=\"color:#ADBAC7\">(() </span><span style=\"color:#F47067\">=></span><span style=\"color:#ADBAC7\"> console.</span><span style=\"color:#DCBDFB\">log</span><span style=\"color:#ADBAC7\">(</span><span style=\"color:#96D0FF\">'tick'</span><span style=\"color:#ADBAC7\">), </span><span style=\"color:#6CB6FF\">1000</span><span style=\"color:#ADBAC7\">)</span></span>\n<span data-line=\"\"> </span>\n<span data-line=\"\"><span style=\"color:#F47067\">  return</span><span style=\"color:#ADBAC7\"> () </span><span style=\"color:#F47067\">=></span><span style=\"color:#ADBAC7\"> {</span></span>\n<span data-line=\"\"><span style=\"color:#DCBDFB\">    clearInterval</span><span style=\"color:#ADBAC7\">(timer)  </span><span style=\"color:#768390\">// コンポーネントがアンマウントされる時に実行</span></span>\n<span data-line=\"\"><span style=\"color:#ADBAC7\">  }</span></span>\n<span data-line=\"\"><span style=\"color:#ADBAC7\">}, [])</span></span></code></pre></figure>\n<h3 id=\"依存配列とは\">依存配列とは</h3>\n<p><span data-rehype-pretty-code-figure=\"\"><code data-language=\"plaintext\" data-theme=\"github-dark-dimmed\"><span data-line=\"\"><span>useEffect</span></span></code></span>の第2引数は「この値が変わったら再実行して」というリスト。</p>\n<figure class=\"mdn-code\" data-rehype-pretty-code-figure=\"\"><div class=\"mdn-code-header\"><div class=\"mdn-code-lang\">TS</div><div class=\"mdn-code-actions\"><button type=\"button\" class=\"mdn-code-copy\" aria-label=\"Copy code to clipboard\">Copy</button></div></div><pre tabindex=\"0\" data-language=\"typescript\" data-theme=\"github-dark-dimmed\"><code data-language=\"typescript\" data-theme=\"github-dark-dimmed\" style=\"display: grid;\"><span data-line=\"\"><span style=\"color:#768390\">// depsの違いによる動作</span></span>\n<span data-line=\"\"><span style=\"color:#DCBDFB\">useEffect</span><span style=\"color:#ADBAC7\">(fn)        </span><span style=\"color:#768390\">// 毎回実行</span></span>\n<span data-line=\"\"><span style=\"color:#DCBDFB\">useEffect</span><span style=\"color:#ADBAC7\">(fn, [])    </span><span style=\"color:#768390\">// マウント時のみ</span></span>\n<span data-line=\"\"><span style=\"color:#DCBDFB\">useEffect</span><span style=\"color:#ADBAC7\">(fn, [a])   </span><span style=\"color:#768390\">// aが変わった時</span></span>\n<span data-line=\"\"><span style=\"color:#DCBDFB\">useEffect</span><span style=\"color:#ADBAC7\">(fn, [a,b]) </span><span style=\"color:#768390\">// aまたはbが変わった時</span></span></code></pre></figure>\n<h3 id=\"本プロジェクトでの使用例-1\">本プロジェクトでの使用例</h3>\n<figure class=\"mdn-code\" data-rehype-pretty-code-figure=\"\"><div class=\"mdn-code-header\"><div class=\"mdn-code-lang\">TS</div><div class=\"mdn-code-actions\"><button type=\"button\" class=\"mdn-code-copy\" aria-label=\"Copy code to clipboard\">Copy</button></div></div><pre tabindex=\"0\" data-language=\"typescript\" data-theme=\"github-dark-dimmed\"><code data-language=\"typescript\" data-theme=\"github-dark-dimmed\" style=\"display: grid;\"><span data-line=\"\"><span style=\"color:#768390\">// Home.tsx - CMSから記事を取得</span></span>\n<span data-line=\"\"><span style=\"color:#DCBDFB\">useEffect</span><span style=\"color:#ADBAC7\">(() </span><span style=\"color:#F47067\">=></span><span style=\"color:#ADBAC7\"> {</span></span>\n<span data-line=\"\"><span style=\"color:#F47067\">  const</span><span style=\"color:#DCBDFB\"> fetchLatestPosts</span><span style=\"color:#F47067\"> =</span><span style=\"color:#F47067\"> async</span><span style=\"color:#ADBAC7\"> () </span><span style=\"color:#F47067\">=></span><span style=\"color:#ADBAC7\"> {</span></span>\n<span data-line=\"\"><span style=\"color:#F47067\">    const</span><span style=\"color:#6CB6FF\"> res</span><span style=\"color:#F47067\"> =</span><span style=\"color:#F47067\"> await</span><span style=\"color:#DCBDFB\"> fetch</span><span style=\"color:#ADBAC7\">(</span><span style=\"color:#96D0FF\">`${</span><span style=\"color:#6CB6FF\">CMS_ENDPOINT</span><span style=\"color:#96D0FF\">}/posts`</span><span style=\"color:#ADBAC7\">)</span></span>\n<span data-line=\"\"><span style=\"color:#F47067\">    if</span><span style=\"color:#ADBAC7\"> (res.ok) {</span></span>\n<span data-line=\"\"><span style=\"color:#F47067\">      const</span><span style=\"color:#6CB6FF\"> data</span><span style=\"color:#F47067\"> =</span><span style=\"color:#F47067\"> await</span><span style=\"color:#ADBAC7\"> res.</span><span style=\"color:#DCBDFB\">json</span><span style=\"color:#ADBAC7\">()</span></span>\n<span data-line=\"\"><span style=\"color:#DCBDFB\">      setLatestPosts</span><span style=\"color:#ADBAC7\">(data.posts)</span></span>\n<span data-line=\"\"><span style=\"color:#ADBAC7\">    }</span></span>\n<span data-line=\"\"><span style=\"color:#ADBAC7\">  }</span></span>\n<span data-line=\"\"><span style=\"color:#DCBDFB\">  fetchLatestPosts</span><span style=\"color:#ADBAC7\">()</span></span>\n<span data-line=\"\"><span style=\"color:#ADBAC7\">}, [])  </span><span style=\"color:#768390\">// マウント時のみ実行</span></span></code></pre></figure>\n<figure class=\"mdn-code\" data-rehype-pretty-code-figure=\"\"><div class=\"mdn-code-header\"><div class=\"mdn-code-lang\">TS</div><div class=\"mdn-code-actions\"><button type=\"button\" class=\"mdn-code-copy\" aria-label=\"Copy code to clipboard\">Copy</button></div></div><pre tabindex=\"0\" data-language=\"typescript\" data-theme=\"github-dark-dimmed\"><code data-language=\"typescript\" data-theme=\"github-dark-dimmed\" style=\"display: grid;\"><span data-line=\"\"><span style=\"color:#768390\">// AdminAuthContext.tsx - 認証状態の監視</span></span>\n<span data-line=\"\"><span style=\"color:#DCBDFB\">useEffect</span><span style=\"color:#ADBAC7\">(() </span><span style=\"color:#F47067\">=></span><span style=\"color:#ADBAC7\"> {</span></span>\n<span data-line=\"\"><span style=\"color:#F47067\">  const</span><span style=\"color:#6CB6FF\"> unsubscribe</span><span style=\"color:#F47067\"> =</span><span style=\"color:#DCBDFB\"> onAuthStateChanged</span><span style=\"color:#ADBAC7\">(auth, </span><span style=\"color:#F47067\">async</span><span style=\"color:#ADBAC7\"> (</span><span style=\"color:#F69D50\">firebaseUser</span><span style=\"color:#ADBAC7\">) </span><span style=\"color:#F47067\">=></span><span style=\"color:#ADBAC7\"> {</span></span>\n<span data-line=\"\"><span style=\"color:#F47067\">    if</span><span style=\"color:#ADBAC7\"> (firebaseUser) {</span></span>\n<span data-line=\"\"><span style=\"color:#F47067\">      const</span><span style=\"color:#6CB6FF\"> token</span><span style=\"color:#F47067\"> =</span><span style=\"color:#F47067\"> await</span><span style=\"color:#ADBAC7\"> firebaseUser.</span><span style=\"color:#DCBDFB\">getIdToken</span><span style=\"color:#ADBAC7\">()</span></span>\n<span data-line=\"\"><span style=\"color:#DCBDFB\">      setIdToken</span><span style=\"color:#ADBAC7\">(token)</span></span>\n<span data-line=\"\"><span style=\"color:#DCBDFB\">      setUser</span><span style=\"color:#ADBAC7\">(firebaseUser)</span></span>\n<span data-line=\"\"><span style=\"color:#ADBAC7\">    } </span><span style=\"color:#F47067\">else</span><span style=\"color:#ADBAC7\"> {</span></span>\n<span data-line=\"\"><span style=\"color:#DCBDFB\">      setUser</span><span style=\"color:#ADBAC7\">(</span><span style=\"color:#6CB6FF\">null</span><span style=\"color:#ADBAC7\">)</span></span>\n<span data-line=\"\"><span style=\"color:#DCBDFB\">      setIdToken</span><span style=\"color:#ADBAC7\">(</span><span style=\"color:#6CB6FF\">null</span><span style=\"color:#ADBAC7\">)</span></span>\n<span data-line=\"\"><span style=\"color:#ADBAC7\">    }</span></span>\n<span data-line=\"\"><span style=\"color:#ADBAC7\">  })</span></span>\n<span data-line=\"\"> </span>\n<span data-line=\"\"><span style=\"color:#F47067\">  return</span><span style=\"color:#ADBAC7\"> () </span><span style=\"color:#F47067\">=></span><span style=\"color:#DCBDFB\"> unsubscribe</span><span style=\"color:#ADBAC7\">()  </span><span style=\"color:#768390\">// クリーンアップ: 監視解除</span></span>\n<span data-line=\"\"><span style=\"color:#ADBAC7\">}, [])</span></span></code></pre></figure>\n<hr>\n<br>\n<h2 id=\"usecallback---関数メモ化フック\">useCallback - 関数メモ化フック</h2>\n<p>関数の参照を安定させる。子コンポーネントへの不要な再レンダリングを防ぐ。</p>\n<h3 id=\"なぜ必要なのか\">なぜ必要なのか</h3>\n<figure class=\"mdn-code\" data-rehype-pretty-code-figure=\"\"><div class=\"mdn-code-header\"><div class=\"mdn-code-lang\">TS</div><div class=\"mdn-code-actions\"><button type=\"button\" class=\"mdn-code-copy\" aria-label=\"Copy code to clipboard\">Copy</button></div></div><pre tabindex=\"0\" data-language=\"typescript\" data-theme=\"github-dark-dimmed\"><code data-language=\"typescript\" data-theme=\"github-dark-dimmed\" style=\"display: grid;\"><span data-line=\"\"><span style=\"color:#768390\">// 毎回新しい関数が作られる</span></span>\n<span data-line=\"\"><span style=\"color:#F47067\">function</span><span style=\"color:#DCBDFB\"> Parent</span><span style=\"color:#ADBAC7\">() {</span></span>\n<span data-line=\"\"><span style=\"color:#F47067\">  const</span><span style=\"color:#DCBDFB\"> handleClick</span><span style=\"color:#F47067\"> =</span><span style=\"color:#ADBAC7\"> () </span><span style=\"color:#F47067\">=></span><span style=\"color:#ADBAC7\"> console.</span><span style=\"color:#DCBDFB\">log</span><span style=\"color:#ADBAC7\">(</span><span style=\"color:#96D0FF\">'clicked'</span><span style=\"color:#ADBAC7\">)  </span><span style=\"color:#768390\">// 毎回新しい参照</span></span>\n<span data-line=\"\"> </span>\n<span data-line=\"\"><span style=\"color:#F47067\">  return</span><span style=\"color:#ADBAC7\"> &#x3C;</span><span style=\"color:#F69D50\">Child</span><span style=\"color:#F69D50\"> onClick</span><span style=\"color:#ADBAC7\">={</span><span style=\"color:#F69D50\">handleClick</span><span style=\"color:#ADBAC7\">} />  </span><span style=\"color:#768390\">// Childは毎回再レンダリング</span></span>\n<span data-line=\"\"><span style=\"color:#ADBAC7\">}</span></span>\n<span data-line=\"\"> </span>\n<span data-line=\"\"><span style=\"color:#768390\">// useCallbackで参照を安定させる</span></span>\n<span data-line=\"\"><span style=\"color:#F47067\">function</span><span style=\"color:#DCBDFB\"> Parent</span><span style=\"color:#ADBAC7\">() {</span></span>\n<span data-line=\"\"><span style=\"color:#F47067\">  const</span><span style=\"color:#6CB6FF\"> handleClick</span><span style=\"color:#F47067\"> =</span><span style=\"color:#DCBDFB\"> useCallback</span><span style=\"color:#ADBAC7\">(() </span><span style=\"color:#F47067\">=></span><span style=\"color:#ADBAC7\"> {</span></span>\n<span data-line=\"\"><span style=\"color:#ADBAC7\">    console.</span><span style=\"color:#DCBDFB\">log</span><span style=\"color:#ADBAC7\">(</span><span style=\"color:#96D0FF\">'clicked'</span><span style=\"color:#ADBAC7\">)</span></span>\n<span data-line=\"\"><span style=\"color:#ADBAC7\">  }, [])  </span><span style=\"color:#768390\">// 同じ関数を再利用</span></span>\n<span data-line=\"\"> </span>\n<span data-line=\"\"><span style=\"color:#F47067\">  return</span><span style=\"color:#ADBAC7\"> &#x3C;</span><span style=\"color:#F69D50\">Child</span><span style=\"color:#F69D50\"> onClick</span><span style=\"color:#ADBAC7\">={</span><span style=\"color:#F69D50\">handleClick</span><span style=\"color:#ADBAC7\">} />  </span><span style=\"color:#768390\">// Childの再レンダリングを防げる</span></span>\n<span data-line=\"\"><span style=\"color:#ADBAC7\">}</span></span></code></pre></figure>\n<h3 id=\"本プロジェクトでの使用例-2\">本プロジェクトでの使用例</h3>\n<figure class=\"mdn-code\" data-rehype-pretty-code-figure=\"\"><div class=\"mdn-code-header\"><div class=\"mdn-code-lang\">TS</div><div class=\"mdn-code-actions\"><button type=\"button\" class=\"mdn-code-copy\" aria-label=\"Copy code to clipboard\">Copy</button></div></div><pre tabindex=\"0\" data-language=\"typescript\" data-theme=\"github-dark-dimmed\"><code data-language=\"typescript\" data-theme=\"github-dark-dimmed\" style=\"display: grid;\"><span data-line=\"\"><span style=\"color:#768390\">// Home.tsx - ナビゲーション関数</span></span>\n<span data-line=\"\"><span style=\"color:#F47067\">const</span><span style=\"color:#6CB6FF\"> handleBack</span><span style=\"color:#F47067\"> =</span><span style=\"color:#DCBDFB\"> useCallback</span><span style=\"color:#ADBAC7\">(() </span><span style=\"color:#F47067\">=></span><span style=\"color:#ADBAC7\"> {</span></span>\n<span data-line=\"\"><span style=\"color:#DCBDFB\">  navigate</span><span style=\"color:#ADBAC7\">(</span><span style=\"color:#96D0FF\">'/'</span><span style=\"color:#ADBAC7\">)</span></span>\n<span data-line=\"\"><span style=\"color:#ADBAC7\">}, [navigate])</span></span></code></pre></figure>\n<figure class=\"mdn-code\" data-rehype-pretty-code-figure=\"\"><div class=\"mdn-code-header\"><div class=\"mdn-code-lang\">TS</div><div class=\"mdn-code-actions\"><button type=\"button\" class=\"mdn-code-copy\" aria-label=\"Copy code to clipboard\">Copy</button></div></div><pre tabindex=\"0\" data-language=\"typescript\" data-theme=\"github-dark-dimmed\"><code data-language=\"typescript\" data-theme=\"github-dark-dimmed\" style=\"display: grid;\"><span data-line=\"\"><span style=\"color:#768390\">// Posts.tsx - タグクリック処理</span></span>\n<span data-line=\"\"><span style=\"color:#F47067\">const</span><span style=\"color:#6CB6FF\"> handleTagClick</span><span style=\"color:#F47067\"> =</span><span style=\"color:#DCBDFB\"> useCallback</span><span style=\"color:#ADBAC7\">((</span><span style=\"color:#F69D50\">tag</span><span style=\"color:#F47067\">:</span><span style=\"color:#6CB6FF\"> string</span><span style=\"color:#ADBAC7\">) </span><span style=\"color:#F47067\">=></span><span style=\"color:#ADBAC7\"> {</span></span>\n<span data-line=\"\"><span style=\"color:#DCBDFB\">  startTransition</span><span style=\"color:#ADBAC7\">(() </span><span style=\"color:#F47067\">=></span><span style=\"color:#ADBAC7\"> {</span></span>\n<span data-line=\"\"><span style=\"color:#DCBDFB\">    setSearchParams</span><span style=\"color:#ADBAC7\">(tag </span><span style=\"color:#F47067\">?</span><span style=\"color:#ADBAC7\"> { tag } </span><span style=\"color:#F47067\">:</span><span style=\"color:#ADBAC7\"> {})</span></span>\n<span data-line=\"\"><span style=\"color:#ADBAC7\">  })</span></span>\n<span data-line=\"\"><span style=\"color:#ADBAC7\">}, [setSearchParams])</span></span></code></pre></figure>\n<hr>\n<br>\n<h2 id=\"usememo---値メモ化フック\">useMemo - 値メモ化フック</h2>\n<p>計算結果をキャッシュして、不要な再計算を防ぐ。</p>\n<h3 id=\"基本的な使い方-1\">基本的な使い方</h3>\n<figure class=\"mdn-code\" data-rehype-pretty-code-figure=\"\"><div class=\"mdn-code-header\"><div class=\"mdn-code-lang\">TS</div><div class=\"mdn-code-actions\"><button type=\"button\" class=\"mdn-code-copy\" aria-label=\"Copy code to clipboard\">Copy</button></div></div><pre tabindex=\"0\" data-language=\"typescript\" data-theme=\"github-dark-dimmed\"><code data-language=\"typescript\" data-theme=\"github-dark-dimmed\" style=\"display: grid;\"><span data-line=\"\"><span style=\"color:#768390\">// 重い計算結果をキャッシュ</span></span>\n<span data-line=\"\"><span style=\"color:#F47067\">const</span><span style=\"color:#6CB6FF\"> expensiveResult</span><span style=\"color:#F47067\"> =</span><span style=\"color:#DCBDFB\"> useMemo</span><span style=\"color:#ADBAC7\">(() </span><span style=\"color:#F47067\">=></span><span style=\"color:#ADBAC7\"> {</span></span>\n<span data-line=\"\"><span style=\"color:#F47067\">  return</span><span style=\"color:#ADBAC7\"> items.</span><span style=\"color:#DCBDFB\">filter</span><span style=\"color:#ADBAC7\">(</span><span style=\"color:#F69D50\">item</span><span style=\"color:#F47067\"> =></span><span style=\"color:#ADBAC7\"> item.active)</span></span>\n<span data-line=\"\"><span style=\"color:#ADBAC7\">              .</span><span style=\"color:#DCBDFB\">map</span><span style=\"color:#ADBAC7\">(</span><span style=\"color:#F69D50\">item</span><span style=\"color:#F47067\"> =></span><span style=\"color:#ADBAC7\"> ({ </span><span style=\"color:#F47067\">...</span><span style=\"color:#ADBAC7\">item, processed: </span><span style=\"color:#6CB6FF\">true</span><span style=\"color:#ADBAC7\"> }))</span></span>\n<span data-line=\"\"><span style=\"color:#ADBAC7\">              .</span><span style=\"color:#DCBDFB\">sort</span><span style=\"color:#ADBAC7\">((</span><span style=\"color:#F69D50\">a</span><span style=\"color:#ADBAC7\">, </span><span style=\"color:#F69D50\">b</span><span style=\"color:#ADBAC7\">) </span><span style=\"color:#F47067\">=></span><span style=\"color:#ADBAC7\"> a.name.</span><span style=\"color:#DCBDFB\">localeCompare</span><span style=\"color:#ADBAC7\">(b.name))</span></span>\n<span data-line=\"\"><span style=\"color:#ADBAC7\">}, [items])  </span><span style=\"color:#768390\">// itemsが変わった時だけ再計算</span></span></code></pre></figure>\n<h3 id=\"usecallbackとusememoの違い\">useCallbackとuseMemoの違い</h3>\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n<div class=\"table-wrapper\"><table><thead><tr><th>フック</th><th>メモ化対象</th><th>使い分け</th></tr></thead><tbody><tr><td><span data-rehype-pretty-code-figure=\"\"><code data-language=\"plaintext\" data-theme=\"github-dark-dimmed\"><span data-line=\"\"><span>useCallback</span></span></code></span></td><td>関数</td><td>イベントハンドラ、子に渡す関数</td></tr><tr><td><span data-rehype-pretty-code-figure=\"\"><code data-language=\"plaintext\" data-theme=\"github-dark-dimmed\"><span data-line=\"\"><span>useMemo</span></span></code></span></td><td>計算結果</td><td>フィルタリング、ソート、変換処理</td></tr></tbody></table></div>\n<h3 id=\"本プロジェクトでの使用例-3\">本プロジェクトでの使用例</h3>\n<figure class=\"mdn-code\" data-rehype-pretty-code-figure=\"\"><div class=\"mdn-code-header\"><div class=\"mdn-code-lang\">TS</div><div class=\"mdn-code-actions\"><button type=\"button\" class=\"mdn-code-copy\" aria-label=\"Copy code to clipboard\">Copy</button></div></div><pre tabindex=\"0\" data-language=\"typescript\" data-theme=\"github-dark-dimmed\"><code data-language=\"typescript\" data-theme=\"github-dark-dimmed\" style=\"display: grid;\"><span data-line=\"\"><span style=\"color:#768390\">// Posts.tsx - タグ別フィルタリング</span></span>\n<span data-line=\"\"><span style=\"color:#F47067\">const</span><span style=\"color:#6CB6FF\"> filteredPosts</span><span style=\"color:#F47067\"> =</span><span style=\"color:#DCBDFB\"> useMemo</span><span style=\"color:#ADBAC7\">(() </span><span style=\"color:#F47067\">=></span><span style=\"color:#ADBAC7\"> {</span></span>\n<span data-line=\"\"><span style=\"color:#F47067\">  if</span><span style=\"color:#ADBAC7\"> (</span><span style=\"color:#F47067\">!</span><span style=\"color:#ADBAC7\">tagFilter) </span><span style=\"color:#F47067\">return</span><span style=\"color:#ADBAC7\"> posts</span></span>\n<span data-line=\"\"><span style=\"color:#F47067\">  return</span><span style=\"color:#ADBAC7\"> posts.</span><span style=\"color:#DCBDFB\">filter</span><span style=\"color:#ADBAC7\">((</span><span style=\"color:#F69D50\">p</span><span style=\"color:#ADBAC7\">) </span><span style=\"color:#F47067\">=></span><span style=\"color:#ADBAC7\"> p.tags?.</span><span style=\"color:#DCBDFB\">includes</span><span style=\"color:#ADBAC7\">(tagFilter))</span></span>\n<span data-line=\"\"><span style=\"color:#ADBAC7\">}, [posts, tagFilter])</span></span>\n<span data-line=\"\"> </span>\n<span data-line=\"\"><span style=\"color:#768390\">// タグ一覧の抽出と重複排除</span></span>\n<span data-line=\"\"><span style=\"color:#F47067\">const</span><span style=\"color:#6CB6FF\"> allTags</span><span style=\"color:#F47067\"> =</span><span style=\"color:#DCBDFB\"> useMemo</span><span style=\"color:#ADBAC7\">(() </span><span style=\"color:#F47067\">=></span><span style=\"color:#ADBAC7\"> {</span></span>\n<span data-line=\"\"><span style=\"color:#F47067\">  const</span><span style=\"color:#6CB6FF\"> tagSet</span><span style=\"color:#F47067\"> =</span><span style=\"color:#F47067\"> new</span><span style=\"color:#DCBDFB\"> Set</span><span style=\"color:#ADBAC7\">&#x3C;</span><span style=\"color:#6CB6FF\">string</span><span style=\"color:#ADBAC7\">>()</span></span>\n<span data-line=\"\"><span style=\"color:#ADBAC7\">  posts.</span><span style=\"color:#DCBDFB\">forEach</span><span style=\"color:#ADBAC7\">((</span><span style=\"color:#F69D50\">p</span><span style=\"color:#ADBAC7\">) </span><span style=\"color:#F47067\">=></span><span style=\"color:#ADBAC7\"> p.tags?.</span><span style=\"color:#DCBDFB\">forEach</span><span style=\"color:#ADBAC7\">((</span><span style=\"color:#F69D50\">t</span><span style=\"color:#ADBAC7\">) </span><span style=\"color:#F47067\">=></span><span style=\"color:#ADBAC7\"> tagSet.</span><span style=\"color:#DCBDFB\">add</span><span style=\"color:#ADBAC7\">(t)))</span></span>\n<span data-line=\"\"><span style=\"color:#F47067\">  return</span><span style=\"color:#ADBAC7\"> [</span><span style=\"color:#F47067\">...</span><span style=\"color:#ADBAC7\">tagSet].</span><span style=\"color:#DCBDFB\">sort</span><span style=\"color:#ADBAC7\">()</span></span>\n<span data-line=\"\"><span style=\"color:#ADBAC7\">}, [posts])</span></span></code></pre></figure>\n<hr>\n<br>\n<h2 id=\"useref---参照フック\">useRef - 参照フック</h2>\n<p>再レンダリングを引き起こさずに値を保持。DOM要素への参照にも使用。</p>\n<h3 id=\"主な用途\">主な用途</h3>\n<ol>\n<li><strong>DOM要素への参照</strong></li>\n</ol>\n<figure class=\"mdn-code\" data-rehype-pretty-code-figure=\"\"><div class=\"mdn-code-header\"><div class=\"mdn-code-lang\">TS</div><div class=\"mdn-code-actions\"><button type=\"button\" class=\"mdn-code-copy\" aria-label=\"Copy code to clipboard\">Copy</button></div></div><pre tabindex=\"0\" data-language=\"typescript\" data-theme=\"github-dark-dimmed\"><code data-language=\"typescript\" data-theme=\"github-dark-dimmed\" style=\"display: grid;\"><span data-line=\"\"><span style=\"color:#F47067\">const</span><span style=\"color:#6CB6FF\"> inputRef</span><span style=\"color:#F47067\"> =</span><span style=\"color:#DCBDFB\"> useRef</span><span style=\"color:#ADBAC7\">&#x3C;</span><span style=\"color:#F69D50\">HTMLInputElement</span><span style=\"color:#ADBAC7\">>(</span><span style=\"color:#6CB6FF\">null</span><span style=\"color:#ADBAC7\">)</span></span>\n<span data-line=\"\"> </span>\n<span data-line=\"\"><span style=\"color:#768390\">// フォーカスを当てる</span></span>\n<span data-line=\"\"><span style=\"color:#ADBAC7\">inputRef.current?.</span><span style=\"color:#DCBDFB\">focus</span><span style=\"color:#ADBAC7\">()</span></span>\n<span data-line=\"\"> </span>\n<span data-line=\"\"><span style=\"color:#F47067\">return</span><span style=\"color:#ADBAC7\"> &#x3C;</span><span style=\"color:#F69D50\">input</span><span style=\"color:#F69D50\"> ref</span><span style=\"color:#F47067\">=</span><span style=\"color:#ADBAC7\">{</span><span style=\"color:#F69D50\">inputRef</span><span style=\"color:#ADBAC7\">} /></span></span></code></pre></figure>\n<ol start=\"2\">\n<li><strong>レンダリング間で値を保持（再レンダリングを起こさない）</strong></li>\n</ol>\n<figure class=\"mdn-code\" data-rehype-pretty-code-figure=\"\"><div class=\"mdn-code-header\"><div class=\"mdn-code-lang\">TS</div><div class=\"mdn-code-actions\"><button type=\"button\" class=\"mdn-code-copy\" aria-label=\"Copy code to clipboard\">Copy</button></div></div><pre tabindex=\"0\" data-language=\"typescript\" data-theme=\"github-dark-dimmed\"><code data-language=\"typescript\" data-theme=\"github-dark-dimmed\" style=\"display: grid;\"><span data-line=\"\"><span style=\"color:#F47067\">const</span><span style=\"color:#6CB6FF\"> countRef</span><span style=\"color:#F47067\"> =</span><span style=\"color:#DCBDFB\"> useRef</span><span style=\"color:#ADBAC7\">(</span><span style=\"color:#6CB6FF\">0</span><span style=\"color:#ADBAC7\">)</span></span>\n<span data-line=\"\"> </span>\n<span data-line=\"\"><span style=\"color:#768390\">// 値を更新しても再レンダリングされない</span></span>\n<span data-line=\"\"><span style=\"color:#ADBAC7\">countRef.current </span><span style=\"color:#F47067\">+=</span><span style=\"color:#6CB6FF\"> 1</span></span></code></pre></figure>\n<ol start=\"3\">\n<li><strong>タイマーIDの保持</strong></li>\n</ol>\n<figure class=\"mdn-code\" data-rehype-pretty-code-figure=\"\"><div class=\"mdn-code-header\"><div class=\"mdn-code-lang\">TS</div><div class=\"mdn-code-actions\"><button type=\"button\" class=\"mdn-code-copy\" aria-label=\"Copy code to clipboard\">Copy</button></div></div><pre tabindex=\"0\" data-language=\"typescript\" data-theme=\"github-dark-dimmed\"><code data-language=\"typescript\" data-theme=\"github-dark-dimmed\" style=\"display: grid;\"><span data-line=\"\"><span style=\"color:#F47067\">const</span><span style=\"color:#6CB6FF\"> timerRef</span><span style=\"color:#F47067\"> =</span><span style=\"color:#DCBDFB\"> useRef</span><span style=\"color:#ADBAC7\">&#x3C;</span><span style=\"color:#6CB6FF\">number</span><span style=\"color:#F47067\"> |</span><span style=\"color:#6CB6FF\"> null</span><span style=\"color:#ADBAC7\">>(</span><span style=\"color:#6CB6FF\">null</span><span style=\"color:#ADBAC7\">)</span></span>\n<span data-line=\"\"> </span>\n<span data-line=\"\"><span style=\"color:#ADBAC7\">timerRef.current </span><span style=\"color:#F47067\">=</span><span style=\"color:#ADBAC7\"> window.</span><span style=\"color:#DCBDFB\">setTimeout</span><span style=\"color:#ADBAC7\">(() </span><span style=\"color:#F47067\">=></span><span style=\"color:#ADBAC7\"> {</span></span>\n<span data-line=\"\"><span style=\"color:#768390\">  // 処理</span></span>\n<span data-line=\"\"><span style=\"color:#ADBAC7\">}, </span><span style=\"color:#6CB6FF\">1000</span><span style=\"color:#ADBAC7\">)</span></span>\n<span data-line=\"\"> </span>\n<span data-line=\"\"><span style=\"color:#768390\">// クリーンアップ</span></span>\n<span data-line=\"\"><span style=\"color:#ADBAC7\">window.</span><span style=\"color:#DCBDFB\">clearTimeout</span><span style=\"color:#ADBAC7\">(timerRef.current</span><span style=\"color:#F47067\">!</span><span style=\"color:#ADBAC7\">)</span></span></code></pre></figure>\n<h3 id=\"usestateとuserefの使い分け\">useStateとuseRefの使い分け</h3>\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n<div class=\"table-wrapper\"><table><thead><tr><th>特性</th><th>useState</th><th>useRef</th></tr></thead><tbody><tr><td>値変更時の再レンダリング</td><td>する</td><td>しない</td></tr><tr><td>用途</td><td>UIに表示する値</td><td>DOM参照、タイマーID、内部フラグ</td></tr><tr><td>値の読み取り</td><td>直接</td><td><span data-rehype-pretty-code-figure=\"\"><code data-language=\"plaintext\" data-theme=\"github-dark-dimmed\"><span data-line=\"\"><span>.current</span></span></code></span>プロパティ経由</td></tr></tbody></table></div>\n<h3 id=\"本プロジェクトでの使用例-4\">本プロジェクトでの使用例</h3>\n<figure class=\"mdn-code\" data-rehype-pretty-code-figure=\"\"><div class=\"mdn-code-header\"><div class=\"mdn-code-lang\">TS</div><div class=\"mdn-code-actions\"><button type=\"button\" class=\"mdn-code-copy\" aria-label=\"Copy code to clipboard\">Copy</button></div></div><pre tabindex=\"0\" data-language=\"typescript\" data-theme=\"github-dark-dimmed\"><code data-language=\"typescript\" data-theme=\"github-dark-dimmed\" style=\"display: grid;\"><span data-line=\"\"><span style=\"color:#768390\">// AccessCounter.tsx - API呼び出しの重複防止</span></span>\n<span data-line=\"\"><span style=\"color:#F47067\">const</span><span style=\"color:#6CB6FF\"> didSend</span><span style=\"color:#F47067\"> =</span><span style=\"color:#DCBDFB\"> useRef</span><span style=\"color:#ADBAC7\">(</span><span style=\"color:#6CB6FF\">false</span><span style=\"color:#ADBAC7\">)</span></span>\n<span data-line=\"\"> </span>\n<span data-line=\"\"><span style=\"color:#DCBDFB\">useEffect</span><span style=\"color:#ADBAC7\">(() </span><span style=\"color:#F47067\">=></span><span style=\"color:#ADBAC7\"> {</span></span>\n<span data-line=\"\"><span style=\"color:#F47067\">  if</span><span style=\"color:#ADBAC7\"> (didSend.current) </span><span style=\"color:#F47067\">return</span><span style=\"color:#768390\">  // 既に送信済みならスキップ</span></span>\n<span data-line=\"\"><span style=\"color:#ADBAC7\">  didSend.current </span><span style=\"color:#F47067\">=</span><span style=\"color:#6CB6FF\"> true</span></span>\n<span data-line=\"\"><span style=\"color:#768390\">  // APIコール...</span></span>\n<span data-line=\"\"><span style=\"color:#ADBAC7\">}, [])</span></span></code></pre></figure>\n<figure class=\"mdn-code\" data-rehype-pretty-code-figure=\"\"><div class=\"mdn-code-header\"><div class=\"mdn-code-lang\">TS</div><div class=\"mdn-code-actions\"><button type=\"button\" class=\"mdn-code-copy\" aria-label=\"Copy code to clipboard\">Copy</button></div></div><pre tabindex=\"0\" data-language=\"typescript\" data-theme=\"github-dark-dimmed\"><code data-language=\"typescript\" data-theme=\"github-dark-dimmed\" style=\"display: grid;\"><span data-line=\"\"><span style=\"color:#768390\">// ScrollTopHomeSwitch.tsx - 累積値の保持</span></span>\n<span data-line=\"\"><span style=\"color:#F47067\">const</span><span style=\"color:#6CB6FF\"> wheelAccumRef</span><span style=\"color:#F47067\"> =</span><span style=\"color:#DCBDFB\"> useRef</span><span style=\"color:#ADBAC7\">(</span><span style=\"color:#6CB6FF\">0</span><span style=\"color:#ADBAC7\">)</span></span>\n<span data-line=\"\"><span style=\"color:#F47067\">const</span><span style=\"color:#6CB6FF\"> wheelLastAtRef</span><span style=\"color:#F47067\"> =</span><span style=\"color:#DCBDFB\"> useRef</span><span style=\"color:#ADBAC7\">(</span><span style=\"color:#6CB6FF\">0</span><span style=\"color:#ADBAC7\">)</span></span>\n<span data-line=\"\"> </span>\n<span data-line=\"\"><span style=\"color:#768390\">// イベントハンドラ内で更新（再レンダリングなし）</span></span>\n<span data-line=\"\"><span style=\"color:#ADBAC7\">wheelAccumRef.current </span><span style=\"color:#F47067\">+=</span><span style=\"color:#ADBAC7\"> deltaY</span></span>\n<span data-line=\"\"><span style=\"color:#ADBAC7\">wheelLastAtRef.current </span><span style=\"color:#F47067\">=</span><span style=\"color:#ADBAC7\"> now</span></span></code></pre></figure>\n<hr>\n<br>\n<h2 id=\"usecontext---コンテキスト消費フック\">useContext - コンテキスト消費フック</h2>\n<p>Contextから現在の値を取得。Providerで包まれた子孫コンポーネントで使用。</p>\n<h3 id=\"なぜ必要なのか-1\">なぜ必要なのか</h3>\n<p>通常、データを子コンポーネントに渡すにはpropsを使う。しかし、深くネストしたコンポーネントにデータを渡すには、途中のすべてのコンポーネントを経由する必要がある（「props drilling」問題）。</p>\n<figure class=\"mdn-code\" data-rehype-pretty-code-figure=\"\"><div class=\"mdn-code-header\"><div class=\"mdn-code-lang\">TS</div><div class=\"mdn-code-actions\"><button type=\"button\" class=\"mdn-code-copy\" aria-label=\"Copy code to clipboard\">Copy</button></div></div><pre tabindex=\"0\" data-language=\"typescript\" data-theme=\"github-dark-dimmed\"><code data-language=\"typescript\" data-theme=\"github-dark-dimmed\" style=\"display: grid;\"><span data-line=\"\"><span style=\"color:#768390\">// props drilling: 中間コンポーネントがthemeを使わないのに渡している</span></span>\n<span data-line=\"\"><span style=\"color:#F47067\">function</span><span style=\"color:#DCBDFB\"> App</span><span style=\"color:#ADBAC7\">() {</span></span>\n<span data-line=\"\"><span style=\"color:#F47067\">  const</span><span style=\"color:#6CB6FF\"> theme</span><span style=\"color:#F47067\"> =</span><span style=\"color:#96D0FF\"> 'dark'</span></span>\n<span data-line=\"\"><span style=\"color:#F47067\">  return</span><span style=\"color:#ADBAC7\"> &#x3C;</span><span style=\"color:#F69D50\">Header</span><span style=\"color:#F69D50\"> theme</span><span style=\"color:#F47067\">=</span><span style=\"color:#ADBAC7\">{</span><span style=\"color:#F69D50\">theme</span><span style=\"color:#ADBAC7\">} /></span></span>\n<span data-line=\"\"><span style=\"color:#ADBAC7\">}</span></span>\n<span data-line=\"\"><span style=\"color:#ADBAC7\">function Header({ theme }) {</span></span>\n<span data-line=\"\"><span style=\"color:#ADBAC7\">  return &#x3C;Nav theme</span><span style=\"color:#F47067\">=</span><span style=\"color:#ADBAC7\">{theme} </span><span style=\"color:#F47067\">/></span></span>\n<span data-line=\"\"><span style=\"color:#ADBAC7\">}</span></span>\n<span data-line=\"\"><span style=\"color:#F47067\">function</span><span style=\"color:#DCBDFB\"> Nav</span><span style=\"color:#ADBAC7\">({ </span><span style=\"color:#F69D50\">theme</span><span style=\"color:#ADBAC7\"> }) {</span></span>\n<span data-line=\"\"><span style=\"color:#F47067\">  return</span><span style=\"color:#ADBAC7\"> &#x3C;</span><span style=\"color:#F69D50\">Button</span><span style=\"color:#F69D50\"> theme</span><span style=\"color:#F47067\">=</span><span style=\"color:#ADBAC7\">{</span><span style=\"color:#F69D50\">theme</span><span style=\"color:#ADBAC7\">} /></span></span>\n<span data-line=\"\"><span style=\"color:#ADBAC7\">}</span></span>\n<span data-line=\"\"><span style=\"color:#ADBAC7\">function Button({ theme }) {</span></span>\n<span data-line=\"\"><span style=\"color:#ADBAC7\">  return &#x3C;button className</span><span style=\"color:#F47067\">=</span><span style=\"color:#ADBAC7\">{theme}</span><span style=\"color:#F47067\">></span><span style=\"color:#ADBAC7\">Click</span><span style=\"color:#F47067\">&#x3C;/</span><span style=\"color:#ADBAC7\">button</span><span style=\"color:#F47067\">></span></span>\n<span data-line=\"\"><span style=\"color:#ADBAC7\">}</span></span></code></pre></figure>\n<p>Contextを使うと、途中を飛ばして直接データを受け取れる。</p>\n<figure class=\"mdn-code\" data-rehype-pretty-code-figure=\"\"><div class=\"mdn-code-header\"><div class=\"mdn-code-lang\">TS</div><div class=\"mdn-code-actions\"><button type=\"button\" class=\"mdn-code-copy\" aria-label=\"Copy code to clipboard\">Copy</button></div></div><pre tabindex=\"0\" data-language=\"typescript\" data-theme=\"github-dark-dimmed\"><code data-language=\"typescript\" data-theme=\"github-dark-dimmed\" style=\"display: grid;\"><span data-line=\"\"><span style=\"color:#768390\">// Context: どの階層からでも直接アクセス</span></span>\n<span data-line=\"\"><span style=\"color:#F47067\">const</span><span style=\"color:#6CB6FF\"> ThemeContext</span><span style=\"color:#F47067\"> =</span><span style=\"color:#DCBDFB\"> createContext</span><span style=\"color:#ADBAC7\">(</span><span style=\"color:#96D0FF\">'light'</span><span style=\"color:#ADBAC7\">)</span></span>\n<span data-line=\"\"> </span>\n<span data-line=\"\"><span style=\"color:#F47067\">function</span><span style=\"color:#DCBDFB\"> App</span><span style=\"color:#ADBAC7\">() {</span></span>\n<span data-line=\"\"><span style=\"color:#F47067\">  return</span><span style=\"color:#ADBAC7\"> (</span></span>\n<span data-line=\"\"><span style=\"color:#F47067\">    &#x3C;</span><span style=\"color:#ADBAC7\">ThemeContext.Provider value</span><span style=\"color:#F47067\">=</span><span style=\"color:#96D0FF\">\"dark\"</span><span style=\"color:#F47067\">></span></span>\n<span data-line=\"\"><span style=\"color:#F47067\">      &#x3C;</span><span style=\"color:#ADBAC7\">Header </span><span style=\"color:#F47067\">/></span></span>\n<span data-line=\"\"><span style=\"color:#F47067\">    &#x3C;/</span><span style=\"color:#ADBAC7\">ThemeContext.Provider</span><span style=\"color:#F47067\">></span></span>\n<span data-line=\"\"><span style=\"color:#ADBAC7\">  )</span></span>\n<span data-line=\"\"><span style=\"color:#ADBAC7\">}</span></span>\n<span data-line=\"\"><span style=\"color:#F47067\">function</span><span style=\"color:#DCBDFB\"> Header</span><span style=\"color:#ADBAC7\">() { </span><span style=\"color:#F47067\">return</span><span style=\"color:#ADBAC7\"> &#x3C;</span><span style=\"color:#F69D50\">Nav</span><span style=\"color:#ADBAC7\"> /> }</span></span>\n<span data-line=\"\"><span style=\"color:#F47067\">function</span><span style=\"color:#DCBDFB\"> Nav</span><span style=\"color:#ADBAC7\">() { </span><span style=\"color:#F47067\">return</span><span style=\"color:#ADBAC7\"> &#x3C;</span><span style=\"color:#F69D50\">Button</span><span style=\"color:#ADBAC7\"> /> }</span></span>\n<span data-line=\"\"><span style=\"color:#F47067\">function</span><span style=\"color:#DCBDFB\"> Button</span><span style=\"color:#ADBAC7\">() {</span></span>\n<span data-line=\"\"><span style=\"color:#F47067\">  const</span><span style=\"color:#6CB6FF\"> theme</span><span style=\"color:#F47067\"> =</span><span style=\"color:#DCBDFB\"> useContext</span><span style=\"color:#ADBAC7\">(ThemeContext)  </span><span style=\"color:#768390\">// 直接取得！</span></span>\n<span data-line=\"\"><span style=\"color:#F47067\">  return</span><span style=\"color:#ADBAC7\"> &#x3C;</span><span style=\"color:#F69D50\">button</span><span style=\"color:#F69D50\"> className</span><span style=\"color:#ADBAC7\">={</span><span style=\"color:#F69D50\">theme</span><span style=\"color:#ADBAC7\">}>Click</span><span style=\"color:#F47067\">&#x3C;/</span><span style=\"color:#ADBAC7\">button</span><span style=\"color:#F47067\">></span></span>\n<span data-line=\"\"><span style=\"color:#ADBAC7\">}</span></span></code></pre></figure>\n<h3 id=\"本プロジェクトでの使用例-5\">本プロジェクトでの使用例</h3>\n<figure class=\"mdn-code\" data-rehype-pretty-code-figure=\"\"><div class=\"mdn-code-header\"><div class=\"mdn-code-lang\">TS</div><div class=\"mdn-code-actions\"><button type=\"button\" class=\"mdn-code-copy\" aria-label=\"Copy code to clipboard\">Copy</button></div></div><pre tabindex=\"0\" data-language=\"typescript\" data-theme=\"github-dark-dimmed\"><code data-language=\"typescript\" data-theme=\"github-dark-dimmed\" style=\"display: grid;\"><span data-line=\"\"><span style=\"color:#768390\">// AdminAuthContext.tsx - カスタムフックでラップ</span></span>\n<span data-line=\"\"><span style=\"color:#F47067\">export</span><span style=\"color:#F47067\"> function</span><span style=\"color:#DCBDFB\"> useAdminAuth</span><span style=\"color:#ADBAC7\">() {</span></span>\n<span data-line=\"\"><span style=\"color:#F47067\">  const</span><span style=\"color:#6CB6FF\"> context</span><span style=\"color:#F47067\"> =</span><span style=\"color:#DCBDFB\"> useContext</span><span style=\"color:#ADBAC7\">(AdminAuthContext)</span></span>\n<span data-line=\"\"><span style=\"color:#F47067\">  if</span><span style=\"color:#ADBAC7\"> (</span><span style=\"color:#F47067\">!</span><span style=\"color:#ADBAC7\">context) {</span></span>\n<span data-line=\"\"><span style=\"color:#F47067\">    throw</span><span style=\"color:#F47067\"> new</span><span style=\"color:#DCBDFB\"> Error</span><span style=\"color:#ADBAC7\">(</span><span style=\"color:#96D0FF\">'useAdminAuth must be used within AdminAuthProvider'</span><span style=\"color:#ADBAC7\">)</span></span>\n<span data-line=\"\"><span style=\"color:#ADBAC7\">  }</span></span>\n<span data-line=\"\"><span style=\"color:#F47067\">  return</span><span style=\"color:#ADBAC7\"> context</span></span>\n<span data-line=\"\"><span style=\"color:#ADBAC7\">}</span></span></code></pre></figure>\n<figure class=\"mdn-code\" data-rehype-pretty-code-figure=\"\"><div class=\"mdn-code-header\"><div class=\"mdn-code-lang\">TS</div><div class=\"mdn-code-actions\"><button type=\"button\" class=\"mdn-code-copy\" aria-label=\"Copy code to clipboard\">Copy</button></div></div><pre tabindex=\"0\" data-language=\"typescript\" data-theme=\"github-dark-dimmed\"><code data-language=\"typescript\" data-theme=\"github-dark-dimmed\" style=\"display: grid;\"><span data-line=\"\"><span style=\"color:#768390\">// 各コンポーネントでの使用</span></span>\n<span data-line=\"\"><span style=\"color:#F47067\">const</span><span style=\"color:#ADBAC7\"> { </span><span style=\"color:#6CB6FF\">isAdmin</span><span style=\"color:#ADBAC7\">, </span><span style=\"color:#6CB6FF\">idToken</span><span style=\"color:#ADBAC7\">, </span><span style=\"color:#6CB6FF\">loginWithGoogle</span><span style=\"color:#ADBAC7\">, </span><span style=\"color:#6CB6FF\">logout</span><span style=\"color:#ADBAC7\"> } </span><span style=\"color:#F47067\">=</span><span style=\"color:#DCBDFB\"> useAdminAuth</span><span style=\"color:#ADBAC7\">()</span></span>\n<span data-line=\"\"> </span>\n<span data-line=\"\"><span style=\"color:#F47067\">if</span><span style=\"color:#ADBAC7\"> (</span><span style=\"color:#F47067\">!</span><span style=\"color:#ADBAC7\">isAdmin) {</span></span>\n<span data-line=\"\"><span style=\"color:#F47067\">  return</span><span style=\"color:#ADBAC7\"> &#x3C;</span><span style=\"color:#F69D50\">div</span><span style=\"color:#ADBAC7\">>管理者ログインが必要です</span><span style=\"color:#F47067\">&#x3C;/</span><span style=\"color:#ADBAC7\">div</span><span style=\"color:#F47067\">></span></span>\n<span data-line=\"\"><span style=\"color:#ADBAC7\">}</span></span></code></pre></figure>\n<hr>\n<br>\n<h2 id=\"lazy-と-suspense---遅延読み込み\">lazy と Suspense - 遅延読み込み</h2>\n<h3 id=\"lazy---コード分割\">lazy - コード分割</h3>\n<p>コンポーネントを動的にインポートし、コード分割を実現。初期バンドルサイズを削減。</p>\n<figure class=\"mdn-code\" data-rehype-pretty-code-figure=\"\"><div class=\"mdn-code-header\"><div class=\"mdn-code-lang\">TS</div><div class=\"mdn-code-actions\"><button type=\"button\" class=\"mdn-code-copy\" aria-label=\"Copy code to clipboard\">Copy</button></div></div><pre tabindex=\"0\" data-language=\"typescript\" data-theme=\"github-dark-dimmed\"><code data-language=\"typescript\" data-theme=\"github-dark-dimmed\" style=\"display: grid;\"><span data-line=\"\"><span style=\"color:#768390\">// 通常のimport: 最初に全部読み込む</span></span>\n<span data-line=\"\"><span style=\"color:#F47067\">import</span><span style=\"color:#ADBAC7\"> Home </span><span style=\"color:#F47067\">from</span><span style=\"color:#96D0FF\"> './routes/Home'</span></span>\n<span data-line=\"\"><span style=\"color:#F47067\">import</span><span style=\"color:#ADBAC7\"> AdminPanel </span><span style=\"color:#F47067\">from</span><span style=\"color:#96D0FF\"> './routes/AdminPanel'</span><span style=\"color:#768390\">  // 管理者しか使わないのに全員が読み込む</span></span>\n<span data-line=\"\"> </span>\n<span data-line=\"\"><span style=\"color:#768390\">// lazy: 必要になったら読み込む</span></span>\n<span data-line=\"\"><span style=\"color:#F47067\">const</span><span style=\"color:#6CB6FF\"> Home</span><span style=\"color:#F47067\"> =</span><span style=\"color:#DCBDFB\"> lazy</span><span style=\"color:#ADBAC7\">(() </span><span style=\"color:#F47067\">=></span><span style=\"color:#F47067\"> import</span><span style=\"color:#ADBAC7\">(</span><span style=\"color:#96D0FF\">'./routes/Home'</span><span style=\"color:#ADBAC7\">))</span></span>\n<span data-line=\"\"><span style=\"color:#F47067\">const</span><span style=\"color:#6CB6FF\"> AdminPanel</span><span style=\"color:#F47067\"> =</span><span style=\"color:#DCBDFB\"> lazy</span><span style=\"color:#ADBAC7\">(() </span><span style=\"color:#F47067\">=></span><span style=\"color:#F47067\"> import</span><span style=\"color:#ADBAC7\">(</span><span style=\"color:#96D0FF\">'./routes/AdminPanel'</span><span style=\"color:#ADBAC7\">))  </span><span style=\"color:#768390\">// 管理者がアクセスした時だけ読み込む</span></span></code></pre></figure>\n<h3 id=\"suspense---ローディング表示\">Suspense - ローディング表示</h3>\n<p>遅延読み込みコンポーネントのローディング中にフォールバックUIを表示。</p>\n<figure class=\"mdn-code\" data-rehype-pretty-code-figure=\"\"><div class=\"mdn-code-header\"><div class=\"mdn-code-lang\">TS</div><div class=\"mdn-code-actions\"><button type=\"button\" class=\"mdn-code-copy\" aria-label=\"Copy code to clipboard\">Copy</button></div></div><pre tabindex=\"0\" data-language=\"typescript\" data-theme=\"github-dark-dimmed\"><code data-language=\"typescript\" data-theme=\"github-dark-dimmed\" style=\"display: grid;\"><span data-line=\"\"><span style=\"color:#F47067\">&#x3C;</span><span style=\"color:#ADBAC7\">Suspense fallback</span><span style=\"color:#F47067\">=</span><span style=\"color:#ADBAC7\">{&#x3C;div>読み込み中</span><span style=\"color:#F47067\">...&#x3C;/</span><span style=\"color:#ADBAC7\">div</span><span style=\"color:#F47067\">></span><span style=\"color:#ADBAC7\">}</span><span style=\"color:#F47067\">></span></span>\n<span data-line=\"\"><span style=\"color:#F47067\">  &#x3C;</span><span style=\"color:#ADBAC7\">LazyComponent </span><span style=\"color:#F47067\">/></span><span style=\"color:#ADBAC7\">  {</span><span style=\"color:#768390\">/* 読み込み完了まで fallback が表示される */</span><span style=\"color:#ADBAC7\">}</span></span>\n<span data-line=\"\"><span style=\"color:#F47067\">&#x3C;/</span><span style=\"color:#ADBAC7\">Suspense</span><span style=\"color:#F47067\">></span></span></code></pre></figure>\n<h3 id=\"本プロジェクトでの使用例-6\">本プロジェクトでの使用例</h3>\n<figure class=\"mdn-code\" data-rehype-pretty-code-figure=\"\"><div class=\"mdn-code-header\"><div class=\"mdn-code-lang\">TS</div><div class=\"mdn-code-actions\"><button type=\"button\" class=\"mdn-code-copy\" aria-label=\"Copy code to clipboard\">Copy</button></div></div><pre tabindex=\"0\" data-language=\"typescript\" data-theme=\"github-dark-dimmed\"><code data-language=\"typescript\" data-theme=\"github-dark-dimmed\" style=\"display: grid;\"><span data-line=\"\"><span style=\"color:#768390\">// AnimatedRoutes.tsx - 全ルートの遅延読み込み</span></span>\n<span data-line=\"\"><span style=\"color:#F47067\">const</span><span style=\"color:#DCBDFB\"> loadHome</span><span style=\"color:#F47067\"> =</span><span style=\"color:#ADBAC7\"> () </span><span style=\"color:#F47067\">=></span><span style=\"color:#DCBDFB\"> import</span><span style=\"color:#ADBAC7\">(</span><span style=\"color:#768390\">/* webpackPreload: true */</span><span style=\"color:#96D0FF\"> '../routes/Home'</span><span style=\"color:#ADBAC7\">)</span></span>\n<span data-line=\"\"><span style=\"color:#F47067\">const</span><span style=\"color:#DCBDFB\"> loadPosts</span><span style=\"color:#F47067\"> =</span><span style=\"color:#ADBAC7\"> () </span><span style=\"color:#F47067\">=></span><span style=\"color:#DCBDFB\"> import</span><span style=\"color:#ADBAC7\">(</span><span style=\"color:#768390\">/* webpackPreload: true */</span><span style=\"color:#96D0FF\"> '../routes/Posts'</span><span style=\"color:#ADBAC7\">)</span></span>\n<span data-line=\"\"> </span>\n<span data-line=\"\"><span style=\"color:#F47067\">const</span><span style=\"color:#6CB6FF\"> Home</span><span style=\"color:#F47067\"> =</span><span style=\"color:#DCBDFB\"> lazy</span><span style=\"color:#ADBAC7\">(loadHome)</span></span>\n<span data-line=\"\"><span style=\"color:#F47067\">const</span><span style=\"color:#6CB6FF\"> Posts</span><span style=\"color:#F47067\"> =</span><span style=\"color:#DCBDFB\"> lazy</span><span style=\"color:#ADBAC7\">(loadPosts)</span></span>\n<span data-line=\"\"> </span>\n<span data-line=\"\"><span style=\"color:#768390\">// ルートをSuspenseで囲む</span></span>\n<span data-line=\"\"><span style=\"color:#F47067\">&#x3C;</span><span style=\"color:#ADBAC7\">Suspense fallback</span><span style=\"color:#F47067\">=</span><span style=\"color:#ADBAC7\">{null}</span><span style=\"color:#F47067\">></span></span>\n<span data-line=\"\"><span style=\"color:#F47067\">  &#x3C;</span><span style=\"color:#ADBAC7\">Routes location</span><span style=\"color:#F47067\">=</span><span style=\"color:#ADBAC7\">{location}</span><span style=\"color:#F47067\">></span></span>\n<span data-line=\"\"><span style=\"color:#F47067\">    &#x3C;</span><span style=\"color:#ADBAC7\">Route path</span><span style=\"color:#F47067\">=</span><span style=\"color:#96D0FF\">\"/\"</span><span style=\"color:#ADBAC7\"> element</span><span style=\"color:#F47067\">=</span><span style=\"color:#ADBAC7\">{&#x3C;App />} </span><span style=\"color:#F47067\">/></span></span>\n<span data-line=\"\"><span style=\"color:#F47067\">    &#x3C;</span><span style=\"color:#ADBAC7\">Route path</span><span style=\"color:#F47067\">=</span><span style=\"color:#96D0FF\">\"/home\"</span><span style=\"color:#ADBAC7\"> element</span><span style=\"color:#F47067\">=</span><span style=\"color:#ADBAC7\">{&#x3C;Home />} </span><span style=\"color:#F47067\">/></span></span>\n<span data-line=\"\"><span style=\"color:#F47067\">    &#x3C;</span><span style=\"color:#ADBAC7\">Route path</span><span style=\"color:#F47067\">=</span><span style=\"color:#96D0FF\">\"/posts\"</span><span style=\"color:#ADBAC7\"> element</span><span style=\"color:#F47067\">=</span><span style=\"color:#ADBAC7\">{&#x3C;Posts />} </span><span style=\"color:#F47067\">/></span></span>\n<span data-line=\"\"><span style=\"color:#F47067\">  &#x3C;/</span><span style=\"color:#ADBAC7\">Routes</span><span style=\"color:#F47067\">></span></span>\n<span data-line=\"\"><span style=\"color:#F47067\">&#x3C;/</span><span style=\"color:#ADBAC7\">Suspense</span><span style=\"color:#F47067\">></span></span></code></pre></figure>\n<hr>\n<br>\n<h2 id=\"uselayouteffect---同期的副作用フック\">useLayoutEffect - 同期的副作用フック</h2>\n<p>DOMの変更後、ブラウザの描画前に同期的に実行。</p>\n<h3 id=\"useeffectとの違い\">useEffectとの違い</h3>\n<figure class=\"mdn-code\" data-rehype-pretty-code-figure=\"\"><div class=\"mdn-code-header\"><div class=\"mdn-code-lang\">TEXT</div><div class=\"mdn-code-actions\"><button type=\"button\" class=\"mdn-code-copy\" aria-label=\"Copy code to clipboard\">Copy</button></div></div><pre tabindex=\"0\" data-language=\"plaintext\" data-theme=\"github-dark-dimmed\"><code data-language=\"plaintext\" data-theme=\"github-dark-dimmed\" style=\"display: grid;\"><span data-line=\"\"><span>レンダリング完了 → useLayoutEffect実行 → 画面に描画 → useEffect実行</span></span>\n<span data-line=\"\"><span>                  ↑ ここで実行           ↑ ユーザーに見える</span></span></code></pre></figure>\n<h3 id=\"使い分け\">使い分け</h3>\n<ul>\n<li><strong>useEffect（99%のケース）</strong>: API呼び出し、イベント登録、ログ出力など</li>\n<li><strong>useLayoutEffect（レアケース）</strong>: DOM測定、ちらつき防止、レイアウト調整</li>\n</ul>\n<h3 id=\"本プロジェクトでの使用例-7\">本プロジェクトでの使用例</h3>\n<figure class=\"mdn-code\" data-rehype-pretty-code-figure=\"\"><div class=\"mdn-code-header\"><div class=\"mdn-code-lang\">TS</div><div class=\"mdn-code-actions\"><button type=\"button\" class=\"mdn-code-copy\" aria-label=\"Copy code to clipboard\">Copy</button></div></div><pre tabindex=\"0\" data-language=\"typescript\" data-theme=\"github-dark-dimmed\"><code data-language=\"typescript\" data-theme=\"github-dark-dimmed\" style=\"display: grid;\"><span data-line=\"\"><span style=\"color:#768390\">// AnimatedRoutes.tsx - ルート遷移中のクラス付与</span></span>\n<span data-line=\"\"><span style=\"color:#DCBDFB\">useLayoutEffect</span><span style=\"color:#ADBAC7\">(() </span><span style=\"color:#F47067\">=></span><span style=\"color:#ADBAC7\"> {</span></span>\n<span data-line=\"\"><span style=\"color:#F47067\">  if</span><span style=\"color:#ADBAC7\"> (</span><span style=\"color:#F47067\">!</span><span style=\"color:#ADBAC7\">hasMountedRef.current) {</span></span>\n<span data-line=\"\"><span style=\"color:#ADBAC7\">    hasMountedRef.current </span><span style=\"color:#F47067\">=</span><span style=\"color:#6CB6FF\"> true</span></span>\n<span data-line=\"\"><span style=\"color:#F47067\">    return</span><span style=\"color:#768390\">  // 初回マウント時はスキップ</span></span>\n<span data-line=\"\"><span style=\"color:#ADBAC7\">  }</span></span>\n<span data-line=\"\"> </span>\n<span data-line=\"\"><span style=\"color:#F47067\">  const</span><span style=\"color:#6CB6FF\"> root</span><span style=\"color:#F47067\"> =</span><span style=\"color:#ADBAC7\"> document.documentElement</span></span>\n<span data-line=\"\"><span style=\"color:#ADBAC7\">  root.classList.</span><span style=\"color:#DCBDFB\">add</span><span style=\"color:#ADBAC7\">(</span><span style=\"color:#96D0FF\">'route-transitioning'</span><span style=\"color:#ADBAC7\">)  </span><span style=\"color:#768390\">// 遷移中クラスを即座に付与</span></span>\n<span data-line=\"\"> </span>\n<span data-line=\"\"><span style=\"color:#F47067\">  const</span><span style=\"color:#6CB6FF\"> timer</span><span style=\"color:#F47067\"> =</span><span style=\"color:#ADBAC7\"> window.</span><span style=\"color:#DCBDFB\">setTimeout</span><span style=\"color:#ADBAC7\">(() </span><span style=\"color:#F47067\">=></span><span style=\"color:#ADBAC7\"> {</span></span>\n<span data-line=\"\"><span style=\"color:#ADBAC7\">    root.classList.</span><span style=\"color:#DCBDFB\">remove</span><span style=\"color:#ADBAC7\">(</span><span style=\"color:#96D0FF\">'route-transitioning'</span><span style=\"color:#ADBAC7\">)</span></span>\n<span data-line=\"\"><span style=\"color:#ADBAC7\">  }, </span><span style=\"color:#6CB6FF\">ROUTE_TRANSITIONING_DURATION</span><span style=\"color:#ADBAC7\">)</span></span>\n<span data-line=\"\"> </span>\n<span data-line=\"\"><span style=\"color:#F47067\">  return</span><span style=\"color:#ADBAC7\"> () </span><span style=\"color:#F47067\">=></span><span style=\"color:#ADBAC7\"> {</span></span>\n<span data-line=\"\"><span style=\"color:#ADBAC7\">    window.</span><span style=\"color:#DCBDFB\">clearTimeout</span><span style=\"color:#ADBAC7\">(timer)</span></span>\n<span data-line=\"\"><span style=\"color:#ADBAC7\">    root.classList.</span><span style=\"color:#DCBDFB\">remove</span><span style=\"color:#ADBAC7\">(</span><span style=\"color:#96D0FF\">'route-transitioning'</span><span style=\"color:#ADBAC7\">)</span></span>\n<span data-line=\"\"><span style=\"color:#ADBAC7\">  }</span></span>\n<span data-line=\"\"><span style=\"color:#ADBAC7\">}, [location.pathname])</span></span></code></pre></figure>\n<hr>\n<br>\n<h2 id=\"starttransition---低優先度更新\">startTransition - 低優先度更新</h2>\n<p>状態更新を低優先度としてマークし、ユーザー入力等を優先。React 18の機能。</p>\n<h3 id=\"なぜ必要なのか-2\">なぜ必要なのか</h3>\n<figure class=\"mdn-code\" data-rehype-pretty-code-figure=\"\"><div class=\"mdn-code-header\"><div class=\"mdn-code-lang\">TS</div><div class=\"mdn-code-actions\"><button type=\"button\" class=\"mdn-code-copy\" aria-label=\"Copy code to clipboard\">Copy</button></div></div><pre tabindex=\"0\" data-language=\"typescript\" data-theme=\"github-dark-dimmed\"><code data-language=\"typescript\" data-theme=\"github-dark-dimmed\" style=\"display: grid;\"><span data-line=\"\"><span style=\"color:#768390\">// 重い処理がユーザー入力をブロック</span></span>\n<span data-line=\"\"><span style=\"color:#F47067\">function</span><span style=\"color:#DCBDFB\"> Search</span><span style=\"color:#ADBAC7\">() {</span></span>\n<span data-line=\"\"><span style=\"color:#F47067\">  const</span><span style=\"color:#ADBAC7\"> [</span><span style=\"color:#6CB6FF\">query</span><span style=\"color:#ADBAC7\">, </span><span style=\"color:#6CB6FF\">setQuery</span><span style=\"color:#ADBAC7\">] </span><span style=\"color:#F47067\">=</span><span style=\"color:#DCBDFB\"> useState</span><span style=\"color:#ADBAC7\">(</span><span style=\"color:#96D0FF\">''</span><span style=\"color:#ADBAC7\">)</span></span>\n<span data-line=\"\"><span style=\"color:#F47067\">  const</span><span style=\"color:#ADBAC7\"> [</span><span style=\"color:#6CB6FF\">results</span><span style=\"color:#ADBAC7\">, </span><span style=\"color:#6CB6FF\">setResults</span><span style=\"color:#ADBAC7\">] </span><span style=\"color:#F47067\">=</span><span style=\"color:#DCBDFB\"> useState</span><span style=\"color:#ADBAC7\">([])</span></span>\n<span data-line=\"\"> </span>\n<span data-line=\"\"><span style=\"color:#F47067\">  const</span><span style=\"color:#DCBDFB\"> handleChange</span><span style=\"color:#F47067\"> =</span><span style=\"color:#ADBAC7\"> (</span><span style=\"color:#F69D50\">e</span><span style=\"color:#ADBAC7\">) </span><span style=\"color:#F47067\">=></span><span style=\"color:#ADBAC7\"> {</span></span>\n<span data-line=\"\"><span style=\"color:#DCBDFB\">    setQuery</span><span style=\"color:#ADBAC7\">(e.target.value)        </span><span style=\"color:#768390\">// 入力を即座に反映したい</span></span>\n<span data-line=\"\"><span style=\"color:#DCBDFB\">    setResults</span><span style=\"color:#ADBAC7\">(</span><span style=\"color:#DCBDFB\">searchItems</span><span style=\"color:#ADBAC7\">(query))  </span><span style=\"color:#768390\">// 重い処理...入力が遅延する</span></span>\n<span data-line=\"\"><span style=\"color:#ADBAC7\">  }</span></span>\n<span data-line=\"\"><span style=\"color:#ADBAC7\">}</span></span>\n<span data-line=\"\"> </span>\n<span data-line=\"\"><span style=\"color:#768390\">// startTransitionで解決</span></span>\n<span data-line=\"\"><span style=\"color:#F47067\">function</span><span style=\"color:#DCBDFB\"> Search</span><span style=\"color:#ADBAC7\">() {</span></span>\n<span data-line=\"\"><span style=\"color:#F47067\">  const</span><span style=\"color:#ADBAC7\"> [</span><span style=\"color:#6CB6FF\">query</span><span style=\"color:#ADBAC7\">, </span><span style=\"color:#6CB6FF\">setQuery</span><span style=\"color:#ADBAC7\">] </span><span style=\"color:#F47067\">=</span><span style=\"color:#DCBDFB\"> useState</span><span style=\"color:#ADBAC7\">(</span><span style=\"color:#96D0FF\">''</span><span style=\"color:#ADBAC7\">)</span></span>\n<span data-line=\"\"><span style=\"color:#F47067\">  const</span><span style=\"color:#ADBAC7\"> [</span><span style=\"color:#6CB6FF\">results</span><span style=\"color:#ADBAC7\">, </span><span style=\"color:#6CB6FF\">setResults</span><span style=\"color:#ADBAC7\">] </span><span style=\"color:#F47067\">=</span><span style=\"color:#DCBDFB\"> useState</span><span style=\"color:#ADBAC7\">([])</span></span>\n<span data-line=\"\"> </span>\n<span data-line=\"\"><span style=\"color:#F47067\">  const</span><span style=\"color:#DCBDFB\"> handleChange</span><span style=\"color:#F47067\"> =</span><span style=\"color:#ADBAC7\"> (</span><span style=\"color:#F69D50\">e</span><span style=\"color:#ADBAC7\">) </span><span style=\"color:#F47067\">=></span><span style=\"color:#ADBAC7\"> {</span></span>\n<span data-line=\"\"><span style=\"color:#DCBDFB\">    setQuery</span><span style=\"color:#ADBAC7\">(e.target.value)  </span><span style=\"color:#768390\">// 高優先度: 即座に反映</span></span>\n<span data-line=\"\"> </span>\n<span data-line=\"\"><span style=\"color:#DCBDFB\">    startTransition</span><span style=\"color:#ADBAC7\">(() </span><span style=\"color:#F47067\">=></span><span style=\"color:#ADBAC7\"> {</span></span>\n<span data-line=\"\"><span style=\"color:#768390\">      // 低優先度: ユーザー入力を邪魔しない</span></span>\n<span data-line=\"\"><span style=\"color:#DCBDFB\">      setResults</span><span style=\"color:#ADBAC7\">(</span><span style=\"color:#DCBDFB\">searchItems</span><span style=\"color:#ADBAC7\">(e.target.value))</span></span>\n<span data-line=\"\"><span style=\"color:#ADBAC7\">    })</span></span>\n<span data-line=\"\"><span style=\"color:#ADBAC7\">  }</span></span>\n<span data-line=\"\"><span style=\"color:#ADBAC7\">}</span></span></code></pre></figure>\n<h3 id=\"本プロジェクトでの使用例-8\">本プロジェクトでの使用例</h3>\n<figure class=\"mdn-code\" data-rehype-pretty-code-figure=\"\"><div class=\"mdn-code-header\"><div class=\"mdn-code-lang\">TS</div><div class=\"mdn-code-actions\"><button type=\"button\" class=\"mdn-code-copy\" aria-label=\"Copy code to clipboard\">Copy</button></div></div><pre tabindex=\"0\" data-language=\"typescript\" data-theme=\"github-dark-dimmed\"><code data-language=\"typescript\" data-theme=\"github-dark-dimmed\" style=\"display: grid;\"><span data-line=\"\"><span style=\"color:#768390\">// Posts.tsx - タグフィルタリングの低優先度更新</span></span>\n<span data-line=\"\"><span style=\"color:#F47067\">const</span><span style=\"color:#6CB6FF\"> handleTagClick</span><span style=\"color:#F47067\"> =</span><span style=\"color:#DCBDFB\"> useCallback</span><span style=\"color:#ADBAC7\">((</span><span style=\"color:#F69D50\">tag</span><span style=\"color:#F47067\">:</span><span style=\"color:#6CB6FF\"> string</span><span style=\"color:#ADBAC7\">) </span><span style=\"color:#F47067\">=></span><span style=\"color:#ADBAC7\"> {</span></span>\n<span data-line=\"\"><span style=\"color:#DCBDFB\">  startTransition</span><span style=\"color:#ADBAC7\">(() </span><span style=\"color:#F47067\">=></span><span style=\"color:#ADBAC7\"> {</span></span>\n<span data-line=\"\"><span style=\"color:#DCBDFB\">    setSearchParams</span><span style=\"color:#ADBAC7\">(tag </span><span style=\"color:#F47067\">?</span><span style=\"color:#ADBAC7\"> { tag } </span><span style=\"color:#F47067\">:</span><span style=\"color:#ADBAC7\"> {})</span></span>\n<span data-line=\"\"><span style=\"color:#ADBAC7\">  })</span></span>\n<span data-line=\"\"><span style=\"color:#ADBAC7\">}, [setSearchParams])</span></span></code></pre></figure>"
  },
  {
    "slug": "markdown_memo",
    "title": "Markdown記法のメモ",
    "summary": "このサイトで実装しているMarkdown記法と、コードブロック/メモ/定義リストなどの拡張仕様をまとめる",
    "createdAt": "2025-12-15",
    "tags": [
      "Markdown",
      "MDN"
    ],
    "html": "<p>このサイトのPostsは <span data-rehype-pretty-code-figure=\"\"><code data-language=\"plaintext\" data-theme=\"github-dark-dimmed\"><span data-line=\"\"><span>content/posts/*.md</span></span></code></span> をHTMLへ変換して表示しています。\nここでは「このサイトで使えるMarkdown記法」を備忘録としてまとめます。</p>\n<h2 id=\"目次\">目次</h2>\n<div class=\"toc-box\"><ul>\n<li><a href=\"#%E3%83%99%E3%83%BC%E3%82%B9%E3%83%A9%E3%82%A4%E3%83%B3gfm\">ベースライン（GFM）</a></li>\n<li><a href=\"#%E8%A6%8B%E5%87%BA%E3%81%97\">見出し</a></li>\n<li><a href=\"#%E8%A6%8B%E5%87%BA%E3%81%97%E4%BE%8B\">見出し例</a></li>\n<li><a href=\"#%E7%AE%87%E6%9D%A1%E6%9B%B8%E3%81%8D\">箇条書き</a></li>\n<li><a href=\"#%E7%95%AA%E5%8F%B7%E4%BB%98%E3%81%8D%E3%83%AA%E3%82%B9%E3%83%88\">番号付きリスト</a></li>\n<li><a href=\"#%E5%BC%B7%E8%AA%BF\">強調</a></li>\n<li><a href=\"#%E6%89%93%E3%81%A1%E6%B6%88%E3%81%97%E7%B7%9A\">打ち消し線</a></li>\n<li><a href=\"#%E3%82%A4%E3%83%B3%E3%83%A9%E3%82%A4%E3%83%B3%E3%82%B3%E3%83%BC%E3%83%89\">インラインコード</a></li>\n<li><a href=\"#%E8%A1%A8%E3%83%86%E3%83%BC%E3%83%96%E3%83%AB\">表（テーブル）</a></li>\n<li><a href=\"#%E3%83%AA%E3%83%B3%E3%82%AF\">リンク</a></li>\n<li><a href=\"#%E3%82%B3%E3%83%BC%E3%83%89%E3%83%96%E3%83%AD%E3%83%83%E3%82%AFmdn%E5%AF%84%E3%81%9B\">コードブロック（MDN寄せ）</a></li>\n<li><a href=\"#%E8%A8%80%E8%AA%9E%E6%8C%87%E5%AE%9A\">言語指定</a></li>\n<li><a href=\"#-nolint%E3%83%AA%E3%83%B3%E3%82%BF%E3%83%BC%E6%8A%91%E5%88%B6\">-nolint（リンター抑制）</a></li>\n<li><a href=\"#%E8%BF%BD%E5%8A%A0%E3%82%AF%E3%83%A9%E3%82%B9example-good--example-bad\">追加クラス（example-good / example-bad）</a></li>\n<li><a href=\"#hidden%E9%9D%9E%E8%A1%A8%E7%A4%BA\">hidden（非表示）</a></li>\n<li><a href=\"#%E3%83%A1%E3%83%A2%E8%AD%A6%E5%91%8A%E3%82%B3%E3%83%BC%E3%83%AB%E3%82%A2%E3%82%A6%E3%83%88mdn%E3%82%A2%E3%83%A9%E3%83%BC%E3%83%88\">メモ/警告/コールアウト（MDNアラート）</a></li>\n<li><a href=\"#%E5%AE%9A%E7%BE%A9%E3%83%AA%E3%82%B9%E3%83%88mdn%E5%BD%A2%E5%BC%8F\">定義リスト（MDN形式）</a></li>\n<li><a href=\"#%E6%95%B0%E5%BC%8Fkatex\">数式（KaTeX）</a></li>\n<li><a href=\"#html-%E3%82%92%E3%81%9D%E3%81%AE%E3%81%BE%E3%81%BE%E4%BD%BF%E3%81%86\">HTML をそのまま使う</a></li>\n<li><a href=\"#%E6%94%B9%E8%A1%8C%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6\">改行について</a></li>\n<li><a href=\"#mermaid-%E3%83%80%E3%82%A4%E3%82%A2%E3%82%B0%E3%83%A9%E3%83%A0\">Mermaid ダイアグラム</a></li>\n<li><a href=\"#%E3%83%95%E3%83%AD%E3%83%BC%E3%83%81%E3%83%A3%E3%83%BC%E3%83%88-flowchart\">フローチャート (flowchart)</a></li>\n<li><a href=\"#%E3%82%B5%E3%83%96%E3%82%B0%E3%83%A9%E3%83%95-subgraph\">サブグラフ (subgraph)</a></li>\n<li><a href=\"#%E3%82%B7%E3%83%BC%E3%82%B1%E3%83%B3%E3%82%B9%E5%9B%B3-sequencediagram\">シーケンス図 (sequenceDiagram)</a></li>\n<li><a href=\"#%E7%8A%B6%E6%85%8B%E9%81%B7%E7%A7%BB%E5%9B%B3-statediagram-v2\">状態遷移図 (stateDiagram-v2)</a></li>\n<li><a href=\"#%E3%82%AF%E3%83%A9%E3%82%B9%E5%9B%B3-classdiagram\">クラス図 (classDiagram)</a></li>\n<li><a href=\"#er%E5%9B%B3-erdiagram\">ER図 (erDiagram)</a></li>\n<li><a href=\"#%E5%86%86%E3%82%B0%E3%83%A9%E3%83%95-pie\">円グラフ (pie)</a></li>\n<li><a href=\"#%E3%82%B9%E3%82%BF%E3%82%A4%E3%83%AB%E3%81%AE%E3%82%AB%E3%82%B9%E3%82%BF%E3%83%9E%E3%82%A4%E3%82%BA\">スタイルのカスタマイズ</a></li>\n</ul></div>\n<br>\n<h2 id=\"ベースラインgfm\">ベースライン（GFM）</h2>\n<p>基本は GitHub Flavored Markdown（GFM）です。</p>\n<h3 id=\"見出し\">見出し</h3>\n<p><span data-rehype-pretty-code-figure=\"\"><code data-language=\"plaintext\" data-theme=\"github-dark-dimmed\"><span data-line=\"\"><span>#</span></span></code></span>〜<span data-rehype-pretty-code-figure=\"\"><code data-language=\"plaintext\" data-theme=\"github-dark-dimmed\"><span data-line=\"\"><span>####</span></span></code></span> で見出しを記述します。</p>\n<figure class=\"mdn-code\" data-rehype-pretty-code-figure=\"\"><div class=\"mdn-code-header\"><div class=\"mdn-code-lang\">MD</div><div class=\"mdn-code-actions\"><button type=\"button\" class=\"mdn-code-copy\" aria-label=\"Copy code to clipboard\">Copy</button></div></div><pre tabindex=\"0\" data-language=\"md\" data-theme=\"github-dark-dimmed\"><code data-language=\"md\" data-theme=\"github-dark-dimmed\" style=\"display: grid;\"><span data-line=\"\"><span style=\"color:#6CB6FF;font-weight:bold\"># 見出し1</span></span>\n<span data-line=\"\"><span style=\"color:#6CB6FF;font-weight:bold\">## 見出し2</span></span>\n<span data-line=\"\"><span style=\"color:#6CB6FF;font-weight:bold\">### 見出し3</span></span>\n<span data-line=\"\"><span style=\"color:#6CB6FF;font-weight:bold\">#### 見出し4</span></span></code></pre></figure>\n<p>表示例:</p>\n<h4 id=\"見出し例\">見出し例</h4>\n<br>\n<h3 id=\"箇条書き\">箇条書き</h3>\n<p><span data-rehype-pretty-code-figure=\"\"><code data-language=\"plaintext\" data-theme=\"github-dark-dimmed\"><span data-line=\"\"><span>-</span></span></code></span> または <span data-rehype-pretty-code-figure=\"\"><code data-language=\"plaintext\" data-theme=\"github-dark-dimmed\"><span data-line=\"\"><span>*</span></span></code></span> で箇条書きリストを記述します。</p>\n<figure class=\"mdn-code\" data-rehype-pretty-code-figure=\"\"><div class=\"mdn-code-header\"><div class=\"mdn-code-lang\">MD</div><div class=\"mdn-code-actions\"><button type=\"button\" class=\"mdn-code-copy\" aria-label=\"Copy code to clipboard\">Copy</button></div></div><pre tabindex=\"0\" data-language=\"md\" data-theme=\"github-dark-dimmed\"><code data-language=\"md\" data-theme=\"github-dark-dimmed\" style=\"display: grid;\"><span data-line=\"\"><span style=\"color:#F69D50\">-</span><span style=\"color:#ADBAC7\"> 項目1</span></span>\n<span data-line=\"\"><span style=\"color:#F69D50\">-</span><span style=\"color:#ADBAC7\"> 項目2</span></span>\n<span data-line=\"\"><span style=\"color:#F69D50\">  -</span><span style=\"color:#ADBAC7\"> ネストした項目</span></span>\n<span data-line=\"\"><span style=\"color:#F69D50\">-</span><span style=\"color:#ADBAC7\"> 項目3</span></span></code></pre></figure>\n<p>表示例:</p>\n<ul>\n<li>項目1</li>\n<li>項目2\n<ul>\n<li>ネストした項目</li>\n</ul>\n</li>\n<li>項目3</li>\n</ul>\n<br>\n<h3 id=\"番号付きリスト\">番号付きリスト</h3>\n<p><span data-rehype-pretty-code-figure=\"\"><code data-language=\"plaintext\" data-theme=\"github-dark-dimmed\"><span data-line=\"\"><span>1.</span></span></code></span> で番号付きリストを記述します。</p>\n<figure class=\"mdn-code\" data-rehype-pretty-code-figure=\"\"><div class=\"mdn-code-header\"><div class=\"mdn-code-lang\">MD</div><div class=\"mdn-code-actions\"><button type=\"button\" class=\"mdn-code-copy\" aria-label=\"Copy code to clipboard\">Copy</button></div></div><pre tabindex=\"0\" data-language=\"md\" data-theme=\"github-dark-dimmed\"><code data-language=\"md\" data-theme=\"github-dark-dimmed\" style=\"display: grid;\"><span data-line=\"\"><span style=\"color:#F69D50\">1.</span><span style=\"color:#ADBAC7\"> 最初の項目</span></span>\n<span data-line=\"\"><span style=\"color:#F69D50\">2.</span><span style=\"color:#ADBAC7\"> 2番目の項目</span></span>\n<span data-line=\"\"><span style=\"color:#F69D50\">3.</span><span style=\"color:#ADBAC7\"> 3番目の項目</span></span></code></pre></figure>\n<p>表示例:</p>\n<ol>\n<li>最初の項目</li>\n<li>2番目の項目</li>\n<li>3番目の項目</li>\n</ol>\n<br>\n<h3 id=\"強調\">強調</h3>\n<p><span data-rehype-pretty-code-figure=\"\"><code data-language=\"plaintext\" data-theme=\"github-dark-dimmed\"><span data-line=\"\"><span>*italic*</span></span></code></span> でイタリック、<span data-rehype-pretty-code-figure=\"\"><code data-language=\"plaintext\" data-theme=\"github-dark-dimmed\"><span data-line=\"\"><span>**bold**</span></span></code></span> で太字になります。</p>\n<figure class=\"mdn-code\" data-rehype-pretty-code-figure=\"\"><div class=\"mdn-code-header\"><div class=\"mdn-code-lang\">MD</div><div class=\"mdn-code-actions\"><button type=\"button\" class=\"mdn-code-copy\" aria-label=\"Copy code to clipboard\">Copy</button></div></div><pre tabindex=\"0\" data-language=\"md\" data-theme=\"github-dark-dimmed\"><code data-language=\"md\" data-theme=\"github-dark-dimmed\" style=\"display: grid;\"><span data-line=\"\"><span style=\"color:#ADBAC7\">これは </span><span style=\"color:#ADBAC7;font-style:italic\">*イタリック*</span><span style=\"color:#ADBAC7\"> で、これは </span><span style=\"color:#ADBAC7;font-weight:bold\">**太字**</span><span style=\"color:#ADBAC7\"> です。</span></span></code></pre></figure>\n<p>表示例:</p>\n<p>これは <em>イタリック</em> で、これは <strong>太字</strong> です。</p>\n<br>\n<h3 id=\"打ち消し線\">打ち消し線</h3>\n<p><span data-rehype-pretty-code-figure=\"\"><code data-language=\"plaintext\" data-theme=\"github-dark-dimmed\"><span data-line=\"\"><span>~~text~~</span></span></code></span> で打ち消し線を引けます。</p>\n<figure class=\"mdn-code\" data-rehype-pretty-code-figure=\"\"><div class=\"mdn-code-header\"><div class=\"mdn-code-lang\">MD</div><div class=\"mdn-code-actions\"><button type=\"button\" class=\"mdn-code-copy\" aria-label=\"Copy code to clipboard\">Copy</button></div></div><pre tabindex=\"0\" data-language=\"md\" data-theme=\"github-dark-dimmed\"><code data-language=\"md\" data-theme=\"github-dark-dimmed\" style=\"display: grid;\"><span data-line=\"\"><span style=\"color:#ADBAC7;text-decoration:line-through\">~~打ち消し線のテキスト~~</span></span></code></pre></figure>\n<p>表示例:</p>\n<p><del>打ち消し線のテキスト</del></p>\n<br>\n<h3 id=\"インラインコード\">インラインコード</h3>\n<p><span data-rehype-pretty-code-figure=\"\"><code data-language=\"plaintext\" data-theme=\"github-dark-dimmed\"><span data-line=\"\"><span>`code`</span></span></code></span> でインラインコードを記述します。</p>\n<figure class=\"mdn-code\" data-rehype-pretty-code-figure=\"\"><div class=\"mdn-code-header\"><div class=\"mdn-code-lang\">MD</div><div class=\"mdn-code-actions\"><button type=\"button\" class=\"mdn-code-copy\" aria-label=\"Copy code to clipboard\">Copy</button></div></div><pre tabindex=\"0\" data-language=\"md\" data-theme=\"github-dark-dimmed\"><code data-language=\"md\" data-theme=\"github-dark-dimmed\" style=\"display: grid;\"><span data-line=\"\"><span style=\"color:#ADBAC7\">このコマンドは </span><span style=\"color:#6CB6FF\">`npm install`</span><span style=\"color:#ADBAC7\"> で実行します。</span></span></code></pre></figure>\n<p>表示例:</p>\n<p>このコマンドは <span data-rehype-pretty-code-figure=\"\"><code data-language=\"plaintext\" data-theme=\"github-dark-dimmed\"><span data-line=\"\"><span>npm install</span></span></code></span> で実行します。</p>\n<br>\n<h3 id=\"表テーブル\">表（テーブル）</h3>\n<p><span data-rehype-pretty-code-figure=\"\"><code data-language=\"plaintext\" data-theme=\"github-dark-dimmed\"><span data-line=\"\"><span>|</span></span></code></span> 区切りでテーブルを記述します。</p>\n<figure class=\"mdn-code\" data-rehype-pretty-code-figure=\"\"><div class=\"mdn-code-header\"><div class=\"mdn-code-lang\">MD</div><div class=\"mdn-code-actions\"><button type=\"button\" class=\"mdn-code-copy\" aria-label=\"Copy code to clipboard\">Copy</button></div></div><pre tabindex=\"0\" data-language=\"md\" data-theme=\"github-dark-dimmed\"><code data-language=\"md\" data-theme=\"github-dark-dimmed\" style=\"display: grid;\"><span data-line=\"\"><span style=\"color:#ADBAC7\">| 列1 | 列2 | 列3 |</span></span>\n<span data-line=\"\"><span style=\"color:#ADBAC7\">|------|------|------|</span></span>\n<span data-line=\"\"><span style=\"color:#ADBAC7\">| データ1 | データ2 | データ3 |</span></span>\n<span data-line=\"\"><span style=\"color:#ADBAC7\">| データ4 | データ5 | データ6 |</span></span></code></pre></figure>\n<p>表示例:</p>\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n<div class=\"table-wrapper\"><table><thead><tr><th>列1</th><th>列2</th><th>列3</th></tr></thead><tbody><tr><td>データ1</td><td>データ2</td><td>データ3</td></tr><tr><td>データ4</td><td>データ5</td><td>データ6</td></tr></tbody></table></div>\n<br>\n<h3 id=\"リンク\">リンク</h3>\n<p><span data-rehype-pretty-code-figure=\"\"><code data-language=\"plaintext\" data-theme=\"github-dark-dimmed\"><span data-line=\"\"><span>[text](url)</span></span></code></span> でリンクを記述します。</p>\n<figure class=\"mdn-code\" data-rehype-pretty-code-figure=\"\"><div class=\"mdn-code-header\"><div class=\"mdn-code-lang\">MD</div><div class=\"mdn-code-actions\"><button type=\"button\" class=\"mdn-code-copy\" aria-label=\"Copy code to clipboard\">Copy</button></div></div><pre tabindex=\"0\" data-language=\"md\" data-theme=\"github-dark-dimmed\"><code data-language=\"md\" data-theme=\"github-dark-dimmed\" style=\"display: grid;\"><span data-line=\"\"><span style=\"color:#ADBAC7\">[</span><span style=\"color:#96D0FF\">Google</span><span style=\"color:#ADBAC7\">](</span><span style=\"color:#ADBAC7;text-decoration:underline\">https://google.com</span><span style=\"color:#ADBAC7\">)</span></span></code></pre></figure>\n<p>表示例:</p>\n<p><a href=\"https://google.com\">Google</a></p>\n<br>\n<h2 id=\"コードブロックmdn寄せ\">コードブロック（MDN寄せ）</h2>\n<p>MDN の「Markdown の書き方」に寄せて、コードフェンス（```）の情報文字列を次のように扱います。</p>\n<br>\n<h3 id=\"言語指定\">言語指定</h3>\n<p>先頭の単語を言語として扱います。</p>\n<figure class=\"mdn-code\" data-rehype-pretty-code-figure=\"\"><div class=\"mdn-code-header\"><div class=\"mdn-code-lang\">MD</div><div class=\"mdn-code-actions\"><button type=\"button\" class=\"mdn-code-copy\" aria-label=\"Copy code to clipboard\">Copy</button></div></div><pre tabindex=\"0\" data-language=\"md\" data-theme=\"github-dark-dimmed\"><code data-language=\"md\" data-theme=\"github-dark-dimmed\" style=\"display: grid;\"><span data-line=\"\"><span style=\"color:#ADBAC7\">```js</span></span>\n<span data-line=\"\"><span style=\"color:#ADBAC7\">console.</span><span style=\"color:#DCBDFB\">log</span><span style=\"color:#ADBAC7\">(</span><span style=\"color:#96D0FF\">\"hello\"</span><span style=\"color:#ADBAC7\">);</span></span>\n<span data-line=\"\"><span style=\"color:#ADBAC7\">```</span></span></code></pre></figure>\n<p>表示例:</p>\n<figure class=\"mdn-code\" data-rehype-pretty-code-figure=\"\"><div class=\"mdn-code-header\"><div class=\"mdn-code-lang\">JS</div><div class=\"mdn-code-actions\"><button type=\"button\" class=\"mdn-code-copy\" aria-label=\"Copy code to clipboard\">Copy</button></div></div><pre tabindex=\"0\" data-language=\"js\" data-theme=\"github-dark-dimmed\"><code data-language=\"js\" data-theme=\"github-dark-dimmed\" style=\"display: grid;\"><span data-line=\"\"><span style=\"color:#ADBAC7\">console.</span><span style=\"color:#DCBDFB\">log</span><span style=\"color:#ADBAC7\">(</span><span style=\"color:#96D0FF\">\"hello\"</span><span style=\"color:#ADBAC7\">);</span></span></code></pre></figure>\n<p>注意事項:</p>\n<ul>\n<li><span data-rehype-pretty-code-figure=\"\"><code data-language=\"plaintext\" data-theme=\"github-dark-dimmed\"><span data-line=\"\"><span>plain</span></span></code></span> は <span data-rehype-pretty-code-figure=\"\"><code data-language=\"plaintext\" data-theme=\"github-dark-dimmed\"><span data-line=\"\"><span>plaintext</span></span></code></span> と同じ扱いです。</li>\n<li>以前使っていた <span data-rehype-pretty-code-figure=\"\"><code data-language=\"plaintext\" data-theme=\"github-dark-dimmed\"><span data-line=\"\"><span> ```lang:タイトル</span></span></code></span> の <span data-rehype-pretty-code-figure=\"\"><code data-language=\"plaintext\" data-theme=\"github-dark-dimmed\"><span data-line=\"\"><span>:タイトル</span></span></code></span> 部分は無視されます（タイトル表示は行いません）。タイトルは本文として書いてください。</li>\n</ul>\n<br>\n<h3 id=\"-nolintリンター抑制\"><span data-rehype-pretty-code-figure=\"\"><code data-language=\"plaintext\" data-theme=\"github-dark-dimmed\"><span data-line=\"\"><span>-nolint</span></span></code></span>（リンター抑制）</h3>\n<p>言語名に <span data-rehype-pretty-code-figure=\"\"><code data-language=\"plaintext\" data-theme=\"github-dark-dimmed\"><span data-line=\"\"><span>-nolint</span></span></code></span> を付けられます（例: <span data-rehype-pretty-code-figure=\"\"><code data-language=\"plaintext\" data-theme=\"github-dark-dimmed\"><span data-line=\"\"><span>html-nolint</span></span></code></span>）。</p>\n<figure class=\"mdn-code\" data-rehype-pretty-code-figure=\"\"><div class=\"mdn-code-header\"><div class=\"mdn-code-lang\">MD</div><div class=\"mdn-code-actions\"><button type=\"button\" class=\"mdn-code-copy\" aria-label=\"Copy code to clipboard\">Copy</button></div></div><pre tabindex=\"0\" data-language=\"md\" data-theme=\"github-dark-dimmed\"><code data-language=\"md\" data-theme=\"github-dark-dimmed\" style=\"display: grid;\"><span data-line=\"\"><span style=\"color:#ADBAC7\">```html-nolint</span></span>\n<span data-line=\"\"><span style=\"color:#ADBAC7\">&#x3C;p></span></span>\n<span data-line=\"\"><span style=\"color:#ADBAC7\">I will not be linted.</span></span>\n<span data-line=\"\"><span style=\"color:#ADBAC7\">&#x3C;/p></span></span>\n<span data-line=\"\"><span style=\"color:#ADBAC7\">```</span></span></code></pre></figure>\n<p>表示例:</p>\n<figure class=\"mdn-code nolint\" data-rehype-pretty-code-figure=\"\"><div class=\"mdn-code-header\"><div class=\"mdn-code-lang\">HTML</div><div class=\"mdn-code-actions\"><button type=\"button\" class=\"mdn-code-copy\" aria-label=\"Copy code to clipboard\">Copy</button></div></div><pre tabindex=\"0\" data-language=\"html\" data-theme=\"github-dark-dimmed\"><code data-language=\"html\" data-theme=\"github-dark-dimmed\" style=\"display: grid;\"><span data-line=\"\"><span style=\"color:#ADBAC7\">&#x3C;</span><span style=\"color:#8DDB8C\">p</span><span style=\"color:#ADBAC7\">></span></span>\n<span data-line=\"\"><span style=\"color:#ADBAC7\">I will not be linted.</span></span>\n<span data-line=\"\"><span style=\"color:#ADBAC7\">&#x3C;/</span><span style=\"color:#8DDB8C\">p</span><span style=\"color:#ADBAC7\">></span></span></code></pre></figure>\n<br>\n<h3 id=\"追加クラスexample-good--example-bad\">追加クラス（<span data-rehype-pretty-code-figure=\"\"><code data-language=\"plaintext\" data-theme=\"github-dark-dimmed\"><span data-line=\"\"><span>example-good</span></span></code></span> / <span data-rehype-pretty-code-figure=\"\"><code data-language=\"plaintext\" data-theme=\"github-dark-dimmed\"><span data-line=\"\"><span>example-bad</span></span></code></span>）</h3>\n<p>言語名の後ろに追加の単語を並べると、クラスとして扱います（MDNの「情報文字列」の考え方）。</p>\n<figure class=\"mdn-code\" data-rehype-pretty-code-figure=\"\"><div class=\"mdn-code-header\"><div class=\"mdn-code-lang\">MD</div><div class=\"mdn-code-actions\"><button type=\"button\" class=\"mdn-code-copy\" aria-label=\"Copy code to clipboard\">Copy</button></div></div><pre tabindex=\"0\" data-language=\"md\" data-theme=\"github-dark-dimmed\"><code data-language=\"md\" data-theme=\"github-dark-dimmed\" style=\"display: grid;\"><span data-line=\"\"><span style=\"color:#ADBAC7\">```js example-good</span></span>\n<span data-line=\"\"><span style=\"color:#F47067\">const</span><span style=\"color:#6CB6FF\"> ok</span><span style=\"color:#F47067\"> =</span><span style=\"color:#6CB6FF\"> true</span><span style=\"color:#ADBAC7\">;</span></span>\n<span data-line=\"\"><span style=\"color:#ADBAC7\">```</span></span>\n<span data-line=\"\"> </span>\n<span data-line=\"\"><span style=\"color:#ADBAC7\">```js example-bad</span></span>\n<span data-line=\"\"><span style=\"color:#F47067\">const</span><span style=\"color:#6CB6FF\"> nope</span><span style=\"color:#F47067\"> =</span><span style=\"color:#6CB6FF\"> true</span><span style=\"color:#ADBAC7\">;</span></span>\n<span data-line=\"\"><span style=\"color:#ADBAC7\">```</span></span></code></pre></figure>\n<p>実際の表示例（このページ上で見えるはず）:</p>\n<figure class=\"mdn-code example-good\" data-rehype-pretty-code-figure=\"\"><div class=\"mdn-code-header\"><div class=\"mdn-code-lang\">JS</div><div class=\"mdn-code-actions\"><button type=\"button\" class=\"mdn-code-copy\" aria-label=\"Copy code to clipboard\">Copy</button></div></div><pre tabindex=\"0\" data-language=\"js\" data-theme=\"github-dark-dimmed\"><code data-language=\"js\" data-theme=\"github-dark-dimmed\" style=\"display: grid;\"><span data-line=\"\"><span style=\"color:#F47067\">const</span><span style=\"color:#6CB6FF\"> ok</span><span style=\"color:#F47067\"> =</span><span style=\"color:#6CB6FF\"> true</span></span></code></pre></figure>\n<figure class=\"mdn-code example-bad\" data-rehype-pretty-code-figure=\"\"><div class=\"mdn-code-header\"><div class=\"mdn-code-lang\">JS</div><div class=\"mdn-code-actions\"><button type=\"button\" class=\"mdn-code-copy\" aria-label=\"Copy code to clipboard\">Copy</button></div></div><pre tabindex=\"0\" data-language=\"js\" data-theme=\"github-dark-dimmed\"><code data-language=\"js\" data-theme=\"github-dark-dimmed\" style=\"display: grid;\"><span data-line=\"\"><span style=\"color:#F47067\">const</span><span style=\"color:#6CB6FF\"> nope</span><span style=\"color:#F47067\"> =</span><span style=\"color:#6CB6FF\"> true</span></span></code></pre></figure>\n<br>\n<h3 id=\"hidden非表示\"><span data-rehype-pretty-code-figure=\"\"><code data-language=\"plaintext\" data-theme=\"github-dark-dimmed\"><span data-line=\"\"><span>hidden</span></span></code></span>（非表示）</h3>\n<p><span data-rehype-pretty-code-figure=\"\"><code data-language=\"plaintext\" data-theme=\"github-dark-dimmed\"><span data-line=\"\"><span>hidden</span></span></code></span> を付けたコードブロックは、HTMLに出力されません（表示されません）。</p>\n<figure class=\"mdn-code\" data-rehype-pretty-code-figure=\"\"><div class=\"mdn-code-header\"><div class=\"mdn-code-lang\">MD</div><div class=\"mdn-code-actions\"><button type=\"button\" class=\"mdn-code-copy\" aria-label=\"Copy code to clipboard\">Copy</button></div></div><pre tabindex=\"0\" data-language=\"md\" data-theme=\"github-dark-dimmed\"><code data-language=\"md\" data-theme=\"github-dark-dimmed\" style=\"display: grid;\"><span data-line=\"\"><span style=\"color:#ADBAC7\">```js hidden</span></span>\n<span data-line=\"\"><span style=\"color:#F47067\">const</span><span style=\"color:#6CB6FF\"> secret</span><span style=\"color:#F47067\"> =</span><span style=\"color:#96D0FF\"> \"not shown\"</span><span style=\"color:#ADBAC7\">;</span></span>\n<span data-line=\"\"><span style=\"color:#ADBAC7\">```</span></span></code></pre></figure>\n<br>\n<h2 id=\"メモ警告コールアウトmdnアラート\">メモ/警告/コールアウト（MDNアラート）</h2>\n<p>ブロック引用の先頭行を <span data-rehype-pretty-code-figure=\"\"><code data-language=\"plaintext\" data-theme=\"github-dark-dimmed\"><span data-line=\"\"><span>[!NOTE]</span></span></code></span> / <span data-rehype-pretty-code-figure=\"\"><code data-language=\"plaintext\" data-theme=\"github-dark-dimmed\"><span data-line=\"\"><span>[!WARNING]</span></span></code></span> / <span data-rehype-pretty-code-figure=\"\"><code data-language=\"plaintext\" data-theme=\"github-dark-dimmed\"><span data-line=\"\"><span>[!CALLOUT]</span></span></code></span> にすると、専用のボックスとして描画されます。</p>\n<figure class=\"mdn-code\" data-rehype-pretty-code-figure=\"\"><div class=\"mdn-code-header\"><div class=\"mdn-code-lang\">MD</div><div class=\"mdn-code-actions\"><button type=\"button\" class=\"mdn-code-copy\" aria-label=\"Copy code to clipboard\">Copy</button></div></div><pre tabindex=\"0\" data-language=\"md\" data-theme=\"github-dark-dimmed\"><code data-language=\"md\" data-theme=\"github-dark-dimmed\" style=\"display: grid;\"><span data-line=\"\"><span style=\"color:#8DDB8C\">> [</span><span style=\"color:#96D0FF\">!NOTE</span><span style=\"color:#8DDB8C\">]</span></span>\n<span data-line=\"\"><span style=\"color:#8DDB8C\">> これはメモです。</span></span>\n<span data-line=\"\"> </span>\n<span data-line=\"\"><span style=\"color:#8DDB8C\">> [</span><span style=\"color:#96D0FF\">!WARNING</span><span style=\"color:#8DDB8C\">] 注意</span></span>\n<span data-line=\"\"><span style=\"color:#8DDB8C\">> これは警告です。</span></span>\n<span data-line=\"\"> </span>\n<span data-line=\"\"><span style=\"color:#8DDB8C\">> [</span><span style=\"color:#96D0FF\">!CALLOUT</span><span style=\"color:#8DDB8C\">] タイトル</span></span>\n<span data-line=\"\"><span style=\"color:#8DDB8C\">> これはコールアウトです。</span></span></code></pre></figure>\n<p>実際の表示例:</p>\n<div class=\"notecard note\">\n<p><strong>メモ:</strong> これはメモです。</p>\n</div>\n<div class=\"notecard warning\">\n<p><strong>警告:</strong> 注意\nこれは警告です。</p>\n</div>\n<div class=\"callout\">\n<p><strong>タイトル</strong></p>\n<p>これはコールアウトです。</p>\n</div>\n<br>\n<h2 id=\"定義リストmdn形式\">定義リスト（MDN形式）</h2>\n<p>GFM のリスト構文を変形した、MDN 独自の定義リスト形式に対応しています。</p>\n<figure class=\"mdn-code\" data-rehype-pretty-code-figure=\"\"><div class=\"mdn-code-header\"><div class=\"mdn-code-lang\">MD</div><div class=\"mdn-code-actions\"><button type=\"button\" class=\"mdn-code-copy\" aria-label=\"Copy code to clipboard\">Copy</button></div></div><pre tabindex=\"0\" data-language=\"md\" data-theme=\"github-dark-dimmed\"><code data-language=\"md\" data-theme=\"github-dark-dimmed\" style=\"display: grid;\"><span data-line=\"\"><span style=\"color:#F69D50\">-</span><span style=\"color:#ADBAC7\"> 用語1</span></span>\n<span data-line=\"\"><span style=\"color:#F69D50\">  -</span><span style=\"color:#ADBAC7\"> : 用語1の説明</span></span>\n<span data-line=\"\"> </span>\n<span data-line=\"\"><span style=\"color:#F69D50\">-</span><span style=\"color:#6CB6FF\"> `用語2`</span></span>\n<span data-line=\"\"><span style=\"color:#F69D50\">  -</span><span style=\"color:#ADBAC7\"> : </span><span style=\"color:#ADBAC7;font-weight:bold\">**強調**</span><span style=\"color:#ADBAC7\">も使えます</span></span></code></pre></figure>\n<p>実際の表示例:</p>\n<dl class=\"definition-list\">\n<dt>用語1</dt>\n<dd>\n<p>用語1の説明</p>\n</dd>\n<dt><span data-rehype-pretty-code-figure=\"\"><code data-language=\"plaintext\" data-theme=\"github-dark-dimmed\"><span data-line=\"\"><span>用語2</span></span></code></span></dt>\n<dd>\n<p><strong>強調</strong>も使えます</p>\n</dd>\n</dl>\n<p>制約:</p>\n<ul>\n<li>1つの用語（<span data-rehype-pretty-code-figure=\"\"><code data-language=\"plaintext\" data-theme=\"github-dark-dimmed\"><span data-line=\"\"><span>dt</span></span></code></span>）につき、定義（<span data-rehype-pretty-code-figure=\"\"><code data-language=\"plaintext\" data-theme=\"github-dark-dimmed\"><span data-line=\"\"><span>dd</span></span></code></span>）は1つだけ対応しています（複数 <span data-rehype-pretty-code-figure=\"\"><code data-language=\"plaintext\" data-theme=\"github-dark-dimmed\"><span data-line=\"\"><span>dd</span></span></code></span> は変換しません）。</li>\n</ul>\n<br>\n<h2 id=\"数式katex\">数式（KaTeX）</h2>\n<ul>\n<li>インライン数式: <span data-rehype-pretty-code-figure=\"\"><code data-language=\"plaintext\" data-theme=\"github-dark-dimmed\"><span data-line=\"\"><span>$...$</span></span></code></span>（例: <span data-rehype-pretty-code-figure=\"\"><code data-language=\"plaintext\" data-theme=\"github-dark-dimmed\"><span data-line=\"\"><span>$a^2 + b^2 = c^2$</span></span></code></span>）</li>\n<li>ブロック数式: <span data-rehype-pretty-code-figure=\"\"><code data-language=\"plaintext\" data-theme=\"github-dark-dimmed\"><span data-line=\"\"><span>$$...$$</span></span></code></span></li>\n</ul>\n<p>例:</p>\n<p>インライン: <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msup><mi>a</mi><mn>2</mn></msup><mo>+</mo><msup><mi>b</mi><mn>2</mn></msup><mo>=</mo><msup><mi>c</mi><mn>2</mn></msup></mrow><annotation encoding=\"application/x-tex\">a^2 + b^2 = c^2</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8974em;vertical-align:-0.0833em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">a</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8141em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">b</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8141em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">c</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span></span></span></span></span></span></span></span></p>\n<span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><semantics><mrow><munderover><mo>∑</mo><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mi>n</mi></munderover><mi>i</mi><mo>=</mo><mfrac><mrow><mi>n</mi><mo stretchy=\"false\">(</mo><mi>n</mi><mo>+</mo><mn>1</mn><mo stretchy=\"false\">)</mo></mrow><mn>2</mn></mfrac></mrow><annotation encoding=\"application/x-tex\">\\sum_{i=1}^{n} i = \\frac{n(n+1)}{2}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:2.9291em;vertical-align:-1.2777em;\"></span><span class=\"mop op-limits\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.6514em;\"><span style=\"top:-1.8723em;margin-left:0em;\"><span class=\"pstrut\" style=\"height:3.05em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">i</span><span class=\"mrel mtight\">=</span><span class=\"mord mtight\">1</span></span></span></span><span style=\"top:-3.05em;\"><span class=\"pstrut\" style=\"height:3.05em;\"></span><span><span class=\"mop op-symbol large-op\">∑</span></span></span><span style=\"top:-4.3em;margin-left:0em;\"><span class=\"pstrut\" style=\"height:3.05em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">n</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.2777em;\"><span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord mathnormal\">i</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:2.113em;vertical-align:-0.686em;\"></span><span class=\"mord\"><span class=\"mopen nulldelimiter\"></span><span class=\"mfrac\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.427em;\"><span style=\"top:-2.314em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord\">2</span></span></span><span style=\"top:-3.23em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"frac-line\" style=\"border-bottom-width:0.04em;\"></span></span><span style=\"top:-3.677em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">n</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">n</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mord\">1</span><span class=\"mclose\">)</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.686em;\"><span></span></span></span></span></span><span class=\"mclose nulldelimiter\"></span></span></span></span></span></span>\n<br>\n<h2 id=\"html-をそのまま使う\">HTML をそのまま使う</h2>\n<p>Markdown内に書いた HTML はそのまま通ります（例: <span data-rehype-pretty-code-figure=\"\"><code data-language=\"plaintext\" data-theme=\"github-dark-dimmed\"><span data-line=\"\"><span>&#x3C;br /></span></span></code></span>, <span data-rehype-pretty-code-figure=\"\"><code data-language=\"plaintext\" data-theme=\"github-dark-dimmed\"><span data-line=\"\"><span>&#x3C;div>...&#x3C;/div></span></span></code></span> など）。</p>\n<br>\n<h2 id=\"改行について\">改行について</h2>\n<p>段落内の改行は基本的に <span data-rehype-pretty-code-figure=\"\"><code data-language=\"plaintext\" data-theme=\"github-dark-dimmed\"><span data-line=\"\"><span>&#x3C;br></span></span></code></span> にはなりません（MDN/GFM寄せ）。</p>\n<ul>\n<li>改行したい: 空行で段落を分ける、または <span data-rehype-pretty-code-figure=\"\"><code data-language=\"plaintext\" data-theme=\"github-dark-dimmed\"><span data-line=\"\"><span>&#x3C;br /></span></span></code></span> を明示します。</li>\n</ul>\n<br>\n<h2 id=\"mermaid-ダイアグラム\">Mermaid ダイアグラム</h2>\n<p>コードブロックの言語を <span data-rehype-pretty-code-figure=\"\"><code data-language=\"plaintext\" data-theme=\"github-dark-dimmed\"><span data-line=\"\"><span>mermaid</span></span></code></span> に指定すると、ダイアグラムとして描画されます。</p>\n<br>\n<h3 id=\"フローチャート-flowchart\">フローチャート (flowchart)</h3>\n<p>システムの流れや構成を表現するのに便利です。</p>\n<figure class=\"mdn-code\" data-rehype-pretty-code-figure=\"\"><div class=\"mdn-code-header\"><div class=\"mdn-code-lang\">MD</div><div class=\"mdn-code-actions\"><button type=\"button\" class=\"mdn-code-copy\" aria-label=\"Copy code to clipboard\">Copy</button></div></div><pre tabindex=\"0\" data-language=\"md\" data-theme=\"github-dark-dimmed\"><code data-language=\"md\" data-theme=\"github-dark-dimmed\" style=\"display: grid;\"><span data-line=\"\"><span style=\"color:#ADBAC7\">```mermaid</span></span>\n<span data-line=\"\"><span style=\"color:#ADBAC7\">flowchart TB</span></span>\n<span data-line=\"\"><span style=\"color:#ADBAC7\">    A[開始] --> B{条件分岐}</span></span>\n<span data-line=\"\"><span style=\"color:#ADBAC7\">    B -->|Yes| C[処理1]</span></span>\n<span data-line=\"\"><span style=\"color:#ADBAC7\">    B -->|No| D[処理2]</span></span>\n<span data-line=\"\"><span style=\"color:#ADBAC7\">    C --> E[終了]</span></span>\n<span data-line=\"\"><span style=\"color:#ADBAC7\">    D --> E</span></span>\n<span data-line=\"\"><span style=\"color:#ADBAC7\">```</span></span></code></pre></figure>\n<p>表示例:</p>\n<div class=\"mermaid-block\" data-mermaid=\"flowchart TB\n    A[開始] --> B{条件分岐}\n    B -->|Yes| C[処理1]\n    B -->|No| D[処理2]\n    C --> E[終了]\n    D --> E\"></div>\n<p>フローチャートの方向:</p>\n<ul>\n<li><span data-rehype-pretty-code-figure=\"\"><code data-language=\"plaintext\" data-theme=\"github-dark-dimmed\"><span data-line=\"\"><span>TB</span></span></code></span> (Top to Bottom): 上から下</li>\n<li><span data-rehype-pretty-code-figure=\"\"><code data-language=\"plaintext\" data-theme=\"github-dark-dimmed\"><span data-line=\"\"><span>LR</span></span></code></span> (Left to Right): 左から右</li>\n<li><span data-rehype-pretty-code-figure=\"\"><code data-language=\"plaintext\" data-theme=\"github-dark-dimmed\"><span data-line=\"\"><span>BT</span></span></code></span> (Bottom to Top): 下から上</li>\n<li><span data-rehype-pretty-code-figure=\"\"><code data-language=\"plaintext\" data-theme=\"github-dark-dimmed\"><span data-line=\"\"><span>RL</span></span></code></span> (Right to Left): 右から左</li>\n</ul>\n<p>ノードの形状:</p>\n<ul>\n<li><span data-rehype-pretty-code-figure=\"\"><code data-language=\"plaintext\" data-theme=\"github-dark-dimmed\"><span data-line=\"\"><span>[text]</span></span></code></span>: 四角形</li>\n<li><span data-rehype-pretty-code-figure=\"\"><code data-language=\"plaintext\" data-theme=\"github-dark-dimmed\"><span data-line=\"\"><span>(text)</span></span></code></span>: 角丸四角形</li>\n<li><span data-rehype-pretty-code-figure=\"\"><code data-language=\"plaintext\" data-theme=\"github-dark-dimmed\"><span data-line=\"\"><span>{text}</span></span></code></span>: ひし形（条件分岐）</li>\n<li><span data-rehype-pretty-code-figure=\"\"><code data-language=\"plaintext\" data-theme=\"github-dark-dimmed\"><span data-line=\"\"><span>((text))</span></span></code></span>: 円形</li>\n<li><span data-rehype-pretty-code-figure=\"\"><code data-language=\"plaintext\" data-theme=\"github-dark-dimmed\"><span data-line=\"\"><span>[[text]]</span></span></code></span>: サブルーチン</li>\n</ul>\n<br>\n<h3 id=\"サブグラフ-subgraph\">サブグラフ (subgraph)</h3>\n<p>関連する要素をグループ化できます。</p>\n<figure class=\"mdn-code\" data-rehype-pretty-code-figure=\"\"><div class=\"mdn-code-header\"><div class=\"mdn-code-lang\">MD</div><div class=\"mdn-code-actions\"><button type=\"button\" class=\"mdn-code-copy\" aria-label=\"Copy code to clipboard\">Copy</button></div></div><pre tabindex=\"0\" data-language=\"md\" data-theme=\"github-dark-dimmed\"><code data-language=\"md\" data-theme=\"github-dark-dimmed\" style=\"display: grid;\"><span data-line=\"\"><span style=\"color:#ADBAC7\">```mermaid</span></span>\n<span data-line=\"\"><span style=\"color:#ADBAC7\">flowchart TB</span></span>\n<span data-line=\"\"><span style=\"color:#ADBAC7\">    subgraph Frontend[\"フロントエンド\"]</span></span>\n<span data-line=\"\"><span style=\"color:#ADBAC7\">        React[React]</span></span>\n<span data-line=\"\"><span style=\"color:#ADBAC7\">        Router[React Router]</span></span>\n<span data-line=\"\"><span style=\"color:#ADBAC7\">    end</span></span>\n<span data-line=\"\"> </span>\n<span data-line=\"\"><span style=\"color:#ADBAC7\">    subgraph Backend[\"バックエンド\"]</span></span>\n<span data-line=\"\"><span style=\"color:#ADBAC7\">        API[API Server]</span></span>\n<span data-line=\"\"><span style=\"color:#ADBAC7\">        DB[(Database)]</span></span>\n<span data-line=\"\"><span style=\"color:#ADBAC7\">    end</span></span>\n<span data-line=\"\"> </span>\n<span data-line=\"\"><span style=\"color:#ADBAC7\">    React --> API</span></span>\n<span data-line=\"\"><span style=\"color:#ADBAC7\">    API --> DB</span></span>\n<span data-line=\"\"><span style=\"color:#ADBAC7\">```</span></span></code></pre></figure>\n<p>表示例:</p>\n<div class=\"mermaid-block\" data-mermaid=\"flowchart TB\n    subgraph Frontend[&#x22;フロントエンド&#x22;]\n        React[React]\n        Router[React Router]\n    end\n\n    subgraph Backend[&#x22;バックエンド&#x22;]\n        API[API Server]\n        DB[(Database)]\n    end\n\n    React --> API\n    API --> DB\"></div>\n<br>\n<h3 id=\"シーケンス図-sequencediagram\">シーケンス図 (sequenceDiagram)</h3>\n<p>処理の流れや通信を時系列で表現できます。</p>\n<figure class=\"mdn-code\" data-rehype-pretty-code-figure=\"\"><div class=\"mdn-code-header\"><div class=\"mdn-code-lang\">MD</div><div class=\"mdn-code-actions\"><button type=\"button\" class=\"mdn-code-copy\" aria-label=\"Copy code to clipboard\">Copy</button></div></div><pre tabindex=\"0\" data-language=\"md\" data-theme=\"github-dark-dimmed\"><code data-language=\"md\" data-theme=\"github-dark-dimmed\" style=\"display: grid;\"><span data-line=\"\"><span style=\"color:#ADBAC7\">```mermaid</span></span>\n<span data-line=\"\"><span style=\"color:#ADBAC7\">sequenceDiagram</span></span>\n<span data-line=\"\"><span style=\"color:#ADBAC7\">    participant U as User</span></span>\n<span data-line=\"\"><span style=\"color:#ADBAC7\">    participant C as Client</span></span>\n<span data-line=\"\"><span style=\"color:#ADBAC7\">    participant S as Server</span></span>\n<span data-line=\"\"> </span>\n<span data-line=\"\"><span style=\"color:#ADBAC7\">    U->>C: ボタンクリック</span></span>\n<span data-line=\"\"><span style=\"color:#ADBAC7\">    C->>S: APIリクエスト</span></span>\n<span data-line=\"\"><span style=\"color:#ADBAC7\">    S-->>C: レスポンス</span></span>\n<span data-line=\"\"><span style=\"color:#ADBAC7\">    C-->>U: 結果表示</span></span>\n<span data-line=\"\"><span style=\"color:#ADBAC7\">```</span></span></code></pre></figure>\n<p>表示例:</p>\n<div class=\"mermaid-block\" data-mermaid=\"sequenceDiagram\n    participant U as User\n    participant C as Client\n    participant S as Server\n\n    U->>C: ボタンクリック\n    C->>S: APIリクエスト\n    S-->>C: レスポンス\n    C-->>U: 結果表示\"></div>\n<p>矢印の種類:</p>\n<ul>\n<li><span data-rehype-pretty-code-figure=\"\"><code data-language=\"plaintext\" data-theme=\"github-dark-dimmed\"><span data-line=\"\"><span>->></span></span></code></span>: 実線矢印（同期メッセージ）</li>\n<li><span data-rehype-pretty-code-figure=\"\"><code data-language=\"plaintext\" data-theme=\"github-dark-dimmed\"><span data-line=\"\"><span>-->></span></span></code></span>: 点線矢印（応答）</li>\n<li><span data-rehype-pretty-code-figure=\"\"><code data-language=\"plaintext\" data-theme=\"github-dark-dimmed\"><span data-line=\"\"><span>-x</span></span></code></span>: 非同期メッセージ</li>\n<li><span data-rehype-pretty-code-figure=\"\"><code data-language=\"plaintext\" data-theme=\"github-dark-dimmed\"><span data-line=\"\"><span>--x</span></span></code></span>: 非同期応答</li>\n</ul>\n<br>\n<h3 id=\"状態遷移図-statediagram-v2\">状態遷移図 (stateDiagram-v2)</h3>\n<p>状態の変化を表現できます。</p>\n<figure class=\"mdn-code\" data-rehype-pretty-code-figure=\"\"><div class=\"mdn-code-header\"><div class=\"mdn-code-lang\">MD</div><div class=\"mdn-code-actions\"><button type=\"button\" class=\"mdn-code-copy\" aria-label=\"Copy code to clipboard\">Copy</button></div></div><pre tabindex=\"0\" data-language=\"md\" data-theme=\"github-dark-dimmed\"><code data-language=\"md\" data-theme=\"github-dark-dimmed\" style=\"display: grid;\"><span data-line=\"\"><span style=\"color:#ADBAC7\">```mermaid</span></span>\n<span data-line=\"\"><span style=\"color:#ADBAC7\">stateDiagram-v2</span></span>\n<span data-line=\"\"><span style=\"color:#ADBAC7\">    [*] --> Idle</span></span>\n<span data-line=\"\"><span style=\"color:#ADBAC7\">    Idle --> Loading: データ取得開始</span></span>\n<span data-line=\"\"><span style=\"color:#ADBAC7\">    Loading --> Success: 成功</span></span>\n<span data-line=\"\"><span style=\"color:#ADBAC7\">    Loading --> Error: 失敗</span></span>\n<span data-line=\"\"><span style=\"color:#ADBAC7\">    Success --> Idle: リセット</span></span>\n<span data-line=\"\"><span style=\"color:#ADBAC7\">    Error --> Idle: リトライ</span></span>\n<span data-line=\"\"><span style=\"color:#ADBAC7\">```</span></span></code></pre></figure>\n<p>表示例:</p>\n<div class=\"mermaid-block\" data-mermaid=\"stateDiagram-v2\n    [*] --> Idle\n    Idle --> Loading: データ取得開始\n    Loading --> Success: 成功\n    Loading --> Error: 失敗\n    Success --> Idle: リセット\n    Error --> Idle: リトライ\"></div>\n<ul>\n<li><span data-rehype-pretty-code-figure=\"\"><code data-language=\"plaintext\" data-theme=\"github-dark-dimmed\"><span data-line=\"\"><span>[*]</span></span></code></span>: 開始/終了状態</li>\n<li><span data-rehype-pretty-code-figure=\"\"><code data-language=\"plaintext\" data-theme=\"github-dark-dimmed\"><span data-line=\"\"><span>--></span></span></code></span>: 遷移</li>\n<li><span data-rehype-pretty-code-figure=\"\"><code data-language=\"plaintext\" data-theme=\"github-dark-dimmed\"><span data-line=\"\"><span>: ラベル</span></span></code></span>: 遷移条件/イベント</li>\n</ul>\n<br>\n<h3 id=\"クラス図-classdiagram\">クラス図 (classDiagram)</h3>\n<p>オブジェクト指向設計を表現できます。</p>\n<figure class=\"mdn-code\" data-rehype-pretty-code-figure=\"\"><div class=\"mdn-code-header\"><div class=\"mdn-code-lang\">MD</div><div class=\"mdn-code-actions\"><button type=\"button\" class=\"mdn-code-copy\" aria-label=\"Copy code to clipboard\">Copy</button></div></div><pre tabindex=\"0\" data-language=\"md\" data-theme=\"github-dark-dimmed\"><code data-language=\"md\" data-theme=\"github-dark-dimmed\" style=\"display: grid;\"><span data-line=\"\"><span style=\"color:#ADBAC7\">```mermaid</span></span>\n<span data-line=\"\"><span style=\"color:#ADBAC7\">classDiagram</span></span>\n<span data-line=\"\"><span style=\"color:#ADBAC7\">    class User {</span></span>\n<span data-line=\"\"><span style=\"color:#ADBAC7\">        +String name</span></span>\n<span data-line=\"\"><span style=\"color:#ADBAC7\">        +String email</span></span>\n<span data-line=\"\"><span style=\"color:#ADBAC7\">        +login()</span></span>\n<span data-line=\"\"><span style=\"color:#ADBAC7\">        +logout()</span></span>\n<span data-line=\"\"><span style=\"color:#ADBAC7\">    }</span></span>\n<span data-line=\"\"> </span>\n<span data-line=\"\"><span style=\"color:#ADBAC7\">    class Post {</span></span>\n<span data-line=\"\"><span style=\"color:#ADBAC7\">        +String title</span></span>\n<span data-line=\"\"><span style=\"color:#ADBAC7\">        +String content</span></span>\n<span data-line=\"\"><span style=\"color:#ADBAC7\">        +publish()</span></span>\n<span data-line=\"\"><span style=\"color:#ADBAC7\">    }</span></span>\n<span data-line=\"\"> </span>\n<span data-line=\"\"><span style=\"color:#ADBAC7\">    User \"1\" --> \"*\" Post: 投稿する</span></span>\n<span data-line=\"\"><span style=\"color:#ADBAC7\">```</span></span></code></pre></figure>\n<p>表示例:</p>\n<div class=\"mermaid-block\" data-mermaid=\"classDiagram\n    class User {\n        +String name\n        +String email\n        +login()\n        +logout()\n    }\n\n    class Post {\n        +String title\n        +String content\n        +publish()\n    }\n\n    User &#x22;1&#x22; --> &#x22;*&#x22; Post: 投稿する\"></div>\n<br>\n<h3 id=\"er図-erdiagram\">ER図 (erDiagram)</h3>\n<p>データベース設計を表現できます。</p>\n<figure class=\"mdn-code\" data-rehype-pretty-code-figure=\"\"><div class=\"mdn-code-header\"><div class=\"mdn-code-lang\">MD</div><div class=\"mdn-code-actions\"><button type=\"button\" class=\"mdn-code-copy\" aria-label=\"Copy code to clipboard\">Copy</button></div></div><pre tabindex=\"0\" data-language=\"md\" data-theme=\"github-dark-dimmed\"><code data-language=\"md\" data-theme=\"github-dark-dimmed\" style=\"display: grid;\"><span data-line=\"\"><span style=\"color:#ADBAC7\">```mermaid</span></span>\n<span data-line=\"\"><span style=\"color:#ADBAC7\">erDiagram</span></span>\n<span data-line=\"\"><span style=\"color:#ADBAC7\">    USER ||--o{ POST : writes</span></span>\n<span data-line=\"\"><span style=\"color:#ADBAC7\">    POST ||--|{ TAG : has</span></span>\n<span data-line=\"\"> </span>\n<span data-line=\"\"><span style=\"color:#ADBAC7\">    USER {</span></span>\n<span data-line=\"\"><span style=\"color:#ADBAC7\">        int id PK</span></span>\n<span data-line=\"\"><span style=\"color:#ADBAC7\">        string name</span></span>\n<span data-line=\"\"><span style=\"color:#ADBAC7\">        string email</span></span>\n<span data-line=\"\"><span style=\"color:#ADBAC7\">    }</span></span>\n<span data-line=\"\"> </span>\n<span data-line=\"\"><span style=\"color:#ADBAC7\">    POST {</span></span>\n<span data-line=\"\"><span style=\"color:#ADBAC7\">        int id PK</span></span>\n<span data-line=\"\"><span style=\"color:#ADBAC7\">        string title</span></span>\n<span data-line=\"\"><span style=\"color:#ADBAC7\">        text content</span></span>\n<span data-line=\"\"><span style=\"color:#ADBAC7\">        int user_id FK</span></span>\n<span data-line=\"\"><span style=\"color:#ADBAC7\">    }</span></span>\n<span data-line=\"\"> </span>\n<span data-line=\"\"><span style=\"color:#ADBAC7\">    TAG {</span></span>\n<span data-line=\"\"><span style=\"color:#ADBAC7\">        int id PK</span></span>\n<span data-line=\"\"><span style=\"color:#ADBAC7\">        string name</span></span>\n<span data-line=\"\"><span style=\"color:#ADBAC7\">    }</span></span>\n<span data-line=\"\"><span style=\"color:#ADBAC7\">```</span></span></code></pre></figure>\n<p>表示例:</p>\n<div class=\"mermaid-block\" data-mermaid=\"erDiagram\n    USER ||--o{ POST : writes\n    POST ||--|{ TAG : has\n\n    USER {\n        int id PK\n        string name\n        string email\n    }\n\n    POST {\n        int id PK\n        string title\n        text content\n        int user_id FK\n    }\n\n    TAG {\n        int id PK\n        string name\n    }\"></div>\n<p>関係の記法:</p>\n<ul>\n<li><span data-rehype-pretty-code-figure=\"\"><code data-language=\"plaintext\" data-theme=\"github-dark-dimmed\"><span data-line=\"\"><span>||--||</span></span></code></span>: 1対1</li>\n<li><span data-rehype-pretty-code-figure=\"\"><code data-language=\"plaintext\" data-theme=\"github-dark-dimmed\"><span data-line=\"\"><span>||--o{</span></span></code></span>: 1対多（0以上）</li>\n<li><span data-rehype-pretty-code-figure=\"\"><code data-language=\"plaintext\" data-theme=\"github-dark-dimmed\"><span data-line=\"\"><span>||--|{</span></span></code></span>: 1対多（1以上）</li>\n<li><span data-rehype-pretty-code-figure=\"\"><code data-language=\"plaintext\" data-theme=\"github-dark-dimmed\"><span data-line=\"\"><span>}o--o{</span></span></code></span>: 多対多</li>\n</ul>\n<br>\n<h3 id=\"円グラフ-pie\">円グラフ (pie)</h3>\n<p>割合を可視化できます。</p>\n<figure class=\"mdn-code\" data-rehype-pretty-code-figure=\"\"><div class=\"mdn-code-header\"><div class=\"mdn-code-lang\">MD</div><div class=\"mdn-code-actions\"><button type=\"button\" class=\"mdn-code-copy\" aria-label=\"Copy code to clipboard\">Copy</button></div></div><pre tabindex=\"0\" data-language=\"md\" data-theme=\"github-dark-dimmed\"><code data-language=\"md\" data-theme=\"github-dark-dimmed\" style=\"display: grid;\"><span data-line=\"\"><span style=\"color:#ADBAC7\">```mermaid</span></span>\n<span data-line=\"\"><span style=\"color:#ADBAC7\">pie title 言語の使用率</span></span>\n<span data-line=\"\"><span style=\"color:#ADBAC7\">    \"TypeScript\" : 45</span></span>\n<span data-line=\"\"><span style=\"color:#ADBAC7\">    \"JavaScript\" : 30</span></span>\n<span data-line=\"\"><span style=\"color:#ADBAC7\">    \"Python\" : 15</span></span>\n<span data-line=\"\"><span style=\"color:#ADBAC7\">    \"その他\" : 10</span></span>\n<span data-line=\"\"><span style=\"color:#ADBAC7\">```</span></span></code></pre></figure>\n<p>表示例:</p>\n<div class=\"mermaid-block\" data-mermaid=\"pie title 言語の使用率\n    &#x22;TypeScript&#x22; : 45\n    &#x22;JavaScript&#x22; : 30\n    &#x22;Python&#x22; : 15\n    &#x22;その他&#x22; : 10\"></div>\n<br>\n<h3 id=\"スタイルのカスタマイズ\">スタイルのカスタマイズ</h3>\n<p>ノードにスタイルを適用できます。</p>\n<figure class=\"mdn-code\" data-rehype-pretty-code-figure=\"\"><div class=\"mdn-code-header\"><div class=\"mdn-code-lang\">MD</div><div class=\"mdn-code-actions\"><button type=\"button\" class=\"mdn-code-copy\" aria-label=\"Copy code to clipboard\">Copy</button></div></div><pre tabindex=\"0\" data-language=\"md\" data-theme=\"github-dark-dimmed\"><code data-language=\"md\" data-theme=\"github-dark-dimmed\" style=\"display: grid;\"><span data-line=\"\"><span style=\"color:#ADBAC7\">```mermaid</span></span>\n<span data-line=\"\"><span style=\"color:#ADBAC7\">flowchart LR</span></span>\n<span data-line=\"\"><span style=\"color:#ADBAC7\">    A[通常] --> B[強調]</span></span>\n<span data-line=\"\"><span style=\"color:#ADBAC7\">    B --> C[薄い]</span></span>\n<span data-line=\"\"> </span>\n<span data-line=\"\"><span style=\"color:#ADBAC7\">    style B fill:#134e4a,stroke:#5eead4,stroke-width:2px</span></span>\n<span data-line=\"\"><span style=\"color:#ADBAC7\">    style C opacity:0.5</span></span>\n<span data-line=\"\"><span style=\"color:#ADBAC7\">```</span></span></code></pre></figure>\n<p>表示例:</p>\n<div class=\"mermaid-block\" data-mermaid=\"flowchart LR\n    A[通常] --> B[強調]\n    B --> C[薄い]\n\n    style B fill:#134e4a,stroke:#5eead4,stroke-width:2px\n    style C opacity:0.5\"></div>\n<br>"
  },
  {
    "slug": "first_blog",
    "title": "ReactでWebサイトを実装した",
    "summary": "Vite + React + Tailwindで個人サイトを作った",
    "createdAt": "2025-11-30",
    "tags": [
      "React",
      "Tailwind",
      "Vite"
    ],
    "html": "<p>ReactでWebサイトを作りました。けっこう大変だった。</p>\n<p>大変だったところはいろいろある。</p>\n<ul>\n<li>全く触ったことがないTypescriptやTailwind.cssなどの学習を１からやったこと</li>\n<li>フロントエンドのUIデザイン</li>\n<li>バックエンドの動的実装</li>\n<li>絶対量としての作業時間の確保</li>\n</ul>\n<div style=\"text-align: right;\">\netc......\n</div>\n<br>\nこの記事では、上記の大変だったことについてと、このサイトの軽い仕様を書いていこうと思う。\n<br><br>\n<h2 id=\"目次\">目次</h2>\n<div class=\"toc-box\"><ul>\n<li><a href=\"#%E5%85%A8%E3%81%8F%E8%A7%A6%E3%81%A3%E3%81%9F%E3%81%93%E3%81%A8%E3%81%8C%E3%81%AA%E3%81%84typescript%E3%82%84tailwindcss%E3%81%AA%E3%81%A9%E3%81%AE%E6%A7%8B%E6%96%87%E3%81%AE%E5%AD%A6%E7%BF%92\">全く触ったことがないTypescriptやTailwind.cssなどの構文の学習</a></li>\n<li><a href=\"#%E3%83%95%E3%83%AD%E3%83%B3%E3%83%88%E3%82%A8%E3%83%B3%E3%83%89%E3%81%AEui%E3%83%87%E3%82%B6%E3%82%A4%E3%83%B3\">フロントエンドのUIデザイン</a></li>\n<li><a href=\"#%E3%83%90%E3%83%83%E3%82%AF%E3%82%A8%E3%83%B3%E3%83%89%E3%81%AE%E5%8B%95%E7%9A%84%E5%AE%9F%E8%A3%85%E3%81%A8%E9%9D%99%E7%9A%84%E5%AE%9F%E8%A3%85%E3%81%AE%E3%83%AB%E3%83%BC%E3%83%86%E3%82%A3%E3%83%B3%E3%82%B0%E5%88%86%E3%81%91\">バックエンドの動的実装と静的実装のルーティング分け</a></li>\n<li><a href=\"#%E7%B5%B6%E5%AF%BE%E9%87%8F%E3%81%A8%E3%81%97%E3%81%A6%E3%81%AE%E4%BD%9C%E6%A5%AD%E6%99%82%E9%96%93%E3%81%AE%E7%A2%BA%E4%BF%9D\">絶対量としての作業時間の確保</a></li>\n</ul></div>\n<br>\n<h3 id=\"全く触ったことがないtypescriptやtailwindcssなどの構文の学習\">全く触ったことがないTypescriptやTailwind.cssなどの構文の学習</h3>\n<p>そもそもWeb開発自体初めてだったので、TypescriptやTailwind.CSSはおろか、Javascriptや普通のCSSの記法ですら知らない状態で制作を始めた。情報系を専攻する学生として恥ずかしいことだが、そもそも大学すらも上手く通えていないため、もはやそれどころではない。TypescriptはJavaScriptの静的型付け言語版だということを学習の過程で知ったが、逆になぜ今まで動的型付けでやってたんだ・・・・・？と不思議に思ったりした（本当になぜ？）。曖昧さ回避のために普通に静的型付けの方が分かりやすくて明快で良いんじゃない？って思った。実際Typescriptの構文は非常に明快でわかりやすいと思う。<br>\r\nまずWebサイトを作るに当たって以下のコマンドでviteを使ってプロジェクトをサクッと作って</p>\n<figure class=\"mdn-code\" data-rehype-pretty-code-figure=\"\"><div class=\"mdn-code-header\"><div class=\"mdn-code-lang\">PowerShell</div><div class=\"mdn-code-actions\"><button type=\"button\" class=\"mdn-code-copy\" aria-label=\"Copy code to clipboard\">Copy</button></div></div><pre tabindex=\"0\" data-language=\"powershell\" data-theme=\"github-dark-dimmed\"><code data-language=\"powershell\" data-theme=\"github-dark-dimmed\" style=\"display: grid;\"><span data-line=\"\"><span style=\"color:#ADBAC7\">npm create vite@latest</span></span></code></pre></figure>\n<p>Typescript使います～とか、React使います～みたいなのを選択したらプロジェクトがディレクトリ直下に作られる。最初は後学のためにNext.jsで実装しようと考えていたが、先輩のプログラマーからNext.jsは個人サイトの実装にはオーバーだと言われて、viteをオススメされたのでそれを使うことにした。ビルドがめっちゃ早いし、開発がスムーズに進んだ。</p>\n<p>正直サイトの大枠のプログラムはCodexが考えてくれるから、コーディング面でなにか困ったみたいなのはなかった。やりたいことを言えば大抵応えてくれる。すごい時代だ。Typescriptのコードの記法やらTailwind.cssのクラスの書き方やらは調べながら、Google先生に頼りつつ書いた。ReactはClassNameにコンポーネントの見た目とかをまとめて指定できるからめっちゃ楽だなって思った。Codexに書かせた部分のコードも全部ChatGPTに読ませて理解したつもりだ。非常にWeb開発の勉強になった。<br><br></p>\n<h3 id=\"フロントエンドのuiデザイン\">フロントエンドのUIデザイン</h3>\n<p>正直サイトの作り方なんて全くわからなかったので、最初はCodex CLIにフロントエンドをすべて作らせようと考えていた。実際に生成させたらとりあえず全部詰め込みましたみたいな欲張り全部のせラーメンみたいな最悪のUIのものが出力されて、これはUIデザインでは使い物にならないと悟った。\r\n静的サイトの実装だったので、基本的にはフロントエンドが綺麗に整っていればいいと思ったのでフロントUIを入念に練ることにした。いろんな人の個人サイトとかWebサイトをリファレンスにしつつ、あとは直感でデザインした。操作しやすい機能美のあるサイトになっていれば良いなと思う。\r\nフォントはAdobe CCに加入していたのでAdobe Fontsを利用した。Adobe Fontsだとローカルにフォントファイルを置けなくて（DLできなくて）サイトのロードに時間がかかるという問題が発生したので、先にフォント配信サーバへのDNSの名前解決とかを済ませておいてなるべく早くAdobe Fontsからフォントを取得できるようにしたりした。あとフォントが読み込めていない間は既存のフォントにフォールバックするようにした。あとはこのサイトはCloudflareでデプロイされているんだけど、Cloudflareがキャッシュを取ってページの読み込みを高速にしてくれているらしい。他にもいろいろ工夫をした。あんまり言い過ぎても面白くないのでこの程度にしておこうと思う。あ、色とかこだわったよ。あとライトモードとダークモードに対応しているよ。<br><br></p>\n<h3 id=\"バックエンドの動的実装と静的実装のルーティング分け\">バックエンドの動的実装と静的実装のルーティング分け</h3>\n<p>本当は動的実装なんてやるつもりなかったんだけど、なんとなくサイトのアクセスカウンターを実装したくなって、動的な処理をクラウドサーバー（Cloudflare）側でやらなきゃいけなくなった。Cloudflare WorkerっていうのとCloudflare KVというのを使って実装した。KVは名前空間というデータを置いとく場所を構築できるCloudflareの機能で、WorkerとKVをBindingすることでWorkerからデータにアクセスできるようになる。Workerはサーバー上にAPIのエンドポイントを立てることができて、フロント側でそのエンドポイントを叩いてあげて、JSONで合計PVを返して、それを受け取ったWorkerがKVに値を保存するという感じになっている。静的部分はCloudflare Pagesでデプロイしていて、使ってるドメインをいい感じにルーティングする必要があった。最初は同じく静的部分をWorkerでデプロイしていたんだけど、Workerだと特定のURLを直接叩いたときにindex.htmlをフォールバックするようにリダイレクトさせると、なぜか「無限ループになってますよ！」というビルドエラーが出て一生ビルドができなかった。Pagesでデプロイしたら一瞬でビルドできたので最悪だった。なぜindex.htmlをフォールバックさせる必要があったのかというと、「react-routerのルーティング設定だけをしてサーバー側に静的リソースの存在しないページに直接URLで指定してアクセスすると 404 Error になってアクセスできなくなる」という現象が発生したから。今回は<span data-rehype-pretty-code-figure=\"\"><code data-language=\"plaintext\" data-theme=\"github-dark-dimmed\"><span data-line=\"\"><span>react-router-dom</span></span></code></span>でサイトをルーティングしたんだけど、それだけだとルーティング先のURLを直接叩く場合動かないらしい。めんどくさすぎる。<br><br></p>\n<h3 id=\"絶対量としての作業時間の確保\">絶対量としての作業時間の確保</h3>\n<p>（執筆途中）</p>"
  }
]